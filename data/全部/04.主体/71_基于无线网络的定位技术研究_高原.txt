第一章绪论
1.1研究背景及意义
在移动互联网时代，涌现出大量基于位置的服务（Location Based Service, LBS）,它们包括但不限于急救服务，天气预报，社交网络，广告投放，导航和地 图等.它们为人们的生活带来了极大的便利，吸引了海量的用户，创造了巨大的 价值。据报道，2016年12月，腾讯位置服务团队宣布其定位服务日均调用量已 突破500亿次，峰值突破520亿次，覆盖用户数6.8亿，平均每个用户每天调用 位置服务73次内，可见用户对于基于位置的服务的庞大需求。根据ITU-R
（International Telecommunication Union - Radio Communication Sector, 国际电信 联盟无线电通信部门）的 IM「2020（ Inemational Mobile Telecommunications - 2020, 国际移动通信-2020）规划，可以预见在5G （5thGeneration,第五代通信）时代， 在诸如 VR （Virtual Reality,虚拟现实）/AR （AugmentedReality,增强现实）等 eMBB （enlianced Mobile Broadband,演进的移动宽带）场景中，基于位置的服务 将在现有基础上得到进一步发展，例如车联网（Vehicle to X,V2X）和物联网
（Internet of Things, loT）等 URLLC （Ultra-Reliable Low Latency Communication, 低延迟高可靠）场景和mMTC （massive Machine-Type Communication,海量机器 间通信）场景可能会为基于位置的服务开创新的发展空间。
作为基于位置的服务的支撑条件，需要终端具有估计其位置的能力，即无线 定位能力。未来新兴的基于位置的应用会给无线定位技术提出更高的要求，例如 需要更为精确的定位能力，误差在米级别及以下；更低的复杂程度，能够实时定 位，并且跟踪用户的位置；泛在的定位能力，在室内，地下室等多种场景支持定 位服务。
一些专用的定位系统的出现一定程度上满足了现阶段的定位需求，例如全球 卫星定位系统（Global Positioning Systems, GPS）。此外在一些商用通信系统中， 也加入了对无线定位能力的支持，以期望满足定位需求，例如在3GPP （3rd Generation Partnership Project,第三代合作伙伴计划）规定的定位服务（Location Service. LCS）, IEEE （Institute ofElectrical and Electronics Engine,国际电气电子 工程师协会）对ZigBee （BP IEEE802.15.4）物理层的扩展IEEE802.15.4a。但是 这些系统对于新兴的基于位置的服务提出的要求还有一定差距。
在上述背景下，无线定位技术的研究目前是学术界和产业界的热点话题之一, 被广泛讨论。无线定位技术本身是一项系统技术，涉及传感器网络，信号检测与估计，位置估计与跟踪等诸多领域，也需要对相关分系统技术进行改进和优化， 以满足定位技术的需求。
1.2无线定位技术概述
1.2.1	无线定位技术基本原理
无线定位技术是指利用无线信号的某一种或者某些特征对其某一终端的位 置进行估计的技术，这里的位置信息可以是经纬度，坐标或者地址等完备信息， 也可以是距离范围和角度等不完备的信息，也可以包括位置的导出量如速度等。 在无线传感器网络研究中，该无线信号的发射机也可以被称为信号源，接收机也 可以被称为传感器。该终端可以是通信设备，也可以是专用设备，也被称为目标 节点，系统中其他节点称为非目标节点。目标终端可以是信号源，也可以是传感 器。因为无线定位技术涉及发射机和接收机，并且有时需要发送定位报文，因此 常常和无线通信系统结合在一起。由下文叙述可知，无线定位有着多种方式，在 某种特定场景下的具体选择需要综合考虑到复杂度，精度和应用环境等因素 1.2.2无线定位技术分类
无线定位技术按照不同的准则有着不同的分类。按照定位依据划分，主要可 以分为基于测距(ranging)的定位技术，基于位置指纹(fingerprint)的定位技术 和基于连接性(connectivity)的定位技术；按无线信号的发射和接收方式主要可 以分为单边方式(unilateral),也称为无源模式，和多边方式(multilateral),也称 为有源模式；按照非目标节点的位置主要可以分为基于卫星星座(satellite constellation)的定位技术，基于网络(network)的定位技术等⑶。
基于测距的定位首先认为一些非目标节点的位置是已知或者可知的，通过诸 如到达时间(Time of Arrival, ToA),到达时间差(Time difference of Arrival, TDOA ) 和到达角(Angle of Arrival, AoA) /到达方位(Direction of Arrival, DoA)等信 号特征中的一种或几种来确定目标和信号源的相对位置，然后再根据几何学通过 如三角定位(trilateration)或多点定位(multilateration)等方法确定该目标的位 置。基于位置指纹的定位不关心非目标节点的确切位置，将接收到信号的某些特 征，如参考信号功率(Received Signal Strength, RSS)等，和预先建立的数据库 中的记录进行比对，从而得出对目标位置信息的估计。基于连接性的定位利用一 些模糊的距离信息，例如检测目标是否位于信号源的无线覆盖范围之内，将目标 的位置估计在无线覆盖的区域之内，或者利用跳数(hop)作为参考。
单边方式中目标终端是传感器，非目标节点是信号源，多边方式中目标终端 是信号源，非目标节点是传感器。单边方式中目标终端可以处于无线电静默状态,
2
具有一定的隐蔽性。在多边方式中，可以对目标进行秘密踉踪，为了保证定位服 务范围，需要目标终端具有一定的发射功率。
基于卫星星座的定位技术是指非目标节点固定在卫星上，卫星星座具有信号 覆盖广，信道简单等优势，但在城市或者室内覆盖不足。基于网络的定位中的网 络一般指现有的通信网络如WLAN （ Wireless Local Area Network,无线局域网）， 蜂窝网络或者自组织网络如ZigBee网络，非目标节点位于这些网络中。此外， 非目标节点也可以是专用的无线信号源，它们也被称为信标（beacon）。
现有的无线定位技术可以属于上述分类中的一种或者几种，例如GPS是一 种单边的基于卫星星座和测距的定位技术，而第一代的北斗卫星导航系统
（BEIDOU）是多边的基于卫星和测距的定位技术。
1.2.3实用无线定位系统简介
1.2.3.1	GPS
GPS是无线定位技术的典型代表，它即使通过非常长距离的无线链路（卫星 -地面链路）也能够达到相当高的精度（在开阔天空下，有GPS的智能手机的典 型精度是半径4.9m[3]）。它可以为地球表面绝大部分地区提供服务，除了定位服 务，还能够提供授时和导航服务。高级用户也可以通过双频接收或者其他增强系 统（如实时动态技术，Real Time Kinematic, RTK）达到厘米级的精度。但它也不 是一个万能的解决方案,在某些应用场景下,GPS是昂贵和复杂的,而且功耗高， 尺寸大。此外，由于多径衰落和卫星峡谷等现象的影响，在室内或者城市，GPS 的定位精度将会显著下降。
GPS系统主要包括空间段（SpaceSegment, SS）,即空间星座部分，控制段 （Control Segment, CS）,即地面监控部分和用户段（User Segment, US）,即用 户设备部分。其中空间段最初被设计为包括24颗人造卫星，其中21颗是工作卫 星，3颗作为备份卫星，它们都位于轨道半径大约为26600Km的中距离圆形轨 道。24颗卫星均匀分布在6个轨道平面上，每个轨道平面有4颗卫星。轨道平 面交角的设计保证在全球的任意时刻，任意地点至少能够观测到4颗卫星。截至 2016年2月，GPS星座已经包括32颗卫星，其中31颗在使用中。这些附加的 卫星通过向接收机提供冗余的测量量来改进精度。控制段包括1个主控站，4个 数据注入站和6个监测站。主控站位于美国某空军基地，是整个地面监控系统的 管理中心和技术中心，还有一个备用的主控站。数据注入站负责同步卫星上的原 子钟，更新每个卫星的轨道模型对应的星历。监测站和其他一些共享的第三方监 测站负责跟踪卫星的飞行路径。因为存在着卫星漂移现象，长期以往会导致定位 精度下降。监测站会跟踪卫星的轨道，当发生卫星漂移时，系统将它标记为“不 健康”，使接收机不会使用这颗卫星作为参考，然后根据新的轨道，上传对应星
3
历，重新标记为“健康”后，才能够使用。用户段由大量的军用和民用GPS接收 机组成。GPS接收机由天线，处理器和高精度时钟组成。一个接收机能够处理的 通道数是指它能够同时监测的卫星数量，在2007年，一个典型的接收机能够处 理12-20个通道。
GPS卫星发送的导航信号采用扩频调制，不同卫星之间采用CDMA （Code Division Multiple Access,码分多址）的方式多址。这些导航信号编码了卫星位置， 内部时钟状态和网络健康程度等信息，这些信息称为导航报文。系统采用了两种 不同的GOLD伪随机码来编码，分别称为C/A （Coarse/Acquisition）码和P/Y （EncryptedPrecision）码，分别作为民用的公开编码和军用的加密编码。C/A码 的速率为每秒L023M码片，而P/Y码的速率为10.23M码片每秒。所有卫星在 两个相互隔离的载波频率上发送上述导航信号，分别是1.57542GHz （称为L1） 和1.2276GHz （称为L2）。其中L1载波发送C/A和P/Y编码的信号，而L2载 波只发送P/Y编码的信号。此外，GPS系统还利用了其他的载波频率，但用作电 离层校准，民用救生等作用【3
1.2.3.2	手机定位
智能手机一般具有多种定位方式（GPS,基于网络的定位和惯性导航等），可 以独立使用，也可以综合使用。有些产品可能支持包括GPS在内的多种GNSS （GlobalNavigation Satellite System,全球导航卫星系统）。这里根据公开资料以 iPhone为例介绍一下目前智能手机采用的定位技术【斗⑹。操作系统会在后台实时 维护一个本地数据库，保存用户当前位置附近的Wi-Fi热点和蜂窝基站信息。还 有一个在线的Wi-Fi热点和蜂窝基站信息数据库，以及它的一份本地缓存。该数 据库是通过大量用户采用众包的方式建立和维护的。当系统响应位置请求并且获 得用户许可后，它首先会根据本地数据库和本地缓存迅速得到一个粗略的位置估 计。接下来进一步根据这些信息获得更为精确的位置估计。如果GPS不可用， 至此可以得到最终位置估计，如果GPS可用，可以利用得到的位置估计和其他 信息辅助GPS模块，完成同步和查找卫星星图等初始化步骤，加快GPS定位速 度，获得最终位置估计。在该流程中，涉及到了位置指纹定位和A-GNSS（Assisted-GNSS,辅助的GNSS）定位等多种方法，并且这些方法的综合利用，提高了定 位精度和响应速度。
惯性导航技术在智能手机上也得到了广泛应用。智能手机普遍具有加速度计, 陀螺仪和电子罗盘等传感器，除了感知机身的姿态外，它们也可以用来实现惯性 导航功能。惯性导航通过上述传感器测量物体的加速度和角速度，结合初始位置 和速度，跟踪目标的位置和速度。但是这种方式由于累积误差的影响，无法在较 长的时间内保持精度，因此还是需要GPS或者网络定位结果修正，以提升长期
4
精度，目前通常在室内提供短期的动态位置估计。智能手机的定位技术还在不断 发展中。
1.3	国内外发展现状
卫星导航系统系统因其军民两用的特点，被各国政府视为重大战略项目，受 到了官方的大力推动。美国，中国，欧盟，俄罗斯，日本和印度都在自主研发卫 星导航系统系统。美国的GPS和中国的北斗2代，欧盟的Galileo,俄罗斯的 GLONASS属于GNSS,可以向全球提供服务，而北斗1代，日本的QZSS（QuasiZenith Satellite System,准天顶卫星系统），印度的 NAVIC （Navigation with Indian Constellation,印度星座导航）则属于 RNSS （Regional navigation satellite systems, 区域导航卫星系统），主要为本国提供定位服务。目前，GPS在进一步强化和完 善，北斗2代计划在2020年基本实现全球覆盖⑺。
基于网络的定位中广泛采用的有基于蜂窝网络的和基于WLAN的定位。相 关法律法规对基于蜂窝网络的定位作出了规定。FCC （Federal Communications Commission,联邦通信委员会）的E911 （北美的增强型911要求,Enhanced 911） 规定在2012年底前，蜂窝网络运营者需要具有对紧急电话呼叫者95%的误差在 300m以内的定位能力网。中国的法律法规中虽然没有类似的强制规定，但因为 国内主要运营商都参照了 3Gpp （3rd Generation Partnership Project,第三代合作 组织）或OMA （ Open Mobile Architecture,开放移动架构）等组织的标准，可以 提供基于2G/3G蜂窝网络的定位倒。从2009年的Release 9起，3Gpp将LCS引 入了 LTE的无线接入网，但受限于运营商的核心网升级，目前还没有大规模运 用。基于WLAN的定位技术起步较晚，但发展迅速，多为基于位置指纹的定位 技术。在2003年开始的SKYHOOK是早期的商用系统之一【助。这类技术基于用 户自组织的WLAN网络，不需要统一的标准，甚至可以完全基于软件实现，因 此产品繁多，例如谷歌，苹果，百度地图等的Wi-Fi定位技术。
1.4	本文研究内容与章节安排
本文对基于无线网络的定位技术中的一些问题进行了研究。首先研究了基于 位置指纹的定位方法。本文提出了一种新型的基于多径环境中位置特征的位置指 纹，并建立了相应模型。基于该模型，推导了一个定位算法。本文进一步分析了 该位置指纹的CRB （Cramer-Raobound,克拉美罗界）和该定位算法的正确估计 概率。前者是任何基于该观测量的无偏位置估计方差的下界，后者是提出的位置 估计算法的一种性能指标。本文希望这些结果对设计相关定位系统和开展实验具 有一定帮助。其次，本文研究了 3GPPLCS下行模式中测距采用的PRS（Positioning
5
Reference Signal,定位参考信号）的传播时延估计问题。下行模式利用PRS的 RSTD （Reference Signal Time Difference,参考信号到达时间差）来测距，因此传 播时延估计是一个基本问题。传统的方法基于时域相关，然而受多径效应的影响 较大。对于 OFDM （Orthogonal frequency-division multiplexing,正交频分复用） 信号，MUSIC （Multiple Signal Classification,多重信号分类）方法能够从多径中 分离径，但是需要已知多径数。MDL （Minimum Description Length,最小描述长 度）方法可以对此进行估计。本文考虑了 MDL-MUSIC联合方法对PRS时延进 行估计，并且提出了一种称为遍历法的新方法。和直接的两步法不同，提出的遍 历法会从所有假设中选择多径数，然后估计传播时延。此外同样基于PRS,根据 SIC-SAGE （ Serial Interference Cancellation - Space Alternating Generalized Expectation-maximization,串行干扰取消-空间变换的广义最大期望）方法，本文 通过引入差分的方式来利用得到的多个快拍，提出了一种SIC-DFC （SIC -Difference Frequency-domain Correlation,串行干扰取消-差分频域相关）方法。最 后通过链路级仿真，对上述算法的性能进行了研究。本文希望这些结果对下行定 位模式的最终精度提升有所帮助。本文章节安排如下：
第二章是基于网络的定位。这里介绍了背景与基础知识，为后文叙述做了铺 垫。首先介绍了 TDOA和基于位置指纹的定位，它们都是典型的基于网络的定 位方式。这里主要从抽象层面介绍了它们的基本原理和概念。其次，这一章节介 绍了 3Gpp定位系统（LCS）的定义。从标准和协议的角度介绍了 LCS的术语， 概念，系统的功能划分，架构和流程，其中重点介绍了 E-UTRAN （Evolved Universal Terrestrial Radio Access,演进的通用陆地无线接入网）中的下行定位模 式，这是一种标准化的TDOA方式，并且主要利用PRS来测距。
第三章是基于多径特征的位置指纹定位。首先对相关研究进行了总结，并提 出了一种利用多径传播中位置特征TDOPA作为位置指纹的方式，它是一种基于 位置指纹的定位方式。然后根据位置指纹定位的特点和高斯噪声对TDOPA进行 了建模，从该模型得到了利用TDOPA的无偏定位算法的CRB；从该模型推导出 一种基于贝叶斯推断的定位算法，运用分析的方法得出了该算法的一些特性，并 仿真验证，最后得出结论。
第四章是基于LTE PRS的传播时延估计。PRS是LCS下行模式中测距所利 用的参考信号。本章首先对相关研究进行了总结，并提出了一种MDL-MUSIC联 合的时延估计算法。此外，还提出一种基于SIC和频域相关的SIC-DFC方法。 然后描述了时域相关等对比算法。最后介绍了链路级仿真平台的搭建，基于该平 台仿真进行算法性能的研究，并得出结论。
6
第五章是总结与展望。本章对之前章节进行了总结，并对后续研究进行了展 望。
最后是参考文献和致谢，向前人的工作和他人对本文的帮助致敬和感谢。
7
第二章基于无线网络的定位
2.1	优势和挑战
基于无线网络的定位依赖于现有的网络和终端，可以不需要额外设备和硬件 改动，只通过软件升级的方式实现，便于部署。由于“卫星峡谷”和多径现象， 室内信号覆盖不足，GNSS等基于卫星星座的定位技术在城市和室内精度恶化， 而无线网络在城市和室内均有良好的覆盖，可以提供泛在的定位服务。另一方面， 定位能力也能为网络部署和运营带来益处，例如定位结果可以为RRM （Radio Resource Management,无线发源管理）和 MM （Mobility Management,移动性管 理）所用，从而提高系统容量，或者改善用户体验。
然而，由于无线信道的复杂性，如多径和NLOS （Non-Light of Sight,非视 距）等因素，给无线网络定位也带来了诸多困难口工
本章首先介绍了两种主要的基于无线网络的定位方式TDOA和位置指纹定 位；其次，本章对3GPP的定位系统（LCS）做了介绍。通过本章的介绍，使读 者具有对后续章节关注问题的背景具有一定程度的了解。
2.2	TDOA 定位
TDOA定位是一种经典的基于网络的定位方法。在20世纪80年代曾经广 泛使用的导航系统LORAN-C就是基于这种技术。TDOA或者ToA的定位方式 都需要测量传播时间，根据传播时间推算出距离。传播时间的估计可以分为单向 和双向两种方式。在单向方式中，测量的是某事件（例如信号起点）发生在发射 机上和发生在接收机上的时间差，即传播时间。在这种方式中，又可以有多种具 体实现。例如，发射机可以发送一个时间戳，带上信号发送时间，或者接收机提 前知道周期性信号的起始时间。根据测得的传播时间，乘以光速，就可以得到发 射机和接收机之间的距离。这种方式被广泛采用，例如GPS系统中的测距。单 向方式要求发射机和接收机是同步的，并且接收机需要知道信号的发射时间，才 能正确推算距离。在双向方式中，测量的是信号的往返传播时间。在这种方式中， 一个终端作为询问者，另一个作为应答者，需要询问者和应答者都具有双工的能 力。询问者发送特定信号给应答者，由于双工模式等因素，在响应时延后，应答 者发送信号给询问者，询问者可以根据发送和接收时间差和引入的响应时延，估 计往返距离。相比于单向方式，这种方式对应答者性能要求可以较低，它只需要
s
其具有接收，存储和发射等能力，而不需要复杂的信号处理能力。正因为这种特 点，它在RFID (Radio Frequency Identity,射频标识)技术中被采用。
如果已知信号发射时间，但是不满足单向方式中发射机和接收机同步，也可 以利用时间差即距离差定位，即采用TDOA定位，这种方式只要求非目标节点 之间保持同步。这里时间差具体指两个非目标节点和同一个目标节点间信号传播 时延的差。时间差可以由两种方式得到，一种方式是接收机具有发送信号的副本， 分别估计来自多个发射机信号的传播时间，然后差分得到时间差，称为主动模式； 另一种方式接收机无发送信号副本，通过对两个发射机的信号的处理，直接得到 时间差，称为被动模式。
系统的部署又可以分为两种情况，一种是目标发送信号由网络接收，称为多 边方式；另一种是网络发送信号由目标接收，称为单边方式。如果网络中有M个 节点参与定位，总共可以得到C；,组时间差，但是这些时间差是线性相关的。事 实上可以得到时间差的多个独立的集合，集合中每一个时间差对应的时延中至少 有一个没有被其他时间差采用，这样的集合具行个元素，并且是线性无关 的。通常认为这样一个独立的集合足以支持定位［⑵，然而在考虑到噪声的情况下, 可以引入冗余的时间差来提高精度口叫
根据测量的时间差可以换算得到距离差，加上已知或者确知的非目标节点的 位置，通过求解定位方程等方法，可以估计目标的位置。这里以二维欧氏平面为 例(三维空间可以以此类推)，简要介绍一下TDOA基本的几何模型。记已知的 网络节点i的位置坐标为的& P)，待估计的目标节点的位置坐标为(x y),目 标到节点i和j之间的距离差为4,, =4一4，则有下列方程：
4.产 J(x — x)2+(y — y)2 - J(x_xj+(y_yj	(2-1)
由多个节点和距离差可以联立得到方程组.，方程组的解即为位置的估计。图2-1 为TDOA定位示意图。
.■
用户
e!MB2	eNBB
图2-1 TDOA定位示意图
该方程组为非线性方程组，通过变量变换，可以变换为关于第三方变量的线 性方程组。为了使方程组有解，需要满足其中。为坐标数，即维数， 当大于号成立时为超定方程组。对于超定方程组情况，求解可以采用LS (Least Square,最小二乘)法，加权的 LS网, Chan 算法〔皿,AML( Approximately Maximum Likelihood)算法。旬，Tylor级数算法［⑸和高斯一牛顿法【16］等。
2.3位置指纹定位
基于位置指纹的定位，也称为RFPM (Radio Frequency Pattern Matching,射 频模式识别)，是一种新兴的基于网络的定位技术。在2003年开始的SKYHOOK 就是这样的商用系统之一［期。目前该技术主要基于WLAN网络，因为WLAN多 是用户自组织的，地理位置未知但基本固定口7卜口叫其中采用的位置指纹一般为 一些 Wi-Fi 热点相关的 RSS 或者 RSSI (Received Signal Strength Indicator)等量。 通过比较接收机得到的位置指纹和数据库(即样本集)中的记录来估计位置，这 里数据库是预先建立的，包含已知位置和对应的位置指纹。这种方式不需要硬件 改动，可以在现有通信系统上实现。此外，这种方式受到多径和阴影衰落的影响 较小，因为它们带来的影响本身就包含在位置指纹中，甚至可以利用这些信息增 强定位。同样地，系统部署方式可以分为单边或者多边方式，这里以单边方式为 例进行说明。
定位过程由两个阶段组成。第一个阶段称为训练或者离线阶段，目的是建立 数据库。在该阶段，测量一些参考点上的位置指纹，预处理并建立起和位置的映 射，存入数据库。第二个阶段称为测试或者在线阶段，目标测量自己的位置指纹， 通过某种搜索算法和数据库中的记录比较，得到位置估计。在早期的位置指纹技 术中，离线阶段是通过路测或者室内测试等实测的方式进行口刃，但现在一些研究 基于的众包(crowdsourcing)的方式进行，也能取得不错的精度口刃。流程如图2-2所示。
10
图2-2位置指纹定位流程示意图
测试阶段的搜索算法可以有多种实现〔2〕，比较典型的有最近邻居和贝叶斯推 断算法。最近邻居算法也称为NNSS （Nearest Neighbor in Signal Space,信号空 间中最近邻居）算法，其中，记数据库中的一个参考位置的指纹为国，对应的位 置为“，现观测得到一个位置指纹,记为。，则位置估计为。= argminM。-Sj, 其中卜|算子表示距离。这里距离的定义包括但不限于欧式距离，也可以有范数或 者曼哈顿距离等方法。最近邻居算法易于操作和实现。
贝叶斯推断算法也称为MAP （Maximum-a-Posteriori,最大后验概率）算法。 在贝叶斯推断算法中，位置估计为在给定观测位置指纹的条件下，后验概率最大 的参考位置。记观测得到的位置指纹为。，参考位置外下的位置指纹的概率分布 为尸（x|pj ,在每个参考位置上的先验概率记为P（p,）。则由贝叶斯公式，后验 概率为：
（2-2） 工尸（。加）尸（2）
/
则位置估计为P = argmax,„ P（p.|o）。容易看出，当先验概率相等的情况下，退 化为最大似然估计。=arg max% P{o\ A ） o贝叶斯推断要求具有位置指纹的概率 分布，但在实际中，通常采用位置指纹的统计特性来近似概率特性。
RADAR系统是早期被提出的位置指纹定位实验，在2000年进行口叫 它是 一种基于WLAN射频的室内用户定位和跟踪系统。它采用从三个WLAN AP （AccessPoint,接入点）接收机收集得到的用户信号强度信息确定用户坐标。这
11
里利用的信号强度信息是从WLAN网卡驱动中得到的SS （Signal Strength,信号 强度）和SNR （Signal-to-Noise Ratio,信噪比），每当接收到广播包的时候就可 以得到这些信息。
训练阶段可以进一步分为数据收集阶段和处理阶段。在数据收集阶段通过收 一集信号强度信息来建立数据库。一个移动的信标周期性地发送广播包，让AP来 接收。AP每次接收到广播包时，记录AP编号，SS和SINR的三元组，最后附 上时间戳。训练阶段和测试阶段收集到的信息都可以采用这样的三元组格式来表 示。在训练阶段，移动信标会以坐标的形式标记自己的实际位置，由于LOS/NLOS 环境，这里也会记录信标的朝向，进而得到二维坐标和朝向的三元组，最后附上 时间戳。在数据处理阶段,对同一地点同一朝向的多次测量取平均值，然后合并， 得到每一个AP视角下信标二维坐标，朝向，SS和SINR的五元组，并存入数据 库。测试阶段，类似地，目标终端也会发送广播包，并且AP多次测量取平均值， 得到每一-个AP视角下的SS和SINR的两元组。
通过实验比较，该研究最后采用了 SS作为位置特征，而没有采用SINR。在 该研究提出的“经验方法”中，采用NNSS算法来匹配测试阶段的两元组中的SS 和训练阶段的五元组中的SS,并将匹配到的五元组中的坐标和朝向作为估计结 果。因为系统中有三个AP,这里的距离需要包括AP的自由度。对NNSS的一 个改进是引入多个最近邻居，最后将多个最近邻居加权平均。该研究还提出了另 一种“无线传播模型方法”作为改进，通过一些无线传播模型来扩充训练阶段的 数据库。这里用到了瑞利衰落模型，莱斯衰落模型和楼层衰减模型，通过训练阶 段的实测数据，取得模型参数设定，进而得到更多位置上的五元组，于是扩充了 数据库。通过运用这种方法，可以减少训练阶段的工作量。在数据库扩充完成后， 其他步骤和“经验方法”相似。实验结果表明，RADAR能够以相当高的概率在 几米的误差内估计用户的位置。
2.4 3GPP定位系统（LCS）
2.4.1	背景和发展
如前文所述，一方面由于基于位置的服务提出的定位需求，另一方面相关法 律法规也要求网络运营商在某些情况下具有确定用户位置范围的能力，3GPP决 定其标准应该支持位置服务特性。从2009年的Release 9起，3Gpp将基于LTE 的无线定位引入了 LCS。
LCS能够用标准的形式报告用户终端的位置，这些信息可以为用户、移动设 备、网络运营商、服务提供商、增值服务提供商等所用，用来支持基于位置的服 务，合法监视和紧急呼叫等功能，提供的位置服务可以被收费。LCS的设计支持
12
GSM ( Global System for Mobile Communication ), UMTS ( Universal Mobile Telecommunications System) / 3G(3rd Generation)或者 LTE / EPS(Evolved Packet System)网络，即支持 E-UTRAN, GERAN (GSM EDGE Radio Access Network ) 和 UTRAN(UMTSTerrestrialRadioAccessNetwork)等多种接入网，EPC (Evolved Packet Core), CS (Circuit Switch)和 PS (Packet Switch)等多种核心网，此外 也支持 I-WLAN (Interworking WLAN)网络(一种 Wi-Fi 和 3GPP 网络的结合)。
目前LCS还在不断修订和更新中，这里根据3GPPRelease 14标准对其进行 简要介绍。
242系统架构，接口，协议和流程
本节主要描述了 3GPP对LCS的标准化情况。3GPP协议中对LCS的描述 分为了第一阶段(stage 1),第二阶段(stage 2)和第三阶段(stage 3),第一阶 段是提供总体服务的描述，主要从订阅者和用户的角度，但不涉及人机接口的细 节；第二阶段描述包含LCS系统功能模型，系统架构，状态描述，信息流，位置 估计机制和信令交互等；第三阶段是对第二阶段的补充。现对其系统架构、接口、 协议和流程进行简要介绍。
2.4.2.1	逻辑参考模型
在第一阶段描述的LCS逻辑参考模型中,将LCS抽象为LCS客户端(client), LCS服务器(server)和目标MS (MobileStation,移动台)三个功能实体。LCS 服务器是指提供LCS能力的软件/硬件实体，LCS服务器接收请求并服务，返 回响应。LCS服务器由多个LCS组件组成，它们分布在一个或者多个PLMN (Public Land Mobile Network,公共陆地移动网络)中。LCS客户端是指和LCS 服务器互动来得到一个或者多个MS位置信息的软件/硬件实体。LCS客户端可 以和也可以不和人类用户互动。LCS客户端通过一个唯一的国际ID标识磔1。
它们之间的关系为：LCS客户端向LCS服务器发出请求，LCS服务器对请 求做出响应，LCS服务器和客户端之间可以相互指派；LCS服务器可以定位目标 MS,但需要遵守目标的隐私控制条件。逻辑参考模型如图2-3所示。
13
----Stage 1
----Stage 2,3
图2-3 LCS逻辑参考模型口。1
2.4.2.2	LCS系统架构
LCS客户端通过Le接口接入LCS服务器，来自一个或者多个PLMN（Public Land Mobile Network）的LCS服务器之间可以通过Lg或者Lr接口连接。Lg接 口是 MSC （Mobile Switching Center,移动交换中心）/ SGSN （Serving GPRS Support Node,服务GPRS支撑点）之间的连接，属于间接接口； Lr是GMLC （Gateway Mobile Location Center,网关移动位置中心）和GMLC之间的连接， 属于直接连接。服务器和客户端之间的接口如图2-4所示。
图2-4LCS接入接口与参考点
这里主要介绍涉及E-UTRAN的LCS服务器组件。它们包括GMLC, MME （Mobility Management Entity,移动性管理实体），E-SMLC （Evolved Serving Mobile Location Center,演进的服务移动位置中心）或 SLP （SUPL （Secure User Plane Location ） Location Platform,安全用户面定位平台），LMU （ Location Measurement Unit,位置测量单元）。此外还有 HSS （Home Subscriber Server,家 订阅者服务器），LRF （LocationRetrieval Function,位置存取功能），PPR （Privacy Profile Register,隐私配置寄存器）等必需功能组件。这里E-SMLC和SLP的功 能是等价的，取决于E-UTRAN中的LCS基于用户面还是控制面，基于用户面
14
则采用SLP,否则为E-SMLC» LCS服务器内部各组件/网元之间的接口如图2-
5所示-
图2-5 LCS 一般安排MU
2.4.2.3	LCS功能安排
从功能上，LCS由若干逻辑功能实体组成。LCS的逻辑功能实体可以分为两 个主要功能组：LCS客户端功能组和LCS服务器功能组。
LCS客户端功能组包括LCF (Location Client Function,客户端功能)，它提 供LCS客户端和服务器之间的逻辑接口，负责请求一个或者多个UE的位置， 提出QoS (Quality of Services)要求和接收响应，响应中包含位置信息或者失败 指示。
LCS服务器功能组包括客户处理组件(client handling component),系统处 理组件(system handling component),订阅者处理组件(subscriber handling component) 和定位组件 (positioning component)(>
客户处理组件主要包括LCCF (Location Client Control Function,定位客户端 控制功能)，负责管理和LCF的外部接口。LCCF通过和LCAF (Location Client Authorization Function,定位客户端鉴权功能)交互，对请求的LCS客户端验证 和鉴权(识别该LCS客户端是否被允许定位该订阅者)。LCCF也处理LCS客户 端的移动性管理。LCCF决定是否最终估计结果满足QoS。LCCF在同时收到多 定位请求时，提供流控制。它也可以在命令LCCTF (Location Client Coordinate Transformation Function,定位客户端坐标转换功能)执行向当地坐标的转换。它 也可以命令 LSCTF (Location System Co-ordinate Transformation Function,定位
15
系统坐标转换功能）执行当地坐标向网络标识（如小区ID,定位区域标识符等）-的转换。它也能通过LSBF飞Location System Billing Function,定位系统记账功 能）产生LCS收费和记账数据。
系统处理组件主要包括LSCF （Location System Control Function,定位系统 控制功能），LSBF, LSOF （Location System Operations Function,定位系统运营 功能）,LSBcF （ Location System Broadcast Function，定位系统广播功能）,LSCTF, LIMS-IWF （Location IMS （IP Multimedia Subsystem） - Interworking Function, 定位IP多媒体子系统互操作功能）。其中LSCF负责协同定位请求，管理呼叫相 关的和非呼叫相关的LCS定位请求并分配网络资源。LSBF负责收费和记账活 动。LSOF负责指派数据，如定位能力、客户端数据和订阅者数据，错误管理和 LCS性能管理等。LSBcF提供广播能力，它仅在某些定位模式下使用。LSCTF提 供将地理格式表示的区域定义转换为网络ID的功能。在请求网络中的LIMS-IWF 负责基于IMS用户标识符决定LCS请求到目标UE家网络的路由，在家网络中 LIMS-1WF负责决定合适的HSSo
订阅者处理组件包含 LSAF （Location Subscriber Authorization Function,位 置订阅者鉴权功能），LSTF （Location Subscriber Translation Function,位置订阅 者翻译功能），LSPF（ Location Subscriber Privacy Function，位置订阅者隐私功能）。 LSAF负责授权对某个特定的UE定位的指派，具体来说，该功能验证某订阅者 适用于LCS。如果LCF在UE中，LSAF验证该是否UE订阅请求的LCS服务。 LSTF负责映射目标UE的真名和假名。LSPF负责执行所有的隐私相关的鉴权， 对于目标UE,它应该根据它的隐私选项鉴权。
定位组件包括PRCF （Positioning Co-ordination Function,定位无线协同功能）, PCF （Positioning Calculations Function,定位计算功能），PSMF （ Positioning Signal Measurement Function,定位信号测量功能），PRRM （Positioning Radio Resources Management,定位无线资源管理功能）。它们根据接入网类型有着不同的描述。 图2-6展示了逻辑功能组的划分和其中包括的逻辑功能实体。
16
上述功能需要映射到具体网元。标准中规定了功能向网元的映射方式⑷］。例 如在EPS中，LCF可以位于LCS客户端,MME或者UE中；LCCF只位于GMLC 中；LSCF只位于MME中；PRCF和PCF只位于E-SMLC中。
2.424接口和协议
本节主要介绍E-UTRAN中的LCS接口和协议。如图2-5所示,在E-UTRAN 中，支持LCS所需的接口有：LTE-UU接口，S1-MME接口，SLs接口和SLm 接口。LCS协议可以根据在E-UTRAN中的终点被为三类：以UE为终点，以 eNB为终点和以LMU为终点。
LCS中，以UE为终点的协议有LPP （LTEPositioning Protocol, LTE定位协 议）和RRC （Radio Resource Control,无线资源控制）协议。LPP以目标UE和 定位服务器（在控制面情况是E-SMLC,在用户面情况是SLP）为终点，是一个 点对点的定位协议。它被设计为允许通过多种定位模式来定位，同时独立特定定 位模式和底层传输的细节。LPP消息被用合适的协议通过中间网络接口（如在S1-MME接口 S1-AP协议，在Uu接口通过NAS/RRC协、议）作为透明PDU（ Protocol Data Unit,协议数据单元）被传输。RRC协议以UE和eNode B为终点。除了提 供LPP消息的传输，它也支持用于定位目的的测量量的传输。
17
以 eNB 为终点的的协议有 LPPa （LTE Positioning Protocol Annex, LTE 定位 协议组件）和Sl-AP （S1应用协议）。LPPa在eNB和E-SMLC之间传递信息， 用来支持某些定位功能，例如从eNB收集数据。它对MME是透明的。S1-AP以 MME和eNB为终点，它被用来在S1-MME接口上传输LPP和LPPa消息，也 被用来发起和终结eNB相关的定位流程。
以 LMU 为终点的协议有 SLmAP （SLm Application Protocol, SLm 应用协 议）。SLmAP以E-SMLC和LMU为终点，用来从E-SMLC向LMU传递目标用 户配置数据，或者请求LMU测量和传递LMU测量量到E-SMLCo
为了支持E-SMLC和UE之间的LPP消息传输，协议分层如图2-7所示。为 了支持E-SMLC和eNB之间的LPPa PDU传输，协议分层如图2-8所示。为了 支持E-SMLC和LMU之间的SLmAP消息传输，协议分层如图2-9所示。
图2-7 LPP协议7⑷1
图2-8 LPPa协议栈M2]
SLmAP			SLmAP
SCTP			SCTP
IP			IP
L2			L2
L1			L1
LMU	SLm		E-SMLC
图2-9 SLmAP协议栈回
2.4.2.5 一般网络定位流程
18
LCS中一般的网络定位流程可以被分为下列三个阶段：定位准备过程，定位 测量建立过程，位置计算和释放过程。位置请求可以有不同的形式，如MT-LR （Mobile Terminated Location Request,移动终端终结的位置请求），MO-LR （Mobile Originated Location Request,移动终端起源的位置请求），NI-LR （Network Induced Location Request,网络发起的位置请求）；核心网也可以有不 同的类型，如EPC, PS或CS,根据请求的不同和核心网的不同，定位流程也有 所区别。下面以EPC-MFLR过程为例进行介绍，即EPC中移动端终结的位置请 求，如图2-10所示，其中步骤1）-6）是定位准备过程，步骤7）是定位测量建立过 程，步骤8） -10）是位置计算和释放过程。
图2-10 EPC-MT-LR流程⑷]
下面按步骤简要介绍该流程：
1）执行 PS 和 CS 域共同 MT-LR 过程（common MT-LR procedure in PS and CS domain）o简要来说，主要涉及LCS客户端向某GMLC发送LCS请求（该 GMLC被称为请求GMLC）,请求GMLC通过查询HLR/HSS,向订阅者家 GMLC发送请求；家GMLC执行隐私检查（或者请求PPR检查）；家GMLC通 过查询HLR/HSS,向拜访GMLC发送请求。类似地，也适用于LCS响应过程 如步骤10）o以后的GMLC指拜访GMLC»
19
2）GMLC发送“提供订阅者位置”信息给步骤1）中指示的拜访网络中的MME。 这个消息携带请求位置信息的类型（例如当前位置和可选的速度），订阅者的 IMSI （International Mobile Subscriber Identification Number,国际移动订阅者识别 码），LCSQoS信息（如精度和响应时间），和LCS客户端是否有重载能力。对 于和会话相关的位置请求，该消息也携带UE建立会话的APN-NI （Access Point Name Network Identifier,计入点网络标识符）。此外，也可能包含客户端名或码 字（LCS客户端或者请求者使目标UE位置请求被接受的接入码）。
2a）如果GMLC和MME支持暂时不可达UE的推迟定位报告，MME需要 发送一个“提供订阅者位置确认”的消息并带上“UE暂时不可达”。在这种情况 下，步骤9a）和9b）被执行，而不是9）。
2b）如果发生了步骤2a）, GMLC返回LCS服务响应给LCS客户端。
3）如果该GMLC位于另外一个PLMN或者国家，MME会检查是否位置请 求满足该PLMN和该国家的要求。如果不是，返回错误响应。其次，MME检查 是否UE是去附着的或者挂起的，在这种情况下返回错误响应。如果来自GMLC 的PSL消息包括表示隐私的指示，MME决定隐私相关的动作。
4）如果位置请求来自于一个增值的LCS客户端，隐私相关动作指示器指示 UE必须被提醒或者进行隐私验证，而且该UE支持，一个NAS提醒消息被发送 至IJ目标UE,指示来自LCS客户端的位置请求的类型，LCS客户端的标识和请求 者标识（如果两者都支持和可用），是否需耍隐私验证。此外，可以包含服务类 型和码字等信息。MME发送NAS定位提醒消息和定位过程并行，即继续步骤6） 不用等待步骤5）NAS定位提醒返回结果。
5）目标UE提醒使用者定位请求，如果请求了隐私验证，等待用户授权或者 拒绝。UE然后返回一个提醒结果给MME,指示请求被允许或者拒绝（如果请求 了隐私验证）。这一消息可以在步骤4）之后步骤9）之前的某一时间。如果在给定 的时间内UE没有响应，MME应该推断“无响应”。如果请求了隐私验证，用户 拒绝或者根据用户隐私配置文件无响应表示拒绝请求，MME应该返回错误响应 给 GMLC。
6） MME选择一个E-SMLC,并且发送位置请求信息给该E-SMLC。一旦该 MME选择了一个E-SMLC,它一定要在会话持续过程中继续使用。位置请求包 括位置信息类型，请求的QoS,服务小区标识，UE定位能力，服务类型（如果 可用）。
7）如果基于从MME收到的参数（小区ID）,请求的定位信息的QoS之内 的精度可以被满足，E-SMLC可以立即发送一个定位响应。如果位置请求指示上 一次已知位置，E-SMLC应该基于小区ID决定一个上一次已知位置，立即发送
20
定位响应。否则E-SMLC决定定位模式并为该定位模式发起特定的消息序列。如 -果定位模式返回位置测量量，该E-SMLC可以用它们估计位置。如果获得位置测 量量已经失败了，该E-SMLC可以采用当前小区ID的到一个大致的位置估计。 如果基于UE的定位模式已经计算返回了一个位置估计，E-SMLC可以验证它和 当前小区的一致性。如果取得的位置不满足要求的精度「而且还有充足的响应时 间，该E-SMLC可以发起进一步定位尝试，其中可以采用相同的或者不同的定位 模式。如果要求垂直坐标，但E-SMLC只能得到水平坐标，可以只返回这些。
8）当满足请求的位置类型和QoS的位置信息被取得时，E-SMLC在定位响 应中返回它给MME。E-SMLC应该在该响应中指示取得的位置估计是否满足请 求的精度。定位模式的信息可以被返回。如果不能取得位置估计，E-SMLC返回 定位响应应该包含失败原因和无位置估计指示。
9）只有当2a）不执行时执行这一步。如果MME没有初始化步骤4）的隐私验 证过程，则MME返回位置信息，它的年龄和精度指示给GMLC。如果执行了步 骤4）的隐私验证过程，只有当它收到的NAS定位提醒返回结果表示允许，MME 才返回位置信息。如果该结果指示请求没有被授权或者按照隐私配置文件未响应 表示拒绝，MME应该返回错误响应给GMLC。如果E-SMLC没有返回成功的位 置估计，但是隐私检查成功执行了，而且如果请求当前或上次已知位置，MME 可以返回目标UE上次已知位置。MME应该记录计费信息。
9a）只有2a）执行时这一步会被执行。主要内容和步骤9）相同，不同之处在 于：MME应该在订阅者位置报告中包含在步骤2）得到的任何UE标识。如果在 定位信息得到前发生MME重定位或者改变，旧MME返回错误代码，并且包括 新MME地址。GMLC可以向新MME重发定位请求。
9b）如果9a）执行，GMLC应该反馈订阅者位置报告收到确认。
10）如果在步骤1）中请求当前位置和上一次已知位置，执行PS和CS域共 同MT-LR过程。对于请求UE可用性事件的延迟位置，则执行相应的其他步骤。 2.4.3下行模式（OTDOA）
定位UE涉及到两个方面：信号测量和基于该测量估计位置（或速度）。在 LCS中定义了多种定位模式（positioning method）,网络可以根据QoS选择它们 中的一种或者多种来确定一个UE的位置。E-UTRAN支持的标准定位模式有： A-GNSS （network-assistedGNSS,网络辅助的 GNSS）,下行定位模式（downlink positioning ）,上行定位模式（uplink positioning ）, E-CID （Enhanced-Cell ID,增 强的小区ID）模式，气压传感器模式，WLAN模式，蓝牙模式和陆地信标模式。 也支持采用上述多种方式的混合使用［2%
21
LTE中定位模式中的信令交互既可以在3GPP控制平面(controlplane)中进 行，也可以基于 OMA (Operations, administration and maintenance,运营管理和 维护)SUPL在用户平面(userplane)进行，两者信令交互过程类似，但目标和 服务器不同。在控制平面环境中，目标指UE,服务器指E-SMLC；在用户平面 环境中，目标指SET ( SUPL Enabled Terminal, SUPL支持终端)，服务器指SLP。 下行模式也不例外。
.这里以控制平面环境中的下行模式为例进行介绍，以前也称为OTDOA (Observed Time difference of Arrival,观察的到达时间差)。在下行定位模式中， 基于UE取得的来自多个TP (TransmissionPoint,传输点，一个小区中地理上共 址的一组天线)的下行无线信号，测量参考信号时间差RSTD,并结合TP的位 置信息，估计UE的位置。
2.4.3.1 PRS 禾口 RSTD
下行定位模式主要基于PRS,它是专为定位定义的参考信号，PRS不可用时 也可以基于CRS (Cell-specific Reference Signal,小区参考信号)。PRS仅在为 其配置的下行子帧中的RB (ResourceBlock,资源块)上发射，位于天线端口 6, 仅适用于子载波间隔为15kHz的帧格式。参考信号序列定义画为：
"% ⑺)=一 2 ,，(2⑼)+ /卡(1 - 2 - c(2m +1)),次=0,1,...,2N邕6 一 1 (2-3)
其中々是时隙序号，/是时隙中OFDM符号序号，伪随机序列”•)由长度为31 位的Gold序列生成，长度为加小的输出序列以〃)定义为：
Gz+M)+.5+M))mod2
%(〃+31)=(菁(〃+3)+% (??)) mod 2	(2-4)
x2(?7+31)=(x?(n+3)+x»(n4-2)4'X2(n+l)+x2(n))mod2
其中£=1600,行= 0,12…1 ’第一个M序列被初始化为 玉(0) = lg(i) = 0.i = 12….30 ；第二个M序列被初始化为.,其 具体数值取决于不同的信道或者参考信号。对于PRS,被初始化为， c,ni. = 228 •	/512]+ 210 -(7 . (ns +1)+ / +1 ).(2 •	mod 512)+1)+ 2 -(7V^S mod 512)+ 7VCP ,其
中耀e {0,1,…,4095}等于,也可以由高层指定。
参考信号序列乙.(〃?)，按照如下方式映射到时隙久和天线端口夕中RE (Resource Element,资源单位)上的复调制符号47 ：
碍7=%、(柏	(2-5)
对于常规CP：
22
% = 6 (加 + 端-需)+ (6 - /+*)mod 6
3,5,6 if〃smod2 = 0
/ = - 1,2,3,5,6 if nsmod2 = 1 and (1 or 2 PBCHantenna ports)
2,3,5,6	if Hsmod 2 = 1 and(4 PBCH antenna ports) (2-6)
“2 = 0,1…1	-
加"+ N牒DL—嘘s
其中小区专有频偏v =N；；；〃mod6, p = 6。PRS的一个图样如图2-11所示。
SHOd uuuocu Hum-d o>= PUU0UO
WX三三。==二。?-===
even- numbered slots	odd- numbered slots	even-numbered slots	odd- numbered slots
Antenna port 6	Antenna port 6
图2-11 PRS图样BN
PRS在NW个连续的子帧中被发送，称为一个PRS定位机会(PRS positioning occasion),,定位机会中的子帧通常仅包含CRS和PRS,不包含业务 和控制信道，被称LIS (Low Interference Subframe,低干扰子帧)冈。PRS子帧
配置索引Ors指示了小区特定的PRS周期7；2和子帧偏移量△桃s，如表2-1所示。
PRS只在下行子帧中发送，不在DwPTS中发送。N,,“s和1亦都由高层配置。
表2-1定位参考信号子帧配置网
PRS配置索引/pRs	PRS周期Grs （子帧）	PRS子帧偏移小 rKo （子帧）
0-159	160	,PRS
160-479	320	/pRs -160
480-1119	640	/pRS — 480
1120-2399	1280	“1120
2400-2404	5	/prs-2400
2405-2414	1()	/prs-2405
2415-2434	20	/prs-2415
2435 - 2474	40	/prs-2435
2475-2554	80	"rs-2475
2555-4095	保留
23
通过PRS静默(PRSmuting)机制可以进一步降低干扰。高层给可以给某个 小区配置周期为心仪的静默序列，以PRS定位机会组为单位。此外还有一个长度 为心下的比特序列，其中‘0'代表静默，’1'代表不静默。其中PRS定位机会 组由一个或者多个PRS定位机会组成；数目由高层配置。
RSTD是指邻小区j和参考小区i之间的相对时间差，定义为理ubframeRxj-TsubfranieRxi■＞其中TsubframeRxj为UE接收到来自小区j的一■个子帧的起始时间； TsubframeRxi指UE接收到来自小区i的一个子帧的起始时间中最接近上述来自小区 j的子帧起始的一个。RSTD的参考点是UE天线的连接器。它适用于 RRC_CONNECTED状态下的同频或异频测量磔］，所谓同频测量是指参考小区和 邻小区在同一频段下，异频测量是指不在同一频段下。
协议对RSTD的测量提出了要求126］。它规定了在给定的信噪比下，UE完成 RSTD测量限定的时间和要求的精度，以及RSTD测量报文，高解析度RSTD测 量报告的格式。表2-2展示了同频测量下的测量精度要求，其中以/lot表示单个 子载波上接收能量和邻小区干扰加噪声能量的比值［28］。异频测量的要求会相对 宽松一些。
表2-2 RSTD同频测量精度要求
精或	条件
PRS Es/lot	最小PRS带 宽(参考小 区信道带宽 No-和 pRS 带宽最小 值)	最小可用 子帧数	IoNo,c6 范闹
E-UTRA运营频 带组NOICX	最小 Jq Note I	最大 Io
Ts、。心	dB	RB			dBm /15kHzNolc5	dBm ZB"'Channel
±21	(PRS Es/loi)rcl>- 6dB and (PRS Es/Ioi), >- 13dB	> 6	4 NOTE'，	FDD_A. TDD_A	-121	-50
FDD_B	-120.5	-50
FDD_C, TDD_C	-120	-50
FDD_D	-119.5	-50
FDD_E. TOD_E	-119	-50
FDD_F	-118.5	-5()
FDD_G	-118	-5()
FDD_H	-117.5	-50
FDD_N	-114.5	-50
工16	(PRS Esdouicf >- 6dB and (PRS Es/Iol), >- 13dB	> 15	4 NOTE 9	Note 4	Note 4	Note 4
24
表2-2 RSTD同频测量精度要求四（续上表）
±10	(PRS Es/Iot)rcf>- 6dB and (PRS Es/lot), >- 13dB	>25	> 9 NOTE ')	Note 4	Note 4	Note 4
±9	(PRS Es/Iot)rcr>- 6dB and (PRS Es/Iot),>- !3dB	>50	> I	Note 4	Note 4	Note 4
±8	(PRS Es/Iot)rcf>- 6dB and (PRS Es/Iot), >- 13dR	> 75	> 1	Note 4	Note 4	Note 4
NOTE 1:最小Io恬况是在一个OFDM符号上所仃RE所均得到。 NOTE 2: Ts是最小时间单位 NOTE 3: PRS带宽任定位辅助数据中指定二 NOTE 4:对相同的频段和Io条件双用和PRS值宽沁 相同的需求， NOTE 5:当涉及到载波聚合时,Io等级会提升、＞0 NOTE 6:这里的Io定义在定位了帧I .C化相同的了帧中,PRS符号和非PRS符号的lo水平不同。 NOTE 7;如果•个UE采用了1波聚合,并」L被配置了 个或者两个SCelL则服务小区带宽为涉及RSTD测量的 成分教波中最小的带宽。如果RSTD测量中没打涉及服务小区的CA载波，服务小区的这些带宽不计入PRS带宽的 计算。 NOTE 8:参见E-UTRA运营频段组的定义, NOTE 9:如果采用ID=2或者的间隔图杆.该需求不适用.
2.4.3.2定位流程和信令交互
下行定位流程主要分为三个阶段：能力传输过程，辅助数据传输过程和位置 信息传输过程。对应于2.4.2.5小节中一般网络定位流程中的步骤7）,其他步骤 和一般流程中的相同。主要涉及eNB. UE和E-SMLC 0
首先是能力传输过程。这里的能力指的是UE或者E-SMLC能够支持的不同 定位模式，某个特定定位模式的不同方面或者共同特性（如处理LPP会话）。这 些能力定义在LPP协议中，用LPP协议在UE和E-SMLC之间传输。能力传输 可以由请求发起，称为LPP能力传输过程，也可以主动发出，称为LPP能力指 示过程。在LPP能力传输过程中，首先E-SMLC发送UELPP相关能力请求，
25
然后UE传输LPP相关能力给E-SMLCOLPP能力指示过程中UE无请示地向E-SMLC传输能力。
其次是辅助数据传输过程。辅助数据传输过程分为E-SMLC和UE间的辅助 数据传输，E-SMLC和eNB间的辅助数据传输。E-SMLC和UE之间的辅助数据 传输又可以分为UE发起的和E-SMLC发起的。由E-SMLC向UE传输的辅助数 据包括：测量候选TP的PCI （Physical Cell ID,物理层小区ID）, GCI （Global Cell ID,全球小区ID）和TPID；服务（参考TP）和候选TP的相对定时；候选 TP的PRS配置。E-SMLC和eNB之间的辅助数据传输由E-SMLC发起。E-SMLC 决定是否需要某种辅助数据，然后发送LPPa请求报文给eNB, eNB在响应报文 中提供请求的辅助数据。由eNB向E-SMLC传输的辅助数据有:该eNB的PCI, GCI,所含TP的TPID；所含TP的定时信息，PRS配置，物理坐标等。但是该 辅助信息传输不是必须的，例如可以通过OA&M （Operations. Administration, and Maintenance,运营管理和维护）系统获得。
最后是位置信息传输过程。UE需要向E-SMLC传输位置信息，可以包含 PCI, GCL TPID和下行定时测量。位置信息传输过程分为E-SMLC发起的位置 信息传输和UE发起的位置信息传输。在E-SMLC发起的位置信息传输过程中， E-SMLC发送LPP请求位置信息报文给UE； UE得到请求的下行测量量后，在 响应时间未到之前，返回LPP提供位置信息报文给E-SMLC,附上得到的下行测 量量。在UE发起的位置信息传输过程中，UE发送一个LPP提供位置信息报文 给E-SMLC,可以包含UE已经取得的任何下行测量量。
如标准中所规定的卬］,UE是通过LPP中的IE （InformationElements,信息 元素）OTDOA-ProvideLocationlnfbrmation 提供位置信息给 E-SMLC,它可以被 用来提供相关错误原因。其中主要包含IE OTDOA-SignalMeasurementlnformation, 用来向E-SMLC提供RSTD测量。RSTD测量涉及的相邻小区和参考小区，都是 根据IE OTDOA-ProvideAssistanceData中提供的，参考小区可以是也可以不是辅 助数据中提供的参考小区。在IE OTDOA-SignalMeasurementlnformation中包含 域：系统帧号，指示参考小区的PRS定位机会的启始帧号；参考小区CID；参考 小区GCI；参考质量；参考TPID；参考PRS ID；参考附加径，指示检测到的 RSTD参考小区多径时间；邻小区测量列表等。其中，邻小区测量列表由多个邻 居测量元素组成，它包含域：邻小区CID； RSTD； RSTD质量；邻居TPID；邻 居PRSID； RSTD差值，用作高精度RSTD指示和邻居附加径等。
2.5本章小结
26
本章主要介绍了后续章节相关的基础知识，方便读者更好地理解后续章节的 内容。首先，本章介绍了基于无线网络的定位技术的特点，相比于基于卫星星座 的定位技术，其具有易于部署的优势，但是由于信道的复杂性，这种定位技术也 面临着一系列挑战。其次，本章介绍了两种主要的基于无线网络的定位技术 TDOA定位和位置指纹定位，其中TDOA定位是一种基于测距的定位技术，后 者基于位置指纹。这两者都得到了一定程度的实际应用，本章从抽象层面对它们 进行了介绍，包括基本概念和流程。位置指纹定位是第三章的基础知识，而TDOA 定位是第四章的基础知识。最后，本章对3GPPLCS作了简要介绍，这是一种标 -准化的基于网络的定位系统，并且已经得到了实际的应用。本章根据3Gpp相关 标准，介绍了 LCS的系统架构，接口和一般流程，通过这些内容，希望读者能 够对实际的定位系统有一个宏观的认识。此外，这一部分还重点介绍了 LCS中 的下行定位模式和PRS,这也是第四章的一个基础知识。
27
第三章基于多径特征的位置指纹定位
3.1	问题描述和相关研究
由第二章中的介绍可知，基于位置指纹的定位被视为一种可行的和有效的定 位方式，因为它受到多径效应的不利影响较小。相关研究有实测和分析两类。相 关实测研究较多，例如第二章中描述的早期的2000年的RADAR系统口叫 还有 最近2016年的研究口7-国。它们主要利用来自多个源点的信号强度作为位置指纹， 例如大多利用RSSU7-19],也有研究利用其导出量SSD（ Signal Strength Difference, 信号强度差）【2文相关的理论研究较为成熟，CRB是经典理论，2007年的研究 建模了 RSS并且引入了 “正确估计概率”作为性能指标网，2009年的研究公式 化了多种定位算法⑶1。这些理论研究有助于改进算法和进行实验，但对于一种新 的位置指纹可能会失效。
本文提出了一种新的位置指纹,称为TDOPA （Time Difference of Path Arrival, 多径到达时间差），它利用了多径传播中的位置特征。该位置指纹依赖于单一源 而不是多个源点。通过一些多径信道估计技术，可以得到TDOPA。TDOPA之所 以作为位置指纹，是因为它和位置的强相关性。在达接收机端，明显的多径分量 （即可分辨径）中除直射径（如果存在）外的分量主要由反射引起而不是散射引 起。这些反射物（如墙壁，天花板等）和发射机通常是固定的，因此每一个反射 径的到达时间取决于接收机的位置。考虑到发射机和接收机之间并不是完全同步, 这里采用了时间差而不是绝对时间。正如之前的研究所采用的,本文的研究方法 是建模和分析。首先基于高斯白噪声，本文提出了位置指纹TDOPA的模型。基 于该模型和MAP准则，得到了一个利用TDOPA的定位算法。基于该模型，得 到了 TDOPA的CRB。接下来根据正确估计概率，本文分析了提出的定位算法的 性能。根据上述的分析结果，最后得出结论。
本章第二节介绍了系统模型和定位算法。第三节中得到了 TDOPA的CRB。 第四节是正确估计概率的公式表达及其性质。第五节是仿真验证。第六节是本章 小结。
3.2	系统模型
为了简化分析，本文采用了一种等效方法来处理反射径。如图3-1所示，来 自源点的反射径的到达时间等于来自镜像的直射径的到达时间，这里镜像位于源 点关于反射体的轴对称位置上。注意到当接收机能够接收到某一反射径时，其镜
28
像的位置与接收机的位置是无关的。每当给出源点和反射体，一便可以得到所有的 镜像点。通过这种技巧，反射径的计算可以被简化。在后文中，没有必要继续区 分镜像和源点，因此在不引起歧义的情况下，它们都被称为镜像。	-
■	-	-	- G
image
icficctor /	7、、.
L '、、、	>
source	\	sensor
_____
rellector
image
图3-1源点和镜像
为了简化分析但并不失一般性，本文的模型基于二维的欧几里得平面，并且 设定了正交坐标系。在模型中，存在着N + 1个镜像，并且按照到达时间的先后 排序，被记为又.％...岛，坐标分别为包 乂)」=0,1,...川。接收机位于坐标 0=(x y)r,是我们的目标参数。一个位置估计记为。=(ay)\从S,到接收机 的距离记为大 方向角记为内e[0,2〃)，如图3-2所示。
图3-2距离和方向南
实际的TDOPA以N维向量的形式表示(称为实际TDOPA向量)：
r = (ri0 r20 TN0)	(3-1)
这里% = (l/c)(z;-/;)”是光速。显然r是目标参数。的函数，因此也被记为r⑼。 考虑到测量误差，模型中引入了高斯噪声。误差在测量每一径的到达时间时被引 入，并最终污染了时间差，因此在相同的位置。上，一个测量的TDOPA (称为样 本TDOPA向量)被表示为：
=(710 +	720 + ”20	• r.VO + 〃V0 )
(3-2)
这里随机变量/ =	表示时间差的测量误差，独立同分布的随机变量
〃，〜"(O,，).:。,[, 1表示到达时间的测量误差。从数学上来讲，S是一个N 维的正态随机变量，其均值向量是r,协方差矩阵是实对称正定矩阵MB,即
29
s~7V(r,o-2B),这里B = 1nX1J+In，/是全1向量，八，是单位矩阵。进一步 定义n=s-r,则有n〜Nd/B)成立。	--
通常认为在训练阶段完成后，可以得到实际位置和实际TDOPA向量，因为 在这一阶段可以利用足够多的样本和高精度的设备。然而在测试阶段，由于样本 数量和接收机精度受限，本文认为只有一个样本TDOPA向量被得到。
一个常用的栅格化方法是将区域划分为全等的矩形小区，并且选取中心作为 其参考。本文的模型采用了这种方法。记小区的个数为M,边长为Z, C = {q,C2,是小区的集合。为了简便起见，小区的边和坐标轴平行或垂直.
但是，仍然存在着实行定位的两个问题。其一，两个不同的位置可能对应相 同的TDOPA,这导致从TDOPA到位置的映射不是单射。其次，两条径也许会 有相同的到达时间，导致TDOPA向量没有预期的长度而不可使用。TDOPA和 其他位置特征的结合也许可以解决这些问题。为了理论研究的便利，在后文中， 分析被限定在不存在上述问题的区域中。
本文采用了基于概率论的定位算法。考虑现得到一个来自某小区中心的样本 TDOPA向量S,在小区生和对应实际TDOPA向量£的条件下，s〜成 立，并且条件PDF已知，记为尸(・| q)。所以后验概率密度为 P(.ci Is)= P(s I cJP(q) / XCj6cP(s I	,这里尸(c,)是小区 Cj 的先验概率。根
据 MAP准则(即贝叶斯准则)，可以得到位置估计为 ^=coordinate[argmaxcgC pici \s)],这里coordinate©)指取小区 c,的坐标。如果先 验概率相等，即尸MAP准则等效于ML (Maximum Likelihood,最大 似然)准则(9=coordinate[arg max,® p(s |c,)] o进一步,在正态分布的情况下，这 里的ML准则等效于：
(9=coordinate[argminte(. ^(s-rj/B-'Cs-r;)]	(3.3)
这里L是小区c,的实际TDOPA向量。基于上述模型，本文采用式3-3 (即最小马 氏距离准则RI)作为定位算法。尽管该算法是在小区中心得到，但它对其他位置 也适用，但要损失一些精确性。在后面的分析中，本文假设接收机总是处于某一 小区的中心。
3.3	克拉美罗界
在估计理论和统计学中，CRB表示确定但未知参数的无偏估计器的方差的 下界。用最简单的形式表示，CRB等于费舍尔信息矩阵的逆。
基于上述模型，费舍尔信息矩阵1(。)为：
I(0)=_kG?B-G	(3-4)
30
这里
a[vr(e)i .…	”
g,0 = ―= gj — go,' = 1,2,..., N
SB
g,=(cos@	=
对于一个无偏估计6,其协方差矩阵定义为cov(6) = E[(0-。)(。-。门，方差 定义为 var(6) = E((0 -0)r(e- 0)] = trace{cov(0)],这里 trace。)是矩阵的迹。根据 CRB理论，当NN3时，cov(6)-IT(8)NO成立，这里2O表示公式号左边的矩 阵是半正定的(也称非负定)。进一步，有以下公式成立：
var(O) > trace[F'(e)]	(3-5)
在不引起歧义的情况下，后文将式3-5不等号右边也称CRB,可见它是任意采用 TDOPA的无偏估计的方差的下界。
从数学上来看，通过等效方法，从TDOPA得到的CRB和从TDOA得到的 CRB是相同的。因此，可以得到和TDOA的CRB相同的性质卬卜[33]。
性质1:在正态误差的模型下，没有无偏估计能取得CRB。但是ML估计能 够在N f 8下渐近地取得CRB。
性质2: N越大，CRB越小。
性质3:当镜像的位置满足一种所谓的“均匀角度队列”的情况，即满足公式 4 = a + 2后/(N=04，…,N, ae[0,2万),CRB会取得其最小值4/(1 + 1尸。
本文的定位算法式3-3也是一种ML估计，因此当N足够大时，即镜像足够 多时，它可以渐近地取得CRB。该CRB的数值结果和与提出定位算法方差的比 较将在第五节给出。
3.4	正确估计概率
因为推导定位误差的CDF是繁琐的，如相关研究中所采用的方法【3叱本文 采用正确估计概率作为性能指标。小区%,右。的正确估计概率被记为生，被定 义为 £, = Pr{0 = coordinate(cm) 10 = coordinate^))。
首先，考虑一个只有两个小区4和存在的基础场景。来自小区%和％M 的实际TDOPA向量记为r,“和%,来自小区%,的样本TDOPA向量记为s。根 据定位算法，小区%从小区的正确估计概率记为4,"，可以得到其表达式：
%，,”+产 Pr {(s 一 r J B-' (s - r,„) < (s - rm+1 )r B-1 (s- rm+I)}
31
-Pr{nrB-'n <(r„, -rm+1 +n)7 B-' (rm -rm+I +n)} =「+；&一〃+1)”7(%一%+I)«位一4+了：8-111 >	G-6)
叫口…用)”,,
—0+1)] Zier
这里中(•)是标准正态分布的CDFo
接下来将所有小区纳入考虑。小区%的估计是正确的，当且仅当%从所有 其他小区的估计是正确的。为了得出该正确估计概率与，需要随机变量 (L-1；)■%,i = 1,2,…，加一 l,m + l、.…〃的联合PDF。为了简化，本文采用了近似， 认为它们是独立的。所以正确估计概率2接近与从c,“到其他所有小区的正确估 计概率的乘积，即%,,,/ = 1，2,...,加-1.加+ 1—,"。根据第五节的仿真结果，当b 微小时，即多径到达时间的误差微小时，这种近似接近于仿真结果。在微小误差 的情况下，本文进一步近似地认为一个错误的估计几乎总是最近的小区之一。因 此，如果％最近的四个小区分别是 C"?—2 -* "切一1 *， 2近似为：
匕，a am,m-2am,m-iam,ni+l^m,nn2	(3-7)
如果%的坐标为(xm ym)r , Cm_2,c,i,c,„+1,%,+2的坐标为(x〃，ym ±上丫和 (xm±L K)\因为r的每一个元素有着连续的偏导数，并且上通常和镜像到接 收机的距离相比比较小，本文采用导数近似r„,-rm+1«-iar(0)/ar = -L/vG (1 0)"所以与.近似为：
%”期£J(1 °)G「BTG(1 o)「]	(3-8)
同样地，可以得到从其他最近小区的正确估计概率的近似。最终根据式3-8, 正确估计概率近似为：
o)GrB-'G(l O)7 ]<D2[-^>/(0 l)GrB-'G(O l)r] (3.9)
zvcr	2,va	v 7
本节的剩余部分将介绍正确估计概率式3-9的一些性质。
性质1：。越小，匕越大。
因为函数①⑺是个增函数。因此为了得到高定位精度，需要低的对多径到达 时间的测量误差。
性质2: N越大，乙不会减小。
考虑二次型和,分别代表当N +1和N时式3-9中根号 下的部分，这里*.|=网 Xn+J，并且是任意实数。然后将这两个二次型相 减得到：
32
Xn+iBn+Rn+i - x^B^Xn
(3-10)
这里On是长度为N的零向量。事实上，容易验证，括号中的矩阵是一个有特征 值0(N重)和[N(N+3) + l]/[(N+l)(N+2)]的实对称矩阵，因此它是半正定的。 进一步可以证明该性质。所以，为了得到高定位精度，需要充足的镜像数。
性质3:巴的一个上界是:
(3-H)
采用记号幺=(1 0)GrB-1G(l 0)，和3 = (0 l)GrB-,G(0 1)’,然后根据均值和 算术不等式，凸函数的性质，下面的公式成立：
(3-12)
此外，根据一阶和二阶导数可以验证，再一次地，当满足条件 0 =a+2R/(N+l),i = 0,J..,N, ae[0,2%),即均匀角度队列时，以取得最大值, 并且所以这时取得上界。
图3-3展示了式3-11关于N的数值结果，其中£ = 1, v = lo当N增加时, 该上界也增加并且趋近于1。可以得知，足够数目的镜像对上界是重要的，因为 该上界代表对所有小区的最好的定位精度。以实际场景为例，当栅格化粒度上为 1m时，至U达时间测量的标准差o"为0.7/3e812.3ns时，至少需要9个径，才能有 位置上的正确估计概率可以到达0.8；而同样场景下，测量标准差为0.6/3e8=2ns, 至少需要4个径，才能有位置上的正确估计概率到达0.8。
33
图3-3正确估计概率的一个上界
3.5	仿真验证
本文通过仿真来验证推导和得出数值结果。仿真基于下面的场景：有四个镜 像 SQ,SA,S2,S3,分别位于(200,200),(200,-200), (-200,200)和(-200,-200)o 接收机限制在区域*>o,y>o,x〉y｝。也就是说，如果不采用等效方法，s。是源 点，x = 0和丁 =。是反射体。光速v被设定为1。图3-4展示了该场景。
图3-4仿真场景
图3-5展示了在该场景下的CRB式3-5的数值结果，表3-1列出了部分值, 其中cr = l。可见，CRB随接收机位置的变化而变化，当接收机远离所有镜像时， CRB会显著增加。也就是说，对采用TDOPA的无偏估计器，在这些位置效率会
34
不可避免地降低，例如图3-5中的右上角。对于实际应用，应该尽量避免在CRB 较高的位置继续使用这种定位方法。
OOOOOOOO 05050505 4 3 3 2 2 1 1
SXB A
50	100 150 200 250 300 350 400
X axis
0 0
图3-5 CRB等高线
表3-1CRB和方差（归一化的）
位置	CRB	方差（仿真）
(150.50)	1.22	1.38
(250,50)	2.76	2.90
(250J50)	4.89	5.17
(350,50)	10.1	10.2
(350,150)	23.2	23.8
(350,250)	53.3	54.4
图3-6展示了 b变化时，正确估计概率式3-9和仿真结果的变化，其中£ = 1。 在图中，当b足够小时，近似结果可以接近仿真结果。此外，当。很小时即到达 时间测量误差很小时，正确估计概率比较高。以实际场景为例，图3-3中的距离 单位为m,栅格化粒度£为1m,在位置（150,50）上，当到达时间测量的标准差 为0.4/3e8=L3ns时，正确估计概率为80%左右，也就是说80%的误差小于1m。
35
图3-6正确估计概率
3.6	本章小结
本章提出了一种新型的位置指纹TDOPA。基于TDOPA,本文进一步提出了 一个高斯噪声模型和定位算法。通过该模型和一种等效方法,本文分析了 TDOPA 的CRB和提出算法的正确估计概率。前者是位置估计的方差的下界，后者是位 置估计精度的指标。具体来说，得到了 CRB的闭式解，通过近似得到了正确估 计概率的一个闭式解，然后得到了它的一个上界和随某些参数的增减性。
根据分析结果，这里可以对实际实验做出建议。为了得到较高的正确估计概 率，应该减少每一径的到达时间估计误差，并且利用足够的多径数来形成一个高 维的TDOPA向量。这些结果也是符合直观判断的。
36
第四章 基于LTE PRS的传播时延估计
4.1	问题描述和相关研究
由第二章中的介绍可知，LCS的下行模式定位主要利用PRS进行测距，因 此PRS的传播时延估计是定位流程中的一个基础问题，并且对定位精度有重要 影响。在城市和室内，多径传播会对时延估计带来挑战，这是因为通常认为多径 分量中的首达径对应测距所需要的直线距离，但是它会和相邻多径分量叠加而难 以检测。因此本文关注在多径环境下的LTE PRS的首达径传播时延估计问题， 希望能够提出相关算法，提高估计精度。
时延差估计可以有主动或者被动模式，主动模式是指接收机已知发送信号， 被动模式是指接收机未知发送信号。因为PRS信号根据CID等生成，通过定位 辅助信息的交换，对UE是可知的，所以本文主要关注主动模式的时延差估计方 法，即已知发送信号。在AWGN （Additive White Gaussian Noise,加性白高斯噪 声）信道中，存在着ML估计，它可以渐进地取得CRLB,因此是一种准最佳无 偏估计器［3旬。频域进行的ML估计也被称为频域相关（Frequency-domain Correlation, FC）段］,需要对信号进行傅立叶变换，因此复杂度较高。在时域进 行的ML估计也被称为时域相关（Time-domainCorrelation, TC）以］,它复杂度 较低，因此更常用，对一些 GNSS 中的 DSSS （Direct-Sequence Spread-Signal）信 号，就采用这种方法ML容易证明，在信号是冲激函数的理想情况下，时域相关 方法和频域相关方法等效。
对于多径信道，以上方法不再是最佳估计，甚至不是无偏估计卬］,相比实际 值会偏后，继续使用之前的方法会带来严重的误差。对于OFDM信号，多径信 道可以建模为频域（子载波）上的转移矩阵，基于该模型，可以得到多径信道中 传播时延的ML估计。这时ML方法利用信道矩阵的自相关矩阵，等效于一个多 元函数求极值问题，复杂度高，难以实现Ml。对于ML方法的一些优化有所谓的 “高分辨率”方法，如MUSIC （多重信道分类）【39〕和ESPRIT （Estimating Signal Parameter via Rotational Invariance Techniques,旋转不变子空间）算法口曳它们也 是利用自相关矩阵，但是通过其他手段，避免了多维空间搜索，转化为一维搜索。 为了较为准确地估计信道矩阵的自相关矩阵，通常需要较多的信道矩阵样本，对 于单样本，也可 以通过 SAGE （ Space-Alternating Generalized Expectationmaximization, 空间变换的广义期望最大化）方法进行估计时延参数⑷〕，相关研 究中进一步结合了 SIC （Serial Interference Cancellation,串行干扰取消）方法来
37
提高精度［42］。上述方法均基于信道矩阵，这些方法在实际应用中，一个初始步骤 是对多径成分数目进行估计，以确定模型的尺寸。MUSIC方法画本身也能够进 行该估计，相关研究采用SIC方法进行该估计［42］,但它们需要依赖于预先设定的 门限值，如噪声门限。一些基于信息论准则的方法如AIC （Akaike Information Criterion,赤池信息准则），MDL （Minimum Description Length,最小描述长度准 则）冏和MMDL （MMSE-BasedMDL,基于最小均方误差的MDL）网，它们可 以不需要这样的门限值，易于操作。
除了从频域的信道矩阵入手，另一种思路是对时域相关方法进行改进。例如 通过引入滚降系数修正偏差R5H46］,而不是直接根据峰值。还可以通过综合噪声 功率和信号功率得到一个调和门限值即1,通过该门限来估计首达径时延。还有研 究通过结合上述信息论准则来估计时延147】。
对于具体涉及LTE参考信号PRS时延估计问题，相关研究主要还是基于时 域相关方法的，基于频域信道矩阵的研究较少，如2000年的研究利用传统的时 域相关方法［37］, 2016年的研究利用改进的时域相关方法146348］。本文针对LTE PRS信号，主要基于频域信道矩阵。本文采用MDL-MUSIC联合方式进行时延 估计，并且提出了一种称为“遍历法”的新的联合方式。联合方法不用依赖于预 先设定好的噪声门限。此外，根据SIC-SAGE方法，本文还提出了一种新的“SIC-DFC （SIC-Difiference Frequency-domain Correlation, SIC-差分频域相关）”的联合 方法，这种方法可以有效利用多个样本。本文通过LTE链路级仿真的方式，对这 些算法的性能进行了研究。
本章的第二节描述了发送信号，多径信道和接收信号等的数据模型；第三节 描述MDL-MUSIC联合方法;第四节描述SIC-DFC联合方法;第五节描述了 LTE 链路级仿真平台和仿真场景;第六节展示了仿真结果，并据此分析了算法的性能; 第七节是本章小结。
4.2	数据模型
一个LTE基带的OFDM符号（移除CP）通常建模为如下形式：
其中N是FFT点数，N,是｛-"/2,一汽/2 + 1,..”/2-1｝的子集，代表M个活动 的子载波，渠是子载波左上的归一化符号。采样间隔和带宽相关，例如对于10MHz 系统采样间隔是2Ts,这里Ts=l/（15*2048）ms。在常规CP下，一个LTE子帧包 含14个OFDM符号。如第二章的描述，PRS会被映射到“PRS定位机会”子帧
38
中的RE,在这样的子帧中，仅包含PRS和CRS信号。所以，对于包含PRS的 OFDM符号，N,和邑可以根据系统配置，由式2-3到式2-6得到。
由于多普勒频移可以在估计时延前被校正149］，这里考虑不存在多普勒频移 的影响。鉴于多径信道通常被描述为TDLCTapped-Delay Linear,线形延迟节拍) 模型，这里可以得到接收到的OFDM符号为：
=工4、［〃一 r,］ +	= 0,1,…...	(4-2)
这里。是多径数，4和巴是随机幅度和多径时延，卬㈤〜CN(0。：.)是加性白高 斯噪声。由于CP的保护，这里的移位操作是循环移位。首达径的时延被记为7 ,
=弓一可被称为第Z•径的“过量时延”。多径分量的随机幅度通常被认为是相互 独立的，并且服从复高斯分布，记为q ~CN(0，k)。为了保持接收信号功率一定, 令£:尸；=1。根据平坦衰落的特性，可以认为它们至少在一个OFDM符号内保 持为常量。多径分量的时延是未知的估计目标，特别是首达径的时延，它们在一 段比较长的时间里保持静态［坍，本文认为它们在一次时延估计过程中保持不变。
如果多普勒频偏远小于子载波间隔而且多径时延在CP之内，则接收到的子 载波符号为：
1)	互々
a=&£年'寸'+%左eN,	(4-3)
/=1
这里段和%表示在子载波方上的接收符号和噪声。在高斯白噪声的情况下，信 道矩阵的ML估计等价于LS估计，可以得到信道系数的估计为4 =4/邑。另 外记忆'=匕/邑。于是根据式4-3,并通过矩阵记号，可以得到：
H =@ a + W，	(4-4)
其中
◎ = «) = - f(r2) ... f(r。))
T =(T］ T2 ...
39
这里。月••…底。是N,中元素的一个全排列。进一步信道矩阵的自相关矩阵定义 为P = E(HH〃)。
得到的每一个包含PRS的OFDM符号也被称为一个快拍(采样)，根据每 一个快拍可以得到一个信道矩阵的估计，记作H,,这里左风是快拍序号，
4.3	MDL-MUSIC 方法
MUSIC方法最初作为一种阵列信号的空间谱估计技术被提出14叫广泛运用 在波束成形，到达角估计等领域。它证明特殊条件下(一般容易得到满足)，信 号子空间和噪声子空间存在正交性，这样已知一个子空间，就可以重建另一个子 空间。而信号子空间的基向量包含待估计的参数，得到信号子空间进而能得到信 号参数口纥对于OFDM信号，在子载波上，时延变换为相位差，其模型类似于 阵列信号，因此可以使用MUSIC方法进行参数估计。
MDL方法最早在于1978被提出切］,应用在在信息论和机器学习领域。MDL 方法是“奥卡姆剃刀原理”形式化的一种结果，其想法是，在给予假说(即模型) 的集合的情况下，能产生最多观察数据压缩的那个假说是最好的。其中的描述长 度函数通常由两部分加和产生，其中第一项代表某一模型的描述长度，例如编码 模型参数所使用的比特数；第二项表示该模型下观测样本的描述长度，这里运用 信息论的原理，描述长度等于概率的负对数。根据给定的模型集合和观测数据， 计算每个模型对应的描述长度函数，则MDL方法选择的模型为集合中对应描述 长度最小的那一个。
MDL-MUSIC联合估计径数和时延，可以有两种实现方法“两步法”和“遍 历法”。两者都需要自相关矩阵P的估计P =(1	H/H?和它的特征值分
解0 = VAV"，其中八=血吆(4,4,…,4 )是实对角矩阵，4242…之人是特征 值，V=(v, v2 ... V%)是酉矩阵，…,V、是特征向量。此外，还有多径 数搜索范围N, = {1,2,.., %}和时延搜索范围N”。
4.3.1	两步法
两步法的主要思想是分而治之，首先运用MDL方法估计多径数，其次运用 MUSIC方法估计时延。该算法在多径数不大于导频数的情况下才可以进行，即 D6,厚常这种情况成立。根据MDL,多径数的估计记作力，它是使下列函 数取最小看的上的值：
40
MDL(k) = —(N. +1-k)N, log(,丁，-)
'—1—
N +l-k-=~
1	(4-5)
+-k(2Np+2-k)lQgNs,k^p
这里，N. ={1,2,…,NJ是多径数的搜索范围。根据估计结果力，然后可以的得到 噪声子空间G,它包含特征向量G=(v加v. ... V%)。令：
1
P(t) = F-H—，r e N”.	(4-6)
fw(T)GGwf(T)	I )
这里N“.是时延搜索窗。最后基于MUSIC,通过一维搜索，■被估计为尸«)的力 个极大值。
算法流程：
1)计算式4-5,其最小值的序号为估计多径数，记为力；
2)计算式4-6,选择力个极大值为〒。如果极大值个数比力多，则选择其中力 个最大的；如果不足，则选择所有的。最后勺为彳的第一个元素，输出结果。
4.3.2	遍历法
遍历法的主要思想是假设选择，首先在一个范围内假设多径数目并得到信道 估计，进而得到一系列的描述长度，然后从中选择一个作为结果。这里选择的依 据是MMDL准则，一种引入先验信息作为训练信息的改进的MDL。遍历法的必 要条件和两步法相同。	一
在一次循环中，假设力= deN0,进而得到G ,然后和两步法中的最后一步 类似，根据MUSIC方法得到T的估计2。MMDL方法需要训练信息，在本模型 中，它是信道的随机幅度，这里通过LS估计从£得到信道随机幅度。采用这种 方法，随机幅度的估计为：
旬=(f"(钓f (钓)一、"(")珥	(4-7)
这里£/=(牝 温 -忠/是第1个样本随机幅度的％的估计。实际上，上述结 果可以进一步简化，因为只有4是后续计算所需的。上述结果被用作MMDL的 训练信息，得到描述长度函数：
k L^v I2
MMDL(k) = N, log。；
tr 4	(4-8)
+3(〃+左)logN,/eN〃
41
这里寸=（1/忆）£也同『，r = （l/M）£wN.H/4，。在N.中，函数在乙处取得 最小值在deN；的范围中，重复上述步骤，得到一系列候选者，从中选出 最终结果力=&，p = argmini/eNpZJ o最后，/在循环中得到。
算法流程：
1）令力= deNp,然后计算式4-6并选择d个极大值作为2；
2）计算式4-7估计信道信息4,；
3）计算式4-8得到最小描述长度乙和对应的估计D, .
4）在dwN的范围中重复步骤1一3；然后得到力=4, P = argmin（/eN并 且？在4 =方时的步骤1中取得。最后［为♦的第一个元素，输出结果。
4.4	SIC-DFC 方法
SAGE方法最早在1994年提出〔冽。该方法是EM（ Expectation-Maximization, 最大期望）方法在信号参数估计问题上的应用。EM方法通常用来处理利用丢失 特征的样本的参数估计问题，它由两个步骤交替进行，第一步是计算期望（E步 骤），利用对变量的现有估计值，计算对数似然函数关于丢失特征的期望；第二 •步是最大化（M步骤），最大化在E步骤得到的似然函数期望来重新估计参数值。 M步骤得到的估计被用于下一个E步骤，整个过程不断交替进行。宽泛地来说， EM方法也可以指数据的似然函数不断增加的过程。
SIC方法最早在1995年提出国"该方法最初用于CDMA系统的多用户检 测，它是一种串行的检测方法，相比于联合检测，具有复杂度低的特性。它的主 要思想是首先检测能量最大的用户信号，然后从接收信号中减去得到的检测值， 然后从剩余信号中再次检测能量最大的用户信号，以此类推，直到得到所有用户 的信号。
SIC-SAGE方法联合应用了 SIC来估计多径数目和SAGE来估计时延等参 数【42】。本文不涉及阵列信号，没有估计信号到达角的问题，问题有所退化，因此 在本文中这种方法也被称为SIC-FC （Frequency-domain Correlation,频域相关）， 但它只是利用单个快拍，不能有效地利用多个快拍带来的增益。本文通过引入差 分的方式，可以利用多个快拍进行估计。
根据式4-3,有E（H） = 0,因此对于多快拍的情况将不能继续使用信道矩阵。 SIC-DFC方法利用了差分的方法。选择N,中的一个元素作为参考子载波，记为 院,其他子载波组成集合N,/｛左°｝。
由式4-3可得E（m也）.二浦丁国小，用矩阵记号可以表示为 H =	HkHk； ...	于是：
E（H'） = <1>>	（4-9）
42
其中
①，= f，（/）=（f，&） f&）...门诉））
工=（4 t2 ...行）,
「（了尸’屋等J等L ... e
.。=（巧2 %2 ... 喑丫
左，心…，底”是N,/｛七｝的一个全排列。
但在实际中，不能得到准确的E（H，），这里采用其ML估计 宜理）=（1叱）£叽加/。
定义频域相关函数如下：
z（T,x） = f,w（r）x,TeN1,.	（4-10）
在每一次迭代过程中，根据频域相关函数的可以估计出多径时延和功率：
"arg max』z（了, x）「	（4-11）
从接收信号中减去已经得到的估计值名和f, i = L2,…,八1, d-\<Np, 可以去除多径的干扰，如：
--
X = WNm&）	（4-13）
Z = 1
进行多次迭代，直到满足退出条件或者超出范围。这里退出条件设定为检测 到的多径功率小于某一个“低门限”，认为检测到了伪多径，回退上一步后退出； 或者已经检测到的多径功率和大于某一个“高门限”，认为检测到了所有多径分 量，直接退出。
算法流程：
1）初始化d = l；
2）根据d计算式4-13,得到X；
3）根据式4-10计算X）,并根据式4-11和4-12得到打2和3 ；
5）如果3/小于低门限值，回退上次循环的结果，退出；如果2：田,2大于高门 限值，退出；如果超出多径搜索范围N。，退出；否则，d = d + T,返回步骤 2）。最后。为得到的估计｛今｝中最小的元素，输出结果。
43
4.5	仿真平台和场景
4.5.1	仿真平台
因为目前没有合适的理论分析工具来评价时延估计算法的性能，本文通过链 路级仿真进行算法性能研究。仿真平台基于LTE系统。在仿真中，PRS信号根 据第二章的描述生成。含有PRS的OFDM符号根据标准团生成，并加上常规 CPo在定位机会中，包含上述OFDM符号的子帧被重复地从一个eNB发送到一 个固定的UE。因为差分后可以消除定时误差，所以为了简便起见，这里假设不 存在定时误差。
根据上述仿真需求，本文搭建了仿真平台，其组成如图4-1所示，现对其进 行介绍。
图4-1仿真平台
仿真平台的组件按照功能可以被划分为主过程，发射部分，信道部分，接收 部分，估计器部分，还有结果分析工具。
其中主过程main负责初始化仿真场景相关参数，维护进行蒙特卡洛仿真循 环，调用其他功能模块，最后进行仿真数据的格式化存储。
发射部分产生定位机会子帧，包含函数GenerateSubframe, GeneratePRS, GenerateCRS , ResourceMapping 和 GenerateRandom。GenerateSub行ame 调 用 GeneratePRS, GenerateCRS 和 ResourceMapping 产生 PRS 和 CRS 信号包含的 RE 索引，对应的QPSK符号，并将它们映射到RB上，然后对子载波符号做IFFT
44
可以得到OFDM符号，最后加上CP,封装成子帧。GeneratePRS和GenerateCRS 会调用GenerateRandom,按照定义产生CRS和PRS的RE索引，QPSK符号。 GenerateRandom产生随机随机序列。
信道部分根据信道模型，将信道的影响作用在输入信号上，得到输出信号； 包含函数 Channel_main, ETU, PassAWGN 和 PassDelay。其中 Channel_main 根 据参数设置（ETU,瑞利衰落或AWGN）的不同，调用不同的信道函数。ETU根 据ETU信道模型，将信号通过不同时延的瑞利衰落信道，最后加上加性噪声。 PassAWGN根据输入参数衰落幅度值和噪声功率，使信号通过具有一定幅度的 AWGN信道。PassDelay将循环移位作用在输入参数信号上。
接收部分对接收信号进行处理，得到OFDM符号或者导频符号，包含函数 GetOFDMSymbol, GetSC Symbol, SplitSubframe 和 ResolveSubframe。其中 GetOFDMSymbol 调用 SplitSubframe 和 ResolveSubframe,来得到输入参数指定 的OFDM符号和对应的RBo GetSCSymbol同样调用ResolveSubframe来得至U PRS导频上的子载波符号和对应的子载波序号。SplitSubframe的作用是将输入参 数的子帧分割为OFDM符号和CPo ResolveSubframe的作用是将输入参数的子 帧解调为RB,它的作用与ResourceMapping的作用相逆。
估计部分以OFDM符号或者子载波符号为输入，输盅对首达径传播时延的 估计。根据同一组接收信号，多种估计算法并行进行。有些算法在时域进行，因 此会调用GetOFDMSymbol得到OFDM符号，有些算法是在频域进行，因此会 调用GetSCSymbol得到导频上的符号。另外，由于是主动模式的估计，估计器 还能得到一份发射信号的副本，同样地根据其需要得到QFDM符号或者导频符 号。估计器也会调用一些基础的数学运算函数，如CircularShift, EigenSort和 Inner_LSo由于不同估计器的实现方式不同，提出的算法之前有过详细描述，后 文将对比较算法进行简要介绍，这里不再赘述。
分析工具根据不同参数下的主过程输出的结果，对于特定的性能指标进行统 计，绘制图表。这里采用的性能指标后文将详细描述。因为需要对不同参数下算 法输出的结果做进一步的统计，所以这一部分的子过程子函数比较繁杂，故不再 赘述。
4.5.2	仿真场景
本文的仿真基于10MHz的LTE下行链路。在接收端，这里只采用每个子帧 的第4个OFDM符号（包含PRS）来估计时延。实际的首达径时延被设定为10 个采样点，大约对应于195m的距离，即UE距eN百中等距离。时延搜索窗 宽 度N,, = max（N..）设定为80个采样点，即CP的长度，步长为0.1个采样点。多径 数搜索范围N,设定为｛1,2,…,15｝。蒙特卡洛仿真次数为100.
45
仿真中的信道基于ETU （Extended Typical Urban,扩展典型市区）信道，它 是一种标准化的用来描述城市地区多径衰落情况的模型154］。本文将其离散化为 表4-1,对应式4-2中的参数。采用单天线配置，天线端口 1和6映射到该天线。 多普勒频移被忽略，因为UE是静止的。其他相关参数见表4-2。
表4-1 ETU信道模型
多径	过量时延f ns）	相时功率（dB）	△心（采样）	oF (|J | 化)
1	0	-1.0	0 .	0.1241
2	50	-1.0	1	0.1241
3	120	-io	•)	0.1241
4	200	0.()	3	0.1536
5	230	0.0	4	0.1536
6	500	0.0	8	0.1536
7	1600	-3.0	25	0.0783
8	2300	-5.0	35	0.0494
9	5000	-7.0	77	0.0312
表4-2仿真假设
参数	假设	参数	假设
小区ID	1	CP类型	常规
网络同步	I1 il 步	OFDM数仔帧	14
双1	FDD	「帆ID	1.2..…M
带宽	10MHz	PRS带窕	0J，
载波频率	店带	多多信道模型	ETIJ
物理天线	ITX/IRX	噪方功率
RB数强	50	传播时簸/采样	10
FFT点数	1024	VE速展	0
4.5.3	对比方法
本文在相同的场景下仿真研究了其他几种时延估计算法，并和提出的算法作 了比较。从输入参数来分类：这些比较算法可以分为时域类和频域类，其中时域 类算法以OFDM符号为输入，基于时域相关函数；频域类算法以信道矩阵为输 入，基于频域相关函数或者自相关矩阵。
46
时域类算法函数包括 TC-1 Sample, TCLastMean-MSamples 和 TCThr-MSampleso其中TC-1 Sample函数是对经典的时域相关函数的实现，利用一个子 帧（一个快拍），并且将相关谱峰值对应的时延作为估计值。TCLastMean-MSamples 函数是对经典方法在多子帧上的扩展，但这里最终结果是对每一子帧 估计结果的均值。TCThr-MSamples函数是基于噪声门限的时域相关算法的实现 RI,其中作为输入参数的噪声功率使用了真实的噪声功率，调和参数按照原文中 的设定，需要注意到这种设定过于理想，因为实际得到的是噪声功率估计。
频域类算法函数包含之前叙述的MDL-MUSIC算法和SIC-DFC算法的实现， 其中两步法的实现记为MM-MSamples,遍历法的实现记为MLM-MSamples, SIC-DFC算法的实现记为SDFC-MSamples,其中低门限设定为0,高门限设定 为09 参考载波选择为最接近直流载波的一个。此外，还包括SFC-1 Sample函 数，它是SIC-SAGE算法的实现用］,这里SIC检测的停止门限值设定为2倍的 实际噪声功率。
4.6	仿真结果和分析
理论上，如果得知估计误差的PDF或CDF就可以完全确定估计器的性能特 性，但很难得到它们的闭式解。通过蒙特卡洛仿真的方法可以得到经验的CDFo 经验CDF是指从某一样本的测量得到的分布函数。经验CDF是一个阶跃函数， 在每一个样本点处都会产生跳变。在某一给定的参数下，某一变量的经验CDF 的值为小于或者等于该数值的观测样本在样本集所占的比例。相关定理证明，经 验CDF依概率收敛于CDF,因此可以视为对CDF的估计。为了方便地对不同算 法进行横向比较，实际上本文采用了从CDF得到的一些性能指标而不是经验 CDF本身。
估计算法的性能可以从精度和效率两个方面来考察。精度是指估计结果和实 际结果的接近程度，而效率是指估计结果的离散程度。一个理想的估计算法应该 是精度和效率两方面都比较高。这里首先定义误差，本文的误差定义为估计结果 和实际结果的差的绝对值，即绝对误差。为了反映精度，本文采用了经验CDF的 某分位值作为性能指标,称为“％x的误差”，其定义为所有误差样本中大于或等 于总体中最小x%的误差样本的最小值，即经验CDF中不小于x%的第一点。这 里x取80代表大多数的样本能够达到的精度。为了反映效率，这里采用方差来 说明估计误差的离散程度。上述指标，均是越低越好，x%的误差越低，说明精度 越高；方差越低，说明效率越高。
考虑一个随机估计算法，即将时延随机地，均匀地估计为时延搜索窗的任意 值。这种估计器不会利用输入信号的任何信息，可以作为一个性能的基线。如果
47
上述估计算法的精度比该随机估计好，则说明算法是有效的。容易计算，在本章 的仿真场景下，这种随机估计算法的80%的误差是54个采样点，即108Ts。
首先考察信噪比对各估计算法性能的影响。因为PRS子载波的功率为1,这 里表示每个子载波上的信噪比。图4-2和图4-3展示了 80%的误 差和方差关于纥/N℃的关系，这里子帧数凡=30, PRS带宽N0=50。通过图 4-2可以看出，在-6到12dB的范围中，所有算法的精度均高于随机估计算法， 因此都是有效的。对于MDL-MUSIC方法,其精度会随着的提升而提升。 当EsINoc高于9dB时,MDL-MUSIC在所有算法中提供最高的精度,约为0.2Tso 当瓦在-6到3dB时，遍历法的精度高于两步法，但大于3dB后，其精度 不如两步法。可见,遍历法在较低瓦/N℃时，可以提升精度,但瓦/N“较高时， 提升不明显。说明在较低及/N℃时，遍历法中LS估计得到的训练信息提升了多 径数估计效果；在较高纥/ 时，遍历法估计多径数目的正确性反而有所下降， 可能是MMDL算法本身引起的。当瓦/N℃在一6到6dB时，SIC-DFC算法的精 度比SIC-FC的要高，说明了提出的方法能够有效利用多个快拍，带来性能的提 升。当纥/N”更高时，两种算法的精度相当。提升不明显可能是由于这时影响精 度的主要原因已经不再是噪声，而是SIC-FC算法本身的误差引起的。因为每一 次迭代中估计结果的误差会被引入下一次估计中。当EJN”.足够高时，如大于 9dB,所有算法的精度提升有限。从图4-3中可以看出，月/%,的提升会带来所 有算法效率的提升，并且当£/N或足够高时，各算法的效率提升也有限。MDL-MUSIC的两步法和遍历法的效率相近。在6dB以下的中低瓦/底时，SIC-DFC 算法的效率要高于SIC-FCo
«-।---H------B-----B----r-B----S-i----D-
(匕①
£,/N“(dB)
图4-2 80%的误差关于信噪比
口 WLM-MSampleg
口 MM-MSamples
口 SDFC-MSamples
g SFC-1 Sample
^CLastMean-MSamoles ”.TCThr-MSamples
口 TC-1 Sample
48
600
500
400
200
100
_ 300
0
-10	-5	0	5	10
及/M/dB)
15
图4-3方差关于信噪比
接下来考察PRS带宽对各估计算法性能的影响。N肾 表示了 PRS所占的
RB个数，其小于系统总RB数。更多的PRS带宽会带来更大的系统开销，从而 降低用户的数据调度。图4-4和图4-5展示了 80%的误差和方差关于N优的关
系，这里氏/N8 = 4 , N. = 30。从图4-4可见，MDL-MUSIC算法和SIC-DFC算 法都需要一定的陪，当不满足该要求时，精度较低，满足该要求时，精度较高， 但继续增加N察对精度的提升并不明显。MDL-MUSIC遍历法和SIC-DFC算法 至少需要20RB,而MDL-MUSIC两步法至少需要30RB。从图4-5中可以看出， N肾的增加会提升各算法的效率，对SIC-DFC算法和SIC-FC算法的提升比较 明显，对其他算法的提升不太明显。
(1) ①
n黑,
图4-4 80%的误差关于PRS带宽
49
最后考察子帧个数对各估计算法性能的影响。M表示参与估计的子帧个数, 因为仿真中每个子帧只利用了其中的一个OFDM符号,子帧数也等于快拍数。 更多的PRS子帧会带来更大的系统开销，降低用户的数据调度，也意味着更长 的响应时间。图4-6和图4-7展示了 80%的误差和方差关于Ns，这里耳/ = 4 , N/=50。从图4-6可见，当子帧数满足一定要求后，更多的子帧对精度的提升 有限。MDL-MUSIC两步法至少要求20子帧，遍历法要求30子帧，其他算法在 满足30子帧后也能有稳定的性能。从图4-7可见似的规律，故不再赘述。
「1) ％09@)」oi=。
图4-6 80%的误差关于子帧数
MLM-MSamples MM-MSamples
—H- SDFC-MSamples
-TCLastMean-MSamples
TCThr-MSamples
50
120
100
80
40
20
目前没有研究指出多径信道中的时延估计的CRB,在AWGN信道中CRB 可以作为多径信道下CRB的一个下界RI。本文通过仿真比较了误差的方差和该 CBR,可以看出它们之间仍然有着较大差距，见表4-3，这里耳/N8 =8 ,	=50 ,
忆=30。
表4-3 AWGN-CRB和方差（单位：Ts?）
AWGN-CRB	MLM- MSamples	MM- MSamples	SDFC- MSampIe	TCLastMean- MSamples	TCThr- MSamples
0.000074	0.1222	0.0005	1.8841	1.1389	0.1270
除了研究算法的性能，还需要考察其复杂性。对于如手机等智能终端，能量 消耗是一个主要限制，因此这里仅考虑时间复杂性。因为得到算法的时间复杂度 关于问题规模的函数关系比较困难，为了简便起见，从时间复杂度的渐进上界的 角度来看，并且假设计算时间主要由乘法和加法运算消耗。MDL-MUSIC方法因 为涉及到矩阵分解，求逆等操作，因此其渐近上界是导频数量的立方的同阶无穷 大，即O（N；）。SIC-DFC方法和SIC-FC方法涉及频域相关函数的计算，渐近上 界是导频数量平方和搜索窗长度乘积的同阶无穷大，即O（N：N”）。而其他算法涉 及时域相关函数的计算，渐近上界是符号长度平方和搜索窗长度乘积的同阶无穷 大，即OWN.）。渐近上界反映了算法的复杂度随问题规模增加而增加的量级， 但不能反映在确定规模下的复杂度。这里列出了在本文仿真平台下，执行各算法 消耗的时间。表4-4展示了在不同下各算法的平均每个流程的计算时间， 其中N债=50,『=30。
表4-4平均流程计算时间（单位：s）
MLM- MSamples	MM- MSamples	SDFC- MS ample	SFC- 1 Sample	TCLastMean- MSamples	TCThr- MSamples	TC- 1 Sample
13.9544	0.9570	0.0435	0.0085	0.8631	0.8629	0.0312
51
可以看出，利用多快拍的算法复杂度高于利用单快拍的算法，因为涉及到多 快拍平均。此外，基于频域相关的算法如SIC-DFC和SIC-FC的复杂度低于多子 帧的传统时域相关算法和基于噪声门限的时域相关算法。MDL-MUSIC遍历法的 复杂度是最高的，MDL-MUSIC两步法和基于噪声门限的时域相关算法接近。利 用多快拍的算法中复杂度最低的是SIC-DFC算法。
综合上述仿真结果，可以看出当信噪比足够高时，MDL-MUSIC方法能给出 对比算法中最准确的估计。MDL-MUSIC遍历法在中低信噪比的情况下比两步法 的精度更高，在高信噪比的情况下则不如两步法。SIC-DFC算法相比SIC-FC算 法，在中低信噪比下精度更高，这是因为它可以利用多个子帧来提升性能。另外， 在所有的多子帧的算法中，SIC-DFC算法的复杂度最低。
结合第二章所描述的测量精度要求，这里对PRS传播时延估计问题作以总 结。对于传播时延误差要求，这里认为是RSTD要求的一半。因为本文的研究只 考虑了单天线的情况，而且只利用了每一个PRS子帧中的一个OFDM符号，因 此这里不考虑对子帧数的要求。对于不同SNR下的参考小区PRS时延估计精度 要求，在本文的数据模型和仿真假设下，在50RB的PRS带宽和30子帧下，基 于噪声门限的时域相关方法能够满足要求；在信噪比有所改善时，提出的MDL-MUSIC方法和SIC-DFC方法也能够满足该要求。信噪比足够高时,MDL-MUSIC 方法能够给出最为准确的估计结果。在满足要求的所有多子帧算法中，SIC-DFC 方法的复杂度最低。基于噪声门限的时域相关和SIC-DFC都依赖于预设的门限 值，而MDL-MUSIC方法不需要这样的门限值。在实际实现中，具体采用哪一种 方法，需要综合考虑到噪声等级，误差和复杂度等因素。
4.7	本章小结
本章对于LTE下行定位模式中的PRS传播时延估计问题进行了研究。相关 研究多在时域进行，本文的研究基于频域信道矩阵。本文提出了 MDL-MUSIC的 方法，主要思想是MDL估计径数和MUSIC多径分解，包括两步法和遍历法两 种实现方法。本文还基于SIC-SAGE方法，采用差分的方式来利用多个快拍，提 出了一种SIC-DFC方法。然后本文通过基于LTE的链路级仿真，对上述算法的 性能进行了研究。发现MDL-MUSIC方法在较高信噪比下能够提供更为精确的 估计，SIC-DFC方法具有复杂度低的特点。最后结合精度要求，对PRS时延估 计问题作了总结。
52
第五章结论与展望
5.1	本文研究工作总结
本文主要对无线网络定位技术中的某些问题进行了研究。在第一章，本文介 绍了无线定位技术，包括其基本概念，一原理和分类，并简要介绍了两种实用系统 和国内外发展情况。在未来，基于位置的应用给无线定位技术提出了更高的要求, 而基于无线网络的定位技术被视为一种可以提供泛在的高精度位定位能力的方 案，是学术界和产业界关注的热点话题。在第二章，本文对无线网络定位技术进 行了介绍，作为后续章节的基础知识。这一章首先从抽象层面介绍了两种无线网 络定位技术的原理，它们是TDOA定位和位置指纹定位。•接下来，本文简要介 绍了 3Gpp的定位系统(LCS)的架构和流程，并重点介绍了其中的下行定位模 式。下行定位模式是在E-UTRAN中标准化的TDOA定位方式，它利用了 LTE 的PRS来测距。在第三章，基于位置指纹定位方法，本文提出了一种新的位置 指纹TDOPA和对应的定位算法。TDOPA利用了多径传播中的位置特征。这一 章首先根据高斯噪声建立了 TDOPA的模型，然后根据该模型，分析得出了 TDOPA的CRB和定位算法的一些特性。结果表明,为了提高提出的定位算法的 精度，需要减少多径时延的估计误差，并且利用足够多的多径分量。本文希望这 些分析结果对于相应的实验和后续的改进有一定的帮助。在第四章，本文研究了 LCS下行定位模式中的测距所依赖的PRS传播时延估计问题。为了准确测距， 最好能够估计信号从发射机到接收机的直线传播时延，但在多径环境中，首达径 会受到相邻径的叠加影响而难以检测。传统的方法多基于时域相关，而本文基于 频域处理。但是基于频域的信道矩阵，在时延估计时需要面对确定多径数的问题。 本文提出了 MDL-MUSIC的方法，其中包括两步法和遍历法两种实现方式。此 外，本文还提出了 SIC-DFC方法。仿真结果表明，MDL-MUSIC方法在较高信 噪比的条件下能够给出更为精确的估计，而SIC-DFC具有复杂度低的特点。最 后本文对PRS时延估计问题作了总结。本文希望研究结果能对下行定位模式的 最终精度提升有所帮助。
5.2	今后待研究的问题
受限于笔者的学术能力以及客观条件，即使在本文的研究中，也还有一些问 题亟待解决。在多径特征位置指纹定位中，因为缺少实测数据和实验研究，本文 中TDOPA的模型的建立可能过于理想化，而与实际情况不符。因此，后续研究 53
可以通过实验的方式对基于多径特征的位置指纹进行研究。在PRS时延估计问 题中，本文采用的是单收单发的天线配置，对于多天线场景，也许可以利用多天 线之间的独立性得到多个快拍；另一方面，本文研究只利用的了一个子帧中的一 个OFDM符号，其他符号对应不同的PRS图样，同样采用差分的方式到参考子 载波，也许可以将多个符号作为多个快拍利用，具体细节有待研究。最后，基于 频域处理的算法一般都能给出多个径的相关参数估计，能否利用首达径之外的结 果来提升定位精度，例如揭示是否LOS环境等，这些问题也有待于后续研究。
参考文献
[1]腾讯科技，日均定位服务调用突破500亿-腾讯位置服务升级五大行业解决方 ^[EB/OL], http://tech.qq.eom/a/20161208/029883.htm.
[2]	Bensky A. Wireless positioning technologies and applications[M]. Artech House, 2016.	- -
[3]	GPS.GOV GPS Accuracy[EB/OL]? https://www.gps.gov/systems/gps/performan ce/accuracy/.
[4]	WIKIPEDIA, Global Positioning System[EB/OL]? https://en.w汰ipedia.org/wiki /Global __Positioning_System.
[5]	Apple, Apple Q&A on Location Data[EB/OL], https://www.apple.com/newsroom /2011 /04/27Apple-Q-A-on-Location-Data/.
[6]	Glenn Fleishman, How the iPhone knows where you are[EB/OL], https: /Avww.macworld.coni/article/1159528/smartphones/how-iphone-location-works.html.
[7]国务院办公厅.国家卫星导航中长期发展规划[EB/OL], http://www.gov.cn /zwgk/2013-10/09/content_2502356.htm.
[8]单良，丁震，北美E911素统建设和发展初探[J],中兴通讯技术(简讯)，2010, (6):2728.	」
[9]吴静.3G定位业务的网络结构分析[J].移动通信,2006, 30(5): 54-56.
[10]	SHYHOOK, About[EB/OL], http://www.skyhookwireless.com/about--skyhook.
[IIJSayed A H, Tan ghat A, Kliajehnouri N. Network-based wireless location: challenges faced in developing techniques fbr accurate wireless location infbrmation[J]. IEEE signal processing magazine, 2005,22(4): 24-40.
[12]Chan Y T, Ho K C. A simple and efficient estimator for hyperbolic location[J]. IEEE Transactions on signal processing, 1994, 42(8): 1905/915.
[13]Gustafsson F, Gunnarsson F. Positioning using time-difference of arrival measurements[C]//Acoustics, Speech, and Signal Processing, 2003. Proceedings.(ICASSP'03). 2003 IEEE International Conference on. IEEE, 2003, 6: VI-553.
[14]Chan Y T. Hang H Y C, Ching P. Exact and approximate maximum likelihood localization algorithms1/. IEEE Transactions on Vehicular Technology, 2006, 55(1): 10-16.
[15]Foy W H. Position-location solutions by Taylor-series estimation[J]. IEEE Transactions on Aerospace and Electronic Systems, 1976 (2): 187-194.
[16]Mensing C, Plass S. Positioning algorithms fbr cellular networks using TDOA[C]//Acoustics. Speech and Signal Processing, 2006. ICASSP 2006 Proceedings. 2006 IEEE International Conference on. IEEE, 2006, 4: IV-IV.
[17]Wu C, Yang Z. Liu Y. Smartphones based crowdsourcing for indoor localization^]. IEEE Transactions on Mobile Computing, 2015,14(2): 444-457.
[18]Niu J. Wang B. Cheng L. et al. WicLoc: An indoor localization system based on WiFi fingerprints and crowdsourcing[C]//Communications (ICC), 2015 IEEE
55
International Conference on. IEEE, 2015: 3008-3013.
[19]Bald P, Padmanabhan V N. RADAR: An in-buildiilg RF-based user location and tracking system[C]//D>JFOCOM 2000. Nineteenth Annual Joint Conference of the IEEE Computer and Communications Societies. Proceedings. IEEE. Ieee, 2000,2: 775-784.	_
[20]3GPP? TS 22.071 VI4.1.0, Technical Specification Group Services and System Aspects; Location Services (LCS)； Service description; Stage 1 (Release 14) [S], 2015-09.
[21]3GPP, TS 23.271 V14.2.0? Technical Specification Group Services and System Aspects; Functional stage 2 description of Location Services (LCS) (Release 14) [S], 2017-06.
[22]3GPP, TS 36.305 VI4.2.0, Technical Specification Group Radio Access Network;
Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Stage 2 functional specification of User Equipment (UE) positioning in E-UTRAN (Release 14) [S]? 2017-06.
[23]3GPP？ TS 36.211 VI4.1.0, Technical Specification Group Radio Access Network; Evolved Universal Terrestrial Radio Access (E-UTRA); Physical channels and modulation (Release 14) [S]? 2016-12.
[24]Fischer S. Observed time difference of arrival (OTDOA) positioning in 3GPP ITE[J]. Qualcomm White Pap, 2014.
[25]3GPP, TS 36.214 V15.0.0, Technical Specification Group Radio Access Network;
Evolved Universal Terrestrial Radio Access (E-UTRA); Physical layer; Measurements (Release 15) [S], 2017-09.	-
[26]3GPP, TS 36.133 V14.4.05 Technical Specification Group Radio Access Network; Evolved Universal Terrestrial Radio Access (E-UTRA); Requirements for support of radio resource management (Release 14) [S], 2017-06.
[27]3GPP, TS 36.355 VI4.3.0, Technical Specification Group Radio Access Network; Evolved Universal Terrestrial Radio Access (E-UTRA); LTE Positioning Protocol (LPP) (Release 14) [S], 2017-09.
[28]3GPP, TS 36.101 VI5.0.0, Technical Specification Group Radio Access Network; Evolved Universal Terrestrial Radio Access (E-UTRA); User Equipment (UE) radio transmission and reception (Release 15) [S], 2017-09.
[29]Hossain AKMM, Van H N, Jin Y, et al. Indoor localization using multiple wireless technologies[C]//Mobile Adhoc and Sensor Systems, 2007. MASS 2007. IEEE International Conference on. IEEE, 2007: 1-8.
[30]Kaemarungsi K, Krislmamuithy P. Modeling of indoor positioning systems based on location fingerprinting[C]//INFOCOM 2004. Twenty-third Annual Joint Conference of the IEEE Computer and Communications Societies. IEEE, 2004,2: 1012-1022.
[31 ]Honkaviita V, Perala T? Ali-Loytty S, et aL A comparative survey of WLAN location fingerprinting metliods[C]//Positioning, Navigation and Communication, 2009. WPNC 2009. 6th Workshop on. IEEE, 2009: 243-251.
[32]Yang B, Scheuing J. Cramer-Rao bound and optimum sensor array for source localization from time differences of arrival[C]//Acoustics, Speech, and Signal
56
Processing, 2005. Proceedings.(ICASSPf05). IEEE International Conference on. IEEE, 2005, 4: iv/96biv/964 Vol. 4.
[33]Lui K W K? So H C. A study of two-dimensional sensor placement using time-difiference-of-arrival measurements [J]. Digital Signal Processing, 2009, 19(4): 650-659.
[34]SM-凯(美)，Kay S M,罗鹏飞，等.统计信号处理基础：估计与检测理论 [M].电子工业出版社,2003.
[35]倪浩.OFDM无线系统中的TOA估计技术研究[D].西安电子科技大学, 2010.
[36]Pahlavan K： Li X, Makela J P. Indoor geolocation science and technology [J]. IEEE Communications Magazine, 2002, 40(2): 112-118.
[37]Xu W, Huang M, Zhu C, et al. Maximum likelihood TOA and OTDOA estimation with first arriving path detection for 3GPP LTE system[J]. Transactions on Emerging Telecommunications Technologies, 2016, 27(3): 339-356.
[38]Stoica P, Nehorai A. MUSIC, maximum likelihood, and Cramer-Rao bound[J]. IEEE Transactions on Acoustics, Speech, and Signal Processing, 1989, 37(5): 720741.
[39]Oziewicz M. On application of MUSIC algorithm to time delay estimation in OFDM channels[J]. IEEE Transactions on Broadcasting, 2005, 51(2): 249-255.
[40]Vanderveen M C, Van der Veen A J, Paulraj A, Estimation of multipath parameters in wireless communications [J]. IEEE Transactions on Signal Processing, 1998, 46(3): 682-690.
[41]Xie Y Georghiades C N. Two EM-type channel estimation algorithms for OFDM with transmitter diversity [J]. IEEE Transactions on communications, 2003, 51(1): 106-115.
[42]	Chong C C. Laurenson D I, Tan C M, et al. Joint detection-estimation of directional channel parameters using the 2-D frequency domain SAGE algorithm with serial interference cancellation[C]//Communications? 2002. ICC 2002. IEEE International Conference on. IEEE, 2002, 2: 906-910.
[43]	Wax M, Kailath T. Detection of signals by information theoretic criteria[J]. IEEE Transactions on Acoustics. Speech, and Signal Processing, 1985, 33(2): 387-392.
[44]Huang L. Long T, Mao E, et al. MMSE-Based MDL Method for Accurate Source Number EstimationfJ], IEEE Signal Process. Lett., 2009. 16(9): 798-801.
[45]Yamasaki R, Ogino A, Tamaki T, et aL TDOA location system for IEEE 802.11 b WLAN[C]//Wireless Communications and Networking Conference, 2005 IEEE. IEEE. 2005.4: 2338-2343.
[46]Su B. Cui J. Li A. et al. Performance Study on the ECID Positioning Enhancement in LTE-A Het-Net with RRH[C]//Vehicular Technology Conference (VTC Fall), 2015 IEEE 82nd. IEEE, 2015: 1-5.
[47]Giorgetti A. Chiani M. Time-of-arrival estimation based on information theoretic criteriafJ]. IEEE Transactions on Signal Processing, 2013, 61(8): 1869-1879.
[48]Nokia, 3GPP R4-100797, Link Simulation Results for RSTD Accuracy[S]r Feb 2010.
[49]Shamaei K. Klialife J, Kassas Z. Performance characterization of positioning in
57
LTE systems[C]//Proceedings of ION GNSS Conference. 2016: 2262-2270.
[50]张贤达.现代信号处理[M].清华大学出版社有限公司,2002.
[51]Rissanen J. Modeling by shortest data description[J]. Automatica, 1978,14(5): 465-47L
[52]Fessler J A, Hero A O. Space-alternating generalized expectation-maximization algorithni[J]. IEEE Transactions on Signal Processing, 1994, 42(10): 2664-2677.
[53]HoltzmanJM. DS/CDMA successive interference cancellation[M]//Code Division Multiple Access Communications. Springer US? 1995:161-180.
[54]3GPP, TS 36.104 VI 5.0.0, Technical Specification Group Radio Access Network; Evolved Universal Terrestrial Radio Access (E-UTRA); Base Station (BS) radio transmission and reception (Release 15) [S], 2017-09.
