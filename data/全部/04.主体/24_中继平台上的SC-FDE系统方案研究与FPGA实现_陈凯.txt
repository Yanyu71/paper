第一章绪论
近几年，随着移动互联网的兴起，物联网概念的实现，智能终端的井喷式发展，人 们对移动通信的主要需求从简单的语音业务转变为复杂的数据业务。数据业务对通信网 络的要求与语音业务有很大的不同，语音业务需要保证通信的实时性，而数据业务则更 多的关注数据带宽和数据误码率。就互联网现状而言，缺少的不是业务的制造者而是优 质的传输网络，因此将互联网业务更快的传递到用户手里，让用户接触更多的业务内容 成为了通信网络关注的焦点。基于这样的理念与事实，我国在3G刚刚部署完成不久， 便开始4G网络的部署。这也体现了当下通信网络的矛盾一一服务以及用户需求的增长 超过了网络传输速度的增长。
1.1 SC-FDE 简介
移动网络中使用的信道是无线信道，无线信道的特点是不确定性。当信号在无线信 道中传输的时候，复杂的信道环境会导致接收机接收到的信号不是单一路径信号，而是 由经过多条路径传输的信号叠加而成的信号。不同的路径具有不同的时延与衰减，当这 些信号进行叠加的时候，造成当前码元的釆样信号受到过往信号的干扰，这种干扰称为 多径干扰或码间串扰(ISI)。从频域的角度看，码间干扰表现为频率选择性衰落，而当最 大多径时延远小于码元周期的时候，码间干扰则表现为平坦型衰落⑴。为了减小码间干 扰对通信质量的影响，最常用的方式是进行均衡。码间干扰在时域上表现为对时域信号 的畸变，因此均衡往往被描述为对时域畸变的补偿，使判决前的信号接近发送信号。
随着现代通信系统的传输速率越来越高，传输信号受到的多径干扰越来越严重，消 除或减小多径效应成为了系统性能的保证。现代通信系统一般使用正交频分复用(OFDM) 和单载波频域均衡(SC-FDE)⑵来规避或减小多径效应。
OFDM是一种多载波数字调制技术团，它使用多个相互正交的子载波来承载用户数 据2 OFDM系统总的传输能力是所有并行子通道传输能力之和。采用这样的方式，降低 了对每个子信道传输能力的要求，即使在系统传输速率很高的情况下，每个子载波上承 载的数据速率也可以相对较低，因此每个子载波受到的多径干扰就没有那么严重。虽然 OFDM釆用这种方式可以不使用均衡器来抵抗多径效应，但是也引入了一些新的问题。 由于OFDM系统将不同频率不同相位的多个子载波叠加在一起，这会导致发射端信号 的功率峰均比(PAPR)非常高，为了不引起信号的非线性失真，OFDM系统对发射机， 特别是移动设备上发射机功率放大器的线性范围提出了更高的要求。其次，OFDM将信
号分配到多个子载波上，这种处理方式虽然能够增大系统的传输能力，但却导致了接收 端对频偏非常敏感，容易造成载波间干扰，增加了接收机的设计难度。
为了克服OFDM系统的缺陷，并在保证系统传输速率的前提下提高系统的抗多径 能力，研究学者提出了 SC-FDE系统。SC-FDE是一种单载波系统，不存在PAPR过高 的问题，抗频偏的能力也较OFDM系统有所提升。SC-FDE抗多径的能力主要来自均衡 器。传统的均衡器多为时域均衡器，其结构多为横向滤波器，随着最大多径时延的增长， 时域滤波器的抽头系数也相应增加。随着系统基带速率的不断提升，虽然最大多径时延 的绝对值不会增加，但是传输过程中受到干扰的码元数量却不断增多，为有效减少码间 干扰，就必须增加滤波器的系数个数。由于滤波器系数一般是通过对线性方程组的求解 得到，而方程组求解与系数个数之间是平方复杂度，这就意味着，随着系数个数的增加， 算法的实现难度将越来越大。而且滤波器系数的增加会导致均衡器所需的乘法器个数增 多。由于时域均衡器的这些缺陷，频域均衡逐渐成为研究的热点。频域均衡实现复杂度 低，是线性级别，即使系数增加，也不会岀现复杂度灾难，降低了硬件实现难度。同时 研兖人员发现，将SC-FDE系统与MIMO技术结合在一起，可以获得接近OFDM系统 的传输能力网。
SC-FDE系统分为单载波和频域均衡两个方面，其中单载波部分主要负责降低PAPR 与减小频偏干扰，而FDE则主要负责克服多径效应，保证系统的传输性能。本文着重 于均衡技术进行了两个方面的研究，一是对于均衡系数的设计；二是对于均衡器结构的 设计。均衡系数的确定主要依据两个准则：一个是峰值畸变准则，一个是最小均方误差 准则（MMSE）,这两种准则分别对应迫零算法与最小均方算法（LMS）。从均衡器结构 上来分，有线性和非线性两种。线性均衡器常用横向滤波器实现；非线性均衡器则分为 判决反馈均衡器与自适应均衡器。线性均衡器的实现较为简单，但性能较差，北线性均 衡器实现比较复杂，但性能优于线性均衡器⑸。
由于SC-FDE对功率放大器要求低，数据处理集中在接收端，具有与OFDM相媲 美的传输速率，使得它非常适合作为移动终端的发射系统，因此被LTE采纳为上行传输 标准⑹。
1.2课题背景及国内外研究现状一
对SC-FDE系统的研究近年来正在逐渐增加。为了提高系统性能，国内外的学者从 各个方面提出了改进方法。针对SC-FDE的系统结构，主要由两个方面的改逬：一个是 对均衡系数估计方法的研究；另一个是对均衡器结构的研究。另一个主要的研充方向是 通过调节通信系统的各个方面，组合不同的结构，来提高系统的性能。文献卩〕对非线性 判决反馈均衡器提出了改进，以优化系统。学者Hwang Taewon等提出了重组CP的迭 代方法算法，该算法能够在-定程度上提高系统的频带利用率⑻。Emad S. Hassan等四
学者提出了连续相位调制(CPM)与SC-FDE系统的结合，他们发现，使用CPM调制的 SC-FDE系统具有不逊于OFDM系统的传输能力。此外，还有MIMO与SC-FDE系统 的联合研究，通过引入MIMO, SC-FDE系统也可以获得不逊于OFDM的传输能力。
SC-FDE系统需要精确的定时同步以获得良好的系统性能。SC-FDE系统在实际应 用中一般作为对OFDM系统的补充，因此可以借鉴OFDM的同步技术来研究SC-FDE 系统的同步方案。回顾OFDM同步算法的研究历史，1992年，基于数据辅助的OFDM 同步算法开始兴起。1994年，Moose首先提出了基于两个OFDM符号的定时同步方法， 以后的OFDM系统同步算法中的同步码字便大多是两个符号。随后，Classen设计了利 用两个子载波上的导频进行同步的方法，但是由于算法计算量太大，无法工程实现。 Schmidl和Cox改进了 Classen的方法，提岀了经典的Schmidl&Cox符号定时同步算 法，该算法使用了两个训练序列，能够同时进行符号同步和频偏估计卩叽但由于Schmidl &Cox算法中测度函数的峰值平台会给符号定时带来干扰，H.Minn等对Schmidl&Cox 算法进行了改进【⑴，将同步码字分成4个部分。Minn算法的测度函数在同步位置会呈 现出一个峰值，能够准确的进行符号定时，但是由于同步码字的缺陷，测度函数在错误 的位置会出现一个比较大的虚假峰值，造成错误的定时同步。Park继承了 H.Minn改进 同步码字的思路［⑵，使用共扼对称的同步码字，消除了 Schmidl&Cox算法中的峰值平 台，Park算法的测度函数只会在最大值处形成一条脉冲，抑制了虚假峰值。在这之后， 更多的学者从不同的角度研究并提出了更多的算法，大都是在这三个经典算法之上提出 的改进方案。总之，基于数据辅助的同步算法都是利用同步码字良好的自相关特性，根 据相关峰值得到定时同步位置。目前主流研究依然使用卷积运算计算相关值，但是已经 有学者开始研究使用FFT计算代替卷积计算相关值卩‘I。Chanho Yoon等在进行SC-FDE 系统的同步与信道估计时，将CAZAC序列引入了同步算法〔⑷。CAZAC序列具有更强 的抗噪声干扰以及自身是复序列等特点，正在逐渐代替PN序列，成为同步码字的首选。
1.3论文内容结构的安排
本文将在课题既有基础上设计，实现并改进SC-FDE均衡子系统与同步子系统。本 文将研究重点放在基带数据的同步及均衡，保证数据的帧同步并消除多径效应，对解调 与判决之后的处理并不作深入研究。
论文的主要结构安排如下：
第二章研究SC-FDE系统工作的信道环境，并对多径信道进行延时抽头系数建模。 在多径信道中传输的信号会受到多径的影响，产生比较严重的码间干扰。通过多径信道 的信号畸变比较严重，如果能够知道信道的传输特性，就有办法在接收端将畸变补偿回 来。均衡是常用的消除码间干扰的方法。这一章主要研究时域均衡技术。时域均衡通过 发送已知训练数据，在接收端利用畸变后的训练序列来估计信道的传输特性，从而找到 对畸变进行补偿的方法。根据对传输特性估计方法的不同，时域均衡可以分为基于峰值 畸变准则的迫零均衡与基于最小均方误差的MMSE均衡；而根据均衡器结构的不同， 又可以分为线性均衡器，判决反馈均衡器以及自适应均衡器。
第三章主要研究频域均衡器的原理和设计方法。本章从频域均衡的原理出发，与时 域均衡设计相对照进行介绍。频域均衡器与时域均衡器原理上有相通的理论概念，特别 是在频域均衡器均衡系数设计方面。参照时域均衡的概念，可以将均衡系数的设计方法 同样归结到经典的迫零均衡与最小均方误差法。就结构而言，频域均衡器同样有线性结 构与判决反馈结构。但是由于频域均衡自身的特性，频域判决反馈均衡器和时域判决反 馈均衡器的设计思路和优化方法不同。本章最后还分析了频偏与定时同步偏差对均衡性 能的影响，对比了时域均衡与频域均衡的计算复杂度。
第四章为本文的理论重点部分。首先研究经典的同步算法。经典的算法大都是时域 同步算法如Schimdl&Cox算法，Minn算法与Park算法。在研究了时域同步算法之后， 将时域概念运用到频域，研究了频域滑动窗同步算法。之后又对滑动窗同步算法的核心 原理进行了深入探索，研究了基本的频域同步算法。基本频域同步算法的基础是FFT 计算循环卷积，只要保证在某个滑动窗内包含所有的同步码字信息，便可以计算出同步 位置。通过研究循环卷积的性质，本文发现循环卷积峰值出现位置与同步码字起始点的 关系。本文以此为据，设计了一套全新的同步算法。该算法依据峰值的递增关系和峰值 位置与同步码字起始位置的关系，来定义同步判决准则。同时本章给出了新算法的同步 性能分析，比较了时域同步算法频域同步算法在计算复杂度上的差异。
第五章为本文工作的FPGA实现，是理论工作的实际体现，本章将SC-FDE整体系 统划分为同步子系统与FDE子系统分别设计，最后进行联合。按照严谨的工程设计规 范，先从概要设计出发，介绍系统的目标，接口规范，模块划分，系统框图等内容。之 后是详细设计部分，详细介绍了模块间的连接方式，模块的工作原理，FPGA设计注意 事项等内容。接下来通过Matlab与Modelsim的联合仿真完成系统调试。最后提出系统 的改进优化方案。同步与均衡算法均釆用频域算法，两者能够在关键的频域计算模块上 复用，节约系统资源。
第六章为全文结尾，对所有的研究工作进行总结，概括了论文的创新点与研究成果, 给出课题目前在实现阶段的进展，同时给出课题亲来的研究方向与工作方向。
第二章时域均衡技术研究
本章主要研究SC-FDE系统工作的无线信道环境以及时域均衡技术。由于高速中继 系统工作在无线多径信道，本章对无线多径信道进行了延时抽头系数建模和仿真。为了 克服无线信道的多径效应，需要进行均衡，本章便对时域均衡技术进行了研究。
2.1多径信道
由于信道质量直接影响到通信质量，在移动通信越来越发达，对通信速率要求越来 越高的今天，对无线信道的研究显得尤为必要。由于无线信道的不确定性，无线信道的 建模往往非常复杂［均。但是对于数字移动通信系统，无线信道的多径衰落特性主要考虑 传输信号的时延扩展，因此本课题首先研究多径信道的特点，根据研究结果釆用比较简 单的抽头系数延迟线模型，并对该模型进行了仿真。
假设信道具有慢时变特性，在一段时间范围内信道参数不会发生剧烈的变化，便可 以通过信道估计算法，估计出当前的信道传递函数，并对接收信号进行补偿。信道冲击 响应表示如下
顷)=£"脂(1［)	式(2_1)
J
式中，％,弓，丹表示第［•路径的幅度、时延和相移。加入高斯白噪声后，信道传 输模型可以表示为
=	式(2-2)
其中，表示发送的信号，表示接收到的信号，冲)为加性高斯白噪声。
2.2均衡
在无线通信中，信道的传输特性可以通过一个滤波器表示。假设其信道冲击响应为 h(t),所对应的频率响应为
-	丑(/)=因(/)| 此式(2-3)
力(。和〃(/)是傅里叶变换对，|H(/)|表示信道的幅频响应，是信道的相频响 应。要想实现无失真传输，必须满足在信号带宽内是|H(y)|常数，。("是频率的线性函 数，否则会引起幅度失真或相位失真。SUI-3多径信道模型的幅频响应和相频响应如图 2- 1所示。





图2- 1多径信道频响特性
如上图所示，信道中|H（/）|不是常数，因此存在幅度失真，。（，）不是线性函数，存 在相位失真。从多径信道的定义中可以看到非主路径对信号的延迟，会带来波形在时域 上的重叠，从而带来码间干扰。在码间干扰严重的信道条件下，无法进行信号的正常判 决，若要想消除或减小码间干扰就需要使用均衡技术。下面介绍均衡器分类：
2.2.1 线性均衡器
一般而言，均衡使用的训练序列要求是一个频谱分量非常“丰富”、与噪声类似的序 列，这样的频谱成分能够对信道各个频点的响应都进行估计，从而保证估计的信道接近 实际信道。在二进制系统中，多使用伪噪声PN序列作为训练序列，而在现代的通信系 统中，更多的是使用恒包络零自相关（CAZAC）序列卩6〕。一
横向滤波器是最常用的一种均衡方法，结构如图2-2所示


图2-2横向滤波器
图中的横向滤波器为普通的滤波器结构，它有2N个延迟单元、2N+1个抽头系数 和一个加法器。它的输出为相应抽头系数与经过相应延迟之后的输入的乘积之和。对均 衡器输出影响最大的是抽头系数，如果要完全模拟实际信道的传输特性，就需要一个无 限长的滤波器，这在数字系统中往往无法实现。由于实际信道传输具有距离当前时刻越 远，产生的影响就越小的性质，可以将无限长的滤波器截断，让截断的滤波器尽可能逼 近实际情况。假设有2N + 1个抽头，其系数分别为叱w，…，%,。均衡器的输 出贝荷等于输入x（盼与抽头系数叫的卷积，表达式如下：
y(k)= Z x(k-n)wn,k = -2N,.	：,2N,	yi — —N,…,N	　　　式(2-4)
其中，k=0	±1, ±2,...表示对连续时间序列的釆样，n用于表示对当前釆样点的
采样偏移和滤波器系数的下标。矢量y、w和矩阵x的定义为
~y(-2N)
y =	7(0)	w =	　w0		　　　式(2-5)
・(2N)		一 Wn 一
'x(-N)	0	0			　0	0	'
x(-N + l) x(-N	)	0			　　* •
X =	　　x(N) x(N-l) x(N-2)	• • x{-N +1) x(-N)	　　　式(2-6)
0	0 "	0		. •	x(N) x(N-l)
0	0	0		..	　0	x(N)
则 y、w、	K的关系可以表示为
y = xw			　　　式(2-7)
如果x是方阵，并且它的行列向量的维数都等于矢量w的维数，那么由下列方程可 解得w :
w = x_,y	式(2-8)
求解这个方程组的常用方法有两种：一是确定性方法，称为迫零法(zero-forcing)； 另一种是统计方法，称为最小均方误差法卩刀。
迫零法x由时间序列的釆样值组成，它是无限长的。首先对时间序列进行截断， 只保留2N+1个元素，这样得到的x将是行列均为2N+1的方阵。将x代入式(2-8)得到 2N+1个方程联立的确定性方程组。迫零法通过选择｛叫｝的数值，使得码间干扰失真的 峰值畸变最小，以迫使均衡器输出信号在期望采样点两侧各N个釆样值为零。利用公式 来表示这一过程：
[ 1,SO
y(k) = \	式(2-9)
八 [0/ = ±l,±2,...±N	X )
在实际系统中，滤波器的长度取决于信道产生干扰的程度，即最大多径时延。而随 着系统传输速率的提高，最大多径时延会增大，滤波器的抽头系数也会随之增加。从上 面的分析可以看出，迫零算法忽略了信道的加性噪声，简化了推导过程。但在实际的传 输信道中加性噪声始终存在，而且在实际情况中，信道传递函数的幅频特性很可能在某 个频率出现很大的衰减，甚至出现传输零点。由于均衡器需要对信道进行补偿，它的传 输特性需要与信道特性相反，所以均衡器在信道传输频域深衰落的地方需要有很大的增 益，当存在加性噪声时，这个增益就会放大噪声，导致系统信噪比下降，影响系统性能。
最小MSE法 迫零算法基于的准则是峰值畸变最小准则，另一种通过最小均方误差 (mean-square error, MSE)准则求出的抽头系数仇｝的方法称为最小MSE (MMSE) 法。均方误差的定义是均衡后数据与发送数据差的平方的数学期望。MMSE方法的推导 过程如下，将式(2-7)两边同乘以乂丁得
xTy = xTxw	式(2-10)
可以写为
Rxy=Rxxw	式(2-11)
其中，Rxy = xTy被称为互相关矢量，Rxx=xtx称为输入含噪信号的自相关矩阵。 在计算的时候，由于x是未知的，因此Rw和也是未知的，但是如果发射端发送」 个已知信号作为x,那么可以根据接收端得到的y,求解出职于电，然后式(2-11)两 边同时乘以Rx『可以得到抽头系数：
w = Rxx'Rxv	式(2-12)
在使用迫零算法的过程中，由于需要乘以X」，所以x必须是方阵。但求解最小均方 -误差解的时候，乘以的是Rxx 1,只需要貝心是方阵即可。
2.2.2	反馈判决均衡器
对于存在频率深衰落的信道，迫零均衡算法和MMSE算法都会放大噪声的干扰， 线性均衡器在这种情况下的均衡效果往往并不理想。对于这种情况，需要非线性均衡器, 反馈判决均衡器（DFE）是非线性均衡器的一种，它比线性滤波器更适合于有严重失真 的信道。


图2-3判决反馈均衡器
图2- 3表示的是一个判决反馈均衡器的基本结构，它包含一个前馈滤波器与一个反 馈滤波器。其中，前馈滤波器的作用为对接收信号进行初次均衡，这与线性均衡器中一 样。而判决反馈滤波器则是将已经检测过的符号作为输入，估计已经检测过的符号对当 前正在检测符号的影响，最后将各个前面M个符号的影响加权。在判决之前，正在检 测的符号会减去加权值，从而减小了码间干扰。
2.2.3 自适应均衡
由于实际信道的时变特性，要求信道均衡器必须能够跟踪信道响应的时变特性，不 断调整均衡器的抽头系数。由于自适应算法比较复杂，且普通的时域均衡已经能够满足 系统的需求，故不对自适应算法作深入研究。
2.3均衡器效果图
本小节通过对仿真波形的分析，介绍多径信道下均衡的必要性与均衡器的效果。仿 真使用SUI-3信道。还有其他一些信道模型，可以查阅相关文献卩8】。SUI-3信道的基本 参数见图2-4。
SUI-3Cluinnei
Tapi	Tap 2	叫3	Units
Detoy	0	OX	0,9	ps
Power (omai >Bt>	0	-s	-10	dB
90%K4»ct.(omBi>	1	0	0
75H	(oohiQ	7	0	0
Power (50* ant.)	0	-11	-22	dB
90^K-ftct,(30*>	3	0	0
TSHK-ftct-OO1)	19	0	0
Doppler	0.4	03	0.5	Hz
Antenna Corretettoa:	　　pBiV-0.4	Terrain Type:	B
Gats Reduction Factor: GRF » 3 dB	　　　　　Omni aatenna: tg = Q.264 四
Nonnali2a(io!i Factor:	　　F—= -15113 dB,
Fxr = 03573 dB	　　　　　weaH K: K> 05 (90%)； K = L6 (75%)
30° antenna:	gs = 0423 姓
wwaD K K h 2.2 (WH); K 装 7.0 (75%)

图2-4SUI-3信道参数
从图2-4数据可以看出，SUI-3信道模型一共包含三条路径：
第一条路径：延迟Ous,衰减OdB；
第二条路径：延迟0.4us,衰减5dB；
第三条路径：延迟0.9us,衰减10dB；
其他仿真条件:符号速率为12.5Mbit/s,可以算出两条非主路径分别延迟5个和11.25 个符号。实际仿真时，为了增大多径效应的影响，将两条次路径的衰减稍微改变，让两 条次路径衰减的值均为3dB,从而对判决产生影响。图2-5为釆用线性迫零均衡方式进 行均衡的效果图。


图2-5均衡效果图
从仿真波形可以看出，在存在多径的信道下，如果没有均衡，系统几乎无法正确解 调。添加了均衡之后，在信噪比较低的情况下，均衡的效果比不均衡的效果更差，这是
10 由于仿真中采用的是最简单的迫零均衡，而迫零均衡在存在零频响应的信道条件下，会 放大噪声。随着信噪比上升，均衡的作用就体现出来。虽然均衡能够改善多径信道带来 的影响，但它也无法将多径效应完全消除。
2.4本章小结
本章首先对无线信道进行了建模，通过对无线多径信道的研究发现在复杂多径条件 下，没有均衡的通信系统几乎不能工作。然后引入时域均衡器的研究，简单介绍时域均 衡器的两个研究方向，根据均衡器系数的确定方法不同可以分为迫零均衡与MMSE均 衡；而根据均衡器结构的不同可以分为线性均衡器，判决反馈均衡器以及自适应均衡器。 最后对仿真得到均衡器的均衡性能曲线，从图中看到，在存在多径效应的通信系统中， 使用均衡器是非常必要的。
11
第三章SC.FDE技术研究
本章主要研究单载波频域均衡的原理。OFDM技术的发展以及ETE规范的推广， 频域均衡近年来得到了较多的关注与研究。本章将对照时域均衡中的各个研究点，介绍 频域均衡的研究方向与成果。均衡的首要任务是补偿多径信道对信号的畸变。信道可以 被看作是一个滤波器，因此只需要在接收端实现一个与信道滤波器性质相反的滤波器, 就可以消除多径信道的干扰。从信号处理的角度，滤波既可以在时域实现，又可以在频 域实现，因此有了时域滤波器与频域滤波器的分别。频域均衡与时域均衡在处理目的上 的一致性，它们有很多相似之处，如均衡器系数的确定方法和均衡器的结构设计等方面。 同时频域均衡和时域均衡对信号的处理域不同，它们也有很多区别。时域均衡主要使用 滤波器实现卷积，算法复杂度较高。频域均衡器使用乘法器实现，算法复杂度较低，在 高速数字通信系统中，频域均衡应用更为广泛。
3.1 SC-FDE 介绍
LTE规范建议使用SC-FDE系统作为数据上行链路的传输方式，这样做的原因主要 有以下两个方面：第一、经过与其他技术的配合使用，SC-FDE系统具有不逊于OFDM 系统的传输能力，同时没有OFDM系统的缺陷；第二、SC-FDE系统中数据处理主要集 中在接收端处理，从而减小了用户设备的功耗，提高了设备的续航能力。
SC-FDE系统与OFDM系统的虽然都使用FFT/IFFT模块完成主要的运算，但是它 们之间有明显的不同。首先，它们结构上的差异在于IFFT模块的位置，在OFDM系统 中IFFT模块位于发送端，FFT模块位于接收端，而在SC-FDE系统中，FFT与IFFT模 块都位于接收端；其次，从系统命名上可以看出两者另一个不同的地方在于，SC-FDE 系统只使用一个载波频率，而OFDM使用多个载波频率，这也是峰均比，频偏等因素 对两个系统有不同影响的原因卩圳20】。下面介绍SC-FDE系统的结构框图。
SC-FDE系统的发送端不需要进行复杂的运算与操作，结构比较简单，如图3-1所
/Ko


从上图可知，SC-FDE系统主要针对的是IQ两路数据，在IQ两路数据前需要加入 循环前缀（CP）以及以独特字（UW）形成的训练序列。最后将数据输出至单载波调制 器，形成中频数据后送入射频模块。其中CP的作用是消除码间干扰。CP的产生方法: 先将数据分块，每N点为一块，然后将每N点数据的后M点放在该块数据之前。而 UW的作用是信道估计。


如上图所示，SC-FDE的接收端主要由FFT与IFFT构成。信号通过射频模块变为 中频数据后，通过频谱搬移成为基带信号，假设数据流中已经完成同步与最佳釆样，数 据将通过去CP形成初始数据的釆样，然后FFT变换将信号从时域变换到频域，进行接 下来的频域处理过程。通过数据与UW分离模块，UW数据被用于信道估计，得出估计 信道的传递函数，使用得到的信道估计参数对数据进行均衡，最后将均衡后的数据进行 IFFT变换，让信号从频域反变换到时域。至此，SC-FDE系统中的均衡部分已经完成, 通过星座逆映射与串并变换形成解调数据之后，可以进行数据判决也可以送入信道编解 码模块，剩下的工作便是发射端的反向操作。
3.2 SC-FDE系统原理
SC-FDE系统利用UW完成信道估计，得出信道的传递函数，使用估计的传递函数 进行均衡。
3.2.1 独特字（UW）
独特字为信道的训练序列，用于进行信道估计。真实的信道频域分量非常丰富，为 了进行完整的信道估计，要求独特字具有幅频均匀的特性。以前的研究发现，横包络零 自相关序列（CAZAC）很好的满足了这一特性，并且CAZAC序列具有理想的周期自相 关特性与良好的互相关特性，在各个领域均被广泛应用，非常适合作为UW。下面介绍 几种CAZAC序列的产生方式。
Frank序列的生成公式如下：
a”=a小k=e'g " 0<A,p<g,gcd（r,q） = l	式
13
式中，”的取值范围为序列总长度为寸,4可以取值为任意整数。
Zadofi^Chu序列的生成公式如下：
ak = exp jlTt— *（* + ' +qk ,左= 0,1,...0-1 （若N为奇数）
N[ 2 丿
r r 2 F	式（3-2）
ak = exp j2n^-\— + qk ,	4 = 0,1,...,7V-1 （若TV■为偶数）
N\ 2
其中q为随意整数，N为序列的总长度，M为与N互质的任意整数。
将上式中的q取为0, M取为1,则该公式进一步简化，得到Newman序列的生成 公式如下：
,Q<k<N-\	式（3-3）
从以上三种CAZAC序列的产生方式可以看出，生成的UW序列均为复数，要求传 输过程中，必须分为IQ两路传输，所以使用CAZAC序列作为UW的SC-FDE系统对 调制方式有一定的要求，即要求QPSK或更高的调制方式。
35——


图3- 3CAZAC序列与PN序列对比
如上图所示，在典型两径信道下，使用PN序列进行IFFT变换得到复序列的同步 性能比使用CAZAC序列的序列相关性要差4dB左右。
3.2.2 SC-FDE理论分析
SC-FDE系统接收端收到的信号贝。可以表示为
14

y(0 = X。) * 仰)+«(0	式(3-4)
其中X0)为发射的信号波形；狀。信道冲击响应；花(。为信息传递过程中受到的加 性高斯白噪声的干扰(噪声分布满足均值为0,方差为F的复高斯分布)。
在数字系统中，将信号离散化，按每符号进行一次釆样得到：
y(n) = x(n) ®h(n)+yv(n), n =	式(3-5)
经过离散傅里叶变换将信号变换到频域：
Y(k) = X(k)H(k) + W(k), k =	式(3-6)
从理论上来看，由于x(〃)无限长，线性卷积无法直接使用有限长度的FFT直接进 行运算，上面的频域乘法运算也无法直接进行。但是CP的引入，在消除码间干扰的同 时，使得X。)具备了循环特性，上面的卷积也就成为了循环卷积，在去掉CP之后，每 一块数据可以直接使用频域乘积进行计算⑵一23］。频域均衡的基本结构如图所示。



假设均衡系数为。(幻，则均衡过程可以表示为
X'(k) = Y (比)C(k)
频域均衡的实质是希望X'(幻尽可能的接近X(4) o频域算法的关键问题就在于如何 得到C(k)。常用的解决方法就是使用训练序列，利用训练序列进行信道估计。从2.2.1 节中知道信道训练序列需要是一个频谱分量丰富，类似噪声的序列，而3.2.1节中介绍 的CAZAC序列便具备这样的特性。使用CAZAC序列作为训练序列。下面介绍使用UW 估计C(幻的过程。
迫零法 将UW序列的FFT变换标记为UW(k),代入上式得：
UW(k) = UW(k)H(k) + W(k), k = 0,l,...,N-l	式(3-8)
UW(k)表示接收端接收到的信号，那么信道的频率响应为：
亟史皿	T	式(3-9)
UW(k) LW(k)	v 7
式(3-9)中，信道准确的传递函数为H(k)°所(幻表示噪声的频域信息，是未知的。 采用这种方式只能得到信道传递函数的估计值。使用片(4)表示信道传递函数的估计值,
15


W(k)
UW(k)
从上式可知，疗(k)和HG)相差崙J。由于UW{k}具备良好的幅频特性，W(k) 的性质不会被改变，依然是服从高斯分布的白噪声。若忽略噪声的影响,
式(3-11)
均衡系数a盼可以表示为:
式(3-12)
均衡过程可以表示为:

时域的迫零均衡准则在分析的时候也忽略了噪声的影响，该方案与之相同，因此称 之为频域迫零均衡方案。时序迫零均衡要求对方程组进行求解，求解方程的复杂度在 0(困2)与0(^3)之间，与之相比，频域迫零均衡只要求进行除法运算即可，复杂度在 O(N)的量级，即使考虑到FFT计算的复杂度，整个系统的复杂度也在O(N\o&N)。 因此频域信道估计算法的复杂度较时域算法有很大优势。但是同时域算法一样，频域均 衡算法在信道频率响应为0的点计算出的C(幻也会非常大，会放大噪声。
最小均方误差法频域中存在与时域对应的迫零均衡方法，因此频域中也存在与时 域MMSE对应的频域MMSE方法。MMSE为了保证均衡时噪声功率不被过度放大，需 要预先对信道中的噪声功率进行估计，MMSE算法的系数计算公式如下：
夂幻=湍帯对=0,1,…,N -1	式(3一14)
式中：1(k)为估计的信道特征函数行佐)的共轴，J2为信道中噪声的估计方差。 可以看出当信道中存在频率传输零点时，C(左)不会非常大，因此不会过度放大噪声。但 该方案需要对信道的噪声方差进行估计，在目前的系统中还没有噪声方差估计模块。暂 不做研究。下面介绍对频域迫零均衡的改进方法。
由于信道中存在最大多径时延，多径效应会延伸到最大多径时延的位置。在信道的 冲击响应中，最大多径时延之后收到的值均为噪声的干扰。可以将这部分值设置为零, 从而减小噪声的干扰。据此可以对迫零信道估计方案做出如下的改进。
16
首先估计信道的冲击响应，
好)=g"))=[和)，=匚,n_i	式GT)
然后，将信道冲击响应中最大多径时延之后的值设为零，以消除部分噪声干扰。假 设多径时延的长度为L。
由(”)=俨3)；°才•尸	式(3』6)
[0,	n = L)…,N -1
最后，如果使用时域均衡方式可以直接使用这个冲击响应进行信道均衡，若使用频 域方式还需要计算信道的传递函数。
百好)=DFT{hDFT(n)}	式(3-17)
从式(3-15)注意到片(”)中有一部分为噪声的干扰，因此可以利用此方法估计噪声的 方差，并利用方差进一步改进信道估计结果。噪声方差估计如下
宀他加心心习和)I，	式(3-18)
信道冲击响应估计如下：
姦("如次〃)，|如次〃)| > 2尸	式gig)
0, others
其中2尸为噪声门限。当的值大于噪声门限2】时，估计值不变。否则将 hDFr(n)置为0。在得到冲击响应的估计结果之后，再变换到频域即得到信道传递函数的 估计结果。
冃心)=DFT{hADFT{n)}	式(3-20)



图3-5几种均衡系数设计方式性能对比
图3-5为几种不同的均衡系数设计方式的性能对比，可以看到，所得到的仿真波形 与理论分析一致：迫零均衡方式的误码率性能最差，考虑最大多径时延的改进方式对性 能的改善在3dB左右，而考虑噪声的改进方式在此之上的改善几乎没有。
3.2.3 频域均衡滤波器结构
频域均衡滤波器一般有两种结构SI： 一种是线性结构，一种是判决反馈结构。两种 结构示意图如下。



图3-6频域线性均衡


图3-7频域判决反馈均衡
上一节已经介绍了线性频域均衡的理论推导，但是一般对于存在零频响应的信道来 说，线性滤波器性能并不理想。在这种多径信道下判决反馈均衡器的性能往往要比线性
18 均衡器的性能好。在传统的时域反馈判决均衡器中，符号被依次判决，滤波器立即将计 算结果反馈给后续的符号以消除码间干扰。但在频域均衡系统中，由于FFT块的时延特 性，这种立即判决反馈的结构无法实现。时频混合的判决反馈均衡方法避免了上述反馈 延迟的问题。这种结构使用频域均衡作为前馈滤波器，使用传统的横向滤波器作为反馈 滤波器。反馈滤波器是一个时域滤波器，进行卷积运算，它的长度要求往往不高，并可 以按性能需求增长或缩短。在线性频域均衡和判决反馈频域均衡中，频域均衡部分是一 样的，对每一个数据块，进行N点FFT计算得到的N点数据与N个均衡系数相乘，然 后IFFT对这N点数据进行逆变换，得到N点时域序列。在线性均衡结构中，这N点数 据将直接判决输出，而在判决反馈结构中，这些时域序列还将被逐点送入反馈判决模块, 它们将逐符号地减去根据前面符号计算得到的码间干扰。
3.2.4 同步偏移对SC-FDE系统性能的影响
对于SC-FDE系统而言，有两个比较重要的影响因素，一个是收发端载波频率的偏 移，一个是定时同步偏移，下面通过仿真比较介绍两种这两个因素的影响。
定时偏移对SC-FDE系统性能的影响主要分为两个方面：一方面定时偏移会使信号 幅度衰减，另一个方面会造成符号间干扰，给系统带来类高斯白噪声的干扰，从而使信 号的信噪比减小。


图3-8定时偏移对频域均衡的影响
从图中可知，由于SC-FDE系统中釆用循环前缀的结构，FFT窗口的位置可以朝同 步码字起始位置之前稍微偏移，小范围的前向偏移不会给信通性能带来太大的影响。但 当偏移量超过最大多径时延时，FFT窗口中会引入上一数据块的干扰，从而使CP作用 减弱，造成严重的码间干扰。与之相反，任意的FFT窗口后向偏移到会对系统性能带来 极大的影响，码间干扰严重。而针对UW块的帧结构则不允许有定时偏移〔25）。
当接收系统中存在频偏时，系统-性能在一定程度上会受到频偏的干扰，当频偏较大
19
时，均衡性能明显下降，并且无法通过增加训练序列的长度消除频偏的影响。


图3-9频率偏移对频域均衡的影响
从仿真波形图3-9可以看出，当频偏比较小的情况下，对系统性能的影响几乎为零。 而当频偏超过一定程度，频偏会导致系统性能明显下降。
3.3时域均衡与频域均衡的复杂度对比
虽然SC-FDE系统性能比SC-TDE系统略低网，但是它们的计算复杂度不在同一个 数量级。
首先分析均衡系数的计算过程，以迫零算法为例进行分析，假设均衡滤波器的抽头 系数个数为N。对于时域方法而言，需要求解由N个方程构成的线性方程组，大约需要 进行"3次乘法计算，即使最佳算法也只优化到N的2.3737次方〔27】。当N较大时这个 复杂度在FPGA里是不可接受的。而使用频域的计算方法，该方案只需要进行N点的乘 法计算，即使考虑到FFT中的乘法计算，也只需要N+NlogN个乘法。因此，仅在均衡 系数的计算过程中，频域均衡相对于时域均衡有很大的计算量改善。对于均衡过程而言, 单纯考虑计算方面，时域算法的滤波器相当于卷积运算，计算一个时域点值需要N次复 数乘法和N-1次复数加法运算。为了获得N个时域数据，需要进行N2次复数乘法计算 和N(N-1)次复数加法。而对于频域算法，均衡过程需要N次复数乘法，FFT需要Nlog2 N/2次复数乘法与Nlog2N次复加运算，IFFT需要的计算量与FFT相同，因此一共需要 完成N+Nlog2N次复数乘法运算和2Nlog2N次复数加法运算。
通过以上对运算量的分析，在均衡系数估计阶段，随着传输速率的提高，均衡系数
20 将会增加，导致时域算法的抽头系数无法计算，频域算法却能在要求的时间内给出均衡 系数的解，因此受到广泛的研究与应用。而在均衡阶段，时域算法是平方数量级，而频 域算法是线性对数级，优于时域算法。
3.4本章小结
本章在第二章时域均衡的基础上，推导出频域均衡的相关概念。在高速的通信系统 中，时域均衡器的设计实现复杂度很高，而这些问题在频域均衡器的设计中能够得到很 好的解决。虽然频域均衡器的性能较时域均衡器有所损失，但是它更容易在数字通信系 统中实现，并且SC-FDE系统有着接近OFDM系统的传输性能，因此目前对单载波频 域均衡器研究正在逐渐增多。本章对应时域均衡器中的迫零与MMSE准则设计滤波器 系数的方法，进行了频域均衡器均衡系数的迫零与MMSE准则的推导。而对应时域均 衡器的线性与反馈结构，比较分析了频域滤波器的线性与反馈结构。同时，本章还给出 了时域均衡算法与频域均衡算法的复杂度对比，通过对比发现时域算法在高传输速率的 情况下，运算量将是目前的数字系统无法承受的，频域算法的复杂度却在可接受的范围 之内。最后简单介绍了 SC-FDE系统的FPGA设计。
21
第四章同步算法研究
在任何通信系统中，同步都非常重要。如果无法完成同步，系统的通信质量将非常 差，甚至出现无法通信的情况。同步按照不同的功用可以划分为，载波同步，位同步， 帧同步与群同步。载波同步即在接收设备中产生一个和接收信号的载波同频同相的本地 振荡，供给解调器作相干解调用。位同步主要解决接收信号的最佳采样和判决问题。帧 同步则主要负责标识数据的起始，终止时刻。同时根据传输同步信息方式不同的可以分 为自同步与外同步。外同步是由发送端发送专门的同步信息，接收端把这个专门的同步 信息检测出来作为同步信号。与之相对的，自同步不需要发送端发送专门的同步信息， 接收端直接从收到的信号中提取同步信息。一般而言，在载波同步中多釆用自同步，在 帧同步中多采用外同步，在位同步中，外同步自同步都有釆用。
就SC-FDE系统而言，系统本身具备一定的抗频偏特性，而且可以使用非相干解调 的方法进行频谱搬移，或者使用差分解调的方法减小频偏的干扰。因此，本文研究的重 点放在位同步与帧同步上，并提岀了一种频域同步的改进方法。为了理论的完备性，本 文先从时域同步方法开始介绍，然后介绍课题在频域同步方向的研究成果。
4.1位同步
为了达到最佳解调，数字接收机需要与输入数字码元同步。在数字通信系统中，接 收机本地振荡器所产生的数字时钟与发送端本地振荡器所产生的数字时钟是相互独立 的，两者在频率及相位上不可能完全相同。如果两者相差较大，直接使用接收端本地振 荡器所产生的周期性脉冲序列对接收信号进行釆样，会引起严重的误码。为此，要设法 从接收信号中提取时钟，使它与发来的数字信号的符号速率同步，这样就可以得到准确 的瞬时采样。下面介绍几种传统的位同步或码元同步方法。为了表述简单，以随机二进 制基带信号为例，非二进制基带信号的情况与此类似。
4.1.1 自同步
自同步属于非数据辅助的同步方式，可以分为两大类：第一类是开环同步，第二类 是闭环同步。开环同步电路从接收数据流中直接恢复得到发射机的数据时钟，而闭环数 据同步电路则通过比较本地信号和接收信号，使本地数据时钟锁定在接收信号时钟上。 闭环同步更精确，但是更复杂也更昂贵。
22

4.1.1.1线谱法
线谱法属于开环同步，其原理是：假设信号为零均值的双极性不归零序列，则接收 信号的均值为0,接收序列的平方呈现周期特性，而且周期正好为符号速率。在这样的 条件下，可以通过一个窄带滤波器将平方序列中的周期滤岀，作为时钟。这种方式对滤 波器的要求比较高，可以使用一个锁相环实现，使环路能够跟踪信号时钟频率的变化。 系统电路如图4-1所示


图4- 1线谱法
开环码元同步最主要的缺点是它具有不可避免的非零均值跟踪误差。虽然对于大信 噪比误差很小，但是由于同步信号波形直接依赖于接收信号，误差不会消失。
如果发送的数据非零均值，那么将导致平方律器件产生的波形不再具有周期性，从 而导致提取到的时钟不准确。因此，在发送端，往往需要加入随机扰码，以达到系统工 作条件。
4.1.1.2早迟门
早迟门电路属于闭环同步，闭环码元同步通过比较本地生成的数据时钟信号和接收 信号，使本地生成信号和接收数据的传输同步。性能优于开环同步。

图4-2早迟门
23
早蛆门电路的基本原理是利用在一个符号内只有当釆样位置位于符号中点时，早门 与迟门的输出差值才会为0,否则环路就会不停的调整采样时刻直到稳定。
从以上两种同步电路可以看出，内同步方法主要使用VCO对釆样偏差进行跟踪。 两种方案都从模拟电路发展而来，需要对信号进行大倍数的过采样以得到精确的位定时 同步信息。文献［28］中分析了早迟门的定时同步误差。
4.1.1.3 Gardner 算法
由模拟电路发展而来的位同步算法未考虑数字电路的特性，没有充分发挥数字电路 的特点。Gardner提出了利用内插法实现位同步的方法㈣，其主要优点是，直接通过数 字处理即可以在得到位同步脉冲的同时得到基带信号的最佳判决值。Gardner位同步系 统结构如下。


图4- 3 Gardner定时环路
Gardner算法通过插值滤波器与重釆样，实现了每个码元有两个釆样值，然后进行 定时误差检测。算法的核心为内插滤波器的设计〔3°］〔31】。
4.1.2 外同步
外同步需要在发射端发送一段己知数据作为训练序列，在接收端对已知数据进行处 理。一般而言，训练序列都比较长，而模拟电路一般不具备记忆特性，因而处理比较困 难。所以在模拟通信系统中，釆用外同步的位同步运用比较少。但是在现代数字电路中， 由于存在专门的存储器件，同时随着工艺与技术的发展，收发信机在数字时钟上的偏差 已经可以做到非常的小（几个ppm的偏差），故不再需要从接收信号中提取数据的时钟 速率，而是直接使用本地时钟就可以完成对信号的釆样。只要保证数据帧的长度在允许 -的偏差范围之内，就可以直接使用过釆样的方式进行最佳釆样，这样的位同步方式更加 的简单精确。传统的位同步方式大都需要锁相环才能精确的跟踪同步时钟，在使用突发 传输方式的通信系统中，突发帧往往会比较短，不利于锁相环的使用。
数字通信系统中可以在接收端对该接收数据进行过采样，然后通过相关算法，在相 关峰值最大处判断为同步，并进行锁定。外同步法的精度直接与过采样的倍数相关。数 字系统的外同步算法性能依靠过采样的倍数，当基带数据码元速率非常高的时候，釆取 过釆样的数字通信系统就对FPGA的处理能力提岀了很高的要求。因此这种方案需要接
24
收机处理能力与码元速率的协调。
在基于过采样的同步中，往往使用自相关性能比较好的序列作为辅助数据。在假设 接收端与发射端数字时钟偏移不大的情况下，可以推导出如下的公式结论。
单倍釆样的情况下，测度函数：

其中广（花）为接收信号，C*（〃）为训练序列的共轴。当尸（花）全部为训练序列时，如果 采样没有偏差测度函数值会比较大。如果存在定时偏差，肱（“）的值会受到比较大的影 响。因此，在过釆样的情况下，测度函数会变为如下



其中s为接收到的模拟信号，其中码元间隔为Ts，过釆样月倍，则Tp=*, C待为辅
助数据的/倍过釆样。因此每个符号中都会至少被釆样到月次，这样便将定时偏移的影 响控制在了0个采样点中的一个，从而减小了定时偏移对测度函数的影响，进而达到位 同步的目的。
文献［32］中分析得出，当单倍釆样的情况下，定时偏移半个码元将会导致测度函数峰 值衰减30%；在2倍釆样的情况下，测度函数的峰值衰减最大也仅为7%；而在四倍采 样的情况下，最大的峰值衰减仅为2%。
一般过釆样倍数越大，对ADC与负责处理的FPGA的要求也越高。因此在通常的 应用中，四倍的过采样倍数既能满足大部分的性能要求也便于硬件实现。
4.2帧同步算法
所有的数据都具有一定的帧结构，即数据流是由固定数量的比特组成。接收机必须 与数据流的帧结构保持同步才能完全解析数据的意义。根据通信系统工作环境的不同， 帧同步系统可能很复杂也可能很简单。最简单的同步方法为帧标记法，该方法周期性地 在数据流中插入一个或一组特殊的比特。但由于SC-FDE系统工作于比较复杂的无线信 道环境，且具有突发传输的特性，因此需要比较复杂的同步方法。
对于突发传输的系统，需要釆用同步码字，在接收端利用相关器进行同步头搜索。 好的同步码字具有这样的特性：相关旁瓣的绝对值很小。传统系统处理能力低，同步码 字均釆用二进制形式，因此同步出错的概率比较高。现代的数字通信系统的处理能力大 大提升，在找出更多优秀同步码字的同时，发展出不少优秀的同步算法。但是同步算法 的复杂度依然与同步码字的长度成正比。帧同步釆用的同步码字往往位于数据帧的开头,
25
当使用过采样法进行位同步的时候，可以将帧同步与位同步一起进行。 下面介绍几种经典的定时同步算法3】。
4.2.1经典同步算法研究
4.2.1.1Schmidl&Cox 算法
Schmidl&Cox算法是经典的基于数据辅助的同步算法，同步头由两个相同的同步序 列构成。算法采用的同步头结构如图所示。
CPI	A	A	CP2	B

图4-4 S&C算法同步头结构
其中A是长度为N/2的ZC序列；B是在奇数时间传输一个ZC序列，在偶数时间 上传输另一个ZC序列。
利用两段UW序列的自相关相关性，进行相关计算。设r(n)为接收端收到的时域 信号，Schmidl&Cox算法测度函数如下：
涉(”)=腿)!	式(4-3)
R(dV
其中，
N-\
人(d)=Ei@+a)r	式(4-4)
A=0
N-\
P(d) = £r(k + d)，r* (k + N + d)	式(4-5)
A=0
峰值判决函数：
d = argmaxM(<7)	式(4-6)
Schmidl&Cox算法的仿真如图4-7所示，从图中可以看出一个数据帧的自相关检测 只有一个峰，但这个峰比较平坦，其上升时间和下降时间都比较长；且在峰值点，因为 循环前缀的存在，会出现一个峰值平台。由于存在上升段与下降段，峰值平台的起止位 置无法准确判断，若以超过门限值的方式来检测峰值，则最后判定的数据帧起始位置误 差将很大。同时由分析知，峰值平台的宽度等于CP的长度。
4.2.1.2Minn 算法
Schmidl&Cox算法中定时估计函数存在一段峰值平台，为了消除这个峰值平台， H.Minn提出了一种新的训练序列同步方案。H.Minn的训练序列由四部分组成，每部分
26
包含的时域数据相同，但符号不完全相同，具体的训练序列时域结构如图所示。
A	A	-A	-A


图4- 5 Minn算法同步头结构
其中A序列为长度为N/2的ZC序列，CP长度为Mo
Minn修改测度函数为：
叩)=甥	式(4 - 7)
其中，
1 N-\
g(d) = Z£尸0 + 2Nk + m)r (cl + 2Nk + m + N)	式(4-8)
A=0 m=0
1 N_1
^2(^)= E E W + 2Nk + m + 7V)|2	式(4-9)
k=0 m=0
算法仿真见图4-7。可以看出，Minn算法会没有峰值平台，峰值尖锐，但是存在虚 假峰值。
4.2.1.3Park 算法
虽然Minn方法可以在符号定时位置产生尖锐的峰值，但算法的测度函数在错误的 时刻也会产生比较大且尖锐的峰值，与正确定时的峰值差别较小，增加了同步判决的难 度。为了克服以上两个缺点，Park提出一个具有四段共辘对称结构的训练序列。结构 如图所示。
C	D	C*	D*
图4- 6 Park算法同步头结构
其中C为长度为N/2的ZC序列，D为C的对称序列，C*、D*分别为C、D的 共辄序列。测度函数为：
式(4-10)
其中
N_1
6(d) = £r(d _k)r(d + k)
k=Q
27

N-1
&（d）= 2＞（d +幻|
k=Q
上面介绍的几种经典算法的仿真结果如下：

从图4- 7可以看到Schmidl&Cox算法的峰值平台，Minn算法的虚假峰值。特别 需要注意的是Park算法，一般认为Park算法产生的定时估计函数也会出现虚假峰值， 但在仿真结果中却没有发现明显的虚假峰值，本文认为产生这一结果的原因是传统的研 究中Park算法的复UW使用的是对PN序列进行FFT变换得到的复序列，而本文中直 接使用CAZAC序列作为复UW,由于CAZAC序列良好的性质没有产生虚假峰值。
由于以上三种算法中都是用CAZAC序列作为UW[34]，但是在经典算法中都是使用 PN序列，或者与PN序列有关的序列作为UW,有必要研究PN序列作为同步码字的性



一般，使用PN序列作为训练序列的Park算法中会出现虚假峰值〔35】，而虚假峰值产
生与CP有关，当使用CAZAC序列进行仿真时，即使存在CP也没有虚假峰值产生的。 这说明CAZAC序列的相关特性优于PN序列。这也可能是本课题中改变了 Park算法训 练序列的产生方式导致的，使用PN序列的Park算法中训练序列是通过对PN序列进行 IFFT计算产生的复序列，而本文的训练序列一一CAZAC序列为复序列，不再需要IFFT 计算。
这几种同步算法的同步码字都具有两倍的信息量，即在接收端不需要保存任何同步 码字的信息，就可以进行同步。在此之外还有另外一种同步码字的设计，即在接收端保 存一套与同步码字具有相关性的序列，这一套序列将不会受到传输过程中的噪声干扰， 这种方式得到的相关结果优于把所有同步信息都发送的方案。两种同步码字方案各有优 缺点，前一种可以实现系统的多样化，即只要实现相同的同步结构就可以进行解调，后 一种方案在性能上优于前一种，但需要在接收端提前知道同步码字信息，只适用于一些 特殊的系统。
经典算法均为时域算法，逐渐移动进行相关运算，然后得出峰值，认为峰值超过门 限的点为数据起始位置，但这也正是产生峰值平台和虚假峰值的原因，时域算法如果不 逐点移动又有可能导致同步点的丢失。下面介绍的频域同步方案，将从另外一个角度设 计同步方案。
4.2.2 频域算法
经典的同步算法均在时域进行计算，通过相关运算得出相关峰值的方式判断同步点。 接下来介绍一种通过频域计算得出相关峰值，然后通过峰值位置推算出符号定时点位置 的同步方法〔36】。频域算法的基础是使辅助数据具有循环相关的特性，然后利用傅里叶变 换进行计算。傅里叶变换的结果是一个数据块，利用峰值在数据块中出现的位置，结合 序列本身的循环卷积特性，可以推导出数据起始位置。
FFT计算所需要的时间比较长，不能在一个码元时间内完成计算，因此需要将多个 码元的时间用于进行FFT计算。因此频域同步算法中引入滑动窗的概念，每次将滑动窗 内的数据送入FFT进行计算，因此为了保留A序列的全部信息，引入CP。频域算法基 本的同步码字结构如下。
CP A CPI A
I
..—，丨」
图4-9频域同步算法同步头结构
其中的CP长度为M, A的长度为N。A序列一般取具备良好自相关特性的序列。 在本项目中仿真使用Chu序列。滑动窗大小为N,每次滑动的长度为N。
29

P(tN+n) = IFFT(FFT(r(tN+«)) • FFT(c(n^)	式(4-14)
NT
R(内)= ZI«N + 4)r	式(4-15)
k=Q
其中或〃）表示本地序列。
其测度函数将会岀现如下的峰值情况，仿真波形如下。



图4-10频域同歩算法峰值情况
无论滑动窗起始位置为何，都会出现两个比较大的峰值，只需要找到两个峰值中的 一个就可以判断同步码字的位置。记录找到的测度函数峰值的位置为P，截取P〜P + N 与p +七〜p + N + N.两段数据，其中N/和表示数据块的长度，〃表示FFT点数。写 出新的测度函数如下：
阳（P）= ｛喜P +	5 + " ' /R（P）	式（4-16）
其中，N”为CP的长度,

JV-1
R(p) = j£ r(p + k)r (p + k)
则帧的起始位置可以表示为：
\p-Ncp,W{p)ti 于门限
stan = \P-Nf,w{Py^ 于门限
4.3改进的滑动窗算法
上一节所介绍的频域同步方案中，滑动窗每次滑动的距离为N,若只用一个A序列， 则在某些情况下滑动窗内有效数据不足，导致峰值无法超过门限，因此4.2节中介绍的 方案增加了一个A序列以保证某个滑动窗中一定会包含A的全部信息。保证至少有一 个滑动窗包含A序列的全部信息的方法有两种：第一种是4.2节的方法，增加一个A序 列;另一个方法是将滑动窗每次的滑动长度由原来的FFT长度N减小为CP的长度Mo 由于滑动窗每次滑动的距离为M,可以保证某一个滑动窗的起始点在CP之中，从而保 证该滑动窗内包含全部的A序列信息。针对这种方法，唯一需要解决的问题是该方法要 求FFT模块能在M点的时间内完成FFT处理，从而实现系统的流水线处理。本小节将 对第二种方法进行理论推导。
首先，改进方案的同步码字将比4.2节方法的同步码字短，仅由CP与A序列构成。 其帧结构如下。
CP A	Data
图4-11本文算法同步头结构
其次，改变滑动窗的滑动距离，每次滑动窗移动CP的长度M点。
假设接收端的釆样序列为双〃)，在本地保存的为A序列的共辗傅里叶变换H(〃)。 假设CP的长度为M, A的长度为N。滑动窗的长度为M。
定义互相关函数P(〃)如下：
P(tM + ri) = IFFT(FFT(r(tM + «))・ FFT{c(ri^,n = 0,1,...,7V-1	式(4-19)
其中表示接收到的序列，c("表示本地序列是A的共轴序列。M为CP的长度, I为自然数是滑动窗的标号。
对每一个2取：
SQ) = max \P{tM + «)|2	式(4-20)
n
即，取一个滑动窗中互相关值最大处的幅值。
31
pH) = index(S(t),\P(tM + »)|2)	式(4-21)
夕。表示滑动窗中峰值所在位置。
定义测度函数如下：
岫)=
另 ipw+”)r	式(4-22)
n=0
当M的值为1时，测度函数如图4-12所示，当M的值为CP的长度时，仿真时使 用的A是长度为256的Chu序列，CP长64,测度函数的仿真如图4-13所示。
当滑动窗起始点位于CP中时,滑动窗内包含A序列全部信息，仅有相位上的区别。 而通过FFT/IFFT变化后，相位上的区别表现为峰值位置的偏移，因此根据改进算法得 到的测度函数数值大小不会有区别，他们之间唯一的不同是以。。下面将A序列取为长 度256的Chu序列，CP长度为64进行仿真计算进行说明。图4-12是测度函数，表4- 1是当滑动窗起始与CP中时的峰值位置函数p(0»
表4-1滑动窗偏移对应的峰值位置
k	峰值位置
64	64
63	63
62	62
• . •	.•.
2	2
1	1
0	0
表4- 1中表示的是滑动窗起点在CP中时，包含CP点数对峰值结果的影响。从表 中可以看出，当k=0时，滑动窗内的数据包含的数据就是A,则峰值位置将出现在。时 刻。当k=l时，滑动窗内的数据位[A(255),A(0:254)],峰值位置出现在1时刻。其他分 析类似。但是当k=64时，峰值位置为64,.此时，会有两个滑动窗存在大小几乎相同的 测度函数，在理想情况下，通过同步判定算法可以找到后一个k=0的滑动窗，但是在加 入噪声的干扰情况下，很可能只能找到k=64的滑动窗，即使如此，还是可以根据该位 置找到A的起始位置。因为如果某个超过门限的测度函数的峰值位置函数的值为64, 那么可以推断出该滑动窗一定是包含全部CP的滑动窗，因此下一个滑动窗k将等于Oo 只需要设计合适的门限规则，就可以判断出正确的同步位置。
下面分析，当滑动窗内不包含完整的A序列的时候，峰值大小的变化情况。
32


图4-12逐点移动测度函数
仿真时，在同步头之前有一段长度为256的0值，这样才能从波形变化中看岀测度 函数值的变化规律。从图中可以看岀，当滑动窗起始位置逐渐增加的时候，测度函数的 值逐渐变大，当滑动窗起始位置位于CP当中时，会岀现一段峰值平台。但是由于滑动 窗的滑动长度为CP的长度，最后岀现的峰值情况会如下。



图4- 13按CP移动的测度函数
从图中可以看出，当滑动窗按CP的长度进行滑动时，将不会岀现峰值平台，而是 会产生以及比较尖锐的峰值。在此过程中一定会出现峰值最大点，并且峰值点左右附近 的值都比较大，虽然不存在误判峰值的可能性，但是存在峰值点左边或右边的值大于峰
33
北京邮电大学工学硕士学位论文
值点值的情况，在这种情况下，找出的同步位置是会出现偏移的。但是频域同步方法不 仅在峰值上具有递增关系，在峰值位置上也同样具备递增关系。如当一个滑动窗内完全 包含A序列信息时，假设它的峰值位置为X,则该滑动窗的前一滑动窗峰值位置一定是 x+M,后一滑动窗峰值位置一定是x-M。因此利用此特性，可以方便的从数据流中找出同 步码字的位置。
设计如下的同步判决准则，满足以下两个条件时认为系统同步：
1、	相邻的五个测度函数的值满足M1<M2<M3>M4>M5。
2、	M3的值大于测度函数门限。
与之对应，设计出如下的同步位置搜索方法：
1、	如果M3的位置为n (0-63),则从出现峰值的滑动窗的第n个点开始输出。
2、	如果M3出现的位置为n (64-127),则从出现峰值的滑动窗的下一滑动窗的第n 个点开始输出。
3、	如果M3出现的位置为n (192-255),则从出现峰值的滑动窗的前一滑动窗的第 n+64点开始输出。
以上的同步码字定位准则将准确的找到同步码字的起始位置，进而找到有效数据的 起始位置。
4.4频偏的影响以及同步性能仿真
改进的频域滑动窗同步系统的同步性能仿真图如下。仿真中使用的为SUI-3信道模 型。



图4.14十万次误同步次数
从图中可以看出在信噪比大于等于OdB的时候，十万次的仿真结果中同步没有出现 一次误同步或漏同步。这样的性能已经足够在本项目的中继系统中使用。
上面的仿真虽然釆用了多径信道，但是没有考虑信道中频偏的影响。在3.2.4节中 分析了频偏对SC-FDE系统的影响，在同步系统中，频偏对性能也会造成一定的影响, 下面给出仿真分析结果。


图4- 15加频偏的十万次仿真
正如分析的一样，仿真时加入1kHz的频偏，将导致同步性能的下降。
4.5算法复杂度分析
注意到，同步算法与均衡算法具有相同的计算形式，因此，同步算法复杂度的分析 与均衡算法类似。当使用过釆样形式的同步方法时，时域算法的复杂度在平方数量级, 而频域算法的复杂度在线性对数级别。可见在高传输速率的通信系统中，频域算法具有 极大的吸引力。但是频域算法在同步系统中也存在一定的缺陷，即关于同步码字起始位 置的寻找过程往往比较复杂。
4.6本章小结
本章是全文的中心，主要介绍同步算法，同步分为频率同步，位同步，帧同步。本 课题主要研究位同步与帧同步。从原始位同步方法讲起，原始的位同步方法都需要使用 锁相环，不仅设计复杂，而且工作速度慢。随着技术与工艺的发展，收发端数字时钟的 偏差与码元宽度相比非常小，对收发端时钟偏差的影响可以忽略不计，可以直接使用接 收端的数字时钟。然后研究过釆样的位定时同步方法。又因为帧同步使用的同步码字处 于一帧的开头，具有很好的自相关与互相关特性，也可以用作位同步的码字。因此位同 步与帧同步可以同时进行。随后研究经典帧同步方法，对SC, Minn, Park算法进行了 仿真，在仿真过程中发现Park算法训练序列的选择对算法性能有较大的影响。当使用 CAZAC序列作为训练序列的时候，经典Park算法存在的虚假峰值的问题将不会出现。
随后研究频域的帧同步方法，介绍频域同步方法的原理以及注意事项。本章从频域均衡 的基础出发，对频域滑动窗法进行了改进，提出了本课题所使用的改进滑动窗算法，并 对改进算法进行了理论推导与仿真。最后对时域算法与频域算法进行了算法复杂度的对 比分析。
36
第五章 基于FPGA的SC-FDE整体系统设计
在数字通信系统中，一般都会使用FPGA,原因之一是FPGA处理速度快，数据吞 吐率非常高；另一个更重要的原因是，FPGA设计一旦固定，整个系统对传输信号只有 固定的时延，可以及时有效的处理数据。所以FPGA在数字通信系统中应用非常广泛。
但由于FPGA器件的限制，以及FPGA自身的电路特性，使FPGA实现复杂算法比 较困难［3刀。因此FPGA系统需要将算法性能与设计实现复杂程度综合考虑。
本章主要介绍SC-FDE整体系统的FPGA设计实现。
5.1 SC-FDE整体系统方案设计
本课题所使用中继平台规定要求传输速率达到10Mbit/s,在这么高的速率下，信道 的多径效应己经非常明显，以SUI-3信道为例，一个码元宽度为O.lus,两条次径时延 分别为0.4us与0.9us,存在多径效应。因此在中继平台上的通信系统必须克服多径效应。 根据第一章的知识，可以使用OFDM技术降低子信道传输速率，由于中继平台上下行 需要采用同一套结构，OFDM不适合作为中继系统无人机平台下行链路，本课题放弃 OFDM,使用均衡器克服多径效应。针对课题要求的传输速率，时域均衡器复杂度太高， 不利于实现，而频域均衡复杂度低，利于FPGA实现，因此中继平台上将选取SC-FDE 作为上下行传输标准。
第三章比较了各种频域均衡算法与均衡器结构，发现MMSE算法比较复杂，并且 需要提前预估噪声方差，迫零算法虽然有可能会放大噪声，算法简单易于实现，因此选 择迫零算法为系统初步选择方案；对于均衡器结构，线性均衡器既可以单独存在又可以 作为判决反馈均衡器的前馈滤波，因此初步选取线性均衡器。这样中继平台上将使用线 性迫零频域均衡器。
为了让均衡器发挥作用，还需要设计实现一个同步系统。根据第四章对同步算法的 研究发现时域算法同步性能不够理想，传统的频域算法未考虑对同步码字信息的充分利 用，并且没有考虑和SC-FDE系统的结合。本文设计的频域同步算法对这两点加以充分 的利用，取得了不错的同步性能，中继平台上使用FPGA实现改进的频域同步算法实现 帧同步，利用过釆样算法实现位同步。
数据帧结构设计：
37


图5- 1中继平台SC-FDE帧结构设计
如图5-1所示，中继平台釆用突发帧结构，同步头的长度为8us,包含一个64点的 同步码字与它的16点CP。UW长为256, CP长为64。数据块的长度为256,数据块的 CP也为64。中继系统要求传输速率lOM/s,加上CP之后的数据速率为12.5M/S。最后 在每一帧的末尾加上保护间隔22.4uso这样可以传输数据块88块，每帧的有效载荷为 22k o
同时根据帧结构的设计可以看出，该帧结构针对的是慢时变信道，即要求信道条件 在2ms内不发生大的改变。
根据3.2.1节对CAZAC与PN序列的对比结果，本文选取64点Chu序列和它的16 点CP构成同步头。均衡头使用256点的Chu序列。
SC-FDE发射端的系统框图如图5- 2所示。
「均衡］	、
普?->加扰-> 交织调制-> 训练加cp ->同步头-> 農震―►養農
序歹!J		—1
图5-2 SC-FDE整体系统发端框图
SC-FDE接收端的系统框图如图5- 3所示。
曩黑f蠹f同步f去CP A均衡f解调f去交织f解扰f鷲
图5- 3 SC-FDE整体系统收端框图
从系统框图中可以看出，整个中继平台包含的内容比较多，但是本论文仅关注其中 的同步与均衡两个部分。在实现的时候也分为两个子系统进行实现，一个是同步子系统, 一个是FDE子系统。由于SC-FDE系统中釆用频域同步与频域均衡的方案，系统中的 同步，信道估计，均衡都在频域进行，可以对FFT/1FFT资源进行复用。而且，因为这 三者在处理过程中，都需要进行复乘运算，因此，复乘模块也能够被复用。
5.2同步子系统设计
本节介绍FPGA同步子系统的设计方案如系统任务，模块划分等，然后按照本方案, 完成FPGA设计。
38
5.2.1系统任务
同步子系统的任务是在输入的数据流中准确找出有效数据的起始点，在有效数据的 起始点和结束点加上开始结束标志位后输出。同时，该系统可以完成信噪比估计等工作。 同步系统模块位于频带处理之后，采样判决等其他信号处理模块之前。因此同步系统的 性能对整个系统性能有直接的影响。只有在同步模块准确找到数据起始位置之后，整个 通信系统才能正常工作。
5.2.2系统接口
在系统设计之前，先完成模块接口的规划。进一步的设计中，系统接口不再更改。 首先输入输出数据位宽为16位，输入数据速率符号速率的四倍采样wr_clk,输出为符号 速率的一倍釆样即wr_clk/4;同时需要一^ wjclk的四倍时钟用做同步模块的工作时钟。 信噪比的估计的输出为七位的无符号数，且该值仅表示信号能量与噪声能量的比值，并 不是绝对的信噪比。
表5- 1同步子系统接口描述
输入	描述	位宽
wr^clk	数据输入时钟	1
rd clk	　　　　　同步系统处理时钟	1
rst	复位信号	1
datareal	输入数据实部	16
dataimag	输入数据虚部	16
输出	描述	位宽
sync data real	输出数据实部	16
syncdataimag	输出数据虚部	16
sop	　　　　　有效数据起始标志	1
eop	　　　　　有效数据结束标志	1
valid	数据有效标志	1
sync flag	同步标志-	1
snr estimate	信噪比估计输出	7

5.2.3	模块划分
本章主要介绍各个模块的划分。
39
5.2.3.1滑动窗控制模块
模块功能：将输入数据从wrclk转化到rdclk输出，并提供握手信号。
模块时序：按照FFT模块的点数N,每接收N/4点数据(wrclk),则输出N点数据 (rdclk),并且为这N点数据加上握手信号(sop, eop, valid)»
5.23.2 FFT/IFFT 模块
模块功能：完成FFT/IFFT计算。
模块时序：1、流水处理；
2、用握手信号(sop, eop, valid)表示输入输出数据块。
5.2.33复乘均衡模块
模块功能：完成复数乘法。
523.4本地ROM控制模块
模块功能:根据FFT输出的握手信号，协调本地ROM数据输出，以进行乘法计算。 模块特点：根据握手信号，使ROM数据与FFT数据对齐。
5.2.3.5功率计算模块
模块功能：计算接收信号的瞬时功率。
5.2.3.6能量计算模块
模块功能：1、统计信号能量；
2、	统计数据块总能量；
3、	找出能量峰值以及峰值位置。
5.23.7同步判断模块
模块功能：1、计算信噪比；
2、	判断信噪比是否满足同步条件；
3、	输出同步标志位与同步位置。	-
5.2.3.8数据定位模块
模块功能：根据同步标志位与同步位置，从数据缓存中取出数据并标志数据起始位。
5.2.4 同步子系统方案与框图
-	同步系统的工作主要针对基带数据的倍频数据，本节只给出基带处理部分的设计,
40
基带系统框图如下。


图5-4同步子系统FPGA结构
如图所示，信号经过中频处理之后，成为基带数据的釆样数据，然后进入同步系统。 频域同步系统处理的单位为数据块，因此需要经过数据分块过程。然后对每一块数据进 行如下处理：
1、	FFT计算，将时域信号变换为频域信号；
2、	频域信号与本地数据进行复数乘法；
3、	将结果送入IFFT模块，将频域信号再次变换到时域，从时域上看，己经完成循 环卷积运算；
4、	信号幅值计算，统计数据块能量，峰值信号能量，峰值点位置等信息。
5、	使用除法计算信噪比，判断信噪比是否满足同步条件；
6、	根据同步判决结果，从数据缓存中找出有效数据起始点，并标记。
以上处理过程中，信号块的握手信号均使用sop, eop, valid这三个握手线的形式 完成。
5.2.5 系统参数
本项目所设计的同步子系统将对基带为10M的符号通过单载波频域均衡系统进行传 输。首先规定基带数据符号速率为10M,每秒钟500帧，即一一帧数据时间长度为2ms； 规定滑动窗大小为256, CP长度为64；因此SC-FDE系统的符号速率被提升为12.5M。 同时因为数据块大小为256,因此FFT模块也需要采用256点的FFT。项目中对采样精 度的需求为正确釆样时刻左右1/4个符号间隔内均为最佳采样区间，由此得到同步子系 统的输入符号速率需要为SC-FDE系统符号速率的四倍采样，即50M。同时为了与 SC-FDE系统共用FFT/IFFT模块结构，需要同步头的长度64点，四倍釆样之后为256 点，同时同步头CP的长度为16点，四倍采样之后为64点。根据设计要求，模块内部
41
FFT/IFFT工作时钟为200Mo
5.2.6	模块详细设计
本小节介绍同步子系统各个模块的详细设计。
5.2.6.1滑动窗模块设计
滑动窗模块实现输入64点5M数据，输岀256点200M数据。
v输入窗-A	k
1			f
・・・	　　64	64	64	64

图5-5滑动窗移动图
该模块使用一块RAM实现，虽然从资源最省的角度，一块256点的RAM足够实 现该模块，但是为了数据完整性，避免对同一 RAM地址进行读写，因此使用512点的 RAM实现该模块。同时考虑到输入数据速率/点数与输岀数据速率/点数，输入输出只需 要连续执行便可以让系统持续执行。还需要考虑的是，将合理分离输入起始地址与输出 起始地址。当输出地址与输入地址相距256点以上时，输入输出永远不会相交。模块流 程图如下：
何个CLK






Rd_addr = Rd_addr + 1;
Wr_addr = Wr_addr + 1;
图5-6滑动窗流程图
5.2.6.2 FFT/IFFT 模块
同步子系统主要运算模块，负责信号时域与频域的相互转换。FFT是离散傅里叶变 换的快速计算方法，它也是傅里叶变换能够实际应用的基础。本课题中直接使用Altera IP 核实现。点数设为256点。使用基时的FFT与IFFT,即FFT与1FFT的输入输出顺序 都为自然顺序。
42


图5-7FFT模块仿真
从FFT模块的仿真图中，可以看出当输入为正弦波时，输出只在该频率值上有幅度 值。这与理论与Matlab仿真相一致。为了说明计算结果的完全正确性，还需要计算比 较相位值。
Altera提供的FFT IP核可以使用块浮点技术进行计算，这样的技术在某种程度上 起到了自适应放大器的作用。本项目使用的同步算法主要依靠对信噪比的估计结果，测 度函数中分子分母的放大倍数对结果没有太大的影响，这个特性在本项目中尤为关键, 可以实现自动增益控制的功能。
模块吞吐率：1符号/CLK；模块时延：534CLK；
526.3复乘均衡模块
该模块完成复数乘法器功能。粗略地看，一个复数乘法器需要4个乘法器，2个加 法器：
dataa =，十 bi da tab = c + di result = x + yi	式(5-1)
式(5-2)
式(5-3)
解得：
x = ac - bd	式(5-4)
y ~ be + ad	式(5-5)
可以做如下变换，	则X, y可以表示为
x = ac — bd + (be -ad) — {be — ad)	式(5-6)
即
x = (ac + be — bd — ad) — {be — ad)	式(5-7)
这样X, y可以表示为
x = {a + b)(c~d) - (be 一 ad)	式(5-8)
y = bead	式(5-9)
43
这样，计算X, V的方程中便只包含了 3个乘法运算与5个加法运算，从而达到节 省资源的目的。但是这样做会导致效率上的损失，改进的方法需要先计算a + D与c-d, 因此需要消耗一级的时钟。
两种设计的吞吐率都为1符号/1CLK；
4乘法，2加法方法模块延迟为2CLK；
3乘法，5加法方法模块延迟为3CLK；
5.2.6.4本地数据控制模块
该模块根据FFT输出的握手信号，产生本地存储器ROM的地址信号，并且延迟当 前握手信号作为IFFT模块的握手信号。
同步子系统开始工作之后，数据连续从FFT模块输出，不会有间隔，因此只需要在 FFT的第一个sop握手信号之后，模块产生累加的ROM地址便可以正确控制ROM数 据。
该模块吞吐率也要求做到1符号/CLK；同时考虑到RAM数据输出延迟为2个CLK, 复数乘法器的延迟为3CLK,因此需要对FFT模块输出的握手信号延迟5个CLK。
5.2.6.5功率计算模块
计算信号功率，将数据实部虚部平方后相加。同时需要将握手信号延迟两级。模块 资源消耗为两个乘法器一个加法器。
power = k(a2 + 屏)	式(5-10)
power表示数据块每一点的功率，其中k为系数，可以设置为lo模块吞吐率：1 符号/CLK；模块延迟：2CLK；
5.2.6.6能量计算模块
计算数据块所有幅值的和，同时将幅值最大的点作为有效信号，幅值最大点的位置 p,取p-1, p, p+1的值作为有效信号的能量。
S咬x=m津{power}	式(5-11)
S =	式(5T2)
n
P = index{S^, power}	式(5-13)
其中表示数据块内的功率最大值，表示数据块的能量，〃表示数据块内功
率最大值的位置，由于行FFT计算式存在频率泄露，因此信号的总能量可
44

以表示为:
Signal sum =	+ amplitud^j)-1] + amplitud^p +1]	式(5-14)
当存在频率泄露时，峰值两侧的能量往往呈对称分布，式(5-14)可以表示为：
Signal _ sum = Sg + arrplitud^p-1]*2	式(5-15)
模块处理流程图:



amplitude



图5-8能量统计模块流程图
该模块每一个数据块才需要输出一次数据，因此数据吞吐率为1符号/256CLK。 而整个模块的延迟仅为加法器与其中的判断，所以模块延迟为257CLK-
5.2.6.7同步判断模块
使用能量计算模块计算出的信号能量与总能量，得到噪声能量。进行除法运算，得 出信号能量与噪声能量的比值。
测度函数宀$件—
Sum 一 Signal _ sum
则模块的流程图如下：
SOP



图5・9同步判决模块流程图
通过理论分析与仿真得知，在同步头进入滑动窗的几个相邻数据块中，该比值先增 大然后减小。因此，设定判定模块的工作原理如下：
首先判决模块将缓存前几个数据块的测度函数的增加或者减小的关系。用一个bit 表示，如当前数据块的测度函数大于上一模块的测度函数，就用1表示否则用0；其次，
45
需要缓存前两个数据块的测度函数值。如此，便会得到一个4bit的表示大小关系的移位 寄存器和3个表示测度函数值的移位寄存器。假设依次进入的测度函数值为名或，M_x, M，Mx, M2,那么对于应该判定为同步的情况应该为：
M_2 <M_x <昭 > 域〉心，此时，表示大小关系的移位寄存器中的值应该为HO。。 同时只要昭大于判决门限，就可以认定同步成功，输出一个同步标志位与同步位置信 ，息、O
模块计算中使用了一个除法器以完成归一化的工作。一般来说，在FPGA中实现 一个除法是很困难的，但由于本模块只需要在256个时钟周期中计算出除法值，对除 法器的时序要求并不高，故在实现中釆用自己设计的除法器，使用流水线设计，对于32 位无符号除法会有32个时钟周期的延迟。
对于该模块的吞吐率与延迟的计算显得稍微复杂，首先数据的吞吐率为1符号/SOP； 对模块的延迟与除法器的采样延迟有关，对32位的除法器，使用32级流水使用可以完 成，此处的延迟釆样设为40个CLK。
5.2.6.8数据定位模块
虽然整个同步子系统吞吐率为1符号/CLK,但系统延退却非常大，因此需要将原始 数据存入一块RAM中，等同步子系统找到同步点与同步位置时，便可以在该RAM中 将数据取出，标识好同步点后送入后级进行处理。系统的整体延迟可以从Modelsim仿 真中得到，大致为400个CLK。即当某个滑动窗中包含全部的A序列信息后，需要经 过400个时钟周期之后系统才会发现这个应该判定这个滑动窗为同步码字。该模块的主 要工作是，在将原始数据输入RAM之后，从RAM之中根据。值找到同步码字起始位 置。结合表4-1滑动窗偏移对应的峰值位置可以定位到同步码字起始点在目标滑动窗内 的位置，因此需要得到当前滑动窗与目标滑动窗之间的关系。从延迟的值可以发现，目 标滑动窗是当前滑动窗的前5个滑动窗，因此根据当前滑动窗的序号值，可以推出目标 滑动窗的序号值。模块的流程图如下：
46

图5- 10峰值查找模块流程图

5.2.6.9系统时钟设计
系统中存在多个时钟，而门控时钟会给时序约束带来不必要的麻烦，所以在FPGA 中不建议使用门控时钟。在本项目中，统一使用由FPGA时钟树提供的时钟，它能保证 到各个寄存器的时钟的延退不会相差太大。
本系统中需要3个时钟，第一个是对基带数据的4倍采样时钟50M,第二个为FFT 处理时钟200M,第三个为数据输出时钟12.5Mo这三个时钟都由PLL提供，PLL的输 入时钟为10Mo
5.3同步子系统仿真与调试
同步子系统数据流比较复杂，需要结合Matlab与Modelsim进行联合仿真，对比数 据流程与数据波形，这样在设计阶段能够快速定位问题，解决问题。如下图所示，使用 Modelsim的testbench将各级输出数据保存为文件，然后在Matlab中调入这些文件数据， 并画出波形，通过对波形的比较，可以判断FPGA程序设计是否出错。如果波形不同， 则需要仔细分析错误模块的问题。以下面的输出为例，进行说明。
仿真条件，在无噪声的情况下，信号满量程输入
Modelsim仿真得到的估计信噪比输出：
：47 肚3。『312	时72巨脯
图5-11信号能量与噪声能量的Modelsim仿真
Matlab仿真得到的估计信噪比输出：
4	47	139	312	722	869	394	176	70	9
图5- 12信号能量与噪声能量的Matlab仿真
47

从上图可以看出，Matlab与Modelsim的输出基本一致。证明Verilog设计功能达到 预期。

从图5- 13的板级调试图中可以看出，在有线直连模拟无线信道的情况下，不存在 同步丢失的情况。
5.4同步子系统性能指标与资源消耗分析
系统尚未进行板级调试，只经过了仿真。不过在仿真中，加入了各种噪声，只要保 证有效的数据比特数在两个以上，都能准确的找到同步码字的位置。因此按照每一个bit 可以抵抗6dB噪声的方法计算，该系统的动态范围能够做到大约70dB左右。
系统的资源消耗如下:
/ Total logic elements
Total combinational functions Dedicated logic registers
Total registers
Total pins
Total virtual pins
Total memory bits
Embedded Multiplier 9-bit elements
Total R±s
图5- 14同步子系统资源消耗
从图5-14可以看出系统对资源的消耗并不大，主要的资源消耗集中在FFT与IFFT 上。
48
5.5 FDE子系统设计
5.5.1 FDE子系统方案与框图


图5- 15FDE子系统的FPGA结构
FDE子系统的结构如图所示。下面对各个模块的时钟和数据速率进行一定的说明， 首先，输入的数据速率为12.5M。FFT块的大小为256。数据中每256点需要插入64点 的CP。同步之后的第一个数据块用于均衡中的信道估计，因此复乘后的数据不通过IFFT 而是进入信道估计的RAM中，此时数据选择器将选择ROM中的数据。信道估计之后 的其他数据将被均衡。
从FDE子系统的结构图中可以看出，FDE子系统的数据处理流程和同步子系统有 很多相同的处理流程，因此可以复用同步子系统的大部分结构。本小节仅针对FDE子 系统特有的模块进行设计。
5.5.2	FDE子系统模块设计
5.5.2.1去CP以及时钟提升模块
模块功能：在数据同步完成之后，对单倍釆样的数据，去掉每一块数据前添加的M 点CP,然后将剩下的N点数据时钟速率提升至FFT处理时钟后输出。
详细设计：釆用状态机设计该模块。输入握手信号中应该包含帧起始sop信号与帧 结束eop信号。这个状态机比较简单，可以利用状态机设计工具FSMDesigner进行设计， 状态转移图可以表示如下。
49


图5-16去CP模块状态转移图
状态转移图中Idle表示空闲状态，当收到帧起始标识时，进入写RAM_A的WA状 态，当RAM_A写满之后，进入写RAM B的WB状态，WA, WB状态循环往复，形 成乒乓RAM结构输出数据。
5.5.2.2数据分支模块
该模块负责将UW与数据分离，将UW部分用于信道估计，将数据部分直接送入
IFFTo
5.5.23数据选择模块
该模块负责完成对UW与数据使用不同的存储数据，对UW使用信道训练数据， 对数据使用信道的估计值。
5.5.2.4信道估计模块
根据式(3-7)设计信道估计模块，对于信道均衡系数的估计，需要使用一个除法器实 现。模块框图如下：

图5-17信道估计模块框图

5.6同步子系统与FDE子系统联合
同步子系统的最终目的是为SC-FDE系统服务，进行方案设计的时候，便将SC-FDE 系统纳入了考虑范围。一般的研究中，将两者结合研究并不太多，大多是将两个系统直
50 接进行串联的结构，而在本项目中，同步子系统与SC-FDE系统紧密相连，釆用几乎同 一套处理结构，为此，在本节扩展同步子系统，让系统成为一个同步SC-FDE系统。
系统框图结构如下


图5-18同步与FDE系统的联合设计
从系统框图可以看出，SC-FDE整体系统的框图与同步子系统的框图没有太大的区 别。其原因是，同步与均衡系统的主要计算，都通过算法转化到频域进行。唯一需要特 别设计的是两个数据选择器与一个数据分支输出器。
FFT计算之前的数据选择器主要负责切换同步前未知数据与同步后有效数据。当找 到有效数据后，针对每一帧数据，可以将FFT和1FFT模块用于均衡运算。在找到有效 数据之前，FFT与IFFT用于寻找同步码字。在复乘模块处的数据选择模块则主要决定 FFT之后的数据的运算方式，同时决定了当前计算数据的作用。对没有找到帧数据起始 位置的数据块，选择本地同步数据；当找到帧起始位置后的第一个数据块，选择本地 FDE数据，表明正在进行信道估计；其他的数据块，则应该选择信道估计的均衡系数, 表明该数据块正在进行均衡。IFFT模块之后的数据输出分支则表示当前数据的作用， 输出至同步计算模块的数据应当是还未进行帧同步的数据；输出至信道估计RAM的数 据应当是信道估计的结果，如果采用更复杂的信道估计方案，则在RAM与数据分支输 出之间加上更复杂的处理模块；而输出至数据输出的数据则应当是均衡之后的数据，如 果釆用判决反馈频域均衡结构，则在此之后应当加上反馈结构。
从上面的分析可以看出，SC-FDE整体系统能够复用FFT与IFFT模块，从而达到 节省系统资源的目的。不过这样做有一定的缺陷，即需要保证对同步头过釆样之后的数 据与均衡头或数据块的长度保持一致，这样才能达到FFT模块复用的目的。但是如果在 FPGA中己经有支持变长FFT计算的模块，则无论是否满足该条件都可以使用该结构。
从联合设计框图中可以看出，系统资源的消耗在同步子系统上不会有太大的增加， 唯一增加比较多的将是RAM资源的消耗。
同时还需要增加一个信道估计模块，因为在系统中，均衡过程使用乘法器实现，求
51
解均衡系数的过程需要除法器的参与。
5.7 SC-FDE整体系统性能与资源消耗


图5- 19SC-FDE系统效果图
图5- 19中的画出的波形为Modelsim仿真同步均衡系统得到的数据，将数据导入 Matlab作图得到。可以看出，输入数据为受到多径效应影响的正弦波，通过均衡后，输 出波形恢复为正弦波，仅存在幅值上的差别。
Flow Status
Quartus n Version
Revision Name
Top-level Entity Name
Family
Device
Timing Models
，Total logic elements
Total combinational fumifons
Dedicated logic registers
Total registers
Total pins
Total virtual pins
Total memory bits
Embedded Multiplier 9-bft elements Total PUs	Successful - Mon Jan 05 13:57:22 2015 10.1 Build 153 11/29/2010 SJ Full Verston syn!28	.
system„top
Cyclone m
EP3C40F484C7
Final
15^12 / 39,600 (39%)
11,189/39,600 (28 %)
13,0»7 / 39,600 ( 33 %)
13087
45/332( 14%)
0
541,408 / 1,161,216 (47%)
64 / 252 ( 25%)
0/4(0%)

图5- 20 SC-FDE系统资源消耗情况
从系统的资源消耗中可以看出，正如上文分析，存储器资源的消耗增加比较多，而 逻辑资源只增加了大约50%o如果不采用复用FFT与1FFT的方案，逻辑资源的增加量 大约是100%。因此，可以看出，本系统在节约FPGA资源上达到最优。
5.8 FPGA系统优化
上一节给出了系统整体的资源消耗。从中可以看出，系统工程总共消耗的资源为 15500个LUT资源。主要的资源消耗为FFT计算模块。接下来对该系统进行资源的优
52
化。
从本系统的FPGA优化角度来讲，有如下几个优化方法：
1、	在FPGA系统中，大多数模块都需要计数器来控制时序结构，可以将计数器移 出模块，放到系统顶层，进行资源的共享，达到节约资源的目的。
2、	从本系统的角度出发，将优化的重心放到FFT模块上。发现整个同步子系统的 主要工作由一对FFT/IFFT组成，而结合数字信号处理的知识。快速傅里叶算法有两种 计算方式：基时与基频郞】。基时FFT的输入为自然顺序，输出为二进制逆序，基频的 FFT输入为二进制逆序，输出为自然顺序。若能利用这一特性，不仅能降低系统整体时 延,而且可以节省RAM资源。所以可以进行的优化为将FFT模块设置为自然顺序输入， 二进制逆序输出；IFFT模块设置为二进制逆序输入，自然顺序输出。然后将本地数据 控制模块设置为二进制逆序地址。系统整体结构上便表现为自然顺序输入，自然顺序输 出。
3、	关于复乘模块的优化，复乘模块中，适合FPGA实现的3乘法5加法结构虽然 节省了一个乘法器资源，但是会增加2个加法器的使用与增加一级时延。通过对结构的 深入研究发现，错误味找到引用源。的两个加法运算a + A, c-d需要提前进行的加法 运算是导致增加一级时延的原因，而对于本项目中需要从RAM中读取本地数据，而从 RAM中读取数据会有两个时钟周期的延迟，因此两个时钟周期的延迟可以利用来计算 a + b,而c, d是RAM中己知的数据，可以提前计算好c-d放入RAM中，这样便达 到节省一个加法器，并且缩短一级时延的目的。这正是FPGA中空间换时间的重要体现。 5.9本章小结
本章主要介绍SC-FDE整体系统的FPGA设计，在设计之前，规定系统的各个参数 与接口是完成设计的必要条件，在参数与接口设计完成之后，一般就不再进行改动。
然后完成对系统的模块划分，针对各个模块进行详细的FPGA设计，同时针对各个 模块的功能与接口进行完备的仿真。在此之后将各个模块级联调试，通过Modelsim与 Matlab的联合仿真快速定位bug位置，进行快速开发。最后完成模块设计。
在同步子系统设计完成之后，通过增加一定的模块，便完成了 FDE子系统的设计， 联合FDE子系统与同步子系统得到SC-FDE整体系统的设计。结合这两个系统的目的 是为了对FFT运算的资源的复用。FFT是本系统中唯一消耗资源比较多的模块，只要完 成对FFT资源的复用，就能很大程度上达到节约系统资源的目的。
53
第六章总结与展望
6.1全文内容及工作总结
在移动通信中，为了克服多径的干扰，均衡是首选方案。而在宽带移动通信系统中， 数据速率往往高达100Mbps〜IGbps,如果仍然采用时域均衡方案，抽头系数的数目可能 非常多，甚至可以达到数百个。对于N个抽头系数的时域均衡器，它的算法复杂度为 0(»2),同时算法的收敛性与稳定性都非常差。为了提高系统性能，采用频域均衡方案， 可以有效的将算法复杂度降至O(Nlog2N)o因此在高速通信移动通信系统中常会釆用 SC-FDE系统，或与之相似都在频域进行处理的OFDM系统。
本文主要从均衡系数的设计，均衡器结构，以及均衡复杂度等几个方面介绍比较了 时域均衡器与频域均衡器的异同。然后研究了定时偏移对SC-FDE系统性能的影响。引 出对同步技术的研究。
对于同步技术，根据同步的分类与本文关注的重点。主要介绍了位同步与帧同步。 位同步从早期的位同步方法讲起，然后介绍了利用过采样进行位同步的现代数字同步方 案。研究了3个经典的时域帧同步方案之后，通过对时域方案的介绍引入对频域同步方 案的研究。特别地，在对时域算法仿真的时候发现，针对Park算法，直接使用CAZAC 这样的复序列能够取得比对PN序列进行IFFT计算得到复序列的方式具有明显的优越 性，能够克服Park算法中存在虚假峰值这一主要缺陷。联系时域均衡使用频域算法实 现，研究同步算法的频域实现。当釆用了频域算法实现的同步系统，结合FPGA实现， 可以复用FFT资源,节约系统资源。本文研究并设计了一个基础的频域滑动窗同步方案。 频域同步方案的基础是某一个滑动窗内要存在完整的同步码字信息。这样的方法有两个, 一个是增长同步头，一个是利用CP,缩短滑动窗每次的滑动距离。以前的研究大多数 集中与第一个方法，而本文详细论述了第二个方法的理论推导。在介绍了第二个方案的 波形特点之后，给出了一套完整的同步判决方案的设计。
最后，本文介绍了本项目中同步算法的FPGA实现以及该算法与SC-FDE系统的整 合。整合后的系统将以FFT/IFFT以及其中复乘运算为核心，在周围加上数据选择的控 制电路。SC-FDE整体系统通过复用FFT/IFFT资源，达到了 FPGA资源的目的。
6.2未来工作的展望
尽管已经实现SC-FDE整体系统级联，但是整个成果仍然停留在仿真和FPGA芯片 内直连阶段，并未加入真正的信道进行测试。而且频域均衡系数也仅适用较为简单的迫
54
第六章总结与展望
零算法实现，均衡结构为单一的线性均衡器结构。因此接下来还有以下几个方面的工作 需要完成：
＞系统的板级调试。目前要想完成系统的板级调试有两种方案，一种是使用一套 能够直接进行基带数据对连的基带板进行调试；第二种时设计一套中频系统， 加在同步均衡系统之前，对中频处理系统中可以暂时使用差分解调以减小频偏 对系统性能的影响。
＞对均衡算法的改进。对均衡算法的改进可以从均衡系数的确定以及均衡器结构 设计两个方面入手，使用更为复杂的MMSE准则确定均衡系数或者使用反馈判 决均衡结构是未来的两个实现方向。
55
参考文献
[1]周炯槃，庞沁华，续大我等.通信原理[M].北京：北京邮电大学出版社,2002.
[2]吴伟陵，牛凯移动通信原理[M].北京：电子工业出版社,2010.
[3]Liao Xuefei, Bai Yong. Improved symbol timing synchronization algorithms for SC-FDE systems[C]//Consumer Electronics, Communications and Networks (CECNet), 2013 3rd International Conference on. IEEE, 2013: 363-366.
[4]杨正光，陈小红，宋荣方等.SC-FDE/MIMO技术在宽带无线接入系统中的应用研 究卩].南京邮电学院学报(自然科学版),2004,24(1):51-54,81.
[5]Sklar B.数字通信：基础与应用[M].北京：电子工业出版社,2002.
[6]王武军，吴建军，童明科等.单载波频域均衡技术的发展与研究现状[C].中国电 子学会第十六届信息论学术年会论文集.北京：电子工业出版社,2009.
[7]杨志，刘泽民.SC-FDE系统的一种新型判决反馈均衡器[J].半导体技术，2007, 32(9):800-803.
[8]Hwang Taewon, Li Ye. Iterative cyclic prefix reconstruction fbr coded single-carrier systems with frequency-domain equalization (SC-FDE)[C]//Vehicular Technology Conference, 2003. VTC 2003-Spring. The 57th IEEE Semiannual. IEEE, 2003, 3: 1841-1845.
[9]Hassan E S, Zhu X, El - Khamy S E, et al. Performance evaluation of OFDM and single carrier systems using frequency domain equalization and phase modulation]J]. International Journal of Communication Systems, 2011, 24(1): 1-13.
[10]Schmidl T M, Cox D C. Robust frequency and timing synchronization fbr OFDM[J]. Communications, IEEE Transactions on, 1997,45(12): 1613-1621.
[11]H. Minn. M. Zeng. V. K. Bhwgava. On Timing Offset Estimation for OFDM Systems [J]. In IEEE Communication Letters. 2000.7, 4(7): 242-244.
[12]Park B, Cheon H, Kang C, et al. A novel timing estimation method fbr OFDM systems[J]. Communications Letters, IEEE, 2003,7(5): 239-241.
[13]Ybon C, Lee H, Lee W Y et al. Joint frame/frequency synchronization and channel estimation for single-carrier FDE 60 GHz WPAN system[C]//Consumer Communications and Networking Conference (CCNC), 2010 7th IEEE. IEEE, 2010: 1«5.
[14]马杰.基于DFT的OFDM系统的MMSE信道估计研究[D].武汉:华中师范大学，
56
2009
[15]蒋秋红.移动通信信道建模与仿真的研究[D].天津:天津大学,2004.
[16]任斌.CAZAC序列在LTE中的应用研究[D].北京:北京邮电大学,2009.
[17]杨勇.基于ATSC数字电视接收机判决反馈均衡器的研究[D].上海:上海交通大 学.2008.
[18]张磊.ITE上行链路SC-FDE同步技术研究[D].杭州:杭州电子科技大学.2011.
[19]高镇，彭克武,潘长勇.多载波与单载波频域均衡系统的仿真与测量[J].通信学 报,2009,30(7)： 112-117.
[20]Reinhardt S, Weigel R. Pilot aided timing synchronization for SC-FDE and OFDM: a comparison[C]//Comniunications and Information Technology, 2004. ISCIT 2004. IEEE International Symposium on. IEEE, 2004,1: 628-633.
[21]Wang Y Dong X. Frequency-domain channel estimation fbr SC-FDE in UWB communications]J], Communications, IEEE Transactions on, 2006, 54(12): 2155-2163.
[22]杜雪.SC-FDE系统的同步技术研究[D].西安：西安电子科技大学,2010.
[23]唐垒花，陈晨，陈文正等.SC-FDE系统的频域均衡器设计卩].浙江大学学报, 2007, 34(6):640-643.
[24]Falconer D., Ariyavisitakul S.L., Benyamin-Seeyar A.,Eidson B. Frequency Domain Equalization fbr Single-Carrier Broadband Wireless Systems[J]. Communications Magazine, IEEE.2002.40(4):58-66.
[25]陈晨，赵民建，陈文正.单载波频域均衡技术的定时同步研究[J].浙江大学学 报,2007,41(3): 445-449.
[26]Qi Y, Huang P, Rong M. Performance Comparison of TDE and FDE in Single-carrier SystemfC]. //Vehicular Technology Conference, 2009. VTC Spring 2009. IEEE 69th. IEEE, 2009: 1-5.
[27]Cormen T H, Leiserson C E, Rivest R L, et al. Introduction to algorithms[M]. Cambridge: MIT press, 2001.
[28]王永庆，乔媛，吴嗣亮.基于早迟门位同步环的FPGA实现[J].微计算机信息, 2009 (8): 178-179.
[29]Gardner F M. Phaselock techniques[M]. John Wiley & Sons, 2005.
[30]付永明，朱江，堀瑛珏.Gardner定时同步环路参数设计及性能分析[J].通信学 报,2012, 33(6): 191-198.
[31]Gappmair, W. Open-Loop Analysis of a Nonlinearly Modified Gardner Synchronizer [J].Communications Letters, IEEE 2014.18(11)： 1963-1966.
57
[32]陈一帆，马正新，石荣.一种基于过釆样的OFDM系统定时同步算法[J].移动 通信,2011,35(12):84-87.
[33]刘洛.OFDM系统符号定时同步研究及实现[D].成都：成都电子科技大学, 2014.
[34]Huemer M, Witschnig H, Hausner J. Unique word based phase tracking algorithms for SC/FDE-systems[C]//Global Telecommunications Conference, 2003. GLOBECOM'03. IEEE. IEEE, 2003,1: 70-74.
[35]Li-xun Huang , Lijun Sun .A novel timing synchronization method for SC-FDE systems[J]. Computer Science and Computational Technology, 2008.2:641-643.
[36]高鸿坚，李建岐，陆阳.一种基于卷积的OFDM定时同步算法实现[J].电子技 术应用,2013,39(3): 100-103.
[37]克里兹，孟宪元.高级FPGA设计：结构，实现和优化[M].机械工业出版社, 2009.
[38]周利清，苏菲.数字信号处理基础[M].北京邮电大学出版社,2005.
58
