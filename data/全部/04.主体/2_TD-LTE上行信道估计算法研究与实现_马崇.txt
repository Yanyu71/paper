第一章绪论
1.1移动通信系统的发展
19世纪90年代，马可尼的无线电报开启了人类的无线电通信纪元。但是直 到20世纪80年代模拟移动无线电系统的岀现,人们才真正步入了移动通信时代, 发展至今，移动通信系统前后经历了四代。
第一代无线通信系统，开始于上世纪70年代。第一代(1G)无线通信系统为 模拟移动通信系统，主要采用的是频分多址(FDMA)技术。用户的强大需求是无 线通信大发展的一个重大推动力，除此之外，微电子技术的飞速发展也为这一时 期移动通信技术飞速发展奠定了技术基础。在最初的1G系统中釆用的大区制， 但是随着用户接入数目的增加，该系统很快饱和。为此，贝尔实验室提出的蜂窝 网的概念，实现了频率复用，同时也大大提高了系统容量，而蜂窝网的网络结构 也一直沿用至今。
第二代无线通信从上世纪80年代开始，2G时代标志着移动通信由模拟时代 步入了数字时代。2G具有代表性的标准是GSM和IS-95o GSM即全球移动通信 系统，是当前运用最为广泛的移动通信标准，目前仍在全世界广泛使用。GSM 釆用了 TDMA和FDMA混合接入的方式，另外为了提高容量，GSM系统采用 了自适应语音编码技术。IS-95是第一个基于CDMA的数字蜂窝网络，CDMA 系统使用正交的地址码来实现多址。CDMA可以支持时间、空间和频率等多种 分集方式，并且具有较高保密性，同时通过正交码来实现多址可以很容易实现用 户容量的拓展。CDMA的这些特性也使其在当今3G技术中被作为无线接入方式 而大量采用卩】。2G系统满足了人们对于话音移动通信的需求，但是随着人们对 于数据通信业务的需求日益增高，原本2G系统已无法适应数据通信需求的高速 发展。虽然推岀了 GPRS/EDGE等新系统，该系统可以支持较高速率的数据业务 传输，但是这仍只是个过渡性产品。
第三代移动通信系统(3G)基本满足了人们对于数据通信业务的需求。第 三代移动通信系统可以提供前两代系统不能提供的各种宽带通信业务，如高速速 率、慢速图像和视频，传输速率可高达2Mbit/s,带宽可达2MHz以上PLlTU-2000 继续延续了在多址接入中CDMA为主的技术。IMT-2000无线通信系统标准有 WCDMA、CDMA2000和TD-SCDMA三大分支。3G无线通信系统的提岀满足 了如下几个需求：全球漫游，系统具有公用频段，用户能实现全漫游；适应多种 环境；提供足够大的容量、强大的多用户处理能力及高保密性等⑴。
在移动通信宽带化趋势下，为了应对IEEE组织的WiMAX等移动无线接入 技术挑战，3GPP组织在2004年12月开始了 LTE的标准化制定工作。LTE理论 上可支持上行最大50Mbps,下行100Mbps的数据传输速率。但是按照ITU的标 准，LTE严格来说并不是4G技术，直到R10版本，3GPP将LTE-Advanced视为 LTE演进的重要一步，才标志着移动通信系统向4G演进的开始。
在下图1-1中，详细描述了移动系统的发展过程及其所能支持最大传输速率 等信息。


图1-1移动通信系统的发展过程两
移动通信系统在过去几十年间得到了迅猛的发展，数据传输速率由2G时代 的小于10kbps发展到4G的百兆甚至吉比特级。移动通信系统的发展也深刻改 变着人们生活、工作、学习的方方面面，推动了社会的发展。
随着工信部向移动、电信、联通发放TD-LTE的牌照，这标志着2013年成 为LTE移动通信系统在中国正式商用的元年。在国内，通信产业界也将借着 TD-LTE牌照发放这一时机，迎来了新一轮大发展。无论是国内的上游的芯片制 造商，下游的通信设备制造商，还是移动终端制造业都将由此受益。除了在公网 使用之外，LTE系统经过简化也常常被运用于专网系统。在TD-LTE无线通信系 统中，信道估计算法的好坏会直接影响通信系统的性能，因此信道估计领域的学 术研究工作一直是无线通信领域的一个重要方向。
1.2 LTE信道估计算法研究现状
在LTE上行发送链路，每个子帧中插入了一个或多个导频信号，即解调参 考信号（DMRS）,因而现有对LTE信道估计算法的研究主要集中于基于导频的
2 非盲信道估计。基于导频的信道估计算法可大致分为三类：基于LS的信道估计 算法，基于DFT变换域去噪的信道估计算法，以及基于MMSE的信道估计算法。
LS信道估计是在获取到的DMRS基础上，与本地产生的ZadoffLChu序列 相除得到频域信道冲击响应（CFR）o LS算法实现简单，但是抗噪声影响能力弱， 在低信噪比环境下性能表现差。为了减少噪声的影响，引入了一种基于DFT变 换域去噪的信道估计算法，该算法以LS估计算法为基础，将LS估计得到的CFR 通过离散傅里叶变换之后，在时域对CIR进行去噪处理。一个好的去噪策略直 接决定了基于DFT变换域去噪的信道估计算法的性能。在去噪方法中，传统的 方法是基于信道冲击响应（CIR）长度一般小于循环前缀（CP）长度的原理，对 于CP长度外的样点置零；文献［5］针对此，提出了改进的门限去噪方法，通过统 计噪声方差，设定基于噪声方差的估计对时域的CIR进行去噪。这种基于DFT 去噪的方法，常因为丢弃了一些信道的能量导致估计性能的下降。文献［5］引入 了判决指导门限进行去噪，进一步改进了基于DFT去噪算法的性能。文献［8］提 出频域加窗的改进DFT算法，该算法通过在频域对CFR进行加窗平滑，来减少 经过离散傅里叶反变换（IDFT）后CIR在时域的扩散，以保证在进行去噪操作时， 减轻因去除一部分有效信道信息对信道估计的不良影响，从而改善信道估计的效 果。在讨论使用的窗函数时，论文［9］提岀了一种基于MMSE准则的经验值窗函 数对时域信道冲击响应去噪的算法，该算法可减少能量泄露的影响，从而改善基 于DFT去噪算法在高信噪比下的性能表现。
MMSE算法在代价函数计算中考虑了噪声的影响，因而在有噪声环境中可 以获得一个较好的性能。传统基于MMSE准则的信道估计算法，需要计算接收 端接收到信号之间的自相关矩阵，以及在导频位置上接收信号和真实信道响应之 间的互相关矩阵。这过程中涉及到了大矩阵的求逆运算和相关运算，并且这种运 算复杂度会随着矩阵维度的增加而急剧增加，因而传统的MMSE算法在实际应 用中受到了很大限制。为了简化基于MMSE准则的信道估计算法复杂度，文献 ［10］提出了基于MMSE准则的奇异值分解（SVD）估计算法，该算法对滤波矩 阵做奇异值分解后得到特征值，然后舍弃相对较小的特征值来实现矩阵降秩，以 简化MMSE运算量。另外，在文献［11］中，提出了一种在信道自相关矩阵中利用 子矩阵块运算代替大矩阵进行运算的低复杂度的LMMSE算法。为了进一步的简 化运算复杂度，文献［12］从信道相关带宽与信道信息的关联性出发，对LMMSE 算法中的自相关矩阵进行降秩。而文献对信道自相关矩阵的构成进行了分析，通 过对LS估计输出进行IDFT变换，在时域根据能量值来截取多径及去除“伪多 径”，并使用Choleshy分解运算代替求逆运算，实现运算复杂度的降低。这些算 法尝试从各个方面来降低运算复杂度，但是都需要预先建模，获取并存储信道特 征信息。这些算法需要预先建模，无法根据实时信道变化进行调整参数，而且， 实际信道和建模存在误差，这都限制了 LMMSE在工程实践中的使用。而文献［14］ 提出了一种快速的LMMSE信道估计算法，该算法改进的MST算法估计信道自 相关矩阵，并使用Kumar快速算法计算LMMSE矩阵。该算法的突出特点是不 需要统计信道信息，因此能够适应变化的信道条件，这也使得该算法具有工程实 现的可能性。
由于在OFDM系统中插入了一些虚子载波来减小邻道干扰并降低滤波要 求，这种CFR信息的缺失导致了信道估计的偏差。一些基于虚载波频域信道响 应拓展的算法被提出来，这类算法可归为基于DFT信道估计算法的改进算法。 文献［15］提出了一种通过添加虚载波频域信道响应(VCFR)的方式来改进基于 DFT的信道估计算法。文献［7］中，讨论了一种在VCFR拓展基础上，并通过频 域加窗平滑，通过IDFT换到时域后，对CIR采用MST去噪算法【16】去除噪声及 干扰的新算法。文献［7］对比了各种频域加窗函数后的MSE指标，验证了加窗函 数对进一步使CIR集中的效果。但是，文献［7］提出的窗函数在VCFR与实际信 道冲击响应边缘不平滑会导致性能下降，另外文献［7］中采用的去噪算法，需要 确定最大径数，这使得该算法对信道条件的适用性变差。
1.3本文主要研究内容
在LTE系统中，现有的信道估计算法有LS估计，基于MMSE准则的信道 估计算法，以及在LS估计基础上改进的基于DFT的信道估计算法。在这三种算 法中，LS估计的算法复杂度最低，但是估计性能也较差，特别是在低信噪比的 情况下，信道估计性能下降特别厉害。基于MMSE准则的信道估计算法需要信 道的统计特性，因而信道估计性能在三种算法之间最好。LMMSE信道估计算法 需要计算各个导频位置接收信号之间的自相关矩阵及噪声，还有一次求逆运算， 算法复杂度大大提高，故而在工程实现中釆用的比较少。基于DFT的信道估计 算法在算法复杂度和估计性能中做了一个很好的折衷，但是也存在高信噪比时性 能的“地板现象"一一在高信噪比下，信道估计性能没有随着信噪比的提高而改 善。
本文针对基于DFT类信道估计算法的研究，主要集中于添加虚频域信道冲 击响应(VCFR)的改进算法。在进行了 VCFR拓展以后，传统的去噪策略无法 很好适配VCFR算法中时域冲击响应的拓展。为此，需要在VCFR信道估计算 法研究中，针对拓展后的时域信道冲击响应改进现有去噪策略。另外，考虑到时 域信道冲击中有效径分布不均的情况，针对前后有效径分布区，采用差异化去噪
策略以适应多种复杂的信道条件。在VCFR信道估计算法中，频域加窗处理起 到减少有效信号径能量损失的作用。在本文的研究中，针对现有一些窗函数不连 续的问题，结合VCFR频域信道冲击响应特点，提出一种适合VCFR算法的平 滑的升余弦窗函数进行频域加窗处理。	.
在多核DSP平台上对VCFR信道估计算法进行实M时，为了保证C语言实 现结果的准确性，需要先确定信道估计算法的定点化方案，所以在进行算法研究 时，先通过MATLAB平台对定点化方案进行性能验证，然后再进行C语言的算 法实现。在VCFR算法中，需要完成信号在时频域的转换，在多核DSP平台上， 使用其自带的协处理器可以高效实现DFT及IDFT运算。另外，考虑到应用场 景中“一发双收"情形，合理设计多核任务分配，将信道估计任务进行划分，有 助于提高信道估计处理效率。
基于MMSE的信道估计算法在实际运用中使用不多，但是由于利用了信道 信息，理想的MMSE算法在性能上相比其他算法有很大优势。针对MMSE信道 估计算法的研究也集中于降低运算复杂度，通过牺牲一定的算法性能，来实现算 法复杂度上的较大改进。本文选取了无需统计信道信息的快速LMMSE信道估计 算法（F-LMMSE）作为研究对象，从算法性能及运算复杂度两方面综合评估 F-LMMSE算法的实用价值。
综上所述，本文完成的主要研究内容可以概括如下：
1）	讨论与LTE上行信道估计相关的物理层导频设计。
2）	讨论基于LS准则及MMSE准则的信道估计算法。并介绍基于DFT变换 域去噪信道估计算法的基本原理。
3）	讨论LMMSE信道估计算法的简化算法，并着重选择了 F-LMMSE进行 研究，分析了 F-LMMSE的工程实践价值及其算法缺陷。
4）	研究改进了基于虚子载波拓展的信道估计算法。本文提出的改进VCFR 算法，从去噪算法、频域窗函数进行改进。
5）	本文对LS算法，基于DFT算法，F-LMMSE算法以及本文提出的改进 VCFR算法进行了大量仿真及对比分析。并从MSE、RAW-BER.吞吐 量等几个指标出发，对改进的信道估计算法性能进行评估。
6）	本文的最后，在MATLAB仿真结果的基础上，完成了改进的VCFR信 道估计算法在多核DSP平台的实现。提出一种适合DSP实现的变比例 VCFR添加方案；完成定点化运算设计，以保证DSP的算法实现的高准 确度；结合MSC8157平台特点，对该算法实现进行了优化。
1.4论文主要工作的组织结构
论文总共分为五章，本文的组织架构如下：
第一章主要介绍了本文的研究背景，并对目前OFDM系统的信道估计算法 主要研究方向和工作进行介绍。最后说明了本文的研究内容。
第二章主要介绍了 LTE系统及OFDM基本原理，并在本章节的最后介绍了 和LTE上行链路中的导频设计。
第三章先介绍了常见的信道估计算法。作为本章的重点，在分析基于DFT 变换域去噪信道估计算法弊端的基础上，提出了改进的基于VCFR拓展的信道 估计算法，详细地介绍了该改进算法的处理流程。在本章的最后，通过大量仿真 评估该改进算法的性能。
第四章主要介绍硬件实现平台及改进的VCFR信道估计算法在该平台上的 设计实现及优化工作。
第五章是对本文工作的总结，并指出该课题进一步的研究方向。
第二章LTE系统与关键技术
过去，移动通信服务是只有少数人负担起的服务，而如今，移动通信服务已 经遍布全球，深刻影响着群众的日常生活。支撑着移动通信服务飞速发展的基础 是无线通信技术的飞快发展，各种新的技术不断涌现，一步步推动着无线通信的 发展。现在移动通信技术己经发展到了第4代，作为4G主流技术，LTE给用户 提供了高速的数据传输业务。LTE系统中引入的正交频分复用技术（OFDM）和 多输入输出（MIMO）关键技术，显著增加了频谱利用率和数据传输效率=OFDM 技术是LTE相比前几代无线通信技术在数据传输效率有飞速发展的关键。
本章中，首先将简要地介绍LTE系统及其标准化过程，然后将重点介绍LTE 中的OFDM原理及LTE上行链路中采用的的DFTS-OFDM的基本原理，在本章 的最后，将对LTE系统的帧结构和导频设汁进行介绍。
2.1LTE系统概述
2.1.1LTE系统的标准化进程
LTE标准化工作是在3GPP组织内开展的，3GPP组织在其Realse 8版本中首 次提到了 LTEo对LTE系统的需求研究自2004年年底开始直到2008年，前后 历时4年，可大致分为三个阶段⑷：
第一阶段，明确了 LTE的需求、应用场景，并形成了需求报告（TR25.913）, RAN1研究报告、RAN2研究报告、RAN3研究报告等一系列报告。
第二阶段，该阶段主要是通过对第一阶段的中初步讨论的系统基本框架进行 确认，同时进一步丰富了系统的细节，最终与2007年3月形成了 LTEstage2规 范 TR36.300。
第三阶段，LTE技术规范的第一个正式版本技术细节问题层出不穷，导致第 三阶段工作的完成时间一拖再拖，直到2008年12月才完成R8版本的工作。有 些来不及纳入R8版本的特性留到了后面的R9版本中进行讨论。
R8版本是针对LTE的第一版协议，在3GPP后续规范中仍有对LTE系统的 补充。3GPP组织针对LTE系统的规范完成时间及主要内容如下图所示：

Rel-8
2008年12月	　　　　Rel-9
2009年12月
第一版
・LTE
• EPC/SAE	　• LTE家庭基站
・定位业务	　　　　Rel-10
2011年3月
・MBMS支持	　　“LTE-Advanced”
,多标准基站	　　•载波聚合
•增强的下行MIM0
•上行MIM0	　　Rel-11
•增强的ICIC	•	增强的载波聚合
•中继	•	附加的频带内載 波聚合

图2-1针对LTE的3GPP标准冏
LTE的R10版本被ITU-R批准作为一项IMT-Advanced技术版本，标志着4G 标准的出现叫。
2.1.2 LTE系统目标及关键技术
表2-1 3GPP LTE与IEEE 802.16e关键技术对比叫
IEEE 802.16e	3GPPLTE
多址技术	OFDMA	下行 0FDMA,上行 SC-FDMA
双工方式	FDD、TDD、半双工 FDD	FDD、TDD
子载波间隔	10.94kHz	15kHz
帧结构	帧长为2.5ms〜20ms； TDD模式下 一帧分为一个上行子帧和一个下 行子帧	帧长10ms,分为10个子帧。每个 子帧两个时隙
CP长度	OFDM符号长度的1/4,1/8,1/16或
1/32	常规 CP4.6875us,拓展 CPI 6.67us
调制方式	BPSK,QPSK, 16QAM,64QAM	QPSK」6QAM,64QAM
编码方式	卷积+RS级联码,块Turbo码，卷 积 Turbo 码，LDPC 码	Turbo码，卷积码
HARQ	Chase合并于增量冗HARQ	Chase合并于增量冗余HARQ,卜 行自适应HARQ,上行同步HARQ
同步	采用外部时空保证网络同步	小区间同步或者异步
8
为了使LTE成为一个有较强竞争力的B3G系统，LTE系统在做设计时考虑 了如下几个目标：
1.降低通信的成本
2.提供扩展业务灵活性，保证能用较低成本为用户提供更好的服务
3.能灵活使用频谱资源
4.网络架构要更加简化，可以提供开放接口
5.降低终端功耗
为了应对IEEE WiMAX对UMTS技术的挑战，3GPP组织着力于开发以 OFDM技术为核心的，能支持20MHz系统带宽的技术。LTE采用了很多与 WiMAX等宽带无线系统相似的技术。为了对比LTE和这些宽带无线接入技术， 将其关键技术对比罗列如表2-1.
2.2 OFDM 与 SC-FDMA
2.2.1 OFDM 原理
OFDM是一种多载波调制技术，其基本思想是将一个宽带信道分成多个并 行的窄带子信道。这样保证每个子信道的信号带宽小于信道的相干带宽，从而使 信道似于平坦衰落信道。
具体实现时，OFDM将输入的高速数据流变成N个并行的低速率子数据流, 经过这一步串并转换，子数据流的速率变成了输入数据速率的1/No在进行调制 时，这N路平行的数据流各自调制不同中心频率的子载波。经过调制的这N路 信号在各自的子信道上传输，而各子载波上的信号相互正交，这样不同子载波可 以重叠以保证其带宽足够小在OFDM接收端，相干解调器有一组相关器组 成，每个相关器对于一个子载波。OFDM的调制和解调的基本原理图如下所述。



图2-2 OFDM调制原理图

图2-3 OFDM解调原理图
实际上，在LTE下行中使用的OFDM基带信号是由IFFT实现的，这样就 可以把数据的信道编码视为频域信号，经过IDFT处理后频域信号变成时域信号。
OFDM系统对子载波的正交性要求非常高，正交性的破坏会导致OFDM解 调性能下降。为了解决OFDM系统在时间色散信道下的子载波间干扰问题，需 要在OFDM符号前端往往插入循环前缀（CP）卩，循环前缀就是将每个OFDM 符号末端Tcp时间长度波形复制、插入到OFDM符号前端，具体操作流程如下图。 假设原来一个OFDM符号时间长度为T®那么添加完CP之后，整个时间长度 就变成了 Tu+TcPo
添加CP前OFDM Tu*
添加C P后0 ID M符号Tu+T,：p
图2-4 OFDM中添加CP过程
OFDM技术之所以能在如此多的宽带接入结束以及移动通信系统中使用，得 益于其拥有的如下优点：
1.数据通过多个子载波传输，OFDM具有较强的抗衰落能力。
2.频谱利用率高，OFDM利用子载波正交性，不同子载波可以重叠。
3.OFDM系统中，数据是频域而不是时域的表现，因此OFDM的均衡器实 现起来比较简单。
4.CP的使用使OFDM符号可以完全消除由于无线信道中多径信号传播造 成的符号间干扰。
5.通过使用不同数量的子载波，OFDM可以很容易调整系统带宽。
但是，OFDM也有一些缺点限制了其使用，这些缺点有：
10
1.OFDM对子载波正交性要求高，因此对频率误差和相位噪声很敏感。
2.快速移动造成的多普勒频移会造成子载波间的干扰，影响高速移动用户 的性能。
3.OFDM信号的峰均功率比（PAPR）很高，对硬件设备要求高。
2.2.2 SC-FDMA基本原理
在LTE的上行物理层设计中需要满足如下要求卩8】：
1.不同的终端发射的上行信号需要彼此正交，以保证最小的小区间干扰， 及最大的系统容量。
2.上行发射信号需要有较低的峰均比，以保证终端设备的功放设计不至于 太复杂。
3.能充分利用频率分集增益。
4.支持频率的选择性调度。
如上节所述，OFDM系统具有PAPR高的特点，因而在LTE系统中，下行 采用OFDM A,而在上行多址接入时选择了单载波频分多址——SC-FDMAo
在OFDM中，每个调制完的数据符号对应一个子载波。然而，在SC-FDMA 生成时，时域调制符号经过DFT变换，在进行子载波映射，这样每个子载波都 携带了所有数据符号的信息，因此SC-FDMA具有单载波系统特性，其PAPR远 低于OFDM多载波系统卩句。
上行发送中使用的SC-FDMA信号可以由时域和频域两种方法生成。在LTE 上行信号产生中采用的是频域生成方法，即DFT-S-OFDM。DFT-S-OFDM产生 信号的过程如下图所示。其第一步是对包含M个来自调制字母表的调制符号做 大小为M的DFT,第二步通过补零之后的DFT输出信号进行映射到N个子载 波上，第三步完成N点IFFT变换，最后加CP,做D/A转换，送到发射天线。 在做M点DFT映射到N个子载波时，可以选择集中式映射，也可以选择分布式 映射。虽然分布式映射可以带来而外的频率分集，但是与集中式映射相比，分布 式映射对频率误差更加敏感，而且对功率控制要求更高。因此，在LTE上行中 采用的是集中式映射的方式。

图2-5 DFT-S-FDMA发送处理过程
11
2.3 LTE帧结构与导频信号设计
2.3.1	LTE帧结构设计
在LTE中，所有时间大小均以Ts为基本单位，一个Ts的时间时间为 1/(15000*2048) So LTE中一个无线帧为10ms, 一共分为10个子帧。LTE中定 义了 2种帧结构，帧结构类型1适用于FDD模式。帧结构类型1分为20个时 隙，每个时隙为0.5ms。其帧结构如下图：



图2-6 LTE帧结构类型1"<J1
FDD的帧结构中，所有帧可以全部用做上行或下行，上下行传输在频域上分 隔开。LTE的帧结构类型2适用于TDD模式，其帧结构如下图所示。



图2-7 LTE帧结构类型2冋
帧结构2适用于TDD模式。TDD系统在时间上进行双工，通过进行上下行 子帧配比，可以实现上下行传输资源的配置。
12

2.3.2	LTE上行传输资源块
One 叩I ink slo^ia

图2-8 LTE ±行资源栅格冋
在上一小节中，介绍了 LTE中的子帧结构，LTE上行传输使用的资源实际 是一种时频结构。在时域上，TD-LTE上行的每个时隙中根据CP的选择，有6 个SC-FDMA符号或7个SC-FDMA符号。采用常规CP时，每个时隙有7个 SC-FDMA符号；采用拓展CP时，有6个SC-FDMA符号。
上行传输使用RE （资源粒子）作为最小资源块。在RE基础上RB （资源块） 的概念，一个RB由时间域连续的SC-FDMA符号以及频域上连续的子载波构成。 LTE上行资源栅格如图2-8所述。在上行多用户进行频域资源分配时也是以RB 数来计，为了方便DFT的使用，用户占用的RB数不是任意设置的，A^sch表 示PUSCH带宽内的资源块数，应满足：
"脂 SCH =2% .3%	N 器	（2-1 ）
20MHz时，经过统计，所有可能的RB配置为34种。
2.3.3 LTE系统上行信道导频信号设计〔"I
在LTE时频资源栅格中插入导频信号虽然会导致一定的开销，但是也大大简 化了信道估计的设计。LTE的上行链路支持两种参考信号，一个是解调参考信号

(DMRS),另一种是探测参考信号(SRS),这些RS的作用包括用于相干解调 所需的信道估计、用户信道质量检测、功率控制以及定时估计等。在本文中，研 究的信道估计算法就是基于DMRS的非盲估计算法。

图2-9 LTE ±行PUSCH常规CP时解调参考信号分布
在LTE下行中，参考信号被设计为梳状且布置在多个0FDM ±。但是，在 上行传输中，为了保证低的立方度量和高的功放效率，上行参考信号设计为独占 一个特定的SC-FDMA信号〔2呢 上行PUSCH常规CP时解调参考信号的分布如 图2-9所示
上行DMRS使用了一种被称为ZadofF-Chu的序列。这种序列在时域和频域 上都有恒定功率，而且在时域上有好的互相关性。ZC序列的元素可以用公式表 示如下：
(2-2)
这是一个长度为Mzc的的ZC序列。公式中u表示长度为Mzc的ZC序列集 中的某个ZC序列。
参考信号序列定义为基序列氣.(〃)的循环移位，按照下式进行:

其中DMRS长度M^= mN* ,且1 5景器UL ,其中M辭表示RS信号的 数目，N*表示一个RB中的子载波数，一般为12o
14
在生成ZC基序列时，对于长度长度小于3澀的基序列，即对应1个或者2 个RB资源块大小的传输带宽时，采用了一种特殊的基于QPSK的序列来代替 ZC序列。其表达式为：
万,,.(〃)=。加》〃4, o<n<M^-l	(2-4)
而对于长度大于3N票的基序列，其由下式得到：
元,0) = Xg("modN^), 0<n<M^	(2-5)
其中，第q个根ZC序列定义为：
Xq S)=。噸,0 < w < n£ -1	(2-6)
上式中q由下式得到：
g = Ll + l/2_|+v.(-1)阈	(2_7)
孕=滤(“ + 1)/31	-
为了获得同样长度的不同ZC序列，需要对ZC基序列进行循环移位，即式 2-3所述。在本文的信道估计专注于PUSCH的信道估计，PUSCH的解调参考信 号的定义如下：
广皿(他.归野+“)=啪)(〃)	(2-8)
时隙队内的循环移位时隙％内的循环移位a =2丸％/12,而佐s为：
ncs ~ ("以rs + "侦rs + 〃pRs("s))modl2	(2-9)
2.4本章小结
在本章中，首先介绍了 LTE系统的标准化过程以及设计时的主要性能指标。 作为LTE系统釆用的关键技术，OFDM以及SC-FDMA的基本原理在本章中进 行了详细说明，通过讨论OFDM的优缺点，解释了在LTE上行链路中釆用 SC-FDMA的原因。作为本文的研究出发点，TD-LTE上行信道中的信道估计与 导频信号息息相关。为了便于后文的信道估计算法介绍。在本章节的最后，对 LTE的帧结构设计以及导频信号的设计进行了详细的介绍。
15

第三章信道估计算法研究与仿真
信道估计算法性能对TD-LTE上行接收链路处理至关重要，信道估计算法性能 的好坏直接决定了上行链路性能的好坏。在本文中基于LTE上行链路PUSCH信 道进行信道估计算法研窕。在TD-LTE PUSCH中，为了便于做信道估计，在子帧 结构的第4个及第11个符号处插入了解调参考信号(DMRS)o通过DMRS的插 入，可以简化LTE上行频域的信道估计的实现，这种基于DMRS的信道估计算法 可归类为非盲检测信道估计算法。
在LTE算法中，常用的有基于最小二乘准则(LS),最小均方误差准则(MMSE) 等。在本节中，首先将介绍目前常用的信道估计算法，如LS算法、基于MMSE 准则的信道估计算法。然后，本文将介绍一些常见的改进的信道估计算法，如基 于DFT变换域去噪的信道估计算法，简化的LMMSE算法。作为本章内容的重点, 将在本章节的最后介绍本文提出的改进的基于添加虚信道冲激响应(VCFR)的改 进算法。
3.1 LTE上行信道估计原理
在第二章中介绍了 LTE±行链路的导频设计，在LTE PUSCH信道中，每个 时隙都插入了解调参考信号(DMRS)o DMRS在导频SC-FDMA符号上是频域连 续的，利用DMRS可以较好的估计出该符号上全频域的信道频域冲激响应(CFR)o 但是，LTE上行信道中，并没有在所有SC-FDMA符号上都设置解调参考信号。 在得到-个子帧中两个SC-FDMA符号上的CFR后，需要通过插值的做法得到时 域其他12个符号上的CFR。
上行信道中由2个SC-FDMA符号上的CFR进行时域维度的插值得到其余12 个SC-FDMA符号上的CFR,往往需要通过插值算法来完成，常用的方法有拉格 郎日内插、基于低通滤波的内插算法以及基于DFT的内插算法。上行信道估计的 基本流程可以表示如下:
前一时隙
CFR -



图3-1 LTE上行信道估计基本流程
在做插值的算法当中，低通滤波内插和DFT插值都要求导频是等距，这两种 插值算法在LTE下行信道估计常常使用。但是对于上行链路，一个子载波对应的 CFR数据为2个点，做DFT插值及低通滤波内插并不合适，而拉格朗日内插更为 常用。拉格朗日又分为一阶线性内插、二阶抛物线内插以及Cubic插值(三阶插值) 〔2日。拉格朗日这三种插值算法的性能随着阶数增加而提高，但是以此对应的，其 算法复杂度也会增加。在本文中，算法研究场景为低速场景，信道的时变不明显， 因此，在做信道均衡操作时，使用当前时隙的CFR作为整个时隙6个SC-FDMA 符号均衡使用的信道估计值。本文研究重点为导频处信道估计算法，插值算法在 本文中不展开讨论。
3.2传统信道估计算法
3.2.1基于最小二乘(LS)准则的信道估计
LS即最小方差准则。对于上行接收侧信号，其时域可以表示为：
K(t) = S(t) + 〃(t)	(3-1)
若在时间(1, T)内得到N个离散的接收端信号点，其结果可表示为：
丫=国，匕,&叫(3-2)
那么，接收端信号第i点的值可以表示为：
匕=X* hr I	(3-3)
令％为接收端信号，X为发端数据，白为信道响应估计值，基于最小二乘准 则，将其估计的代价函数定义为：
J=(Y„-方 X)”・(Y,, - & X)	(3-4)
为获得最优的信道冲激响应估计值，对上式求H估计值偏导，有：
/	3 r a	a
—E-HX-W — HX) dH 8hL	」	(3-5)
=-2XH(Yp-XH)
由式3-5分析，要使得代价函数最小，信道冲激响应的估计值应满足：
17
刍 Yp Y + N X・H + N “ N
n = —=	=	= H
XX X	X
其中，H为真实的信道冲激响应，N为导频位置的噪声干扰。式3-6可见，LS 估计的结果仅依赖于接收端信号X以及发送端信号X。基于DMRS的信道估计， 可以通过配置获取本地ZC序列，因此要实现LS这种无需先验信息的信道估计算 法是非常容易的。
从式子(3-6)也可见，在高信噪比下，LS估计的结果近似于真实的信道估计响 应值。但是，LS估计的弊端也是显而易见的，LS估计的误差受信道噪声的影响非 常大。随着信噪比的下降，LS估计性能明显下降。
3.2.2基于最小均方误差(MMSE)准则的信道估计
由上一节分析可知，LS估计仅依赖于接收端信号以及发送端信号，然而，基 于MMSE准则的信道估计算法引入了信道信息,可以大大提升信道估计算法性能。 现对基于MMSE准则的信道估计进行推导。
令信道冲激响应估计值与真实的信道冲激响应误差为：
A	、
err = H-H	(3-7)
则估计的代价函数丿协/SE可定义为：
丿皿炫=旦|2〃『｝=矿	=	万一&) (h-存)	(3-8)
上式中，方为信道冲激响应估计值，反为信道冲激响应真实值。 对于方，有
H^wY	(3-9)
其中，V为接收端信号，w为K的系数矩阵。
将式3-9代入式3-8中，对式3-8进一步推导如下：
=e\h>h* -	-	(3-10)
欲获得代价函数Jawse的最小值，求其对w的偏导，可得:
令式3-11中偏导值结果为零，可得：
18

w* ={e[* •门
由此可知，式3-9中的w可由式3-12中v/求得



令Rhy=e[h»Yx],对=/[々*],结合式3-13,代入式3-9中，可得：
H ^wY^R^Ryy '^Y	(3-14)
考虑到接收端信号Y = X-H + N ,其中Rhy有：
Rhy = E[H.门=E^H\XH + N)*]
=e[h・H*・X* +H・N*\
=珥	(3-15)
Ryy = £[r«r*] = E[(XH + N)・(XH + N)*]
=E、X・H・H*・X* +X・H・N* + N・H*、X* +N・N*\	(3-16)
=X •初H・H*]・X*+/・/
式3-16中，H的自相关矩阵为Rhh =
由式3-14、式3-15、式3-16可得MMSE信道估计为：
Hmmsk = Rhh -X' <X.Rhh ・X* + a2.7)'-Y
=rhh {x-' ・(x.Rhh .X，+ 宀).(x*)t J' "T .y =电{最+4・(才*・巧丁・対.*
= R〃』Rg+b2・(x*・x)「T'&.、.
由上式3-17可见，MMSE估计相比LS估计可以抑制噪声的影响，同时还引 入了信道自相关矩阵Rhh,所以MMSE算法性能好于LS算法。但是MMSE算法 的计算量相比LS算法大大增加。计算量的增加来自于两方面，一是肉阳的计算， 二是矩阵求逆运算。&渊是信道冲激响应的自相关矩阵，单个自相关矩阵的运算量
19 随着占用子载波数增加而大幅增加，以子载波数为乃为例，计算量为n*n的复数 乘法。在信道变化快时，需要在每个子帧都去更新H的自相关矩阵，这样就无法 通过预先存储H自相关矩阵来降低预算复杂度。求相关矩阵的逆，运算量更是大 幅增加。
综合上述分析，基本的MMSE估计算法并不能直接运用于工程实践当中。为 了简化基于MMSE准则的信道估计算法复杂度，文献［10］提岀了基于奇异值分解 的信道估计算法。另外，在文献［11］中，提出了一种在中利用子矩阵块运算代 替大矩阵进行运算的低复杂度的LMMSE算法。
3.2.3基于DFT变换域去噪的信道估计算法
LS估计运算复杂度低，但是抗噪声干扰能力差，在低信噪比信道条件下性能 差。MMSE信道估计抗噪声能力强，可实现较低的均方误差（MSE）O但是MMSE 算法需要信道信息，实现复杂度过高，因而并不适合运用于工程实践。作为LS估 计与MMSE估计的折衷，多种基于DFT的信道估计算法被提出［5,6,9,10,16］。文献同 和文献［10］提出的DFT算法，主要是基于DFT变换，将频域信道冲激响应变换到 时域，通过在时域的去噪算法来实现信道估计算法的改进；文献［6］为了改进去噪 算法，引入了判决指导门限，通过判决指导门限来改善去噪效果；文献［16］的去噪 算法被广泛使用，该去噪算法统计时域信道冲击响应（CIR）径幅值，取出重要信 号径（MST）,去除其他径，以达到去除噪声及干扰的作用，但是该算法依然不能 解决由于信道信息能量在时域的拓展造成误去除有效信号径导致的性能下降的问 题。
频域	时域	频域


图3-2基于DFT变换域去噪算法处理框图【22】
在文献［22］中提出的算法是一种典型的基于DFT的信道估计算法。基于DFT
20
的信道估计算法利用了 OFDM系统中符号周期远大于信道冲激响应(CIR)持续时 间的特点，这样在CIR中，通过LS估计得到的CIR大部分能量集中于较少的几 径中，因而可以通过将CIR区域外的噪声去除的方式来改善信道估计性能。基于 DFT去噪的信道估计算法处理流程如图3-2所述。
该算法处理步骤如下：
1.IDFT变换，将CFR变换到时域，得到CIR。
2.判定有效CIR长度£,并将该长度外的点置零。
3.DFT变换，将去噪后的信道冲激响应变回频域，得到CFR。
基于DFT的信道估计算法最关键的是信道有效信号径延续长度L的选择。一 般CIR有效长度Z小于保护间隔CP,而且该值远小于子载波数N。但是Z的选择 不具备普遍适用性，Z会随着信道环境的变化而发生变化，在城市模型中，较糟糕 的城市模型中L的长度甚至会达到典型城市模型中长度的两倍【23］。如果Z的设置 小于CIR有效长度值，一些有效的信号径将被去除，这样反而会使得信道估计性 能下降。
传统的DFT算法通过去噪，可以获得一个比LS信道估计算法更低的均方误 差指标。为了改进传统的DFT去噪算法，避免CIR有效长度［选择带来的不确定 性。在文献［5］中，对传统的DFT算法进行了改进。该论文采用的处理框图如下：
频域	时域	频域
Channel
Estimation
WN-D

图3-3改进的基于DFT信道估计算法［'I
为了估计位置信道环境中的CIR,该改进算法相比原有基本的DFT信道估计 算法多了几个处理，如图3-3所述，首先添加了一个信号噪声估计器，通过统计时 域噪声区域的噪声功率平均值获得一个去噪门限值人。然后通过有效信号检测模块
21 来选取有用的信号径。
文献［5］中使用的门限值为：
a2
A = 2 , CTyvZ	（3-18）
其中噪声方差的计算公式如下：
M	319）
yv 气1 a X "=，a x
该改进算法相比传统基于DFT信道估计算法，主要优势有两点：
1.对多种信道条件的适应性更好，通过门限来确定噪声避免了由于Z选择不 当造成有效信号径误判为噪声而去除的情形。
2.选择门限来去噪，除了对噪声区域去噪之外，在信号区域一些噪声也可以 去除。
通过添加的这两步操作，改进的基于DFT的信道估计算法性能优于传统的算 法。
3.3基于LMMSE准则的简化算法
LMMSE算法用信道的自相关矩阵对LS信道估计输出进行调整，可以抑制噪 声的影响。式3-17中，信道的自相关矩阵Rhh有：
Rhh =	（3-20）
Rhh为信道冲激响应H的自相关矩阵，如果H点数为N, Rhh为一个N*N的 矩阵。为了减小运算复杂度，在式3-17中，（X*X）i可以用其期望E［（X*X）-'］来代 替，而O'?为噪声方差，式3-17通过简化，得到LMMSE的信道估计为：
hLMMSE = Rhh ｛沢冲 +	（3-21）
其中，8是一个常数，与调制方式有关（16QAM取17/9, QPSK取1）。SNR 为信噪比，满足SNR = E｛X（幻｝2 /覺o
为信道的自相关矩阵，其元素心,”由多径信道功率及时延决定，其表达式为：
/.-I	&
exp（-丿—〃））	（3-22）
/=o	N
贵,T,表示第Z径的功率及时延。
由式3-21分析LMMSE的信道估计运算量仍非常大，Rhh是N*N的矩阵，有 个矩阵的求逆，在最后和LS估计结果相乘时仍需N*N个复数乘法。在式3-21
22

基础上，有多种方法对LMMSE的信道估计进行简化。
为了便于后续分析，将式3-21表示为：
HLMMSE = Q*Hls	( 3-23 )
其中。为：



这样,LMMSE的估计可以归结为对LS估计输出的CFR,按Q矩阵进行滤波。
3.3.1	基于奇异值分解的LMMSE算法
基于SVD的LMMSE算法通过矩阵降秩的方法来降低运算量。通过SVD, Rhh 可以表示为：
rhh =UMJh	(3-25)
式3-25中,U为酉矩阵，,为一对角阵，是由R初的特征值组成。这样式3-24 可以表示为：
Qsm=U Ar° UH	(3-26)
s“D |_o 0
其中为对角阵，且有：
勾似+M-)， k = \,2,3---r	,	、
△,=< SNR	(3-27)
[o	k>r
这样釆用奇异值分解后，LMMSE的信道估计可以表示为：
A	A	AO A
HSVD-LMMSE = Qsn)-Hf S = U r UH ・HLS	(3-28)
0 0
这样原本LMMSE需要计算的矩阵维度由N*N降为*。同时还避免了矩阵求 逆过程。虽然避免了求逆运算和降低了矩阵维度，但是SVD分解本身需要很大的 运算量。一般的做法是将经过SVD分解后的结果预先存表。但是从实际运用系统 来考虑，信道条件是变化的，SVD预先存的表并不能完全匹配真实信道模型。这 一方面是会导致基于SVD奇异值分解LMMSE算法性能，另一方面也限制了其在
23
真实场景中的使用。
3.3.2 基于块分解LMMSE算法
R物中表征的是H之间的自相关特性，在该矩阵中，相关值大的元素表明了 这两个子载波处的H有强相关性。强相关的元素对滤波矩阵Q的贡献大，而相关 性弱的影响小。基于块分解的LMMSE简化算法利用了这一特性，将信道自相关 矩阵中弱相关的这些元素忽略，来达到降低计算复杂度的目的。
基于块分解的LMMSE算法将信道自相关矩阵分割为大小由相干带宽决定的 一系列子矩阵，即将一个大系统分割为多个独立子系统来做到计算量的简化。自 相关矩阵无叠加分解示意图如下：


图3-4信道自相关矩阵非叠加分块
图3-4中子块大小乙是由信道相关带宽决定。采用非叠加分块后，月伽可以表 示为：
Rhm	　　o …	0 一
Rhh =	0	　Rrm	0	(3-29)
0	　•	0

进行分块后，信道估计的结果就可以简化为：
Hlmmse = [///', H；, H；,	(3-30)
这样进行分解后，长度为0的信道估计CFR分割为M个长度为Z的CFR。 对其中R〃的计算仍按式3-21进行计算，但是求逆的复杂度已经由N*N维矩阵求 逆降低为L*L维矩阵求逆。
非叠加算法会丢失对角子阵上的部分重要信息，从而导致性能下降，使用子 块叠加的办法可以使丢失的信息减少，改善性能。但是与此对应，使用叠加算法 时运算复杂度有也会相应提升。
总体而言，使用基于块分解的LMMSE算法，通过信道自相关矩阵中多个子
24
块代替原本整个大块的做法，可以牺牲一部分性能而得到运算量的大幅降低。
3.3.3 快速的LMMSE算法
无论是基于SVD分解的LMMSE算法，还是基于块分解的LMMSE算法，都 需要先验的信道信息，例如SVD需要预先进行酉矩阵存储，而基于块分解的 LMMSE算法在计算反也时并不能实时获取各径时延幅值及均方时延拓展，因此这 种传统的LMMSE算法并不能很好的适配变化中的信道环境。在文献［14］中提出了 一种快速的LMMSE算法（后文简称F-LMMSE算法）。该算法使用Kumar快速算 法〔24］来计算LMMSE矩阵，并充分利用信道自相关矩阵特性来降低运算复杂度。 F-LMMSE最大的特点是无需先验的信道信息（频域为的自相关矩阵及SNR）,这 使得该算法相比原有传统的LMMSE算法，具有更好的工程实践性。本小节将重 点介绍该算法。
3.3.3.1F-LMMSE算法基本原理
在式3-22中介绍了信道自相关矩阵Rhh的元素［m,n］的计算公式，由该式可知 Rhh矩阵式一个循环矩阵，该矩阵第二行元素可以通过对第一行元素进行循环移位 获得，因此Rhh特征值可以通过FFT计算获得〔25】，表达式如下：
禺；I, ••• 4nt]=[FFTn(Rhh(0,0) Rg(0,1)	••顷*(00-1))] (3-31)
该算法首先通过将LS估计输出的CFR变换到时域釆用MST算法［⑹获得时域
CIR的重要径勒sr，同时计算得到其功率谱P.Msr，Pmst为1*N的向量。通过时域
LS估计得到CIR可计算得到SNR估计，如下：



该文中给出R*的计算公式为:
Thh=N.IFFT&Pmst1	（3-33）
通过推导，文章［14］给出式3-24中。矩阵的第一行元素。可由如下式子计算 得到：
Q =时打 IM）— 服⑴		 一
1 Pg （O） + （A / （N•蘇））鴉⑴ + （少 / （N•赢））■" P、.N -1） + （少 / （N•志））_
（3-34）
式3-34中p为与调制方式相关的常数，当采用16QAM调制时0=17/9,采用
QPSK调制时。=1。由于。矩阵是一个循环矩阵【⑷，在得到。值的第一行元素后, 可通过Q矩阵的第一行元素进行循环移位得到整个Q矩阵，再通过式3-23获得
25
F-LMMSE算法估计出的H。
F-LMMSE的处理过程可归结为如下几步：
1)获得基本的LS信道估计CFR,并变换到时域得到血s
2)使用MST算法得到时域主要径腿,并计算得到MST径功率以及LS估 计各点功率值。
3)用式3-32方式得到SNR估计值。
4)使用式3-34方式得到估计出的。矩阵第一行元素。，经过移位得到。矩 阵。
5)通过式3-23及Q矩阵获得最后F-LMMSE估计的输出值。
333.2 F-LMMSE算法的工程可行性分析
从工程实现的可行性分析，相比原有LMMSE算法，F-LMMSE算法不需要信 道信息，保证了该算法对不同信道环境的适应性。另外从运算量角度分析， F-LMMSE算法不需要直接获取7?柏，同时也无需计算求逆矩阵，而是利用时域的 信号功率有效径经过IFFT运算来获取滤波矩阵Q,可以大大降低运算复杂度。
从算法过程分析，影响F-LMMSE算法性能的主要因素应当是进行Q矩阵的 估计。在时域信号功率的MST径的选择会直接影响Q矩阵，这表明MST径的选 择直接决定了该算法中对肉///估计的准确性，同时SNR的估计也会对最后算法的 性能造成影响。
另外，还有两个因素是在实际系统中使用F-LMMSE算法必须考虑的问题， 现对这两问题描述如下：
1.子载波数N值较大时，。矩阵与Hu乘法会导致运算量增加
虽然F-LMMSE算法避免了矩阵求逆运算，大大降低了运算量。但是如公式 3-23所述，获得最后F-LMMSE的最后结果仍需要用滤波矩阵Q对LS估计结果进 行处理，这是一个N*N的矩阵与N*1矩阵的乘法问题。计算复杂度为N*N个复 '数乘法与N*(N-1)个复数加法。在大矩阵下，这种矩阵乘法运算复杂度仍很高。
2.高SNR环境下，F-LMMSE退化为类基于DFT去噪的估计算法
在高信噪比下，式3-34中的元素，例如第一个元素腸(0)/[腸(O)+(K/(MSNR))] 值约为1。对应的，其他判定为MST径位置上的值均为1,而非MST径位置上值 为0,这是一组0,1序列。这组0,1序列完成IFFT变换后得到0。。通过循环移位 获得。矩阵。。矩阵对Hls矩阵乘，可视为。与Hu两个频域向量的卷积。对应地, 在时域完成的运算是这组0,1序列和时域肌s的乘法。因此，在高SNR下,F-LMMSE 退化为近似于釆用MST去噪算法时基于DFT的信道估计算法，直接导致 F-LMMSE在高SNR下性能与基于DFT的估计算法相似。
通过上述分析，F-LMMSE在小RB低SNR环境中具有较好的运算价值。若 要运用于大RB情形，可釆用3.3.2节中块分解思想，对滤波矩阵Q进行小块划分,
26

以此来降低运算复杂度。而针对于高SNR下的性能退化问题，在实际工程实践中， 可釆用F-LMMSE+LS估计的方式来规避，即通过制定SNR门限来确定算法选择。 在SNR值高于此门限时釆用LS估计的结果，较低的SNR环境则采用F-LMMSE 算法。虽然F-LMMSE算法有这两点弊端，但是其在对信道环境的适应性方面仍 然优于基于SVD的LMMSE算法及基于块分解的LMMSE算法。
3.4基于虚信道冲激响应拓展的改进算法
3.4.1传统基于DFT估计算法的“CFR边缘效应”
基于DFT的信道估计作为LS估计与MMSE估计算法的折衷，凭借其较低的 运算复杂度和较优的性能在工程实践中被广泛使用。一般来说，无论是在梳状导 频还是块状导频中，基于DFT的信道估计算法只能使用本用户使用子载波处的导 频信号，而无法获取到虚子载波处的CFR信息。然而，为了便于滤波器的设计及 避免邻道干扰，在一般的OFDM系统中，都会插入一定量的虚子载波。所以在带 有虚子载波的OFDM系统中，使用基于DFT的信道估计算法时，由于这种CFR 信息的丢失，会导致估计出的CFR具有误差，特别是在边缘区域，误差明显变大, 这就是基于DFT信道估计算法中的常见的“CFR边缘效应” SI。



图3-5 DFT算法的边缘效应
图3-5给出了 DFT算法的“CFR边缘效应”。该仿真使用的基于DFT的信道 估计算法使用文献［5］中算法，使用信道模型为EPA5Hz, SNR为30dB,占用RB 数为50个RB。由图，在信道估计的两侧即图中矩形框框内区域（对应子载波位 置约为0〜20,580〜600区域），可以明显看到基于DFT信道估计算法得到的CFR相 比真实的CFR有明显误差。
27
众所周知，基于DFT的信道估计算法往往会遇到“MSE地板现象"SI。"MSE 地板现象”是和CFR “边缘效应”对应的现象，边缘处的CFR误差直接导致MSE 指标“地板”的出现mi。其成因可以从如下两个角度进行解释【28］：
1）	在OFDM系统中，即使不存在虚子载波，基于DFT的信道估计算法也会 遇到MSE地板效应。当且仅当时域CIR被截断时，这种MSE地板效应 会随着SNR的提高而出现。前文对基于DFT的信道估计算法进行了介绍， 该算法通过变换域对CIR进行门限过滤。这种在时域对CIR进行截断， 会使得相当一部分能量较低的信号径被丢弃。在信道条件比较差时，MSE 的性能还能随着SNR的增加而改善。但是在高SNR的信道环境中，噪声 对该信道估计算法的影响变成次要因素，这种由于丢失有用信号径造成的 信道估计算法性能不可避免的出现了。这种现象也说明，要获得一个更好 的基于DFT的信道估计算法，应当尽可能的把噪声排除在有效径外，并 且尽可能的保留有效信号径。
2）	若在OFDM系统中带有虚子载波，在虚子载波处的CFR信息会丢失，这 会导致在估计CFR时虚子载波边界区域的不连续。这种边界影响同样是 导致MSE地板效应的重要原因。在含有虚子载波的OFDM系统中，使用 基于DFT的信道估计算法得到的频域信道冲激响应值相当于将其对应的 不带有虚子载波时情形时的CFR乘上一个低通滤波器。以此对应，在时 域，观测到的CIR是实际的经过加噪后的多径信道冲激径卷积一个sine 函数。这不可避免地导致了时域多径信道信息的能量泄露，这类似于传统 频谱分析中的功率谱“拖尾，对于一个具有不连续点的时域信号，若将 其转换到频域，并将频谱上高频部分去除，这会导致该信号变回时域时在 不连续点附近的失真。以此类似，基于DFT算法中，去除时域中的一些 径，会导致变换回频域时，在频域不连续点的失真，这也是基于DFT的 信道估计算法“边缘效应”的重要原因。
3.4.2基于虚信道冲激响应拓展的改进信道估计算法
3.4.1节中对基于DFT的信道估计算法在高SNR场景中MSE地板效应成因进 行了解释。通过上节的分析，得出了如下可对基于DFT算法进行改进的几个方向：
1）	减少时域CIR信道有效信息径在时域的延拓，做到尽可能的保留有效信道 信息径。
2）	去除边缘效应影响。
在论文［28］中，提出了一种在虚子载波区域添加虚导频（VP）减少边缘效应 的影响。文献［29］提出了一种低复杂度的基于虚频域信道冲击响应（VCFR）拓展 的信道估计算法。通过拓展VCFR,可减少能量的泄露，使得时域信道冲击响应
28
(CIR)的有效径集中于较小区域，同时将“边缘效应”移到添加的虚子载波位置， 在后续处理中，将去除添加的虚信道冲激响应(VCFR),这就避免了 “边缘效应” 对有效CFR的影响。通过VCFR拓展，该算法在MSE及BLER性能上比传统 DFT算法更优。文献［7］中，讨论了一种在VCFR拓展基础上，并通过频域加窗处 理，通过IDFT换到时域后，对CIR采用MST去噪算法【1切去除噪声及干扰的新算 法。该文献中对比了各种频域加窗函数后的MSE指标，验证了加窗函数对进一步 使CIR集中的作用。但是，文献［7］提出的窗函数在VCFR与实际信道冲击响应边 缘不平滑会导致性能下降，另外文献［7］中采用的去噪算法，需要确定最大径数， 这使得该算法对多种信道的适用性变差。
本小节将介绍本文提出的一种改进的基于VCFR拓展的信道估计算法。该改 进的信道估计算法通过使用新的实数窗函数和新的适用于VCFR拓展信道估计算 法的去噪策略对原有算法进行改进。
3.4.2.1 VCFR信道估计算法系统模型
在LTE上行链路中，针对不同的应用场景，CP长度有常规CP及拓展CP 两种模式。CP长度的设置保证了在对应场景中，时域信道冲击响应CIR长度不超 过CP长度，以消除多径传播引起符号间干扰(ISI)o假设SC-FDMA符号添加的 CP长度为N財。LTE中有不同的带宽配置，20M时，每个SC-FDMA符号中子载 波数目为2048, 10MHz带宽时为1024o本文假设每个SC-FDMA符号使用的子载 波为Ne 则对于第，个SC-FDMA符号中时间连续信号可表示为：
幅=星3"时**5	<3-35)
其中，X,.,表示资源栅格(k,l)中的内容，V是子载波间隔，此处为15kHz, 六为UTE系统中的基本时间单元。
为了简化分析过程，发送端的离散型号可以表示为：
I (〃)=套 X"/平-阳2"网〃-g)	.
Xk ,为第I个SC-FDMA符号上的第4个子载波。
在接收端，接收到的第/个SC-FDMA符号上的第上个子载波可表示为：
Ykj=Hk/Xkjf	(3-37)
其中Hk ,为第I个符号上第k个子载波的频域信道冲击响应CFR, nk ,为高斯 白噪声。
29
假设多径信道径数为£,用弓表示第i径的时延，用4表示第i径的幅度响应 则时域的信道冲击响应CIR可表示为：
L-\
仰)=£妒地-弓)	(3-38)
/=0
其对应的频域信道冲击响应CFR表示为：
L-1	-/眼"
/=£%*厂厂=	(3-39)
/=0
3.4.2.2 VCFR信道估计算法的基本处理流程
基于VCFR拓展频域加窗的信道估计算法其处理流程框图如下：


图3-6 VCFR信道估计处理流程框图
现对改进的基于VCFR拓展的信道估计算法处理流程进行详细叙述：
a)使用本地导频信号获得LS信道估计，长度为N“.
VCFR信道估计算法的基础是LS估计。通过LS信道估计器可获得LS估计的 输出
Hls(k) = ^ = YkR； = Hl!+nk,k= 0,-}-Nac	(3-40)
b)在频域添加一定比例的虚子载波频域冲击响应
A
假设添加的VCFR长度为Ny由H«(k)的左右边界处的信道冲击响应值，产 生一个线性的虚频域信道冲击响应。并将虚频域信道冲击响应添加在认《)左右 A
两侧，得到拓展后的信道冲击响应Hcxp颂如(k),添加的虚频域信道冲击响应由下式 子给出，
牝颇(«) = Hlx 3加)+余(院(0)-念,(&.))/=0,1... Me T	<3-41)
30

其中Nac表示实际使用CFR长度，Nvc表75添加的虚子载波长度。
VCFR拓展过程可按如下图所示：



图3-7 VCFR拓展过程
经过VCFR拓展后的频域信道冲激响应可以表示为:
N
CO丄…零一1
NN N
左=竽号+1…号+ & + 1
N
k = &*N ,•* + N -1
2	4 ac	〒 VC 1
c）频域加窗处理
频域加窗处理有助于信道信息能量集中，同时对添加的虚子载波进行平滑滤 波。在文献［7］中讨论了多种窗函数，其最后采用的窗函数表示如下：

k-M — NgM 一 Nac +1, • •— 1
但是通过分析，发现这种窗函数在信道冲激响应边缘有个跳变，如下图3-8所 示，这不利于信道估计。
本文采用的是一种升余弦窗函数，其表示如下：
31

2〃« + 0.5一"“『；心)
N*c + N"



两种窗函数幅值响应图如下:



图3-8窗函数幅值响应对比图 经过频域加窗平滑之后的，其结果可以表示如下：
HWin (左)=H expand (左)=	— l	( 3-45 )
d)对加窗后的做M点IDFT,获得时域信道冲击响应CIR
经过VCFR拓展之后，CFR的点数由Ng变为M, M为N”与添加的虚信道 冲激响应Me的和。加窗处理之后需要通过一个离散傅里叶反变换将频域信道冲激 响应编程时域的信道冲激响应，其表达式如下：
A	A
hwin (k) = IDFT	《=0,1 …Nac + Nvc — 1	(3-46 )
e)时域去噪处理
采用差异化去噪策略完成去噪步骤之后，CFR用加次表示，去噪过程数学表
达式如下：
32
力=0,1 …Lequcp_ex _ L and h win	> Threshold 1
k = (Nac + Nvc) -Lequcp_ex,…(Ng + Nvc) -1
A / \2
and hwin\k\ >Threshold!
others
差异化去噪过程将在下一小节3.4.23中进行详细说明。
f)去噪后的CIR做DFT转换，在频域去除窗，去除添加的VCFR
去噪处理后，需要将CIR变回频域，并去除之前加窗函数影响，完成DFT转 换，并去除窗后，可表示为：
Hdewin(k) = DFT^hdeno(^)^-］, k = 0,1-■■ Nac + Nvc-I (3—48)
完成去窗操作后，去除两侧添加的VCFR,即得到最后的频域信道冲激响应估 计值。
3.4.23差异化门限去噪策略
时域去噪是所有类DFT信道估计算法中必不可少的过程，在文献［7］中VCFR 算法釆用的去噪算法为MST算法，该算法最早由H.Minn等人在文献［16］提出。 MST算法需要设定认为有效径与多径的比例丿值，然后统计CIR中幅值最大的丿 个径，其余认为是噪声去除。这其中，不难发现J值的设置对于去噪性能影响非常 大。在变化的信道条件下，很难去设定一个具有普遍适用性的J值。在文献［16］ 中，其将丿值设置为多径数目的2倍或者更多倍。在本小节，将介绍一种适合基 于VCFR拓展的信道估计算法的差异化去噪策略。
该去噪算法可以大致分为两步骤：
1.判定噪声区域并去除噪声径
2.对信号区域的差异化门限策略去噪
在OFDM系统中，可认为信道冲击响应(CIR)的长度小于循环前缀的长度， 因此在传统的基于DFT去噪的信道估计算法中都把CIR中位置大于等效 CP长度£劉,宀 的信道估计值置0来完成去噪。如下图所示，中间区域为噪声区域， 两侧有有效的CIR径区域。
A
nirindouwd (K )
Front Valid area	Noise area	Rear Valid area
— —
«L	”
e<///_cp_expand	33	丄约〃 _cp_expand


图3-9 CIR有效信道冲击响应
VCFR算法中，CIR有效径相比不进行VCFR拓展情形会有一个明显的延拓, 如下图所示
800
图3-10在EVA5Hz信道下理想CIR与VCFR算法估出CIR对比
在上图3-10中红色虚线代码理想信道估计的CIR幅值响应，蓝色虚线为VCFR 处理后时域CIR幅值响应。很明显可以看到，在基于VCFR拓展的信道估计算法 中，之前处理时添加的虚信道冲击响应导致CIR在时域的延展。为保证所有信号 有效径都在等效CP长度内，需要采用一个拓展的等效CP长度，本文去噪时采用 了一个拓展的等效CP长度，其表示如下：
1	_( n m \	1 °。
^equ _cp_ exp and 一	vc / 2048
如上式所示，计算等效CP时使用了进行VCFR拓展后的信道冲击响应长度为 M + g）。
在完成CIR有效区域划分之后，对噪声段（如图3-9所示Noise area区域）统 计噪声平均功率b：,并得到该区域噪声功率最大值Maxpowermjise
(3-51)
式3-51中k值对应区域为噪声区域，即k的取值范围应该满足闭区间
[Legu_cp_ expand， ^ac+Nvc^Lequ cpjexpandl
34
同时，在认定为有效CIR区域统计CIR最大值
Maxpowervalidc.lK =	(3-52)
式3-52中的k值对应区域为有效CIR区域，即k的取值范围应满足闭区间［0, Lequ_cp_expand］及［Nac+Nvc-Lequ_cp_expand，Nac+Nvc-1］。
去噪处理的第一步就是要将认定为噪声区域的噪声去除。
去噪处理的第二步是完成对图3-9中的“Front Valid Area”及“Rear Valid Area” 的去噪处理。传统的去噪算法是使用同一门限对这两区域进行去噪。但是，如图 3-9所示，在Front区域，有效信号径数明显会大于Rear区域，而且，一些能量较 小的信号径也主要集中于Front区域。因此，为了达到一个更好的去噪效果，本文 采用了一个差异化的去噪门限，分别对前后两个有效信号区域进行去噪。
对于Front区域，为了尽可能的保留有效信号径，采用了噪声功率平均值作为 门限。但是，噪声功率平均值作为门限，在高SNR中，去噪效果不理想。为此， 针对Front区域，在高低信噪比不同的环境中，使用不同的门限值，本文釆用针对 Front区域的去噪门限表示如下：
ThresholdA'gaxpowfdaR / Maxpoweg <5°	(3_53)
Maxpowernojse, others
对于Rear区域，门限设定如下：
Threshold^ = 2 勇	(3-54 )
3.5仿真和分析
3.5.1	仿真模型
为了全方位的评估基于VCFR拓展的信道估计算法性能，本文从多个信道条 件，多种调制方式，多种指标对VCFR性能进行评估。
釆用的信道模型为ETU、EPA、EVA模型。拓展的行人模型(EPA),拓展的典 型城市模型(ETU),拓展的车辆模型(EVA)等信道模型参照协议TS36.104"〕中规定 其信道信息如下几个表描述。
ETU信道模型为：
表3-1 ETU信道模型
35

衰落
(dB)	-1	-1	-1	0	0	0	-3	-5	-7
时延
(ns)	0	50	120	200	230	500	1600	2300	5000

其中EVA信道模型为:
表3-2 EVA信道模型
衰落
(dB)	0	-1.5	-1.4	-3.6	-0.6	-9.1	-7.0	-12	-16.0
时延
(ns)	0	30	150	310	370	710	1090	1730	2510

EPA信道模型:
表3-3 EPA信道模型
各径衰
落(dB)	0	-1	-2	-3	-8	-17.2	-20.8
各径时
延(ns)	0	30	70	90	110	190	410

仿真采用的参数如下所述:
表3-4仿真参数表
仿真参数	仿真值
-H4-成 帀菟	20MHz
天线配置	ITx, 2Rx
CP长度	Normal CP
调制方式	QPSK, 16QAM, 64QAM
每个时隙导频符号	1
每子帧符号数	14
码率	1 /3, 3/4, 5/6
编码方式	1/3 Turbo
信道条件	EPA.EVA,ETU
虚子载波添加比例	100%
仿真子帧数	10000

36
3.5.2 信道估计算法仿真分析
3.5.2.1信道估计算法的MSE指标
为了评估各个信道估计算法的性能，使用均方误差（MSE）作为参考指标，MSE 指标的定义如下：

1.改进VCFR算法与原有VCFR算法对比分析
为了评估本文提出的VCFR改进算法，使用文献［7］中提出的算法（后文简称
Hao算法）以及文献［5］中的改进基于DFT的信道估计算法作为对比。在ETU5Hz 信道条件下，仿真结果如下：



图3-11 ETU 5Hz下MSE指标对比
上图釆用Hao算法时，该算法采用了 MST去噪算法，该去噪算法对MST径 数选择非常敏感。在ETU信道中，多径时延大，在低信噪比（-5dB〜5dB）当MST 目标径数设置为多径径数2倍时，其性能明显比4倍及6倍多径径数均更优。但 是随着信噪比提高，丿 =2时MSE性能提升不明显。而=6时，MSE性能好。这说 明了 MST算法对不同信噪比条件的适应性差。造成这种性能差异的原因是在低信 噪比下，噪声对信道估计误差影响大，丿=6的MST算法中引入了过多噪声，但是 随着SNR提高，J=2时损失有效信号能量对信道估计误差的影响就会明显表现出 来，而J=6几乎包含了所有主要的信号径，故在高SNR下J=6的性能最好，丿 =4 其次，尤2最差。而采用文献［7］中的窗函数（下文简称Hao窗），以及本文提出的 差异化去噪策略时（下文简称差异去噪），如上图绿色菱形线描述，在大部分情形 下，Hao窗+差异去噪这一组合，性能好于Hao窗+MST去噪。
再比较选择窗函数对信道估计性能的影响。在仿真中，采用Hao窗+差异去噪
37 算法的性能曲线为绿色菱形虚线，而本文采用算法(升余弦窗+差异去噪)为黑色 星形实线。对比两方法性能，明显看到升余弦窗+差异去噪组合性能好于Hao窗+ 差异去噪。这反应了本文采用的新的升余弦窗对基于VCFR拓展信道估计算法性 能有提升明显的效果。
最后，对比传统的基于DFT去噪的信道估计算法和本文提出的算法。如上图 蓝色方形实线与黑色星形实线所述，随着信噪比提高，本文提出算法性能优势明 显，而且基本的DFT去噪算法在SNR高于20dB时，随着性噪比提高，性能并没 有多大改善，而本文提出的算法并不存在这样的在高信噪比下的“地板现象气
2.改进的VCFR算法与LS算法，LMMSE算法，DFT算法对比分析
为了全面比较本文提出的改进VCFR算法与其他算法的性能，现将其与 F-LMMSE算法、基于DFT算法及LS算法进行对比oF-LMMSE算法如前文3.3.3.1 节所述，而基于DFT算法采用的去噪策略为保留等效CP内径，去除其他所有径。 仿真在EVA5HZ的信道条件下进行，采用的RB数为25个RB。得到MSE指标图 如下图3-12所示。

SIIRidB)

图3-12 EVA 5Hz下MSE指标对比
在图3-12中，黑色星形标注曲线为本文提出的改进VCFR算法，该算法的 MSE指标明显优于LS估计，在低SNR条件下(-5dB〜15dB),本文提出的改进 VCFR算法性能好于LS估计约10dBo另外，和F-LMMSE以及基于DFT去噪的 估计算法相比，本文提出的改进算法也有很大性能优势，特别是在高SNR环境中。
另外，图3-12中倒三角形标注实线为F-LMMSE算法。该算法在低SNR下 (-5〜OdB)性能略优于改进VCFR算法。F-LMMSE算法与圆形标注虚线代表的基
38 于DFT算法相比，仍有性能优势。但是，在高SNR下（＞25dB）, F-LMMSE的性 能提高不理想，出现近似于基于DFT算法类似的“地板现象”。从结果来看， F-LMMSE的MSE指标和前文3.3.3.2小节中对该算法高SNR下弊端的分析是一 致的。
综合上述分析，本文提出的基于VCFR拓展的信道估计算法，通过采用新的 频域窗函数及新的差异化去噪策略，使性能相比原有算法有较大提升，也明显优 于LS算法、传统基于DFT的信道估计算法以及F-LMMSE算法。
3.5.2.2改进的基于VCFR拓展信道估计算法对不同信道适应性
为了评估本文提出算法对不同信道的适应性，在EPA, ETU, EVA三种不同 的信道条件下，对LS算法，基于DFT算法，F-LMMSE算法、本文提出改进VCFR 算法以及理想信道冲激响应下的Raw-BER指标进行对比。
Raw-BER指标取自解调输出比特，这样可以排除Turbo译码器对性能评估的 影响。经过仿真，得到Raw-BER指标如图3-15〜3-15。
图3-13〜15表明，本文提出的算法，在SNR为2-26dB的区间，其性能明显好 于LS估计算法，F-LMMSE算法以及及传统的基于DFT去噪的信道估计算法。对 比传统的DFT算法和本文提出的改进VCFR算法，可见，本算法在高信噪比下不 会出现RAW-BER的“地板现象”。
图3-13表明在EPA5HZ的信道条件，本文提出的算法性能相当逼近于理想信 道估计的RAW-BER性能。图3-14表明即使在70Hz的多普勒频移信道条件下， 本文提出的算法性能只是略微差于理想信道估计的性能。

图3-13 EPA5Hz下RAW-BER性能对比

39


图3-15 ETU5HZ下RAW-BER性能对比
通过不同信道条件下的仿真，充分证明本论文提出的改进VCFR算法的优越 性能，且该算法在不同的信道条件下性能表现稳定。
3.5.2.3改进的基于VCFR拓展信道估计算法的吞吐量指标
为了更好的评估本文提出算法的性能指标，引入协议TS36.104D2］中表 8.2.1.1_6对ITx, 2Rx天线配置下PUSCH接收性能要求。该协议中引入了吞吐量 Throughput指标。Throughput指标是在加入HARQ重传下，进行评估的指标，其 计算公式为：
throughput = [1-BLER(4)} / [1 + BLERQ)+BLER ⑵ + BZ£7?(3)]	(3-56)
其中，BLER(z)表示第，次重传时的误块率，i为1,2,3,4。 通过仿真，得到结果如下：
表3-5吞吐量指标
收发天
线配置	仿真条件	　　配置
表	　SNR
[dB]	　吞吐量
要求	　IdealH
吞吐量	　VCFR
吞吐量	LS算法
吞吐量
1TX
2RX	EPA 5Hz
Low	A3-7	■4.2	30%	79.29%	73.46%	7.68%
-0.4	70%	98.30%	9732%	63.9%
A4-8	11.5	70%	97.08%	96.46%	82.1%
A5-7	19.7	70%	95.35%	93.28%	80.8%
EVA 5Hz
Low	A3-I	-2.7	30%	83.23%	61.43%	25.2%
1.8	70%	97.69%	92.73%	81%
A4-1	11.5	70%	98.13%	97.01%	81.5%
A5-1	18.7	70%	97%	88%	89%
EVA 70Hz	A3-7	-4.1	30%	60%	53.46%	1.5%
0.2	70%	98.8%	97.6%	52.8%
ETU 70Hz	A3-1	-2.4	30%	71.25%	48.4%	20.65%
2.9	70%	94.03%	85.4%	75.9%

上图中配置表A3-X均采用QPSK调制，A4-X釆用16QAM调制，A5-X釆用 64QAM调制方式。通过对比LS算法与VCFR算法吞吐量指标，VCFR在低SNR 下相比LS优势十分明显，即使在高信噪比下，VCFR算法也好于LS算法。对比 采用理想信道冲激响应值时吞吐量与本文采用算法是吞吐量指标，可以看到在很 多情形下，本文算法性能接近于理想信道估计。参考协议对吞吐量的最低要求， 可见本文提出的基于VCFR拓展的改进信道估计算法完全能达到协议要求的性能 指标，而且在很多场景中，本算法性能远好于协议要求。
3.6本章小结
在本章中，从LTE上行基于导频的信道估计出发，讨论了多种信道估计算法。 LS算法实现简单但是在低信噪比条件下性能差。基于MMSE准则的信道估计算法 利用了信道自相关特性对LS估计输出进行滤波，可以获得较好的性能，但是算法 实现复杂度太高，不具备工程实践意义。作为LS与MMSE算法的折衷，基于DFT 变换域去噪的算法被提出来，但是由于DFT去噪本身的缺陷，在信道估计边缘性 能下降明显。而作为MMSE简化算法的基于SVD分解的LMMSE算法，以及基
41 于块分解的LMMSE算法虽然在实现复杂度上大大减低，但是其工程实现时均要 预先建模，存储信道信息，这限制了其对不同信道条件的适用性，影响其工程实 现。
在本章的后半部分，介绍了一种快速的LMMSE算法，该算法用FFT变换代 替了传统LMMSE算法的求逆过程，该算法一方面简化了运算复杂度，另一方面， 由于可以实时获得信道自相关特性矩阵，该算法能适应不同的信道条件，因而具 有很高的工程实现可能性。但是，该算法仍需解决大矩阵下乘法复杂度高的问题 以及高SNR场景中性能提升不明显的问题。
基于VCFR拓展的信道估计算法是本文的重点，本文通过使用一种新的升余 弦窗进行频域平滑，同时提岀了一种新的差异化去噪策略。通过仿真分析，改进 的VCFR算法在性能上远好于LS算法、基于DFT去噪算法以及F-LMMSE算法。 从吞吐量指标来看，本文该算法也远好于协议要求。因此，本文提出的改进VCFR 算法，无论是从算法实现角度，还是从算法性能本身来看，都非常具有工程实用 价值。
42
第四章信道估计算法的多核DSP实现
数字信号处理器（DSP）,是一种具有高实时性数字信号处理能力的微处理器。 DSP 一般采用哈佛架构，数据总线和地址总线的分离有助于取指和取数据分开执 行，提高处理器处理吞吐能力。在LTE中，由于基带处理运算高度密集，高性能 的DSP芯片在这些基站侧设备得到广泛使用。现在常用的DSP芯片有飞思卡尔公 司的DSP平台，及TI公司的DSP平台。
LTE上行接收处理，包括解资源映射，信道估计，信道均衡，比特级模块处 理等流程，其要求在较短时间（模块耗时us计）完成高密度的运算。LTE的上行 信道估计是上行接收的关键环节，上行信道估计能否高效执行，对后续模块工作 影响甚大。飞思卡尔公司的MSC8157平台是一款高性能的多核DSP平台，该平 台能适应无线通信领域对功率、性能、成本等方面高要求。另外，MSC8157平台 还加入的协处理器MAPLE-B2,该协处理器集成了 CRC校验、FFT运算、Turbo 编译码以及速率匹配（RM）等多项功能，这些硬件加速器的使用，可以进一步释 放DSP核的运算能力。在本节中，将详细介绍信道估计在该平台的设计与实现。
4.1飞思卡尔MSC8157平負介绍
DSP芯片，也称数字信号处理器，主要运用于快速实现各种数字信号处理算 法。DSP芯片一般具有如下主要特点【331：
（1）	具有多个乘法器，可以在一个时钟周期内完成多个乘法或加法操作
（2）	通过独立的两条总线分别访问指令和数据
（3）	支持快速的中断处理和硬件I/O
（4）	具有多个硬件地址产生器，在一个时钟周期内可以完成多次地址操作
（5）	支持并行执行多个操作
（6）	支持指令流水线操作
MSC8157是飞思卡尔公司第四代高性能多核DSP平台，该平台推出，主要针 对无线通信市场，能够满足通信产业界对平台性能和系统集成的高要求。该芯片 能很好地支持 3G-LTE（FDD 和 TDD）, HSPA+, LTE-Advanced 和 WiMAX 的信号 处理。MSC8157整合了可编程的DSP内核与强大的硬件加速器，相比同类产品， 具有更好的性能、功率效率和性价比。
4.1.1	MSC8157 平台
MSC8157的结构如下图4-1所述：
43

MSC8157 and MSC8157E BlacK Diagram




图4-1 MSC8157架构图Bl
现从内核、存储、DMA以及MAPLE四个方面来详细介绍飞思卡尔MSC8157 平台。
1)MSC8157 内核
如上图4-1所示，MSC8157具有6个SC3850 DSP子系统，每个子系统中有 一个 SC3850 芯片、32kB 的指令 cache(LHcache). 32kB 的数据 cache(LlDcache)、 512KB L2 cache,其中L2可灵活配置为共享内存M2； Core工作主频1GHz；数据 运算和逻辑单元(DALU)包括4个运算逻辑单元ALU(Arithmetic and Logic Unit), 每个ALU包括2个16X16乘法器，同时还有2个地址产生单元(AGU),每个AGU 中包含两个地址运算单元(AAU)；每个时钟周期能做多处理6条指令：4 ALU+2AGU；具有丰富的16位宽指令集。
2)存储
除了每个core里的LI, L2缓存，MSC8157还有3MB、128bit位宽的M3内 存。512M DDR3, DDR控制器时钟主频667MHz(数据速率1333MHz), 32bit数据 总线。
3)DMA
16个双向通道的DMA控制器。每个控制器含有1024个BD(Buffer Descriptor), 总内存32KbyteSo其中buffer descriptor既可以布置在M2中，也可以布置在DDR 内存中。DMA通道间采用基于优先级的时分复用，在同等优先级组中，采用循环 仲裁来提供4个优先级选择。
4)MAPLE
MAPLE-B2是第二代硬件加速引擎，该加速器引擎针对无线通信需求，提供
44
多门类，高性能加速器。可选择3G模式(支持3GLTE和UMTS标准)和WiMAX 模式(IEEE 802.16e和802.16m标准)，其主要功能模块如下：
eTVPE： Turbo译码器，支持WiMAX, UMTS和3GLTE系统的Turbo译码； 集成Turbo译码，解速率匹配和HARQ合并功能；支持二进制和双二进制编码方 式的译码；对于码率为1/3的编码方式，提供多样的解速率匹配函数；译码准则为 Max Log Map或Linear Log Map；提供多种译码终止触发条件，如CRC检测、输 出硬比特校验以及配置的指示。
DEPE： Turbo 编码器，支持 WiMAX OFDMA、3G ETE DL/UL-SCH 和 UMTS 系统；3GLTE及WiMAX应用场景中，信息比特编码和速率匹配处理速率高达 1.8Gbps；支持3GLTE制式中码快CRC和比特填充；支持3GLTE标准中的单码块 的传输块CRC功能；针对FDD-LTE,支持可选的传输块比特扰码功能。
eFTPE：支持DFT/IDFT和FFT/IFFT处理；FFT/IFFT运算支持多种长度，如 128、256、512、1024、1535 和 2048； DFT/IDFT 能支持 3G LTE 中的所有 RB 可 能配置下的子载波数；提供多种不同的输入数据大小支持，如16bit (81, 8Q)或 者32bit (161, 16Q)；在FFT/IFFT运算时可配置是否进行保护边带的插入或去除， 循环前缀的插入或删除也可配置；支持对输入复数的相位进行旋转。
除了这三个常用的模块之外，MAPLE-B2还有完成CRC校验的CRCPE,还 能支持MMSE/ZF/IRC准则的信道均衡等操作。
4.1.2MSC8157 eFTPE 简介
MSC8157中MAPLE-B2提供的eFTPE提供强大的DFT/IDFT运算能力，为基 于VCFR拓展信道估计算法的高效实现提供了可能。在LTE信道估计算法实现中， 需要使用该协处理器的eFTPE,在本小节中将对eFTPE进行详细介绍目习。
eFTPE的FFT/IFFT/DFT/IDFT运算与具体协议无关，不受MAPLE-B2的操作 模式影响。在基于VCFR拓展的信道估计中，eFTPE主要运用于变换域去噪操作 时完成频域到时域的转换，以及去噪完成后完成由时域到频域的转换。MAPLE-B2 中的eFTPE为了适应LTE中的应用，其功能不单是完成快速傅里叶变换或离散傅 里叶变换，除了这些变换之外，eFTPE还有去频偏、Guard Band插入、循环前缀 去除等功能。本文中，考虑到对eFTPE的使用主要为DFT变换及DFT反变换， 对eFTPE其他在本文中不使用的功能将不做介绍。
1) eFTPE的数据结构
输出到eFTPE中的数据是由MAPLE-B2中的DMA自动获取的。输入数据在 系统中的存储位置可以再eFTPE BD中的控制比特进行配置。一旦工作完成， MAPLE-B2会通过内部的DMA将结果送到指定的存储区域，输出的存储位置也 是有BD中的控制比特进行配置。
45
•输入的数据结构
eFTPE的控制信息都是通过BD来传入的。eFTPE根据输入处理数据的格式 可分为两类：模式一支持输入数据为一个复数32bits,其中16个bit为实部，另 16个bit为虚部；模式二支持的输入数据为-•个复数16bits。由于本文中设计得数 据符号模式一，现介绍模式一下数据的输入结构。模式一时，要求每个复数点为 32bits,并且数据起始位是128bit对其。具体数据排列见下图：

图4-2 eFTPE数据排列结构㈣
在eFTPE 一个BD配置多个job时，每个job在内存中依次排列，但是每个job 中数据的起始位仍应满足128bit对齐的要求。
•输出的数据结构
一旦eFTPE完成了其处理，MAPLE-B2会将数据放回到系统内存中，输出数 据的存储位置有BD配置中的OBA字段进行配置。其输出结果的格式以输入数据 格式一致，如上图4-2所示。
2） eFTPE的内部幅值缩放调整
为了尽量避免对溢出进行饱和处理，eFTPE提供了两种幅值缩放模式。缩放 模式分别为：用户缩放和自适应缩放。除了这两种缩放方式之外，还有其他方式 可以控制eFTPE整体的幅值计算。
/总缩放量配置。该配置允许在自适应缩放模式时对最终结果进行调整来满 足对输出结果幅值的要求。
/输入调整系数。该模式会在输入eFTPE时配置调整系数，该调整指数会用 于计算总的缩放值，对数据进行调整。
/额外的缩放。该功能可以在自适应模式时根据输出值具体情况，来决定最 终的缩放结果。
由于用户缩放模式和自适应模式是常用的eFTPE系数调整模式，下面将重点 介绍着两种模式。
•用户自定义缩放模式
为了避免对溢出的DFT点进行饱和处理，用户自定定义模式根据用户的设计, 在每个DFT运算阶段结束后执行向下缩放来调整运算结果。使用该模式，需要将 BD中的SCLTYPE指示位进行置位操作。eFTPE可通过设置eFTPE BD中的 USR_SCLx（x=O,l,……4）, PM SCL以及POJCL来完成每个阶段运算结束后幅值
46
的缩放。
USRJCLx（x=Q,\,……4）域的配置可以决定在哪个阶段结束后进行调整。例如， 对USR_SCLO进行置位之后，会在蝶形运算的第一个阶段结束后根据缩放因子对 该阶段输出结果进行调整；
PACSCZ域可配置为。或1作为潜在的向下调整系数，当釆用前乘处理时，该 域置为1。
PO_SCL域可配置为0-2,作为潜在的向下调整系数，当使用后乘处理时，该域 应置为2»
•自适应模式
采用自适应模式时，如有必要，eFTPE会自动在每个处理阶段结束后执行幅 值的缩小操作。每个阶段结束后缩小的倍数会基于下一阶段运算不溢出这一前提 进行最小范围的调整。
为了激活自适应模式，需要对eFTPE BD中的SCLJTYPE域设置为1。
使用自适应模式时，各阶段的调整倍数会进行累积，并把最后输出时整体调 整倍数写入eFTPE BD中的ADP_OVA_SCL_ST域。使用者可以根据该域的值掌握 自适应模式的调整倍数。
当BD项PT被置位时,意味着在每个BD中有多个任务需要进行运算。这时， 自适应模式输出的调整倍数反馈会有多条，这些反馈回的值将不再在 ADP_OVA_SCL_ST域输出，而是根据eFTPE BD中BDJTAT_PTR中设置的内存 地址，写入指定地址中。
4.2LTE上行接收处理流程多核设计及PUSCH处理链路框架
4.2.1上行接收处理多核设计
在本文中，使用2块MSC8157芯片用作LTE物理层设计，上下行链路各使用 一片DSP芯片。本文中，TD-LTE上行接收链路天线配置为“1发2收”。一片 MSC8157具有6个内核，为了最优化处理效率，并保证多核负载均衡，对上行DSP 片上任务划分如下：
■3个内核用于共享信道PUSCH, Sounding处理
■1个内核用PRACH处理
■1个内核用于PUCCH处理
■1个内核作为上行处理的主控核，负责整个上行接收处理的调度
4.2.2PUSCH接收处理链路框架
由于本文工作主要集中于PUSCH链路，故对其余信道的设计不做介绍。在内
47 核使用分配时，与PUSCH相关的的主要为Corel, core2, core3。基于负载均衡原 则，corel, core2作为一对设备处理对等的工作，主要是完成符号级的处理，core3 则完成比特级处理。在下图4-3中将列出PUSCH信道的主要功能模块构成，以及 各个模块在这三个内核和Maple-B2上任务划分的设计。


图4-3 PUSCH多核任务划分
考虑到本文中PUSCH接收设计多用户情形，将链路设计分为两部分，一是符 号级设计，二是链路级设计。符号级设计主要设计信道估计及信道均衡模块，考 虑到双天线场景中各天线运算量对等，将在corel布置天线1的信道估计，core2 布置天线2的信道估计。而信道均衡，需要在最后一个符号到达时进行，一共需 要完成12个SC-FDMA符号（DMRS所在符号不处理）的天线合并，这时任务划 分采用corel处理前6个符号的信道均衡，core2处理后6个符号的信道均衡。在 一个用户的数据完成信道均衡及解传输预编码后，启动core3完成该用户后续所有 操作。
PUSCH链路的处理时由3个内核以及MAPLE-B2协处理器共同完成的。 PUSCH的链路具体设计如下图4-4所示，该图表示在两接收天线、多用户下PUSCH 的处理框图。图中深色框部分表示的是由MAPLE完成的工作，这些工作包括去 CP、去频偏、解传输预编码、解速率匹配、Turbo译码、Viterbi译码以及码块解 CRC等工作。而图中浅色框表示的功能模块则是由DSP内核完成，包括信道估计、 信道均衡、解调解扰码、CQI\RI\ACK译码等。
48


4.3改进的VCFR信道估计算法的DSP实现与优化
4.3.1 VCFR信道估计整体设计
VCFR信道估计算法的基本流程产生本地解调参考型号，完成LS信道估计, 然后由LS信道估计结果来进行VCFR信道估计。
根据协议要求，PUSCH的本地解调参考信号产生过程如下：
1）	由输入参数 Group-hopping-enabled ,小区 ID , N^SCH ,
Sequence-hopping-enabled, 得至U u 和 v
2）	由u, v得到基序列
3）	由输入参数或以，或払和"g 得到时隙内的循环移位a
4）	对基序列进行循环移位，得到PUSCH的参考序列XJs） LS估计是由本地解调参考序列和输入信号进行复数乘。
VCFR算法的实现分为如下几个步骤：
49

1）	获取添加的虚信道冲激响应	•
2）	分块完成频域窗函数平滑
3）	调用eFTPE完成IDFT变换
4）	获取噪声去噪门限，完成时域去噪操作
5）	调用eFTPE完成DFT变换
6）	完成频域去窗操作及去VCFR操作
结合上述分析，在设计VCFR信道估计算法整体框架时，由于LS估计在获取 到本地解调参考信号之后，再乘以输入数据即可完成LS估计。按照功能进行划分, 信道估计算法将分割为LS信道估计模块和VCFR处理模块。LS估计模块完成基 本ZC序列产生，以及本地DMRS数据与接收端RS数据的复数乘。VCFR处理模 块主要完成VCFR算法各个步骤。
VCFR信道估计实现的整体框图设计如下：

4.3.2 VCFR信道估计子模块详细设计
根据4.3.1节对VCFR信道估计的整体设计，将VCFR信道估计算法规划为两 个子模块，分别为LS估计以及VCFR信道估计。从代码可移植性角度考虑，VCFR
50
算法实现函数设计为针对单用户的处理，即每次调用VCFR模块可完成上行接收 处理时单个用户的信道估计。而多用户的处理，在该模块高一级建立调度函数完 成多用户处理即可。下面根据模块的功能划分将详细介绍各个子模块的接口设计， 处理流程图等。
4.3.2.1 LS估计子模块设计
LS估计子模块主要负责基本ZC序列产生，及时隙m内循环移位以如产生， 输入数据与本地ZC序列复数乘法等工作，根据这三个主要功能，可将LS估计子 模块分为3个子函数。
1.基本ZC序列产生函数
•函数概述
表4-1基本ZC序列产生函数概述
函数原型	void PuschChanEstZcGen (pPuschCelllnfo, pInput Ncs, pOutput dmrs)
功能描述	本函数根据输入控制信息得到本时隙的本地解调参考信号ZC序列
输入参数	pPuschCelHnfo：指向信道估计用到的CELL相关信息控制结构体的指针， 类型为 STRU_Pusch_CellInfo；
p!nput Ncs：指向Ncs数组的指针
输出参数	pOutput dmrs：指向生成的本地探测参考序列数组的指针
返回值	无

•该模块处理流程图
开始
No
V
査表
Msc_24table


循环移位
图4-6基本ZC序列产生处理流程图
2.Ncs计算函数
51

•函数概述
表4-2 Ncs计算函数概述
函数原型	void PuschChanEstNcsCal ( pPuschCelllnfo, pNcs out)
功能描述	本函数根据输入的控制信息，调用gold码序列产生函数生成。然后根据公 式计算得到ns时隙内循环移位参所需要ncs
输入参数	pPuschCelllnfo：指向信道估计用到的CELL相关信息控制结构体的指针。 不随UE变化，该结构体类型为STRU Pusch CellInfo
输岀参数	pNcs out：指向"cs输出数组的指针
..
返回值	无

•该模块处理流程图


图4-7 Ncs生成计算公式
3.LS计算函数
•函数概述
表4-3 LS计算函数概述
52
函数原型
i;	void ChanEst_LS (
pPuschRbLoc, pPuschCelllnfo, pZC_Seq. plnput, pChanEstLsOut)
功能描述	本函数根据输入本用户RB的起始位置，输入的数据，前面模块产生的ZC 基本序列及Ncs的值，完成LS估计算法，并将结果输出。
输入参数
-	pPuschCelllnfb：指向信道估计用到的CELL相关信息控制结构的指针,结 构体类型为 STRU_PuschRbLocInfo
pPuschRbLoc：指向用户RB位置的指针，由L RB及H_RB构成，可到对 应资源栅格中取出每个用户的数据，结构体类型为STRU_Pusch_Cell!nfo pZC_Seq：产生的本地ZC序列
plnput：输入的RS符号位数据，会根据psPuschRbLoc控制结构体中RB 位置来取数据
瑜岀参数	pChanEstLsOut： LS 估计输出
返回值	无

4. LS模块中使用控制结构体定义
在上面介绍的函数设计中，涉及到了几个控制结构体，对这几个控制结构体 的定义见如下几个表格。
♦ PUSCH用户级控制信息
表4-5 PUSCH用户控制信息结构体定义
结构类型名	成员	说明
STRU_PuschRb
Loclnfb	RbStartPosion	用户PUSCH数据在资源栅格中的 起始位置
RbNiim	某一用户PUSCH数据在资源栅格
中使用的总RB数
ns	时隙号
Input Ncs	输入的Ncs值

• PUSCH小区级控制信息
表4-4 PUSCH小区级控制信息结构体定义
53

结构类型名	成员	说明
UlBand Widthindex	上行带宽
Ndmrslndex	PUSCH参考信号的一个循环移位 参数
STRU_Pusch_C	UIDeltaSs	PUSCH参考信号的序列移位图案 参数。取值0〜29
elllnfo	UlSeqGroupHoppingFl
ag	上行参考信号的组跳频使能
UlSeqHoppingFlag	上行参考信号的序列跳频使能
UlCpType	CP 类型：0-normal 1 -extend
Cellld	小区ID
n DMRS l	DMRSJ 值
n DMRS 2	DMRS 2 值
ns	时隙号
4.3.2.2 VCFR信道估计子模块设计
VCFR信道估计算法是在LS估计输出后进行进一步处理，期间做时频域转换 是需要调用MAPLE-B2中的eFTPE模块。
本模块中实现难点是VCFR添加比例问题。在上行信道估计中，单个用户占 用的RB数最少可以使用1个RB （共12个子载波），最多可以使用100个RB （共 1200个子载波），RB数使用情况有34种。若在添加信道冲激响应时，采用固定 的比例，首先不利于窗函数的选择，34种RB占用情况，就需要34种窗函数及其 对于的窗函数倒数；其次，eFTPE工作时，只能处理一定数目的点数，采用固定 比例的方式会导致某些情况下无法使用协处理器完成DFT/IDFT运算。在通过仿真 确定性能差别不明显的前提下，本文采用了一种变比例虚载波添加方式。该方式 对不同RB数占用情况使用不同的VCFR数，使得添加完VCFR总点数只有256、 512、1024、2048这四种情况。这种实现方案不单简化了窗函数的使用，也保证了 所有可能的RB使用情况都能通过eFTPE完成时频域转换。具体的VCFR添加方 式如下表4-6 o
表4-6 VCFR添加数目表
子载波数目	添加完VCFR后总点数	添加VCFR数H
Number sc<240	256	256-Number sc
240<=Number sc<=480	512	512-Number sc
480<Number sc<=960	1024	1024-Number sc
960<Number sc<=l 200	2048	2048-Numbersc
54
在本模块中需要使用MAPLE-B2中的eFTPE, eFTPE有两种工作方式。方式 一是信号量模式，釆用信号量模式时，若进行eFTPE计算，DSP核被信号量阻塞, 进入等待状态直到eFTPE返回结果，DSP核取到eFTPE返回数据，继续DSP核 后续处理。方式二是消息模式，采用消息模式时，DSP核将BD配置好，将控制 和数据送入eFTPE, DSP继续后续处理；eFTPE处理完DFT/IDFT运算之后，通 过发消息模式驱动DSP核完成后续操作。在VCFR实现的场景中，考虑到 DFT/IDFT前后模块的强耦合性，若采用方式二，调度复杂，在多用户场景中使用 极为不便。另外，考虑到eFTPE的运算速率快，DSP核进入等待状态后时间开销 不大，而且采用消息机制，消息收发处理也会消耗DSP核资源。综合上述分析， 最后采用eFTPE工作方式为信号量模式。
VCFR主函数的定义如下：
表4-7 VCFR算法信道估计VCFR处理模块函数概述
函数原型	void PuschChanEst_VCFR(
RbNum, pChanEstLS, pCETempDatal, pCETempData2, pChanEstVCFR
)
功能描述	本函数根据输入控制信息得到本
输入参数	RbNum：该用户占用RB数目 pChanEst LS： LS 估计输出 pCETempDatal：使用中间临时全局数组 pCETein pData2 :使用的中间临时全局数组
输出参数	pChanEst_VCFR： VCFR信道估计输出
返回值	无
VCFR信道估计的处理流程图如下图所示:

55


图4-8 VCFR信道估计处理流程图
4.3.2.3 VCFR定点化设计
定点化设计对信道估计性能有重要作用，一个合理的定标在保证不发生溢出 的前提下，还需要保证精度最高。
表4-8 VCFR信道估计定点化设计方案
本模块主要运算变量	变量描述	'定标
RRS脇 j)	本地的ZC序列	sl6,15
X、⑴	用户的参考信号	S16J2
/,,,&) !	LS信道估计输岀	S16J2
Win f(i)	频域窗函数	S16J3
Recip win f(i)	频域窗函数倒数	s!6,13
H vcfrs,p,i,e(i)	VCFR估计输出	sl6,12

由于MSC8157平台，采用的是SC3850内核，该内核乘法器为16*16乘法器,
56
而在本模块的定点化设计中将该因素考虑在内。在设计主要模块输入输出时尽量 保证使用一个复数用32位来存储（其中实部16位，虚部16位），这样对于两个 复数乘法涉及的就是16位数的乘法，可以降低运算时间。在本文中前端信号定标 为S16,12（每个复数的实部或者虚部保存为short类型，小数点定标在12位位置）。 通过MATLAB仿真，在保证不溢岀的情况下，设计定点化方案如表4-8。
4.3.3 VCFR信道估计实现的优化及结果验证
4.3.3.1 VCFR信道估计实现的优化
1. LS估计模块的优化
在VCFR信道实现中，Code Warrior提供了很多可进行代码分析的工具。下文 进行优化分析的场景均为100RB, QPSK调制情形。所有代码按编译器03进行编 译。优化前LS模块总时间如下图所述：
Start addr.„ Function name	cycles-total	da粕 stalls executjcn stalls 存 executed program stalls
GxCOOOOOOO	coRi»Dn_go 1 d_gen	61892	　　　　25408	　　6892	　　31505	43
OxCDQfXXTlO eNb5HPuschCh>anEs t NcsCa. 1	571	　　　　248	　　67	　　　253	　　　0
OxCWOOFSO	©HbPxChanEst. AgCa ic	26901$	|~L2^~]	　　35079	　　皿618	130
0x£W01B20 eNbRxPuschChanEs t ZcGen	433		　　50	　　　148	33
OxCOOOlDAO eNbRxChanEst	4®	　　　　　95	　　35	　　　80	1S8
jxCOOOIEAO 虾云	206	　　　　　33	　　37	　　　6J	61
GxCOOOlFSQ		Qdiv32_s	147	　　　　　0	　　31	　　　114	　　　0
OxCOOO^GW		Q»iod32_&	246	　　　　　Q	　　73	　　　14B	　　　1
OxC0002130		QFMul	184	　　　　　0	　　21	　　　45	92
QxC00027EO		QFloatToInt32u	108	　　　　　0	　　13	　　　34	48
0yCOOO2MO		QFloatToIntl^u	32	　　　　　0	　　13	　　　6	59
G>C0OG2DFa		QInt32sToFloat	122	　　　　　Q	　　7	　　　24	82

图4-9 LS估计模块优化前时间
由上图4-9可见，在优化前，总时间约为330000个cycle （左侧框区域cycle 数累加），内核主频为1GHz,故优化前时间约为330us。分函数来看主要时间开销 在函数eNbRxChanEstAgcalc。该函数主要功能为RB数大于2时，进行基本ZC 序列产生。进一步分析该函数，由Trace工具得到该函数内部时间使用情况如下图：
压瘀ws诲y	家罗蕊S executed	　cydei-totd!	　　　stalk fjrog>an； sjafis	*项)
z-Llki -12 3 5-1
Eox； i»l. i- u£>Nsc„a. 1++.：		　　1«03	　　3	0	698
(% 98, 1,0)

for t j»0- j<12z j+<-)
(	　　X17S	”242	137	0	　　5100
locp_o;.'Unt (12. 12,1^ ■■)'：
Eti&dx ” Mat感服3FFF0而)，>1；:	　　X17«	2SS12	G	0	　　14112
CG；nl£"ieMp2c = ps?2t!upzc[ arinAdi-]	　　1176		胶诡	　　70S6	0	　　35225
dell aM--3Quai'e.	　　1176	8552	　　5528	9	0
1176	11753	　　3528	0	　　352S
。C_,L_»py ： ?^ Iph；) [ 3 ) cow.1 (■ t o»p~c	　　1176	關斜	　　7056	0	　　17640
.wi-iter (sl6pte：c.prE. eofiSJtSHpl .	. cmSZt©tipi J-sfei
•■,coal § I sin ' (6LSi k ； ； < < 16 + psl6LSin.(k-i-i ;.
。	•:>:•)：< 1 tetjplsin)
.?»riter_2f	tput_.ls*k --iM AzroBp.': :ssb, co»32t.rSJip.? i -1
vxitsr_2f >	. coM22ienpl »sb co»32te>iipi . isb?.，，>

k * k+2.
>	lx7S	　　1764©	0	　　0	3408
>
taz {b.： - 0 : b j < «8iszc„t !>：+；)
<	5	　　　131	5	　　0	47
E.n楸h、"怎厲FFFfgX，1 ：	5	　　　110	0	　　0	60
coai6teKp2.c = pi 3 21 npza [ sx nAd r ].	5	　　　177	30	　　0	82
'■		　　• -	-• - *

57
图4-10 LS估计中eNbRxChanEstAgcalc函数耗时分析
由图4-10矩形部分标注了该函数主要耗时部分。通过分析，可见其主要耗时 发生在取数据耗时。该函数主要完成式2-6操作，C实现为了保证取dK的精度和 对各种RB下不同N值的适配，在存储指数表时最终采用了 N为32768的基本单 位，即以J32768作为存表的单位。这样存储指数表的实部、虚部，需要设置一个 short SinCos[32768*2]的大表，使用存储空间约为128K。产生ZC序列时需要中这 个大表中取数，在一个循环体内部取表不具有连续性，这导致了读数据cache命中 率低，读数据开销大。Cache Misses高的问题在Cache分析工具中亦有体现，如下 图 4-11：


图4-11 LS模块优化前Cache Miss数据
上图4-11中，柱状图分为三部分，最下方红色部分为Data Read的Cache Misses,中间蓝色部分为Data Write的Cache Misses,而最上方绿色部分为 Instruction Read的Cache Misses,可见红色部分在整个Cache Misses统计中占了大 部分比例o Cache Misses的统计也从侧面反映了读数据慢是本模块耗时大的重要原 因。而Cache Misses率高，很大程度上源自于大表的读写。CPU对于经常读写的 数据会load到cache中，但是对于大表，由于其数据太大无法在cache中驻留， 会导致数据频繁的从cache搬入搬出，直接导致CPU取数据失败，从而导致整个 代码时间执行开销大大增加。
为了优化这个模块，开始时尝试优化表存储，通过减小表大小来达到Cache Misses问题的改善，但是多次尝试后效果并不好。
最后通过“空间换时间”的方式，直接存储ZC基本序列来达到优化效果。考 虑到MSC8157拥有512Mbytes DDR3的存储空间，根据式2-3分析，基本ZC序 列取决于u, v值以及子载波数，u取值为0〜11,而v值为0,1,而子载波数只有 34种可能。因此，可以实现通过MATLAB计算得到所有的定点化处理的基本ZC 序列，并存表，该表累计使用3.45M空间。
虽然从DDR3取出数据耗时比从M3中取数据开销大，但是将ZC序列直接存 表后，无需进行多余运算，只需要根据u, v计算查表索引。通过DMA直接从DDR3 中将大块连续的数据取进内存即可。
通过存表法，辅以多字节操作指令、复数乘法指令等手段，起到了一个非常 好的优化效果。优化后时间统计如下：
Start addr... function narne	cycles ieUi	=VIES executed	data		prcgi ann staHs	debug
0xC0(XXXXX) eHbRKChanEsr	12771	5534	　　7065	32	事捋	　　G
47	17	　　4	4	　　11	　　0
cosn4on_goid_gen	1638	1527	　　2	30	　　78	　　0
OxCOOCllSG 話部tcpy	391	SO	　　£8	20	3	　　0

图4-12 LS估计模块优化后耗时统计
由统计可知，时间开销从优化前的33Ous降为约14uso
为了描述优化对Cache Misses问题的解决效果，将优化后Cache Misses统计


图4-13 LS估计模块优化后cache Misses统计
对比图4-11,4-13,不难发现，通过LS的各项优化，Cache Misses指数由优化 前的约890降到不到120,而且优化后Data Read在总Cache Misses中的占比也大 大降低。
为了进一步衡量优化效果，引入AGU, ALU使用率来对比。在4.1节中介绍 了 MSC8157每个内核中有4个运算逻辑单元(ALU)以及2个地址产生单元 (AGU),在每个时钟周期内可以完成4ALU+2AGU操作。这说明，使用多ALU+ 多AGU的比例越高，代码执行效率越高。现将优化前后，AGU、ALU使用情况
对比如下:
59

SUMMARY：




图4-14 LS估计模块优化前ALU-AGU使用情况统计
SUMMARY:
D^y.U Paraiielis...
L04	DALU Counter
7384	AGU Psralleiism ...
1.05	AGU Countef
7441
% / No. VL£S	4 ALU	　　3 ALU	2 ALU	　　　1 ALU	0 ALU	Totai AGU
1.41% / 100 VIES	　0.01% / 1 VLES	0.04% / 3 VLES	　0.18% / 13 VLES	27.12% / 1928 VLES	28 77% / 2045 VIES
1 AGU	-	13.14% / §34 VL6S	　0.03% / 2 VLES	0.17% / 12 VLES	　0.37% 7 26 VLES	33.44% / 2377 VIES	47.14%/ 3351 VLES
sagu	2.58% / 212 VIES	　1.36^ / 97 VLSS	8嗣％ / 631 VLES	10.82% / 769 VLES	■' ?4-c / 3 V_£：	24.09% / 1712 VL£S
Iota； ALU _	17.53% i 1246 VIES	1.41% / 100 VLES	必％ / 646 VLES	11.37% l 808 VLES	| 60.61% : 430& VIES	:100.00% / 7108 V„.

图4-15 LS信道估计模块优化后ALU-AGU使用情况统计
通过上图4-14与图4-15对比，图中左侧绿色框部分表示高效使用ALU-AGU 情形比例，在优化前高效使用AGU+ALU比例为零，而优化后4ALU+1 AGU的比 例占到13.14%,这说明经过优化后，代码执行过程中更加充分使用过了 CPU计算 资源。0ALU使用情形，这能从侧面反映出AGU的负载。优化前0ALU为87.18%, 优化后0ALU情形为60.61%,这说明经过优化AGU的负载降低了。
2. VCFR信道估计子模块的优化
在4.3.2.2节中详细介绍了 VCFR信道估计子模块的设计。该子模块主要运算 量为FFT与IFFT操作。除了这些模块外，其余主要运算量为复数乘法，对复数乘 法的优化主要从充分利用ALU, AGU考虑。手动将循环展开，在每个循环内部通 过read_4f完成64bit数据读，使用指令完成复数乘法，最后使用write_2f每次将 32bit数据写回数组中。-个基本的循环内部代码如下图：
芝玲駕•冬归&藉 ™ 0; ■jl'SIdx <' () i ：?.:	)
£
eprlcop_ccun.,c •: ,: ' -
read_4f 、
read_2 三..
目：：• ；	- ... -■ L_srulz ' ?, „	11,::： 1 <<：.•；. ;
§ ' ST*:喏*泾£： :". •” ■: 21S '> ■' : ' T ''iss-i.：' r '	■ ：,4);
芋 >21触半?es .；.：.：• .: L_eiu.1 t .,.... < "；cpl2,厂..•- T;
:■- L	'■-::a : slS ■- ■ ； ：	• ：-1 ■；=，:
- - •…
i;	.. .. ： . *	■: .." - ;:：I. ?s ' r x <.；;
"ET&X/Me 矿 '-工 '' '•	: ~	■: •■:-;
i<• .■:確發題ks :？:.、：...:. ■ - L_znu 1 z . S ；.'w 14, s ："；•：：•涔如2 ； ：•
$'TeKT5pP.es . ； - • - :	：.•"匸球务侦I"、—;
z ■	■-	l
)
图4-16 VCFR子模块优化后代码实例
如上图4-16所示，在复数乘循环内部采用“取多组数据一指令完成乘法-存多
60
组数据”的模式，对代码进行优化。这样做的好处是可以充分利用ALU, AGU资
源。
由于MAPLE-B2的使用需要硬件支持，而硬件平台不支持Trace工具使用。在 统计VCFR时间时，通过添加函数Timer的方式来计算时间。儿个Timer探针设置 如下图：



图4-17 VCFR时间测试Timer探针设置点

由于VCFR子模块实现时，需要两次调用eFTPE,分别完成IDFT和DFT的 计算，因此为了获取eFTPE计算IDFT的时间，需要设置两个Timer探针，如图 4-17中的T2及T3探针。Timer探针T2放置于eFTPE配置操作之前，而T3放置 于信号量结束等待状态之后，这样，T2和T3之间的时间差就是eFTPE完成IDFT 处理的时间。同理，为了得到eFTPE完成DFT处理的时间设置了 Timer探针T4
61
及T5。为了减小单次统计的误差，统计VCFR子模块时一共完成了 10000个子帧 的信道估计操作，进行平均之后，单次VCFR子模块时间统计Timer值如下图4-18 所示。图4-18中所示的6个计时变量即6个Timer探针的计时，计时器可以精确 到纳秒级别。要获得各个功能子模块的运行耗时，用这几个计时变量求差值即可。
Name	Value
4 渗'FmeVCFRlJ：。能：T	0x5Occb2bO
(X)： u32Seccnd	42
u32MiniSec	507
u32MicroSec	684
u32NaocSec	116
s 冬¥ nimeVCFR2^Corel,	Ox50ccb2dO
u32Seccnd	42
(x)= u32MiHiSec	507
网k u32MicroSec	698
u32NaooSec	296
4 矛 *TimeVCFR3^Ccrel"	0x50ccb2c0
g u32Second	42
u32Millt$e€	507
(x)- u32M:c?o$ec	720
3 u32NaooSec	32
q RTimeVCFR4_Cor€l ,	Dx50ccb2a0
(3<)- u92$e<ond	42
d u32Milh$ec	507
凶* u32Micro$ec	757
妗 u32NaooSec	700
4 0 ,,TimeVCFR5_Corel,	0x5Gccb290
(x> u32Second	42
fxr u32MilHSec	507
即 u32MicroSec	776
u32NacoSec	876
或BTimeVCFR6_Corela	0x50ccb280
(4- u32Second	42
阵u32MilHSec	507
u32MkroSec	785
翎打 uS2Naoo$ec	952
图4-18 VCFR子模块Timer计时结果
使用这6个Timer可以得到对于模块的时间，时间整理如下表
功能	耗时(us)
添加VCFR,频域加窗操作	14.18
IDFT	22.02
时域去噪操作	3 /.J
DFT	19.17
去窗及去VCFR	9.07
总时间	计 101.546
表4-9 VCFR子模块各功能耗费时间统计
由上表4-9可见，经过优化后，VCFR整体时间为lOlus左右。

62
结合前文LS模块估计时间，整个基于VCFR拓展的信道估计算法在最大RB 块情形下所费时间为115us.左右。在做系统设计时，供信道估计处理的时延为3 个SC-FDMA符号的时间跨亩，总共为214us。优化后的约为可供处理时延要求的 一半，这表明经过优化后的信道估计算法能够满足系统设计的要求。
4.3.3.2 VCFR实现准确性验证
为了验证VCFR信道估计算法C语言实现准确性及定点化效果。使用Matlab 产生测试向量作为VCFR信道估计C模块输入，通过硬件仿真得到VCFR信道估 计模块输出。并进行对比。
下图4-19为VCFR信道估计MSC8157硬件平台输出复数的实部与对应 MATLAB测试向量的对比。其中星型点线为Code Warrior集成开发环境中获得的 硬件平台数据，十字点线为MATLAB参考数据，从两曲线吻合程度来看，在 MSC-8157平台实现的信道估计算法功能是准确的。

图4-19硬件平台VCFR信道估计输出与MATLAB数据对比（实部）



为了进一步评估定点化的效果和C实现准确性。将60-100子载波的数据进行 局部放大，如图4-20o在图中选取了两组值做对比，第一组数据：子载波73上的 信道估计值实部，C平台6902, MATLAB平台6850。第二组数据：子载波95上 的信道估计值实部，C平台5235, MATLAB平台5191。通过这样的对比，C实现 平台与MATALB平台的误差分别为0.76%,以及0.84%。由此可见，信道估计的 定点化设计是成功的，这也证明了信道估计模块C实现的结果是准确的可信的。
为了全面对比，也选取了信道估计输出的虚部进行同样的对比。从总体来看 MATLAB平台与C平台结果吻合度非常高。选取第350〜440个子载波的虚部来局 部放大进行观察。两组标记值分别为（C： 3749, MATLAB： 3691）, （C： 2829, MATLAB： 2810）,误差分别为1.57%, 0.67%。从信道估计输出的虚部来看，VCFR 信道估计C实现的结果也是准确可信的。

codewarrior
+ matlab
1000

图4-21硬件平台VCFR信道估计输出与MATLAB数据对比（虚部）

图4-22硬件平台VCFR信道估计输岀与MATLAB数据对比局部放大图（虚部）
综合上述对Matlab平台与硬件平台输出结果实虚部的对比，可以验证本信道 估计算法的C实现是准确可靠的，而且信道估计模块进行的定点化设计方案也兼 顾了运算速度以及精度要求。
4.4本章小节
本章主要进行了 TD-LTE上行信道估计的在多核DSP平台MSC8157上的实 现。MSC8157是一款非常适合进行基站侧无线通信系统基带信号处理的芯片，该 平台本身运算能力强大，而且还具有能满足多种无线通信协议要求的协处理器 MAPLE-B2。本文结合本文中信道估计的实现，对MSC8157的运算能力，主要特 点进行了介绍。同时，考虑到信道估计的实现需要MAPLE-B2中的eFTPE的支持, 也对eFTPE的工作模式，进行DFT/IDFT运算时的自动幅值调整功能进行了详细 说明。结合本文的应用场景，在文章中介绍了 TD-LTE上行的多核任务设计并详细 介绍了 “1发2收”天线配置下，PUSCH接收链路的设计。作为本章节的重点， 在本章的最后一部分，详细介绍了本文改进的VCFR信道估计算法的详细实现设 计。VCFR信道估计算法按照功能，分为了 LS估计操作以及VCFR操作两个功能 子模块。VCFR功能的实现，介绍了两个很重要的问题，一是虚信道冲激响应添加 问题，二是eFTPE工作模式选择问题，通过分析，本章中对这两个实现过程遇到 的问题提出了对应的解决方案。在本章的最后，详细介绍了在MSC8157平台上的 优化工作，在做实现优化时，主要解决的大表读写开销大的问题，并对其他几种 DSP上使用的优化方式进行了介绍。通过实现的功能准确性及时间效率也验证了 本文提出的基于VCFR拓展的信道估计改进算法具有非常高的工程实践价值。
65
第五章总结与展望
5.1论文工作总结
本文依托TD-LTE专网无线系统研发，进行LTE上行信道估计算法方面的 研究。本文首先回顾了移动通信发展历史，并介绍了各代无线通信系统的主流技 术，并在此基础上引出了本文的LTE系统相关技术，特别是介绍了和LTE上行 信道估计密切相关的LTE上行导频设计。
紧接着，本文详细介绍了在OFDM系统中经常被使用的信道估计算法，并 详细介绍了其原理及各个算法的利弊。LS信道估计实现简单但是抗噪声能力差， 基于LMMSE准则信道估计算法性能好，但是工程实用性差。而基于DFT变换 域去噪的信道估计算法作为LS估计与LMMSE估计的折衷，却受到“边界效应” 影响，限制了其性能。为了解决基于DFT变换域去噪信道估计算法遇到的问题， 本文在前人工作基础上，通过使用新的频域平滑窗函数及一种全新的适合VCFR 拓展信道估计算法的差异化去噪策略对基于VCFR拓展的信道估计算法进行改 进。通过仿真证明该算法解决了基于DFT去噪算法“边界效应”的问题，性能 大大提高。与此同时，本文还介绍了 LMMSE相关的简化算法工作，并对一种基 于FFT的快速F-LMMSE算法进行了讨论，该算法不需要预先获取信道信息， 具有工程运用的可操作性。
为了进一步验证VCFR算法的工程实践价值，本论文在飞思卡尔MSC8157 DSP平台上对该算法进行了实现。在介绍VCFR算法实现章节中，首先介绍了 MSC8157 DSP平台，然后详细介绍了 VCFR信道估计算法的软件设计，最后通 过多种优化手段VCFR的实现进行了优化。通过该算法时间开销、功能实现准确 性的综合评估，表明本文提出的改进算法具有非常高的工程运用价值。
总体来说，本文的创新性在于提出了一种改进的基于VCFR拓展的信道估计 算法，解决了传统DFT信道估计算法的“边界效应”问题，通过在多核DSP平 台上的实现也充分验证了该算法的工程实践价值。
5.2论文进一步工作方向
在本文中主要讨论了基于VCFR拓展的信道估计算法，在该算法中釆用的是 差异化门限去噪策略，通过仿真，充分证明了该去噪策略对性能改进的效果。从 仿真的来看，VCFR信道估计算法在不同的SNR下，表现出的性能提升有所差
66
第五章总结与展望
别。这种性能提升的差别很大部分来自与去噪门限的设定。因此，未来对基于 VCFR拓展的信道估计算法的改进可以从进一步优化VCFR去噪策略来进行，比 如进一步精细化去噪算法操作，根据实时计算的门限来进行精细化去噪等。
然后，本文中信道估计的研究主要基于低移动速率速率场景，如何在高速移 动场景中运用VCFR拓展的信道估计算法也是下一步可以进行研究的方向。
另外，在信道估计算法讨论中，引入了 LMMSE相关算法的讨论，并介绍了 一种快速的F-LMMSE算法，本文仅讨论了该算法的工程实践价值。如何对该算 法进行进一步改进，提高算法性能，使之可以在小RB情形中与VCFR信道估计 算法形成互补，也是下一步可以进行研究的方向。
67
参考文献
[1]啜钢，王文博等.移动通信原理与系统[M].第2版.北京:北京邮电大学出版 社.2005:2-3.
[2]彭木根，王文博等.TD.SCDMA移动通信系统[M].第2版.北京:机械工业出版 社.2010:1-3
[3]付晓.移动互联时代的技术发展和产业格局变化[R].上海:上海贝尔新闻 稿.2011,6:1-2.
[4]沈嘉，索士强，全海洋等.3GPP长期演进(LTE)技术原理与系统设计[M].人民 邮电出版社.2009:12-30
[5]Kang Y, Kim K, Park H. Efficient DFT-based channel estimation for OFDM systems on multipath channels [J]. Communications, IET, 2007, 1 (2): 197-202.
[6]Jiang M, Yue G, Prasad N, et al. Enhanced DFT-based channel estimation for LTE uplink[A]//Vehicular Technology Conference (VTC Spring), 2012 IEEE 75th. IEEE, 2012: 1-5.
[7]Hsu H H, Chen C W, Chuang G C H. Windowed DFT-based OFDM channel estimation by adding virtual channel frequency response [A] //Wireless Communications, Networking and Mobile Computing, 2009. WiCom'09. 5th International Conference on. IEEE, 2009: 1-5.
[8]Shuizheng Song, Chun He, Dan Tian, Hao Li. Channel estimation of windowed FFT based on pilot in OFDM systems [A]. ICCP 2010 Proceedings: 1-5
[9]Yang B, Letaief K B, Cheng R S, et al. Windowed DFT based pilot-symbol-aided channel estimation for OFDM systems in multipath fading channels[C]//Vehicular Technology Conference Proceedings, 2000. VTC 2000-Spring Tokyo. 2000 IEEE 51st IEEE, 2000, 2: 1480-1484.
[10]Edfors O, Sandell M, Van de Beek J J, et al. OFDM channel estimation by singular value decomposition [J]. Communications, IEEE Transactions on, 1998, 46(7):931-939.
[11]M.Noh Y.Lee and H.Park. Low complexity LMMSE channel estimation for OFDM systems [C]. IEE Proceedings.vo 1.15 3 ,no.5:645-650,October 2006.
68
[12]石磊，郭宝龙，李小平，等.一种低复杂度LMMSE信道估计算法[J].西安 电子科技大学学报,2012, 39(2): 24-28.
[13]程履帮.OFDMA系统中基于LMMSE信道估计算法的改进及其性能分析 [J],电子学报,2008,36(9): 1782-1785.
[14]Zhou W, Lam W H. A fast LMMSE channel estimation method for OFDM systems [J], EURASIP Journal on Wireless Communications and Networking, 2009,2009: 18.
[15]Dateki T, Ogawa D, Furukawa H. New OFDM Channel Estimation Method by Adding a Virtual Channel Frequency Response[C]//Vehicular Technology Conference, 2006. VTC-2006 Fall. 2006 IEEE 64th. IEEE, 2006: 1-5.
[16]Minn H, Bhargava V K. An investigation into time-domain approach for OFDM channel estimation[J]. Broadcasting, IEEE Transactions on, 2000, 46(4): 240-248.
[17]周炯槃，庞泌华，续大我等.通信原理[M].第3版.北京:北京邮电大学出版 社.2002:446-450
[18]Stefania Sesia等著.LTE—UMTS长期演讲理论与实践[M].马霓、耶钢等，译. 北京:人民邮电出版社.2009:261-271
[19]3GPP TS36.211. Evolution Universal Terrestrial Radio Access (E-UTRA) Physical Channels and Modulation[S] .Release9.2010.4
[20]Erik Dahlman,Stefan Parkvall,Johan Skold 著..4G 移动通信技术权威指南[M]. 堵久辉，缪庆育，译.北京:人民邮电出版社.2012:151-182
[21]郭强.LTE上行信道估计研究[D].西安.西安电子科技大学.2012
[22]Van de Beek J J, Edfbrs O, Sandell M, et al. On channel estimation in OFDM systems[C]//Vehicular Technology Conference, 1995 IEEE 45th. IEEE, 1995, 2: 815-819.
[23]COST 207 TD(86)51-REV 3 (WGl).Proposal on Channel Transfer Functions to Be Used in GSM Tests [S].1986
[24]Kumar R. A fast algorithm for solving a Toeplitz system of equations [J]. Acoustics, Speech and Signal Processing, IEEE Transactions on, 1985, 33(1): 254-267.
69
[25]Bottcher A, Grudsky S M. Spectral properties of banded Toeplitz matrices[M]. Siam. 2005.
[26]Yang B, Cao Z, Letaief K B. Analysis of low-complexity windowed DFT-based MMSE channel estimator for OFDM systems]!]. Communications, IEEE Transactions on, 2001? 49(11): 1977-1987.
[27]Zhang L, Hong Z? Thibault L. Improved DFT-based channel estimation for OFDM systems with null subcarriers[C]//Vehicular Technology Conference Fall (VTC 2009-Fall), 2009 IEEE 70th. IEEE, 2009: 1-5.
[28]Hou X, Zhang Z9 Kayama H. Low-complexity enhanced DFT-based channel estimation for OFDM systems with virtual subcarriers[C]//Personal, Indoor and Mobile Radio Communications, 2007. PIMRC 2007. IEEE 18th International Symposium on. IEEE, 2007: 1-5.
[29]Dateki T, Ogawa D, Furukawa H. New OFDM channel estimation method by adding a virtual channel frequency response [C]//Vehicular Technology Conference, 2006. VTC-2006 Fall. 2006 IEEE 64th. IEEE, 2006: 1-5.
[30]S5 Zhiwen P. Iterative LS channel estimation for OFDM systems based on transform-domain processing[C]//Wireless Communications, Networking and Mobile Computing, 2007. WiCom 2007. International Conference on. IEEE, 2007:416-419.
[31]Lee Y S, Shin H C. Kim H N. Channel estimation based on a time-domain threshold for OFDM systems]J]. Broadcasting, IEEE Transactions on, 2009, 55(3): 656-662.
[32]3GPP TS36.104 V10.10.O.Evolution Universal Terrestrial Radio Access (E-UTRA). Base Station radio transmission and reception[S] .Release 10.2013.3
[33]数字信息处理应用和教程中文资料[N].电子产子世界2013-07-31
[34]MSC 8157 Six-core Digital Signal Processor Data Sheet [R]. Freescale semi -conductor. 2012.1
[35]MSC8157 Reference Manual.Broadban Wireless Access Six Core DSP [R]. Freescale semi-conductor.2012.1
70
