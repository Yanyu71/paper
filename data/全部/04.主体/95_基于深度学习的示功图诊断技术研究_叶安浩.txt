第一章绪论
1.1研究意义及应用背景
近年来，国内油田生产开发［1］的规模不断扩大，在机械采油中有杆泵采油方 式的作用越来越重要。在实际石油生产过程中，抽油机是国内外有杆泵〔2］采油的 应用最广泛的设备，相比于自喷、气举、无杆泵等方式，有杆泵抽油机的结构只 有三部分组成，分别是抽油机、抽油杆、抽油泵，便于维修管理，也能在一定程 度上降低采油成本，目前油田企业使用的油井大约有九成是抽油机井。但深井泵 工作环境十分复杂，不但受到三部分机器配件的综合因素影响，还受到井内“砂、 蜡、气、水、盐、硫”等的物理环境因素的影响，导致抽油机发生各种类型的运 行故障从而无法正常工作，甚至会造成抽油设备的损坏，影响到油田产量和经济 效益。
示功图分析法是抽油机故障成因诊断最主要的方法，示功图是由专门的仪器 设备测出抽油杆工作时的位移和载荷数据，作图绘制出抽油机在一个完整冲程中 的位移和载荷的封闭关系曲线图，反映抽油机深井泵工作状况好坏。在出现故障 时，就会影响到抽油机的正常做功，从而反应在示功图上曲线的变化，而深井泵 的复杂工作环境使得示功图曲线变化类型较多，给正确判断泵工况增大了难度。 因此，是否能够对示功图⑶进行准确分类识别决定着是否能够保障油田企业的生 产效率，在这样的需求下，关于高效准确的示功图识别分类方法的研究一直在深 入。
为此，研究人员提出了许多种示功图识别分类方法［4一5〕，总结起来可以分为 人工识别方法和特征识别方法两大类。人工识别方法主要是借助油田工程师的实 际工作经验和知识,观察采集到的示功图曲线特征，加以对比样本库中的示功图， 通过人工识别将其进行分类。这种方法受影响于入工经验、技术水平等因素且效 率低下。特征识别方法则主要是通过提取示功图的目标特征，再利用机器学习或 深度学习的方法来进行分类识别，这种方法受限于选取的示功图特征参数是否准 确，且模型泛化性能不高。
本文中针对目前常用方法依赖人工先验知识以及实际应用准确率有待提高 的问题，基于深度学习提出了自适应地示功图分类识别的方法。先利用自编码器 解决了示功图在深度学习中的小样本问题，随后通过卷积网络自动学习原始示功 图集的隐含数据特征并泛化表达，达到无需通过特征工程的方式定义特征向量， 不依赖人工先验知识的目的，并且对模型进行了轻量化和强化学习改进，即使在 计算能力不足的嵌入式边缘终端上，也能够准确完成示功图分类识别的功能，并 在保留训练知识的情况下对新知识进行学习以微调模型，保证模型的鲁棒性，为 实际落地应用提岀了可靠的方案。
1.2国内外研究现状
在过去的几个年代里，国内外相关方面的专家学者就抽油机故障成因及诊断 开展了研究。其中示功图分析方法是抽油机故障诊断的主要方法，示功图是经过 专业仪器设备采集油杆位移和载荷数据，并绘制出的关系曲线。抽油机不同的故 障原因会导致油杆出现不同的情况，并影响到抽油机正常做功，导致示功图曲线 发生变化，示功图分析法就是通过对示功图曲线在抽油机不同故障下的变化进行 识别分类，从而实现对抽油机故障的诊断。
就其发展来说，在上世纪的80、90年代，抽油机故障诊断方法以人工识别 法和专家系统为主。随着研究的深入，示功图分析理论逐渐完备，伴随着机器学 习的兴起，基于机器学习和深度学习的方法被作为示功图识别分类的主要方法。
1•专家系统
示功图识别专家系统(Expert System, ES),其实指的是通过借助油田工程 专家的丰富的工作经验和深厚的专业知识，将这些逻辑通过计算机表达出来，从 而建立出的系统能够对样本示功图自动进行逻辑演绎并且推理岀抽油机是否发 生故障、故障的成因等关键信息的一种计算机系统。
1984年，美国Chenvron油气公司问基于Basic语言开发了一套EXPROD专 家系统，对各类别示功图建立了规则库，可以对典型示功图进行识别，落地应用 于该公司下的油田生产。1993年，王玉成【7］针对专家工程集成化程度低的不足之 处，结合智能工程提出了能够将示功图的采样、分析、诊断流程整合一体自动化 的抽油机井集成化智能诊断系统(PUDS),大幅度提高了示功图的识别效率。1996 年，冯定冈结合神经网络来为专家系统提取特征。总的来说，专家系统过度依赖 于其知识库，其智能化程度、自动化程度以及诊断结果的准确率都不够令人满意。
2•机器学习
由Vapnik在1995年提出的支持向量机［9】是机器学习领域中最重要的方法之 一，2007年，时文刚等人提出基于支持向量机的示功图识别方法，将当时逐渐兴 起机器学习方法与示功图识别联系起来。2017年冯中申结合链码特征法，实现 了示功图分类诊断的KNN分类算法【1°］。2018年刘涛等人提出了结合矩特征、傅 里叶描述子的logistic回归模型⑴］。总的来说，机器学习方法应用于有杆泵故障 诊断取得了较好效果，但是机器学习算法对于大规模训练样本难以实现，当分类 数很大时，用来存储和计算的矩阵将需要较高的服务器硬件配置。
2
3.深度学习
随着深度学习研究的兴起和快速发展，其模式识别的能力被研究学者们所认 可，也更多的关注和应用在抽油机故障诊断上。在1988年，DerekHJ, Jennings J W等人初次利用深度神经网络对示功图进行分类QI。1998年，杜保东［⑶提出 了通过人工神经网络，也实现了对示功图的分类识别，总结出了有效的抽油机故 障诊断方法。2004年，杨理践【⑷结合Gibbs波动方程”］对示功图进行处理，再 通过反传神经网络进行分类识别，提高了识别准确率。总的来看，示功图分类识 别的深度学习方法，总体准确率还是优于之前的方法，但是人工神经网络的简单 分类在对多种示功图的鲁棒性和可用性上还存在很大局限性，在网络结构与优化 上还有很大提高的空间。
从上面的总结可以看出，示功图识别分类方法中人工识别法和专家系统的故 障诊断结果非常依赖于工程师的专业知识储备和实际工作经验，无法做到判断出 多种类的故障，只能作简单的识别为故障检修提供参考意见。而基于深度学习抽 油机井示功图诊断【"-⑼的方法绝大都采用各类特征提取方法，能取得一定的准确 率,但仍存在一些局限性。特征提取的不同方法各有优劣，如果选取的特征较少， 不足以体现不同类别示功图的差异，如果选取的特征过多，又会导致维度爆炸的 问题，也会造成对于训练样本数据集之外的示功图知识的识别鲁棒性比较差，仍 存在进一步提升的空间，这是本文示功图诊断方法的研究重点。
1.3主要研究内容和结构安排
1.3.1论文研究内容
本论文针对有杆泵采油示功图图形的特点，选择和搭建基于深度学习的示功 图分类识别网络，通过对比实验来分析各网络参数对示功图识别的影响，对设计 的识别模型不断进行优化改进。分析通过自编码器［20］增强后的生成示功图的特 征，评价故障分类诊断网络的鲁棒性和自适应性，并对模型进行轻量化处理，使 其可以作为一个实际应用部署到计算资源有限的嵌入式边缘设备上正常应用。
1.基于特征提取的示功图分类识别方法
首先对示功图传统复杂特征进行了全面的总结和分析，常用的传统示功图的 特征识别方法一般是根据示功图的图形特征或者实际物理意义，计算岀图形矩特 征、傅里叶描述子特征、灰度特征及生产参数特征等参数，以此来确定增载、卸 载等关键位置的分布与上下冲程的形状，从而确定抽油机的实际工作状态，判断 故障发生的位置。这种方法对常见的典型示功图识别比较准确，但不能保证对各 类工况都有很好的识别，并需要人工先验知识。
3
本文利用OpenCV计算机视觉库PH进行功图复杂特征的提取，在特征的选 取上除了包括图像识别非常有效的图像矩特征，还用位移载荷的工程参数来弥补 图像矩的全局局限性。采用特征融合©I的方法对特征进行处理，提高了示功图识 别准确率，通过分类对比验证基于融合特征识别的示功图方法的有效性，也得出 特征工程方法存在的局限性。
2•基于深度学习的示功图分类识别方法
首先基于示功图的抽油机故障诊断领域并没有权威统一的公开数据集，从某 油田获取的实际示功图样本是比较少的，示功图在抽油机的样本有限，那本文构 建数据集前需要解决示功图的小样本问题，选用了自编码器来进行样本增强。
为了达到无需人工先验知识实现示功图诊断的目的，本文考虑到在图像的分 类识别领域应用很成功的卷积神经网络［2叫图形特征可以由其通过非监督学习0］ 自行提取。通过实验对比分析卷积神经网络结构各个参数对模型性能的影响，设 计了适合示功图分类识别的网络结构，展示了分析及调整参数的过程，并且通过 对比不同的参数初始化方法，设计了基于自编码器编码层参数的初始化方法，进 一步提高的模型训练和识别性能。
3•示功图分类识别的轻量化与强化学习方法
在实际生产过程中，边缘端的计算机设备硬件配置和计算资源肯定远远差于 实验室服务器环境，甚至可能是嵌入式设备，亟待解决的问题就是对模型的轻量 化。基于这个目的出发，本文借鉴了 MobileNet网络血初的基础思路，它在卷积 神经网络的基础上做出了卷积层分解并引入了倒残差结构，其目标是为了对 CNN的模型结构轻量化以适应移动端的嵌入式设备。在本文设计的模型中，通 过对标准卷积层根据矩阵论中的矩阵分解理论进行分解，从而大幅度降低卷积过 程中的参数量和计算量。
另外每一次新的识别任务，会带来新的未学习数据，这将涉及到通过强化学 习［28】来对新数据进行学习并对模型进行微调，在此过程中，还需要保证模型对旧 训练数据的记忆。基于策略的算法的训练过程需要单独对策略函数进行更新，导 致收敛较慢。而基于价值的算法对连续动作以及随机策略的处理能力不足。因此 本文借鉴了策略［29］(Policy Based)和价值(Value Based)相结合的 Actor-Critic^］强 化学习策略，来设计了适合嵌入式设备mi的强化学习方案，并给出了参数调整的 性能对比，以适配不同的实际需求。
1-3.2论文结构安排
本文的主要研究内容是基于深度学习的示功图诊断方案。共分为五章，每一 章的具体内容总结如下：
第一章：介绍了基于示功图识别的抽油机故障诊断方法的课题意义；阐述冃
4
前国内外针对示功图分析方法的研究现状；最后介绍本文的主要创新点与研究思 路。
第二章：介绍抽油机井的基本工作原理和故障可能成因分析，以及其与示功 图的联系，接着通过自编码器样本增强的方法建立了示功图数据集，分析评估了 增强效果。
第三章：对示功图传统特征工程方法进行了总结和学习，把工程特征和图形 矩特征通过特征融合的方法相结合，对示功图进行分类识别，分析特诊工程方法 的准确率以及不足。
第四章：通过大量对比实验设计了适用于示功图识别的卷积神经网络模型， 探究了各项参数对模型性能的影响，并提出了基于自编码器编码层参数的初始化 方案，进一步提升了网络的收敛性能。
第五章：针对计算能力较低的嵌入式边缘设备，对模型进行轻量化改进，使 其能够正常完成对示功图的分类识别，并设计强化学习的策略，在不遗忘训练知 识的前提下，能够持续对新知识进行学习并微调模型以提高模型的鲁棒性，并对 模型参数进行多方面对比评估。
第六章：总结全文，并对未来的工作提出展望。
第二章抽油机井工作原理与示功图样本库建立
2.1引言
目前，针对有杆泵抽油机井示功图故障诊断方法，在通过大量查阅文献资料 总结归纳后发现，在理论方面还算较为完备，在最近的几十年里，国内外也不断 探究示功图的方法，有许多解决方案也已经在油田的实际工作中广泛应用，在进 行示功图研究之前，本文也需要对抽油机井的采油原理，以及示功图诊断的实际 意义和可行性进行一个完备的分析。
但在总结的过程中，本文发现示功图故障诊断方法在技术方面还是存在一些 不完备的地方，其中包括在基于示功图的抽油机故障诊断领域并没有权威统一的 公开数据集。有杆泵抽油机井的故障诊断一般是根据示功图的图形来进行分析， 而获取抽油机的位移载荷数据并绘制示功图是完成抽油机故障诊断技术研究的 重要基础，数据集的匮乏在一定程度上限制着示功图诊断技术的发展。而其数据 的收集难度主要体现在以下两个方面。首先，获取位移载荷数据需要比较专业的 技术和设备，需要选用质量较好、性能稳定的仪器，才能够减少因为仪器的不精 准或者故障而造成的错误分析。其次，有杆泵的工作环境是一个相对复杂、不稳 定且恶劣的环境，反映在示功图上就可以观察到功图曲线是不断波动变化的。而 在某些技术方法中需要依据功图曲线的特征参数来对故障类型进行检测，因此需 要大量的示功图数据集来从混乱复杂的位移载荷数据中提取出能够进行深度学 习的特征。
针对数据集获取中存在的以上问题，首先从某石油企业提供的少量利用专业 智能测试仪在真实工作环境中采集的示功图集作为基本数据集，分析其特征，以 其为基础进行样本增强，构建本文所需的示功图样本数据集。
2.2抽油机采油原理
抽油机在工作过程中靠机、杆、泵相互配合协调，任何一部分在出现故障时 都将在示功图曲线的反映出变化，因此简要了解抽油设备的工作原理对示功图的 分类还是存在一定意义。
目前主流的有杆抽油系统主要由三部分设备组成：一是地表部分的抽油机， 连接了高功率的动力设备用来输出动力，主要部件有减速器、电动机、连杆和游 梁、曲柄；二是连接在抽油机和抽油泵之间，负责传递动力的抽油杆，三是地下 部分的抽油泵，接收到动力后带动泵机进行采油工作，主要部件有泵筒、凡尔和 柱塞。
借助抽油机传递的动力，抽油杆带动泵筒不断做上下往复运动，一次完整的 过程称之为冲程。在上冲程中，抽油杆是向上运动的状态，泵筒中的游动阀受到 液柱的阻力而关闭，而固定阀则被油柱液压顶开，这样井内的原油就被收集进入 泵筒。在下冲程中，抽油杆是向下运动的状态，和上冲程相反，此时泵筒内液柱 的受力情况相反，导致固定阀关闭，游动阀开启的状态，这样原油就可以从泵筒 内抽入油管被采集完毕。这样在一个冲程中，随着抽油杆的持续运动，井内液体 被采集后就源源不断地被运输进入泵筒，最后到达地面完成采油过程，如图2-1 所示。


1-固定阀；2-泵筒；3-柱塞；4-游动阀；5-抽油杆；6-光杆；7-驴头
图2-1抽油机井示意图
从上面的抽油过程中可以知道，抽油泵和抽油杆都位于地下工作，是最重要 同时也是最容易发生故障的两个设备结构。抽油杆在抽油工作过程中起着承上启 下的重要作用。它上方与抽油机连接，下方接抽油泵,在整个抽油机中传递动力。 其带来的载荷影响对应的示功图曲线变化主要有两种，一是振动载荷会使示功图 在上下冲程都产生具有波浪形特征的曲线，二是惯性载荷使示功图产生沿顺时针 方向的旋转，在受到阀门开启关闭的影响时，还可能造成冲程损失。由此，抽油 杆在不同载荷的作用下，容易出现弯曲变形甚至断裂等故障情况。抽油泵的游动 阀和固定阀在抽油过程中不断完成开闭转换来采集原油，也可能因为原油中的杂 质或阀门连接处使用寿命限制等因素，也容易出现故障。因此为了能够快速准确
8
地定位到抽油机故障发生的位置，通过专业设备釆集到用来描述抽油杆位移载荷 的示功图有着非常重要的意义。
2.3示功图特征分析
2.3.1理论示功图
示功图是经过专业仪器设备采集抽油杆在一次冲程中的位移S和载荷F的数 据，并绘制出的关系曲线。
在理想情况下，也就是抽油设备工作正常，也不考虑抽油过程中各种做功的 载荷因素，绘制出来的示功图应该是如图2-2所示，具有平行四边形的特征。A 点是驴头的下死点和活塞上行时的起始点，当活塞向上运动时，游动阀受到油管 内液柱压力和自身重力的作用关闭，使得压力转移到抽油杆和柱塞上，使得抽油 杆发生弹性形变，因此产生了 AB的倾斜线，此时柱塞处于加载过程，叫做增载 线。当抽油杆上行到B点时弹性形变结束，柱塞开始向上运动，开始抽油，这个 过程中液柱压力基本不变，也就是BC水平线段。当抽油杆运动到C点时，上行 程,开始向下运动，完成一个排油的过程。C点是上下行程抽油杆受力的交换点， 开始下行的瞬间游动阀打开，固定阀关闭，抽油杆进行弹性形变并未产生实际位 移，产生CD卸载线，同时形成DD，冲程损失。在D点弹性形变结束，柱塞开始 下行，这个过程中压力也基本不变，所以画出DA水平线段，到达A点就完成了 油液注入油管的过程。这样抽油泵在整个冲程中完成了排油和进油的过程，绘制 出理论示功图ABCD的平行四边形，其图形面积就代表泵在一个完整冲程的做 功多少。
但是这样的示功图实际上是不会存在的，一般是在对实测故障示功图进行分 析时，用来理论示功图的图形来对比分析，找到实际载荷情况在哪部分出现了问 题，从而推断出实际的抽油机设备故障所在。
F
B*
B
C





A

D
j
D''
s

图2-2
理论示功图




9


2.3.2实测示功图及故障关系分析
2.3.1小节讨论了是理想状态下的示功图。而在实际生产中，抽油杆要承受 多重载荷的影响，这就导致了实测示功图的曲线一定会在理论示功图上发生一些 特定差异。其中在抽油杆正常工作时的振动与其他设备之间的摩擦，以及石油液 体本身的粘滞力等因素影响下，整体曲线如图会产生一定程度的旋转，此外抽油 杆的实际运动速度在摩擦载荷的影响下会很可能与地表动力驱动速度不够匹配， 使图形产生如图2-3的成环现象，这代表抽油杆的工作过程中发生了二级振动。


图2-3弹性振动和动载荷共同影响的示功图
此外，经过实际示功图显示，当不同抽油机井发生了相同的问题故障，此时 所测出的示功图，形状都是基本相似的，不同只在于不同抽油机的规格和功率不 同，因此做功效率不同，这一点是可以通过图形归一化来避免的，而形状相似就 代表示功图的曲线变化具有普遍性的规律特征。掌握了各类基本示功图曲线形状 的规律特征，就可以根据示功图对抽油机的具体生产情况作出判断，便于工作人 员对于抽油机故障进行定位及快速检修。经过上面的分析，对抽油机可能发生的 故障情况都做了总结，在本文的研究中，选用了十种典型常见的故障类型对应的 示功图，它们可分为如下类别：泵下碰、抽油杆断脱、供液不足、固定阀漏失、 结蜡、气体影响、双阀漏失、游动阀漏失、正常工作、柱塞脱出。
本文根据抽油机各类型故障可能出现的概率，以及其严重程度，选取了十种 典型示功图作为数据集类别，下面先对它们的故障发生原因和示功图曲线特征进 行总结。
(1) 柱塞下碰
柱塞下碰是在下冲程将要结束的时候，造成活塞下部与卸油器相碰击，使得 抽油杆载荷突然变低。主要产生原因一般是由于抽油杆与地面的防冲距设置过小。
图形规律特征：如图2-4,示功图左下角出现一个小圆圈。
10


图2-4柱塞下碰示意图
(2) 抽油杆断脱
.抽油杆断脱就是抽油杆脱落导致抽油机的动力无法传递到抽油泵，从而导致 无法采油。主要出现在两种情况,一是抽油杆在长期受到各种载荷影响的情况下， 发生了物理断裂，导致不能继续采油，二是换装抽油杆时，抽油机与其连接处的 连接螺纹出现了松动，发生了自由脱落。而根据抽油杆断脱的部位不同，示功图 的故障停止载荷也会不同。
图形规律特征：如图2-5,示功图接近于水平状，上下冲程载荷几乎不发生 变化。

图2-5抽油杆斷脱示意图
(3) 供液不足
供液不足主要是因为泵深度不合理或泵筒的直径过大，或者是正在采油的地 下产能低，从而导致抽油泵筒内石油液体无法充满，在这种状态下游动阀不能及 时打开，影响正常的釆油。
图形规律特征：如图2-6,示功图的右下角缺少一块或较小，上冲程曲线正 常，但是下冲程载荷下降非常慢。而下冲程的转折点取决于抽油泵筒的充满程度， 泵筒采集到的液体越少，因此转折点会越向左移动。
F


/厂





s
图2-6供液不足示意图

11
(4) 固定阀漏失
固定阀漏失是在固定阀与抽油泵筒之间出现了缝隙，引起了石油液体的漏失。 造成此故障的原因可能有采集到的油质地较粘稠、阀座连接处的螺纹或钏钉装配 不紧或者是泵筒出现结蜡现象导致闭合不紧。
图形规律特征：如图2-7,下冲程曲线出现倾斜，示功图右下方面积出现部 分缺失。

图2-7固定阀漏失示意图
(5) 游动阀漏失
游动阀漏失在游动与抽油泵筒之间出现了缝隙，引起了石油液体的漏失。造 成的原因可能是阀座被腐蚀或者刺漏，从而导致密封不严或者是密封钢套使用时 期较长岀现磨损。
图形规律特征：如图2-8,上冲程曲线出现倾斜，示功图左上方面积出现部 分缺失。

图2・8游动阀漏失示意图
(6) 双阀漏失
双阀漏失是出现了游动阀和固定阀同时漏失的情况，此时漏失原因可能是综 合了多方面的故障，可以参考上面游动阀漏失和固定阀漏失的成因。上冲程时固 定阀漏失导致不能正常增载。下冲程时游动阀不能快速卸载，游动阀在下行程未 完时提前关闭而增载。
图形规律特征：如图2-9,示功图的四个角都存在缺失的情况，上冲程增载 和下冲程卸载都变慢，整体呈现椭圆形。
12


图2-9双阀漏失示意图
(7) 结蜡
结蜡的成因在于抽油井中石油液体的含蜡量较高，长期工作导致蜡凝固在抽 油杆上，增大了抽油杆上下运动的摩擦阻力，导致示功图上下冲程都超出了正常 的最大、最小负荷线。
图形规律特征：如图2-10,结蜡示功图整体呈现肥胖的形状，上下冲程的波 峰和波谷的差距较大，峰点较为对称且圆滑。

图2-10结蜡示意图
(8) 气体影响
气体影响的成因在于抽油井的石油中油气含量较大而原油含量较少，导致抽 油泵筒内抽取出大部分气体，从而出现载荷与理论示功图相差较大的情况。这样 的油井要通过保持较深的钻探深度，才能避免影响。
图形规律特征：如图厶11,由于泵内进气导致产量减小，下冲程的卸载曲线 斜率较小，右下角缺失比较严重，上下冲程相比于标准情况也具有一定的弧度。

(9) 柱塞脱出
柱塞脱出的情况，和柱塞下碰恰好相反，是在上冲程做功过程中，柱塞直接 从工作筒脱出，从而导致上冲程突然卸载到下冲程最低水平，主要产生原因一般 是由于抽油杆与地面的防冲距设置过大。
13

图形规律特征:如图2-12,上冲程增载线部分正常，但在后半部分突然卸载,
图形右下角呈现一个“小尾巴”。



2.4示功图数据集构建
2.4.1示功图预处理
本文对现有的真实示功图数据集，首先进行坐标数字化处理，参考过一些文 献，它们的处理方式是将示功图按照上下冲程的物理定义分成了两部分曲线。本 文目标旨在通过深度学习的方法来完成对示功图的分类识别，诊断出抽油机的故 障问题，所以选择直接对示功图这一封闭曲线进行坐标点提取，主要方式是通过 GetGraphOatad］等间隔采样来获取实际示功图的坐标点，每一张示功图设置128 个采样点，其中上下冲程各有64个采样点。这样获取到的图像边界点坐标值存 入excel文件中备用。
其次是将示功图的尺寸归一化，由于受到诸如采油井类型，数据采集设备不 同等多方面因素影响，实际测得的示功图实际载荷与位移的数值差距还是比较大, 为了提取故障示功图的统一特征规律，本文需要对所得示功图数据点集进行归一 化处理，在单位坐标图里只保留示功图的轮廓，坐标变换如式2-1所示。
(2-1)
通过上式进行了坐标点归一化，使得示功图整体轮廓就在一个1X1的矩形 中，避免了不同设备实际参数不同对示功图识别的影响。
2.4.2示功图样本增强
在数字归一化预处理后，其次急需解决的一点问题在于，基于示功图的抽油 机故障诊断领域并没有权威统一的公开数据集，从某油田获取的实际示功图样本 是比较少的，示功图在抽油机的样本有限，那本文构建数据集前，首先需要解决 的是示功图的小样本问题。
近些年在深度学习领域最常见的用来解决样本增强的问题的方法有生成对 抗网络［331(Generative Adversarial Networks, GAN)和自编码器［34］(Autoencoder, AE)。
14 GAN包括生成器和判别器两部分，这两个模型不断的进行博弈，并且持续epoch 轮次的交替训练或者收敛，生成器用于仿造假样本，判别器用于区分实际的真实 样本和生成器仿造的假样本，直到训练结束或者收敛，两个模型达到平衡，此时 判别器判断样本真伪的概率接近五成，生成器的生成高度近似样本目标也就达成 To而AE是包括编码器和解码器，数据集的样本数据的输入进编码器后，通过 网络权值的训练，将输入数据的高维特征进行降维映射。解码器用于接收数据降 维后的低维特征，然后通过对编码器镜像网络结构权值的训练，从低维特征从重 构出符合输入样本分布的数据。从前面的分析，可以知道它们最大区别是，AE 的训练目标和过程都是显式的，其训练过程强制性地把数据拟合到某种分布上， 而GAN通过博弈策略来优化生成器和判别器网络，达到让生成器产生数据的分 布的目的，最终是直接拟合训练数据的分布而不追求符合公式上的强分布性。为 了获取强分布性的数据集，以适应本文的示功图分类识别的场景，因此本文将在 本节选用自编码器来解决样本增强的问题。
首先，讨论基础的自编码器模型。编码器接受输入向量xe[0, l]d,并通过 关系式2-2来映射。
y — fe(.x)= s(Wx + b)	(2-2)
从而计算得到隐藏层表示yw[0, l]d，o随后，解码器部分将得到的低维表 征y通过关系式2-3来映射。
z = %心)=s(W'x + b')	(2-3)
从而将表征向量y重构为输出向量z e [0, 1严。其中权值矩阵VT是"的转 置矩阵，即W' = WTo在这种情况下，每个输入训练的X都会被式2-2映射成一 个相应的y,再被式2-3重构成一个增强样本z。在训练过程中，参数的优化目 标是使得重构向量z和输入向量x的误差最小化，如式2-4 =
6,6' = argmin^'Zf^ L{x',z'}	(2-4)
其中，L是损失函数。这里还可以用到另一种损失函数是重建交叉嫡，因此 此处应该如式2-5将x和z解释为位向量或位概率向量。
LH(JC,Z) = - Xk=i xk logzk + (1 -%k) log(l - zk)	(2-5)
需要注意的是，如果这里X是一个二维向量，贝必H(X,Z)需要表示成示例X 的负对数形式，在给定参数z的情况下，式2-4可以写成式2-6。
6,0' = argminEqoM [L{X, gB< (x)))]	(2-6)
其中q°(Q表示属于相同的经验分布的n个训练输入样本。
但在本小节选用的是卷积自编码器来解决示功图的样本增强问题。其原理和 自编码器一样，但是把全连接层给去掉后，取而代之的是卷积层和池化层的组合。
15

从上面的公式推导可以看出，使用的是全连接层的基础自编码器，完美适用于一 维输入向量的样本增强，但是对于二维的输入向量，比如视频或者图形，全连接 层会损失一部分空间的特征信息，相比较之下，通过卷积层的特征提取和池化层 的降维抽取，二维输入向量的空间特征信息能够被更好的保留下来。图2-13和 图2-14分别是卷积层计算和池化层计算的示意图。

♦ Output
aw + bx + ey + fz
图2-13卷积层计算示意图

池化前	池化后
图2-14最大池化层结构图
卷积自编码器的整体原理还是属于自编码器，但是通过卷积层对于输入向量 的特征提取后，对二维输入向量的局部特征进行了保留，卷积神经网络的权重是 共享的。因此二维向量的重建过程可以理解成是将保留了特征的像素块按照特征 分布进行排列恢复。训练过程重参数优化用到的损失函数也与基础正则自编码器 一样，具体可表示为式2-7。
= argmin^^iKx'.z') + (2-7)
通过上述分析，选用了卷积自编码器来进行样本增强，这对于本文的工作其 实是具有两方面的优势的，一方面解决了示功图自身的小样本问题，另一方面卷 积自编码器的编码层在学习分布的过程中能够学习到一些示功图图形的特征，可 以把其网络参数保存下来，再利用这些参数来预训练本文后面的卷积神经网络分
16

类模型，这在一定程度上也能够解决小样本问题，并且避免分类模型陷入局部最 小以及过拟合，本章设计实现的卷积自编码器的结构如图2-15所示。

图2-15用于示功图样本增强的卷积自编码器结枸
模型输入的示功图是224x224像素，编码部分具有2个卷积层和池化层的 组合以及一个全连接层，卷积层是为了将示功图的特征进行局部感知，避免对每 个像素都进行获取，一是这样的权重数量巨大难以训练，二是这样的操作也很容 易造成模型过拟合，而池化层是对卷积得到的功图局部特征值进行按规则下釆样, 比如本文用到的是最大池化方式，在一定矩阵范围内取其最大值。如图，通过两 层这样的结构，就能够得到表示输入示功图的20维矢量。随后的解码部分，其 实也就是编码层的镜像结构，会将表示形式解码回224x224像素图像。
由于最大池化操作(Max-pooling)在TensorFlow没有内置相应的反池化方 法，因此本文解决的思路是用左上角的原始条目用NxM内核替换池映射中的四
个角落的条目，其中N和M为池核的形状，如图2-16所示。

在CAE预训练构建完成后，可以看到对示功图的重构结果，如图2-17所示。
口 O H 口 □口

口口 u [J □口
d zr CL 一 o zr

d zZ £1 — O b
zr c? C7 o zZ

' J™	'"i rl X ■-亠' 西	-
£~* ZZ C* C7 O ZT
_ Q _ 口 d O

—4 ™. O a o
D 口 _ 口 £1 O

口口 一口 d o
rx □ □ u 口 o

二口匸 q u o
图2-17自编码器重构示功图的部分结果
图2-17左是输入的示功图数据集，图2-17右是经过自编码器重构的示功图。 大部分示功图都能够被解码器部分完好的重构出，也代表着此时编码器部分己经 自学习到一部分示功图特征。
2.4.3示功图数据集
本文中用到的示功图数据，每张图包含128个采样点，其中上下冲程各有64 个釆样点，对油田油井生产活动的示功图数据中的位移和载荷信息数据进行预处 理，绘制224*224像素大小的示功图，数据集总共40000份样本示功图，抽油机 有杆泵示功图数据共分为十类（泵下碰、抽油杆断脱、供液不足、固定阀漏失、 结蜡、气体影响、双阀漏失、游动阀漏失、正常工作、柱塞脱出）。
关于实验条件，本文服务器是NVIDIA CUDA环境，嵌入式硬件是树莓派 4B,利用了 Tensorflow框架来进行各个模型的训练与测试。
2.5本章小结
本章主要完成了基于示功图识别的抽油机井故障诊断技术研究的前期准备 工作，包括明确了抽油机工作原理及故障分析和示功图的关系分析，并从抽油机 井的工作过程分析了高频故障可能发生的原因，讨论了不同种类示功图的具体形 成过程。并且根据大量示功图典型故障情况的图形分析，综合资料统计，详细介 绍了十种典型示功图的故障原因和曲线特点，对示功图数据集进行了预处理，并 通过自编码器样本增强的方法对数据集进行了扩充，完成了故障示功图样本库的 建立，能够满足本文后期技术研究中的数据需求。
18
第三章基于示功图特征提取的抽油机故障诊断方法
3.1引言
特征工程中，能否对目标达到高效率的识别，很大程度上取决于人工经验特 征的正确选取。相应的，在基于示功图分类识别的抽油机故障诊断过程中，选取 的示功图特征参数是否能够体现不同故障类别示功图曲线之间的差异，选取的分 类方式是否合适，决定着能否快速准确地识别示功图，关系到是否能增加油田效 /. ■ • ■
冷O
示功图的整体图形呈一个不规则的封闭曲线形状，基于这点考虑到可用的有 常用的图像识别的特征提取方法，如矩特征提取、傅里叶描述子和灰度矩阵等， 但是这些特征又存在各自的优势与局限性，因此是否能够精确的完成示功图分类 识别的关键在于提取的目标特征是否能够准确有效的描述不同示功图故障类别 间的差异。
本章首先通过对常用的示功图特征提取方法进行分析总结，选取了合适意义 的特征后，为了解决传统特征提取方法的局限性，本文对比选取了合适的方法对 特征融合提取，通过分类对比验证特征融合识别示功图方法的效果。此外，此部 分研究工作也为后面基于深度学习的示功图识别方法提供性能对照。
3.2常用示功图特征提取方法分析
特征向量作为分类模型算法训练的输入数据，选取的特征对于抽油机故障诊 断的准确率有着很大的影响。针对本章的目标，特征提取是特征工程的关键步骤， 本文首先需要对常用的特征提取方法分析总结，根据实际需求以及各自优劣来进 行选择。目前用于区分常见示功图的特征主要有图形矩、差分曲线、链码、傅里 叶描述子、灰度矩阵统计量等。
差分曲线法［幻，是把示功图的上下冲程分离开，然后将上下冲程曲线进行做 差取绝对值处理得到一条差分曲线。因为正常工况的示功图上下冲程载荷具有对 称性，呈平行四边形图样，所以这样得到的差分曲线就能够代替示功图的图形特 征，该方法好处在于计算方式简单，能够快速获取差分曲线，但是不适用于对称 的故障类型示功图的特征提取，例如结蜡。
基于链码的特征提取法【36〕，链码在简单图像轮廓提取中使用较为广泛，最常 用的是八方向链码，即使用0到7共八个数字，依次表示上、下、左、右、左上、
19 左下、右上、右下这八个方向。示功图链码特征提取的思路是先将示功图进行归 一化处理，然后用链码从起点开始依次表达出定长线段的方向，这样得到的数字 集合就是示功图的链码特征。该方法同样易于计算特征，但是只能提取简单的轮 廓特征，并且对图像噪声的影响非常敏感。
傅里叶描述子法［珂，示功图的本质其实是一条二维封闭曲线，通过微积分将 它表示成一个复数形式的函数，由于曲线的封闭性，这个函数一定具有周期性， 因此可以通过傅里叶级数展开运算，计算得结果中的系数项Z(Q就是特征向量， 根据微积分可知，任意函数都能被傅里叶级数无限逼近，当维度取的越高，因此 傅里叶级数就能够更贴近的表达原函数，也就是说傅里叶描述子更能够表达曲线 的特征，它们能够表征示功图不同种类曲线的特点。该方法的优点在于通过微积 分的方法，将示功图识别的二维图像问题转化成了一维频域问题，在后续的分类 中只需要对描述子的差异进行识别分析即可，但是对所有坐标点进行傅里叶级数 变换的计算量还是较大的。
灰度矩阵统计量法郎】，对示功图的灰度矩阵进行统计计算得到特征向量，首 先需要对示功图进行预处理，将图形转化成灰度矩阵，随后根据等高线原则对示 功图内划分出的等大小网格进行赋值，得到灰度矩阵就可以计算出其灰度统计特 征。这六个灰度统计特征就能够很好的描述示功图的图形特点，该方法比较适用 于图像的细致纹理特征描述，缺点是需要对每个像素点进行计算，需要的计算量 较大。
矩特征向量法［3刃，其本质是统计学意义上坐标点分布情况的数学期望，是图 像轮廓识别的重要特征参数。这些矩特征向量通常用于描述了封闭曲线各个方面 的几何特征。该方法的优点在于抗噪能力强、图像描述能力强、信息冗余度低， 但是图形矩是从图形的全局轮廓出发来提取特征，对图形局部特征的描述上还是 有一定缺陷的。
综上所述，从各个算法的复杂度和准确率两方面进行综合考虑，本文选择矩 特征提取法进行特征提取，但考虑到弥补其全局局限性。可以通过示功图坐标点 来计算出各个冲程的一些工程参数，如平均载荷，冲程长度等。这些参数和矩特 征值通过特征融合算法，共同构成的特征向量能够充分的体现示功图的特征，作 为人工神经网络的输入进行训练诊断，能大大提高检测的准确性。
3.3示功图特征参数提取
3.3.1矩特征向量提取
矩在概率论中，一般是用来表示随机变量的分布情况，在特征工程中，它一 般是用来作为描述图像的一组数字特征，是图像轮廓识别的重要特征参数，可以
20
根据此特征来对图像进行分类识别等操作。而在图像识别中，使用最多的是由 M.K.HU提岀的具有尺度、旋转、平移不变性的七个归一化的中心矩，简称Hu不 变矩［呵。但是从第二章的分析中可以知道，当抽油杆收到各种载荷的影响时，示 功图的可能会发生旋转，这也能为抽油机故障定位提供信息。因此选择采用中心 距，以保留其旋转特性。
给定一个二维图像连续函数/■("")，因此图像的几何矩和中心距分别可以通 过式3-1和式3-2计算得到：
mpq = ff xpyqf(x,y')dxdy p,q = 0,1,2,...	(3-1)
Mpq =	- x0)p(y - y0)qf(x,y)dxdy p,q = 0,1,2,...	(3-2)
其中矩心(Xo,%)表示为式3-3。

而对于几何矩和中心距的离散形式如式3-4和式3-5。
mpq = Zy=! xpyqf(x, y) p,q = 0,1,2,...	(3-4)
l^pq = Sz=iS?=i(^ - x0)pO -	= 0,1,2,...	(3-5)
归一化中心矩则可以通过式3-6来计算。
ypq =嚳	p + q = 2,3,...	(3-6)
中心矩进行特征表示，具有平移和旋转不变性，在进行归一化后正好适用于 示功图曲线的识别。
M.K.HU提出的具有尺度、旋转、平移不变性的七个归一化的中心矩，这些 矩特征值在连续图像条件下可以保持归一化中心距的性质，具体计算方式如式3-
7到式3-13 =
加[0] = r]20 + 耳02	(3-7)
hu[l] = bo - Uo2)2 + 4硏 1	(3-8)
加⑵=(773O - 3??12)2 + (3)721 一 ％3)2	(3-9)
/m[3] =(U30 + U12)2 + (力1 + Uos)2	(3-10)
hu[4] =(7/30 - 3弘2)©30 + 加2)[(可30 + Ui2)2 - 3(^21 + ^03)2]
+ (3血1 一 ％3)(血1 +%3)[3(殆0 +加2)2 一 (屉 +%3)2]	(3-11)
hu[5] =(7720 - 耳02)心30 + U12)2 - (^21 + 帕尸]
+4%1(430 + 012)(021 + %3)	(3-12)
hu[6] = 3(耳21 一 ％3)切21 + 耳03)[3(乃30 + 加2)2 - (1?21 + 加尸]
一©30 一 3%2)0721 + %3)[3切30 + %2)2 一 (耳21 + %3尸]	(3-13)
21
因为中心矩具有缩放和平移不变性，并且对于旋转仍然保持敏感性，本小节 将选用式3-14到式3-20这七个中心矩来作为示功图的矩特征向量。
“20 = Zx=iXy=i(x - x0)2f(x,y)	(3-14)
^02 = Xx=iZy=i(y - yoyfCx,y)	(3-15)
心1 = SiLiSy=i(^-x0)(y-y0)/(^y)	G-16)
P-30 = Zx=ily=i(x - x^f{x,y}	(3-17)
“03 = EiU 爲=1O-为)于(x，y)	(3-18)
“2i =工爲爲=iO - %o)2(y - yo)f (s)	G-19)
血2 = S^iEy=i(^-^o)(y-yo)2/(^y)	G-20)
首先，读取在第二章中处理好的示功图数据，将生成的示功图以图片文件形 式保存。此时的原图像是0-255像素的灰度图，在这里利用到了常用的OpenCV 视觉库，能够简洁高效的准确实现对图像的处理。本文共进行了两步处理，第 一步是图像的二值化，它是指将图像转化为灰度值只有0和1的图像，首先需 要选择一个的目标阈值，这里实验中设置的阈值是127,在灰度图中每一点像 素值大于等于127的就替换成1,小于127的就替换成0o第二步是图像的细 化，其实就是对二值图像进行轮廓细化，使得图像的轮廓即示功图曲线的像素 连续，便于提取。
随后对完成图像预处理的示功图进行特征提取，计算其七个图像中心距，得 到示功图的矩特征参数，组成7维矩特征向量，举例如表3-1所示。
表3-1部分矩特征向量
类型
q)l
(p2
q)3
(p4
cp5
(p6
<p7
泵下碰

抽油杆断脱

固定阀漏失

结蜡
双阀漏失

游动阀漏失

正常工作

柱塞脱出

3.3.2工程参数的提取
3.3.1小节是将示功图诊断从常规图像识别的角度来考虑，从常用特征方法 中选取了更为合适的矩特征方法来提取了特征向量。但是这不足以完整的来体现 一个示功图的物理含义，本小节将从示功图的实际工程物理含义入手，选取一些 有区分价值的工程特征参数，来补充3.3.1小节的特征向量的局限性。
考虑到在第二章中对示功图进行了归一化处理，因此封闭曲线的周长和面积 应当是很好的备选参数，其次在物理含义上，示功图是在一次完整抽油运动中的 位移载荷曲线，所以上下冲程中的平均载荷是最能直观从数据上来反馈示功图之 间的区别的参数，故选用了式3-21到式3-27这些工程参数，注意所有参数都进 行了统一归一化处理。
面积：0] = S/Smax
(3-21)
周长：。2 =厶/厶max
(3-22)
扁平率：O3 = Tup - T'd.own/T'max
(3-23)
周长比：。4 = OJO2
(3-24)
平均承载动力：。5 = Taver/Tmax
(3-25)
上冲程平均载荷：06 = Tup/Lup
(3-26)
下冲程平均载荷：07 = Tdown/Ldown
(3-27)
在选取好工程参数后，将示功图转化成黑白二值图，再直接提取出示功图的 白色轮廓（黑底），按照物理意义对其工程参数进行计算，举例如表3-2所示。 这样做的好处在于使用了示功图曲线中的所有点，在提取特征的时候也能尽量把 因为不同情况随机波动的点带来的影响给计算进去，为后续的模型增强鲁棒性。
表3-2部分工程参数特征向量
类型

泵下碰
抽油杆断脱
供液不足
固定阀漏失
结蜡
气体影响
双阀漏失
游动阀漏失
正常工作
柱塞脱出
3.4示功图特征融合算法
前面提到，示功图的分类识别会因为示功图特征提取方法的差异而有所不同, 对于不同种类抽油机故障对应的示功图，各个特征集在识别性能和效率上也有所 差异。因此需要通过融合不同的特征来提升最终的故障识别效率，选择合适的特 征融合算法来获取当前示功图集的特征向量则是重中之重。本小节将分析不同类 别的特征融合算法并选择合适的算法对3.3小节提取的不同特征进行处理。
3.4.1决策层特征融合算法
在决策层进行融合处理特征，其流程是前期可以通过不同的方式来提取特征 向量，经过分类器的训练和识别，得到对于各类特征的识别结果，最后釆用一定 的融合规则，将这些识别结果统一成为最后的判决结果。针对本文的任务，基于 决策层的特征融合算法可以如图3-1所示。

图3-1基于决策层的特征融合算法
假定提取到的特征类别有?I类，将这”类特征分别输入到n个分类器中进行训 练，再用测试数据得到m类分类结果，则测试数据的识别概率可以用= 表示。再根据具体定义好的规则，一般有求和、求最大值和求积 三种，对这些识别结果进行计算处理，最后可以得到m种不同分类结果的概率分 布，在这些分类结果集中选取一个概率最大的作为最终判决结果。其中根据决策 层融合规则得到的新判决概率幻(町的计算方式可以采用如式3-28： qj(k)=q：(k)/導(町	(3-28)
其中，/代表第)个测试数据，$的的计算公式为式3-29：
这里的R函数代表的是决策层融合的规则。
3.4.2特征层特征融合算法
基于特征层的特征融合算法，就是在示功图经过预处理并且提取不同特征后, 将不同的特征联合在一起，以串行、加权叠加或并行的方式构成新的特征向量， 再用新的特征向量作为输入来训练和测试分类网络，得到最后的判决结果。针对 本文的任务，基于特征层的特征融合算法可以如下图所示。
与决策层特征融合算法相似的是，算法前几部分对于示功图的预处理和特征
24
提取过程是一致的，但是特征融合的阶段是不一样的。特征层特征融合的方式相 较于决策层特征融合有着更高的效率，因为是在特征阶段进行融合，不需对应不 同特征提取方法训练多个分类器，只需要将融合后的特征集输入到单个分类器中 训练测试即可。此外，在对特征进行融合之前，还可以加入特征选择方案来降低 融合特征的维度以避免维度太高带来的高时间复杂度和计算复杂度。
主成分分析(Principal Component Analysis, PC A)和典型相关分析(Canonical Correlation Analysis, CCA)是在特征层来处理融合特征的经典方法。设目前存在 两类需要融合的特征集?1 =仙卫2,	和特征集B = ｛加,虬•••，如，若采用串行
融合，得到新特征向量可以表示为：｛a】,a,.・,％加,方2,•••，$•｝,若采用加权并行融 合，得到新特征向量可以表示为：仙耳,...,a”abi，ab2, ...,abj｝。
因为考虑到实际应用边缘端算力不足的问题，特征层融合相较于决策层融合 方法更易操作，得到的特征集也有更健壮的表达性，所以本文中示功图特征融合 选用了如图3-2所示的特征层加权并行融合算法。

图3-2基于特征层的特征融合算法
经过本小节的工作，利用3.3节中将示功图提取出的位移载荷特征和图像矩 特征，融合成14维特征矢量备用，即每一张示功图被一个14维特征矢量表征， 用来作为输入分析目前使用的基于示功图特征工程的抽油机故障诊断方法。
3.5基于融合特征的示功图分类诊断模型
在完成特征提取的准备过程之后，需要对其进行分类来验证这样做法的准确 性。支持向量机和深度神经网络都是很好的分类方法，其中支持向量机［何是属于 机器学习的范畴，它是由Vapnik提出的一种适用于二分类的模式识别的理论， 支持向量机善于根据有限的小样本信息，在高维空间下通过高维平面对于二分类 问题进行求解，在可控范围内尽量使得高维平面两边的数据间隔最大，以此来获 得最好的泛化能力。
支持向量机的简要原理如下，首先在高维样本空间中取一个如式3-30的超 平面。
wTw + a = 0	(3-30)
其中超平面的法向量可以表示为vv = (Wj； w2; w3;o通过投影法， 可以根据式3-31直接计算出特征空间中任意一点x到超平面(iv,a)的距离。
25
d = \wTx + a|/||w||	(3-31)
上面提到了数学上的投影法，而在支持向量机算法中，通过与内核函数K(* ,*)进行运算就代表了高维空间的投影。这样避免了投影的角度余弦值计算，在一 定程度上减少了计算量。其中最常用的是径向基核函数，计算方式如3-32式， 通过它的计算可以把样本投影到高维空间中。
K(x,y) = exp (―y|x — y|2)	(3-32)
经过原理的探究可以知道，支持向量机更适合小样本二分类的学习范畴，一 般是对正常样本和异常样本的分类，如果要构造SVM多分类器，实际上是通过 组合多个基本的二分类器，每增加一个二分类器，多分类器就能多增加一种类别 的输出，这样在类别越多的情况下，网络会越显得十分复杂，而且在参数过多的 情况下，对多分类SVM的训练优化需要的计算资源较多且难以收敛。由此来看， 支持向量机并不是很适合本文中的示功图故障诊断的多分类任务。
示功图的类别较多且可能有类别数目不确定的可能性，而在分类任务上，深 度学习网络是在感知机的模型上做了扩展，可以通过全连接层的权值梯度下降优 化训练，来学习输入和输岀类别之间的复杂函数关系，根据需要也可以设置多个 隐藏层来增加模型的表达能力，输出方面，和SVM不同的是，深度学习网络天 生就适用于多分类的目标，只需要将输出层连接的softmax层设置为需要的类别 即可。
除业之外还有可以根据实际需求，在各个隐藏层使用不同的激活函数，来控 制神经网络中参数的流动，训练出更符合问题需求的模型。
DNN神经网络［创训练过程中逐层计算出样本的输出作为下一层的输入，并 计算各隐藏层的梯度，以此来更新全连接层中各个神经元之间的连接权和阈值， BP算法是最经典的训练方法，普遍认为，DNN神经网络可以通过训练拟合任意 形式的函数公式，所以它也是模式识别领域中最简洁常用有效的方法之一。
因此选择DNN对提取的特征进行分类。其中各层各节点与上层各个节点都 互相连接，源空间与目标空间中的所有节点都相关联。每一层的计算公式如式3- 33 和 3-34：
V = cy(wx + b)	(3-33)

x代表全连接层的输入，w是权重，b是偏移量，。是激活函数。其中£是把模 型最终输出对应给类别i的判别概率。在深度神经网络中，将全连接层最终与 softmax层结合，输出最终的结果分类。
表3-3列出了网络结构各层的规格。输入是前文通过每个示功图的特征提取
26
获得的14维特征向量。
表3-3 DNN网络结构
网络层
激活函数
维度
Input
-
14
HiddenLayer
Relu
32
HiddenLayer
Relu
16
Output
■
10
在有了高维特征矢量的输入后，通过误差逆传播算法［创来训练模型。
3.6实验结果与分析
为了验证特征融合提取出特征向量分类的有效性和准确性，本文设计了如下 的对比实验：使用训练集，通过特征工程的预处理，获取矩特征向量集，工程参 数特征向量集，融合特征向量集分别训练一个结构层次相同的DNN分类网络， 再利用相同的测试集去进行相应的特征提取后测试。
如图3-3到图3-5是三种特征各自的测试准确率，从图3-3中可以看到图形 矩特征的平均测试准确率在87.4%,观察各个类别的准确率可以得知，大部分类 别的准确率在90%左右，但固定阀漏失和游动阀漏失这两个类别的识别准确率 较低。参考第二章的示功图故障关系分析可以知道，这两个类别的故障在示功图 上是存在着一定的相似性，即都是缺失边角部分功图，只是位置不同，这验证了 图形矩特征的全局局限性。
从图3-4中可以看到工程参数特征的平均测试准确率在83.9%,观察各个类 别的准确率可以得知，大部分类别的准确率在80%左右，但是对抽油杆断脱和结 蜡这样的位移载荷关系特别明显的类别识别准确率很高，整体拉高了识别准确率。
从图3-5中可以看到图形矩和工程参数的融合特征的平均测试准确率在 90.6%,比图形矩和工程参数特征都有所提高，结合图3-6来看，融合特征的大 部分类别都比融合前的特征识别准确率要高，只有在部分类别如固定阀漏失等差 异较大的类别时，可能会被影响准确率，但是整体上来看特征融合算法还是达到 了对各个特征取长补短的目的。
27



图形矩特征测试准确率
泵下碰n 抽油杆断脱- 供液不足- 固定阀漏失- 结蜡- 气体影响- 双阀漏失- 游动阀漏失- 正常工作・ 柱塞脱出-泵下碰
抽油杆断脱-
Predicted label
图3-3图形矩特征测试准确率结果
工程参数特征测试准确率

供液不足-

固定阀漏失-

气体影响-

双阀漏失-

游动阀漏失■

正當工作-

柱基脱出-


0. 91 liliM
图3-4工程参数特征测试准确率结果

融合特征测试准确率
泵下碰-Era



.图3-5融合特征测试准确率结果
不同特征各类别测试准确率对比

-•- hu图像矩特征 工程参数特征 融合特征


图3-6各类特征測试准确率结果对比图
从实验结果总体来看，在差异较大的示功图之间，传统特征分类的方法是非 常有效的，尤其是利用特征融合算法将各个特征融合后，能够使不同特征互相弥 补缺点，达到更优的识别准确率。但是特征工程的方法在某些特定近似的故障类 别示功图上的准确率不高，因此本文将在后面的工作中利用深度学习的方法来解 决这个问题。
29
3.7本章小结
本章先对目前常见的示功图诊断的特征提取分类方法进行了深入的分析理 解，总结了各自方法的优势与不足之处，对比之后选用了矩特征值以及示功图的 工程特征参数来对全局局限性进行补充，并针对前人工作中在示功图特征提取时 选取特征的考虑上进行了改进，通过对比选择了适合示功图识别场景的特征融合 算法进行了融合特征，完成了基于示功图融合特征的故障诊断方法，分析出了目 前特征工程方法的优势与缺陷，为后面的研究提供了方向，也为后面基于深度学 习的示功图识别方法提供性能对照。
30
第四章基于示功图深度学习的抽油机故障诊断方法
4.1引言
前面章节提到，目前常用的示功图特征提取故障分类诊断的方法总体上能够 完成一定的示功图识别分类任务，但是在识别不同类别的相似故障示功图的情况 下，即使通过特征融合的方法有一定的改善，但还是存在一定的错误率。因为特 征提取毕竟还是受限于人工先验知识。因此，本文希望通过深度学习的方法，直 接从示功图的图形中自适应学习特征。
示功图识别的本质其实还是图像识别，从这个点出发，考虑到卷积神经网络 能够通过卷积运算来对图形的局部特征进行提取。但是不同于常规的手写数字或 者物体识别，为了解决一些相似类别的示功图的识别问题，还需要精准的识别出 示功图的细微变化，来判断抽油机的故障原因。本部分通过借鉴经典的卷积神经 网络Lenet-5[44], VggNet〔4习以及Alexnet[46]的结构思路，在多组对比实验的基础 上，针对于卷积核、初始学习率及网络结构层数等参数对模型的收敛与性能影响 进行了深入探究，构建了适用于示功图分类识别诊断抽油机故障的网络模型，达 到能够识别出示功图在不同工况下发生细微变化的目标，并对比设计了自编码器 编码层的参数初始化方法，进一步提升了模型的收敛性能。
4.2面向示功图识别的网络结构分析构建
为了构建出针对示功图分类识别的抽油机故障诊断模型，在设计的过程中， 网络结构通过借鉴经典的卷积神经网络Lenet-5, VggNet以及Alexnet的结构思 路，参数对比涉及到了卷积神经网络的卷积核大小、初始学习率、网络层数深度 以及网络的初始化方法。
Lenet-5是计算机科学家Yarn LeCun等在1998年提出的卷积神经网络，其 网络结构设计是将卷积层和池化层的组合并重复连接，每经过一层这样的组合， 就将图像的特征进行一次卷积提取，池化降维，经过一系列这样的过程，可以将 输入图像逐步转化为的低维特征，并且最后将这些特征传递给全连接的神经网络, 以softmax层对图形进行分类，训练方式则是采用了有监督的反向传播算法。而 卷积神经网络中用来实现感受野的概念其实就是通过与卷积核进行运算的过程。 AlexNet是2012年Alex等人提出的,相比于Lenet-5这类基础的卷积神经网络， 它有了更深的网络结构并支持多cpu计算，加速了卷积神经网络的工业化进程。
31
其主要贡献有应用了 relu激活函数、使用了层叠的卷积层以及使用Dropout抑制 过拟合。VggNet是由Oxfbrd的K.Simonyan等人在2014年的ILSVRC大赛上提 出的，它的网络结构在Lenet-5的基础上有了更深和更窄的变化，它是选用了小 维度的卷积核和池化层的组合，使得网络变窄，并用小维度的组合进行重复连接 多次，使得网络变深。主要贡献在于使用小卷积核的堆叠替代大卷积核，减少了 大量参数，并且提出卷积神经网络由于使用relu作为激活函数，适当的权值初始 化对网络的收敛性是非常重要的。
从卷积神经网络的改进发展优化可以看出，CNN的网络结果在往更深更窄 的方向发展，在追求模型准确率的同时追求精简合适的网络结构。本小节将通过 参考CNN发展历程中的经典模型结构，通过调试网络中的各种结构参数，搭建 出针对于示功图识别分类的卷积神经网络结构。
4.2.1卷积核大小对网络性能影响
卷积核也可以叫做滤波算子，图像每一次与卷积核的卷积，都会提取出具有 原图像边缘轮廓特征的新特征图，这即是卷积神经网络中的感受野，而卷积核的 大小决定着运算量的大小、网络参数量的多少以及保留特征的程度如何，因此对 于准确分类识别示功图，用来提取示功图特征的卷积核维度大小也很重要。通过 与卷积核的计算，可以对特征进行提取，摒弃特征外的干扰数据。卷积运算如式 4-1 o
F*G(x,y) =	71) G(x-m,y-n)	(4-1)
其中x, y是输入矩阵的坐标值。
卷积核的大小影响着卷积过程中的粒度，也是卷积神经网络中最核心的一步。 这里先参考了浅层LeNet-5模型的结构，设计了基本的卷积神经网络，具体的网 络结构如表4-1所示。对比实验中，变量为卷积核的大小分别设置为3*3、5*5、 7*7,其他参数统一设置，初始学习率统一设置为0.001,具体的网络结构如表4- 1所示。
表4-1卷积核实验网络结构
网络层
激活函数
维度
步长
dropout
Input
-

-

Convolution!
Relu

2

Maxpooling
-

0

Convolution2
Relu
112*112*64
2

Maxpooling
-

0

Flatten
-
56*56*64
-

FullyConn
Relu
256

Fully Conn
Softmax

Output


1)卷积核3*3
从如下图4-l(a)可以看到，卷积核为3*3的网络经过大约400轮训练后收敛， 准确率收敛在0.897,从图4-l(b)可以看到，网络的loss收敛在0.108,总的来说， 模型的收敛速度较快，最终的loss也稳定在了一个比较低的值，但是测试准确率 并未达到预期的效果，并且波动范围比较大。
Accuracy of baseline	Loss of base Iine

2)卷积核5*5
从如下图4-2(a)可以看到，卷积核为5*5的网络需要大约500轮训练后收敛, 准确率收敛在0.926,从图4-2(b)可以看到，网络的loss收敛在0.093,总的来说, 相比于3*3的卷积核，模型性能明显有所提升，模型的收敛速度虽然变慢，但是
收敛后的模型比较稳定，而且准确率也提升了约3%。

(a)卷积核5*5时准确率	(b)卷积核5*5时损失
图4-2卷积核5*5时模型性能
3)卷积核7*7
从如下图4-3(a)可以看到，卷积核为7*7的网络需要大约400轮训练后收敛， 准确率收敛在0.915,从图4-3(b)可以看到，网络的loss收敛在0.142,总的来说， 相比于5*5的卷积核，模型性能有所下降，和卷积核为3*3时一样，收敛时的模 型仍然处于波动较大的状态，显然性能不符合预期。


(a)卷积核7*7时准确率 图4-3卷积核7*7
4.2.2初始学习率对网络性能影响
初始学习率，即是网络在每一个epoch中前进的间隔，以最经典的有监督随 机梯度下降算法来为例分析，其梯度原理如式4-2。
wt+i = wt-r］活心刃(x,Wt)	(4-2)
其中九是batchsize, 77是学习率，初始学习率如果过小，会导致模型收敛速度 慢甚至无法学习，过大，可能跨过最优解导致模型无法收敛。因此，在本节将使 用搜索法来找到最合适示功图识别的模型初始学习率。
虽然数据集在浅层LeNet-5模型的结构上收敛并整体状态良好，但是最终的 准确率仍不是很符合预期。考虑到可能浅层模型网络的容量较小，不足以表征示 功图的特征，因此参考到VggNet的深层次卷积神经网络，本文考虑采用加深网 络的做法，将卷积层和池化层的组合层叠的次数由两次改为三次。
表4・2初始学习率实验网络结构
网络层
激活函数
维度
步长
dropout
Input
-
224*224
-

Convolution 1
Relu
224*224*32
2

Maxpooling
-
112*112*32
0

Convolution2
Relu
112*112*64
2

Maxpooling
-
56*56*64
0

Convolutions
Relu
56*56*128
2

Maxpooling
-
28*28*128
0

Flatten
-
28*28*128
-

FullyConn
Relu

FullyConn
Softmax

卷积核的大小在经过上一节的实验后确定为5*5,本节实验模型结构整体相 同，只不过多增加了一层卷积层和池化层，进一步提升模型的学习能力，随后再
34
连接了两个全连接层对感受野特征进行降维，最后通过Softmax层进行分类，具 体的网络结构如表4-2所示。
根据上述网络结构，利用搜索法，对于学习率从10的-5次幕到10的0次幕 进行了枚举实验，得到的收敛loss如图4-4o

Learning rate(log scale)
图4-4收敛时Loss和初始学习率关系曲线
从图4-4可以看岀，大约在初始学习率为0.01时，能够获得最低的收敛时 Loss值。下图记录了 learningrate=0.01时的模型收敛曲线，从如下图4-5(a)可以 看到，网络减少到只需要大约300轮训练后收敛，准确率也提高到了 0.966,从 图4-5(b)可以看到，网络的loss收敛在0.0928,总的来说，三层卷积层和池化层 交替的模型性能大大优于两层卷积层和池化层交替。

(a)初始学习率0.01时准确率	(b)初始学习率0.01时损失
图4-5初始学习率0.01时模型性能
4.2.3网络层数深度对网络性能影响
考虑到4.2.2小节加深网络层数为模型提升了性能，参考VggNet考虑能否 再搭建更深的网络以达到更高的识别准确率和更优的性能。在其它参数保持不变
35
的情况下，网络形式仍采用卷积层和池化层交替出现无层叠的形式来构建，这一 节的实验中这个组合的交替次数改为四次，同样利用两个全连接层进行感受野特 征降维，最后通过Softmax层进行分类，具体的网络结构如表4-3所示。
表4-3网络层数深度实验网络结构
网络层
激活函数
维度
步长
dropout
Input
-
224*224

Convolutionl
Relu
224*224*32
2
-
Maxpooling
112*112*32
0

Convolution
Relu
112*112*64
2
Maxpooling

56*56*64
0
Convolutions
Relu
56*56*128
2

Maxpooling
-
28*28*128
Convolution4
Relu
28*28*256
Maxpooling
14*14*256
0
Flatten
14*14*256
FullyConn
Relu
256

FullyConn
Softmax
64
Output
10

从如图4-6(a)可以看到，网络减少到只需要大约300轮训练后收敛，准确率 降低到了 0.944,从图4-6(b)可以看到，网络的loss收敛在0.138,并且有发散的 趋势，总的来说，模型从三层卷积层和池化层的组合改为四层后性能有所下降, 且有过拟合的趋势，因此三层卷积层和池化层的组合是本文的最优选择。

(a)四层卷积层和池化层时准确率	(b)四层卷积层和池化层时损失
图4-6四层卷积层和池化层时模型性能
4.3不同参数初始化条件下识别性能分析
根据VGGNet的实现方式，初始网络权值对于网络后续的训练和收敛影响 都很大。VGGNet中神经网络的权值初始化是采用到了小模型预训练的方法。通 过VGG中层数更少的A模型，进行训练调整，得到网络权值的初始值。然后当需要用到正式的VGG模型时，使用之前已经训练好的A模型的权值初始值，对 VGG模型的浅层进行权值赋值。借鉴此思路，考虑到在第二章中进行自编码器 增强时，选用了卷积自编码器，其编码层正好是简单的卷积层，训练后已经能够 表征部分示功图的特征，因此在本节，将具体研究常见初始化方法和自编码器初 始化对于网络收敛性能，识别率的影响。
常见的初始化方法有Xavier"?】和MSRAH8］初始化。在Glorot提出的Xavier 初始化方法中，主要针对对于每一层网络神经元初始激活值，这些值要满足两条 经验性准则，一是每一层的平均值要保持为0,二是每一层的方差要相同。但是 Xavier的初始化要求神经网络的激活函数关于0对称，但是本章考虑的卷积神经 网络用到relu激活函数，所以暂不考虑Xavier初始化方法。MSRA初始化由 Kaiming提出，只考虑输入的个数n, MSRA的初始化和Xavier初始化不同的 是，针对对于所有网络神经元初始激活值，这些值整体分布满足均值为0,方差 为阿^的高斯分布。
因此在实验得到的基础模型结构的基础上，设计了对比实验共三组，⑴无初 始化组(2)自编码器编码层参数初始化(3)MSRA初始化。
网络采用5*5的卷积核，釆用卷积层和池化层交替构建，卷积层和池化层交 替次数改为三次，随后连接两个dropout层和两个全连接层，最后通过Softmax 层进行分类三组模型的准确率和Loss收敛表现如图4-7。

(a)不同初始化方法下准确率	(b)不同初始化方法下损失
图4-7不同初始化方法下模型性能
可以看到无初始化(随机初始化)情况下，网络大约在400步左右收敛,MSRA 初始化方法下，网络大约在300步左右收敛，而通过自编码器的编码层参数初始 化方法下，网络大约在200步左右收敛。
由此可见，这样的预训练带来的好处是，自编码器的编码层参数已经学习到 表征一部分示功图的特征，随后的训练其实是在这些已经带有示功图特征的参数 上进行微调(finetuning)的过程，这样既能够避免陷入局部最优解，又能节省了 时间和计算资源。预训练能够很好的使得模型迅速收敛，从而只需要微调使模型 更加优化。
4.4实验结果与分析
将事先划分好的测试集放入卷积神经网络故障诊断模型中，获得的准确率结 果如下图。其中抽油机有杆泵示功图数据图中的标签类别从0-9分别为泵下碰, 抽油杆断脫，供液不足，固定阀漏失，结蜡，气体影响，双阀漏失，游动阀漏失， 正常工作，柱塞脱岀。
预训练卷积神经网络模型测试准确率


图4-8测试集在预训练卷积神经网络模型准确率
从图4-8可以看到，总体准确率为96.58%。与传统的特征提取方法相比, 相似类型工作图之间的细微差异具有更好的表示性，基本上对于每个类别只有个 别识别错误，可以更好地完成识别任务。
为了使验证结果更可靠和更有说服力，在本文的测试工作中，还单独使用了 卷积自编码器重建失败的数据集，通过训练后的卷积神经网络诊断分类模型对其 进行测试。测试结果从图4-9可以看到，准确率是86.63%,但是错误类别主要 是在泵下碰和供液不足类别下。
预训练卷积神经网络模型测试准确率
Predicted label
图4-9错误重构数据集在预训练卷积神经网络模型准确率
所以着重从这两类的示功图进行分析原因，通过卷积自编码器的重构图可以 看到，如图4-10,其中左图是输入示功图，右图是重构示功图，首先几乎所有类 别的泵下碰都被错误地判断为正常工作类别，这是因为在重建编码器期间，柱塞 下碰示功图的成因是在下冲程将要结束的时候,.造成活塞下部与卸油器相碰击， 使得抽油杆载荷突然变低，这样在示功图图形的左下角会出现一个小圆圈。对比 可以看到这一点图像特性正好被丢失，因此模型将其判断为正常工作实际上是没

图4・10泵下碰示功图的重构结果
39


图4-11供液不足示功图的重构结果
另外，关于供液不足类别。可以看出，大约1/3的不足液体供应类别被错误 地判断为固定阀的泄漏。当供液不足时，泵筒中的石油原液处于未充满状态，在 这种状态下游动阀不能及时打开，因此示功图曲线的右下角会缺失一块。但是如 图4-11,其中左图是输入示功图，右图是重构示功图，通过重构供液应不足的示 功图可以看出，在重建过程中下冲程线的凹形特征变得不太明显。相比于固定阀 泄漏向下冲程的特性并不明显，因此会出现一定百分比的错误判断。所以图4-9 中对于重构数据的分类诊断率不高，是符合理论分析的预期的。
通过以上对比分析，可以证明本章设计的卷积网络模型能够很好的学习到示 功图的细节，准确率可靠且相比于主流特征提取方法会高出很多。此外还通过自 编码器样本增强，使得模型对不同示功图类型的随机变化有着更强的鲁棒性，利 用参数初始化大幅降低了网络的收敛时间。很好的实现了笔者的初衷，构建基于 卷积神经网络的示功图诊断方案，能够自学习知识库中各种示功图特性，达到不 依赖于人工经验实现示功图诊断的目的。
4.5本章小结
本章根据在示功图的图形中自适应学习特征的目标，通过总结与借鉴三种经 典的卷积神经网络的结构思路，在大量实验基础上，得出适用于示功图分类识别 诊断抽油机故障的网络模型超参数。并且提出用自编码器的编码层参数对卷积神 经网络分类诊断模型进行初始化，来防止模型过拟合，并且加快收敛速度。对比 经典的参数初始化方案，对训练完成的模型进行了评估，最终得出了适合示功图 分类识别的网络结构，无需依赖人工先验经验特征参数，使得模型更加具备应用 价值。

第五章面向嵌入式设备应用的轻量化示功图深度学习方法
5.1引言
在前几章的工作中，首先对现有常用的有杆泵抽油机故障诊断的方法进行了 总结归纳和分析，通过对基于特征参数的故障诊断分类进行实现，找到了当前方 法需要改进的地方。并使用卷积自编码器解决了样本增强和模型预训练的问题, 构建了基于卷积神经网络的示功图故障诊断模型，获得了良好的诊断分类效果。 但是本文的探究并不止于此，在达到了较好的识别率之后，需要考虑如何才能将 设计的模型，应用于实际的油田生产中，为实际工作增加效益。因此还有两个问 题亟待解决，首先，在实际生产工作环境中，计算机或者边缘端的硬件设备，其 处理性能及配置老旧，肯定无法和建模使用时的服务器性能相比，第一个问题就 在于，如何使得模型能在保证准确率的情况下，尽可能的减少计算量，加快计算 速度以提高实用性。其次，由于油气采集实际的工况环境恶劣，抽油泵可能会存 在各种意料之外的故障，即第二个问题在于，如何提升模型的鲁棒性，在边缘端 不断的诊断过程中，还能够学习到新类别的示功图知识，而不是收集数据后按标 签重新训练并部署在边缘端，这样会使得实际模型的可用性大大提高。
为了模拟边缘端嵌入式设备的计算能力不足的情况，以验证本章设计的模型 轻量化高可用方案的可靠性，本章的实验选择在嵌入式设备上完成，在这里选用 了最具有代表性的树莓派作为部署设备。

5.2所采用的嵌入式设备平台简介
可以搭建深度学习模型嵌入式设备有不少，通过联网也可以实现访问互联网 的服务，在本小节中将对比一些物联网嵌入式设备，来选用一个合适的设备作为 测试平台。
首先考虑到了树莓派⑷］（Raspberry Pi）,它是在2012年推出的一款面向科 研教育的小型、功能强大、价格较低的卡片电脑主板。它的工作方式与标准PC 相同，需要一个输入命令的键盘、一个显示器和一个电源。这台信用卡大小的计 算机具备所有基础功能，是与许多设备接口的完美平台。该系统的绝大多数组件， 包括中央和图形处理单元、音频和通信硬件以及256MB （A型）或者512MB （B 型）内存芯片都内置在单个主板上。Raspberry Pi的处理器是一个32位、700 MHz 的芯片系统，它基于ARM11架构，可以超频以获得更大的功率。SD闪存作为Raspberry Pi处理器的内存硬盘，此外，树莓派通过micro USB接口供电，而互 联网连接可以通过以太网接口或WiFi连接。
Raspberry Pi和计算机一样，使用的是操作系统。官方出品的Linux系的 Raspbian系统是非常适合Raspberry-Pi,也保持了免费和开源，也可以按实际需 求选用一些非Linux操作系统。
其次考虑到了 Arduino.,它的输入可以是连接在主板上的各类传感器信号， 然后根据编程好的程序输出相应的数字信号，来控制与周围环境的交互。Arduino 支持两种工作模式，独立或通过USB线连接到计算机。Arduino的主要用途在于 物联网的需求，可以通过编程对于各种传感器等装置进行智能控制，因此不太符 合本文的目标。
再对比了 BeagleBoneBlack,它是基于低功耗德州仪器处理器的单板计算机， 价格较贵，使用AR Cortex-A8内核，它也是一种小型的信用卡大小的计算机， 可以运行Linux/android4.0等操作系统。它和树莓派的主要区别在于，它可以运 行一个小的操作系统，因此实际上可以把它转换成一台可以在这些操作系统上运 行程序的小型计算机。BeagleBone的设计目标功能更高，它的处理能力远远超过 树莓派。
为了验证模型轻量化改进的有效性，本文选择了树莓派作为嵌入式实验平台。 操作系统的选择上，选用了官方的Raspbian,模型环境的选择上，选用了适用于 树莓派的berryconda3,因为相比于miniconda3,前者最高可以支持python3.6的 版本，可以适配tensorflow框架的python3.5以上的环境需求。

5.3基于MobileNet的快速示功图诊断模型
本节借鉴了 MobileNet网络的基本思路，它在卷积神经网络的基础上做出了 卷积层分解并引入了倒残差结构，其目标是为了对CNN的模型结构轻量化以适 应移动端的嵌入式设备。考虑到在第四章中设计实现的模型结构，利用到了三组 卷积层和池化层组合的层叠结构，本章将引入卷积层分解的思路来优化这样的卷 积模型，使其能够在树莓派上完美运行。接下来将详细介绍思路。
MobileNet的vl模型主要提岀了深度可分离卷积的思路，标准卷积其实是 将输入的图像像素矩阵与卷积核直接进行卷积运算获得结果，深度可分离卷积利 用了矩阵论中的矩阵分解思想，把卷积核的矩阵进行分解成为两个小矩阵依次与 输入图像的像素矩阵进行矩阵乘法运算，这样的做法能够在矩阵乘法时节约很多 计算次数，使得硬件需求降低，更适用于嵌入式设备，下面详细分析。假设标准卷积层是输入一个DF XDFX M维度的特征映射F,其卷积核K的 维度为DKXDKXMXN,输入图像像素矩阵与其进行卷积计算，输出成一个 Dp x DF x N维度特征映射G。
按照如上定义，标准卷积的输出特征映射的计算应如式5-1。
(5-1)
因此可以推断，标准卷积层需要的计算量总共为DK XDKXMXNXDFX DF.可以看到总计算量是与上述参数都是乘法关系的。
深度卷积的维度DKxDKxl,逐点卷积的维度是lxlxM。按照上式来计 算，深度卷积层来提取特征需要的计算量总共为DK XDKXMXDFXDF,逐点卷 积来对这些特征进行线性组合需要的计算量总共为M XNXDFXDF.
即用来对标准卷积进行矩阵分解后，总共需要的计算量为：DKXDKXMX DF x DF + M x N x DF x DF。
通过卷积核矩阵分解的方法，将总计算量与网络结构参数的乘法关系改为了 加法关系，这样做比可得减少的计算量大概如式5-2。
DKXDKXMXDFXDF+MXNXDFXDF _ £	1	(5 2)
D^xD^xMxNxDpXDp	N D^2	， )
表5・1深度可分离卷积网络结构
网络层
激活函数
维度
步长
dropout
Input
-
.224*224
-

Dw Conv
Relu
224*224*1
2

Conv
Relu
1*1*32
2

Maxpooling
-
112*112*32
0

Dw Conv
Relu
112*112*64
2

Conv
Relu
1*1*64
2

Maxpooling
-
56*56*64
0

Dw Conv
Relu
56*56*1
2

Conv
Relu
1*1*128
2

Maxpooling
-
28*28*128
0

Flatten
-
28*28*128


Fully Conn
Relu
256
-
0.5
Fully Conn
Softmax
64
-
0.5
Output
-
10
-
-
在本节的工作中把第四章的模型结构建立在本节提到的深度可分离卷积上 进行了更新，模型结构如表5-1所示。除了全连接层的每一层之后都使用到了 batchnorm和ReLU非线性激活函数，最后输入到softmax激活函数进行输出分 类。这里将深度卷积和逐点卷积都设置为单独的层。
此外，尽管基于MobileNet改造后的模型架构已经比较小，本节工作中还引 入了宽度参数a和分辨率参数p来适用于方便根据实际应用需求调整模型的性能。
43 宽度乘数a的作用是将卷积层的输入通道数改变为aM,输出通道数改变为aN, 达到不调整模型结构以控制卷积层大小的目的。分辨率参数Q的作用是在对输入 图像的分辨率进行调整，使得卷积框的大小变为PDF。引入了上述两个调整参数 后，模型的总计算量为：DKX DKX aM x pDF x pDF + aM x aN x pDP x pDF.
其中a 6 (0, 1),常用取值是),其中p = 1 时 为基础模型，对应示功图分辨率为224*224,通过调整p<l的值，使得模型输入 的示功图常用分辨率取值为224, 192, 160, 128。引入这两个参数的作用是可以 在几何倍数上将计算量和参数个数减少，按照实际需求对模型进行轻量化，从而 达到适配嵌入式设备的目的。
5.4基于强化学习的自适应示功图诊断模型
在5.4小节，本文基于mobileNet对示功图诊断模型进行了修改，解决了在 边缘端计算设备算力不足的问题。本节工作中将解决模型的鲁棒性问题，即在边 缘端不断的诊断过程中，如何在不重新训练部署模型的前提下，还自适应能够学 习到新的示功图错误知识。
为了更好地促进知识转移和避免灾难性遗忘，在面对一个新的任务，确定每 一层要添加的最优节点数或者滤波器数是一个组合优化问题。本文需要一种设计 精巧的强化学习方法来解决这个问题。首先采用递归神经网络作为控制器来确定 每项任务需要调整的神经网络的最佳结构。在actor-critic策略的指导下训练控制 器，并且通过验证精度和网络复杂性来定义奖励反馈。这可以尽可能地保持对旧 任务的预测精度，同时也降低整体模型的复杂度。
5.4.1强化学习策略制定
强化学习，是指深度学习模型在不忘记如何执行先前训练过的任务的情况下 学习连续新任务的能力，主要目标是克服对所学任务的遗忘，并利用先前的知识 在新任务上获得更好的表现或更快的收敛以及训练速度。
一般来说，主要有两种强化学习的结构用来解决鲁棒性问题，它们的区别主 要在于网络结构在学习过程中是否发生变化。第一类是使用大容量的固定网络结 构。在训练连续任务的网络时，根据模型参数对旧任务的重要程度，采用一些正 则化项来防止模型参数与先前学习的参数偏离过多。FearNet【50】网络通过使用伪 排练Pi】将最近的记忆整合到长期存储中来缓解灾难性遗忘，伪排练使用生成式 自动编码器来生成先前学习的示例，这些示例在整合过程中与新信息一起回放。 Fernando等人阿提出了 PathNet,其中一个神经网络在每一层有十个或二十个模 块，通过进化的方法为每一层的一个任务挑选三个或四个模块。然而，这些方法
44
通常需要不必要的大容量网络，特别是当任务数量很大时，因为网络结构在训练 期间从不动态调整。
另一种是通过动态扩展网络的方法来适应新的任务，与此同时保持原有结构 的参数不变。渐进式网络［53】用固定大小的节点或层扩展架构，导致网络结构极其 庞大,特别是面对大量的顺序任务。由此产生的复杂体系结构可能存储成本很高， 甚至由于其高冗余而不必要。动态可扩展网络(dynamic Expandable Network, DEN) 3〕在向原始网络添加新参数时引入了群稀疏正则化，缓解了这一问题。对 比来看，第一种策略所需的大容量网络并不符合本文的边缘计算目标，因此这里 会选用动态扩展网络的方式。
此外，强化学习最关键的地方在于需要和未知的数据进行交互并对其学习， 在每一步中，控制器观察环境的当前状态吐，根据策略71 CAt \St)决定行为儿， 并观察奖励信号4+1。这就需要制定合理的策略。
在强化学习中，主要常用的策略有两种。从Value Based强化学习方法开始 说起，它的核心是对于下一步调整的动作通过一个价值函数来计算出动作的价值, 随后从可能的动作集中，遍历选取一个最大价值的动作。这就要求动作集必须是 有限个的状态集合，否则遍历法将无法收敛。DQN算法［洌，是对Value Based强 化学习方法的一种改进，由于Value based算法的核心价值函数计算可能会很难 求解，当需要解决的问题数据集变大时，很难遍历计算价值函数，所以用一个Q 价值网络来代替价值函数，这个Q价值网络是需要提前通过反向传播算法来更 新权值，进行训练优化收敛的，这样在实际模型的使用中，新增的动作能够很快 通过固定好参数的Q网络来计算出该动作的价值，便于对比获得最优的下一步 动作。
虽然DQN对Value Based强化学习方法做出了很大改进，但是由于它们遍 历计算价值的共同点，它们同样只能处理有限个状态集合的问题，而在本文的示 功图分类识别目标下，对于大量新增的训练数据，通过遍历无法确定调整网络结 构的方向，所以针对本文的示功图识别目标这个策略是行不通的。
再来看Policy Based强化学习方法，它采取的思路其实是将接收到上一次任 务的状态与即将进行的下一次动作整体视作一个策略，将其用一个函数进行表示, 因为这样的函数通常是不可导的，所以会用到梯度上升法来找到这个梯度函数的 极值，也就是最优策略。
由此看来，虽然Policy based方法能够实现随机化的策略寻找，但是模型很 容易收敛到局部最优解，而且由于策略的随机性，导致会出现很多无效策略的尝 试。
在考虑到两者各有的优劣势之后，本小节决定采用两者合作的Actor-Critic 算法。其中Actor使用Policy Based方法，负责生成示功图分类识别网络结构调 整的随机策略。而Critic使用DQN算法，负责评估的每个网络结构调整策略的 收益价值，并从中选取最大收益的策略作为行动。
其中策略函数的可以被表示为式5-3o
7C0 (s, a) = P(a|s, 8) = n{s, a)
其中价值函数的可以被表示为式5-4和式5-5 =
总结来说，Critic的目标是计算最优价值策略，Actor的目标是利用Critic的 结果来更新参数，这样循环往复，每一次在实际工作中，示功图的新待检测数据 集输入模型分类识别打上标签之后，再通过Actor-Critic方法来实际调整模型的 网络结构，达到持续学习新来知识的目的。
5.4.2强化学习模型构建
在这一节中，将详细叙述强化持续学习［殉的模型的构建。它主要由三个网络 组成：控制器网络、价值网络和任务网络。控制器被实现为一个LSTM网络，用 于生成策略和确定每个任务将添加多少过滤器或节点。这里将价值网络设计为一 个全连通的网络，它近似于状态的价值。任务网络即是用于解决特定任务的任何 感兴趣的网络，在本文中，上一章中设计实现的卷积网络就作为任务网络。
在任务t-1的学习过程完成并且任务t到达之后，使用控制器来决定每个层 应该添加多少过滤器或节点。为了防止对旧知识的遗忘，在新任务到来时，不会 修改之前任务对应的网络权重，只训练新添加的节点权重。在训练了任务t的模 型之后，根据每一层的形状给每个新添加的过滤器加上时间戳。在推理过程中， 每个任务只使用t阶段引入的参数，而不考虑在后面的任务中添加新的节点来防 止知识遗忘。
当任务网络有m层的时候，当面对新来的任务，对于每一层i,需要指定一 个处于0到％ - 1的数来作为添加的神经元的数量。最直接的做法是遍历所有的 组合动作就可以获取第m层网络的最优配置。但是对于m层网络，这样的遍历 法获取最优策略的时间复杂度是。（口£%），这对于深层的神经网络如VggNet和 ResNet是难以接受的。
为了解决这个问题，此处将一系列操作视为固定长度的字符串。可以使用一 个控制器来生成这样一个字符串，表示每层中应该添加多少个过滤器。由于连续 层之间存在循环关系，控制器自然而然就设计为了 LSTM网络。在第一步，控制 器网络接收一个空embedding层作为当前任务的输入（即状态s）,该状态将在训练期间固定。对于每个任务t,将网络连接一个softmax层输出s表示对每个动 作进行采样的概率，即要添加的滤波器的数量。本文以自回归的方式设计LSTM, 上一步中的概率Pt作为下一步的输入。这个过程是循环的，直到得到所有m层 的动作和概率。动作序列血：祝的策略概率遵循如式5-6的乘积法则。
7T(ai：m|s; 8』=H巻 1 Pt，i, a-i	(5-6)
其中直表示控制器网络的参数。
接下来是任务网络部分，在本文中的任务网络是第四章设计实现的CNN网 络，这里将按顺序方式处理到达的T个任务，其中第T个任务的训练集表示为 Dt =仇刃｝亀，验证集表示为％ =仇力｝答，测试集表示为仇=｛兀如曾，对于 第一个任务，把其当做一个标准的监督学习问题来解决，去训练好任务网络。此 处将第t个任务训练好的参数定义为叱°。当第t个任务到达时，第t-1个任务的 最佳参数"上1已经是已知的。随后使用控制器来决定需要添加的网络节点数量 并实现得到一个扩展的子网络，它待学习的参数表示为甌(包括"上1)。新任务 的训练过程如下所示，保持"爲固定，仅反向传播WtWti的新增的参数。这样， 新任务的优化公式可以表示为式5-7o
min
这里使用如式5-8的随机梯度下降法来学习新增加的网络节点，7?作为学习 率。扩展的子网络节点将被进行最多epochs次训练或者达到收敛就停止。然后 在验证数据集％上测试子网络，并返回相应的精度儿。获得最大回报的扩展子网 络节点的参数将是第t个任务的最优参数，将其存储以供以后的任务使用。
为了便于控制器随着时间的推移产生更好的节点调整，这里还需要设计一个 奖励函数来反映每个任务中网络节点调整的表现。考虑到扩展网络的验证精度和 复杂度对于模型都很重要，因此将这两项结合起来设计了第t个任务的奖励公式 如式5-9 o
Rt =血⑸，％祝)+ aCt(iStla1:m)	(5-9)
其中验证集％上的准确率表示为血，网络复杂度表示为G = 一1：巻1他,其中伤 是第i层添加的网络节点数，a是用来调整验证集准确率和网络复杂度的奖励比 例的参数，由于&是不可微的，因此使用策略梯度下降来更新控制器，接下来将 详细叙述。
控制器的预测可以被看成是代表在m层网络中需要添加的网络节点数目的 一系列动作相当于是设计子网络的新结构并且在新任务中进行训练。在子网络收敛或者达到epochs时，控制器用其在验证集上的准确率人和模型复杂度 G通过奖励公式计算出定义的回报俭，以此来对控制器进行强化学习，控制器找 到新任务的最佳增量结构也就等价于如式5-10的最大化预期回报。
丿(比)=Vs/St)	(5-10)
其中&是真值函数，为了加速比在策略梯度上的训练，式5-11利用了以％为 参数的价值网络来近似替代价值U(St；弘)。
ec^R(St, a1:m) - 7(St; 0V))	(5-H)
其蒙特卡洛近似为式5-12 =
汕角 V9clogn(：a^\St-,比)昨4监)-VQSt> %))	(5-12)
其中N是batchsize,对于价值网络，釆用梯度下降法来更新％,梯度可以表
示为式5-13和式5-14o
总结来说，下面是强化学习训练过程的算法流程：
算法1：强化学习算法
输入：t个任务的数据集，D = {Di，D2, D3......Dt} 输出：第t个任务训练完成时候的参数权重Wt。 for i from 1 to T,进行迭代。
if t=l then:
使用6训练神经网络并获取Wf
else：
调整神经网络并获取Wf
end if
end for
48
算法2：网络节点扩展算法
输入：当前任务的数据集前一任务最优网络参数Wfi，每一层网络的结构 rii, epochs Te
输出：
for i from 1 to 7^,进行迭代。
使用controller的策略生成动作0：^
根据血：机以及前一任务最优网络参数"上1，梯度训练网络，获取叫⑴ 评估controller的梯度和生成的价值网络
end for
返回最佳梯度的网络参数"t12 = argmaxwp Rt
5.5实验结果与分析
5.5.1基于MobileNet轻量化性能分析
表5-2到表5-4展示了基于MobileNet改进后的卷积神经网络模型在不同参 数下与改进前模型的对比的结果。首先从表5-2,可以看到，改进后的模型只会 使示功图上的精确度降低约4%,但相比于改进前节省了约十倍的计算量（乘法 和加法的数量）和大量的网络参数。
表5-3中可以看出，在使用到宽度参数a来缩小模型体系结构时，随着模型 约精简（a越小），计算量参数明显下降，准确率也会随之平稳下降，但当a取的 过小，如a = 0.25时，精度下降会比较明显。
表5-4中可以看出，准确率、计算量、参数数量随着分辨率系数下降而平稳 下降，精度在整个分辨率范围内都平稳下降。
表5-2深度可分离卷积和常规卷积对比
模型
示功图分类准确率
计算量（百万）
参数（百万）
常规卷积

深度可分离卷积


表5-3宽度系数a的影响
宽度系数a
示功图分类准确率
计算量（百万）
参数（百万）
9
表5-4分辨率系数p的影响
分辨率系数
示功图分类准确率
计算量(百万)
参数(百万)

5.5.2强化学习改进性能分析
本节进行了一系列的对比实验来评估强化学习模型的表现。包括本文设计实 现的模型和其它经典模型的准确性、模型复杂度和训练时间消耗的比较。这些都 是利用Tensorflow框架在树莓派4B上完成的。
数据集都是在前文的数据集上做了变化以求证强化学习的效果，用到了两种 变化，一是抽油机有杆泵示功图的坐标置换数据集，其中每个任务由坐标的固定 排列转换而成。二是抽油机有杆泵示功图的旋转数据集，其中每十个一组的旋转 角度都是在0到180度之间的固定值。
用来对比的模型有：(l)DNN,跨所有任务训练的单个全连接网络；⑵CNN, 第四章使用到的预训练的卷积神经网络；⑶梯度情景记忆a】 (Gradient Episodic Memory, GEM)； (4)渐进式神经网络网(Progressive Neural Network, PNN)； (5) 本章使用到的动态可扩展网络RCL。
通过考虑所有任务的平均测试精度、模型复杂度和训练时间来评估每种比较 方法。通过训练所有任务后模型参数的个数来度量模型的复杂度。本文首先对比 了各组模型的测试准确率和模型复杂性，结果如图5-1和图5-2。
经过所有任务的平均測试准确率

图5-1测试集在不同模型上的平均测试准确率

图5・2不同模型上的网络参数数量
此外通过固定大小和可扩展网络之间的比较，可以很容易地发现，具有固定 大小网络结构的方法，如DNN、CNN和GEM,具有较低的模型复杂度，但是它 们的预测精度比那些具有可扩展网络的方法差得多，女口 PNN和RCL。这表明动 态扩展的网络确实可以极大地提高模型的性能。

(a)测试集为坐标置换示功图集	(b)测试集为角度旋转示功图集
图5-3不同模型准确率随任务数的变化
为了更好评价我们的模型对旧知识的识别性能。图5-3显示了随着学习更多 任务，对第一个任务测试数据的测试准确度的变化。RCL和PNN表现出基本无 遗忘，而不扩展网络的方法则产生灾难性遗忘。此外，由于GEM在学习新任务 时会重新训练先前的参数，因此不能完全防止遗忘。


(a)测试集为坐标置换示功图集	(b)测试集为角度旋转示功图集
图5-4奖励设计中参数a的影响
测试精度和模型复杂性之间的平衡结果如图5-4所示。本文通过奖励函数中 的系数a来控制模型性能和复杂性之间的平衡。随着a的增加，模型复杂度显著 不降，而模型性能也逐渐恶化。有趣的是，当a较小时，精度的下降要比参数个 数的减少慢得多。这一实验结果有助于在实际应用中根据需求选择合适的a,使 得中等规模的网络仍然可以获得相对较好的模型性能。
5.6本章小结
为了实际的油田生产中示功图诊断模型能够增加效益，考虑到实际工作环境 的硬件计算资源有限。本章首先利用了一种新的基于深度可分卷积的模型结构 MobileNet,通过对卷积层计算的矩阵分解，在可接受的合理的精度降低范围内， 大大减少了模型参数的数目大小和训练时间。此外，考虑到在实际工况中，可能 出现训练过程中没有遇到过的示功图故障，本文设计了持续强化学习的方案，该 方案通过强化学习为下一个任务寻找最佳的神经网络结构，对新知识持续学习， 并且通过不改变旧网络节点的权值来有效地防止知识的遗忘。实验表明，本章设 计的方案在识别准确率略微降低的前提下，在模型复杂度方面显著优于第四章构 建的模型，能够适用于嵌入式设备的实际应用。

第六章总结和展望
6.1论文工作总结
本文的研究目标是通过对示功图的分类识别，完成对抽油机故障原因的分析 与定位。首先提出目前示功图故障诊断的方法存在的问题，如特征提取的方法太 过于依赖人工经验，在处理新增示功图故障类别的时候准确率较低，在实际工作 中深度学习的方法边缘计算能力不足等。针对以上问题，基于深度学习完成了自 适应强化学习新知识的示功图快速故障诊断方法，具体研究内容如下。
首先，针对示功图识别中的传统常用复杂特征，进行了全面的总结分析。常 用的传统示功图的特征识别方法有根据示功图的图形特征或者实际物理意义，计 算出图形矩特征、傅里叶描述子特征、灰度特征及生产参数特征等参数，以此来 确定增载、卸载等关键位置的分布与上下冲程的形状，从而确定抽油机的实际工 作状态，判断故障发生的位置。这种方法对常见的典型示功图识别比较准确，但 不能保证对各类工况都有很好的识别，训练出的识别模型的鲁棒性较差，而且对 于人工先验知识的比较依赖。在本文的工作中，在特征的选取上除了包括图像识 别非常有效的图像矩特征，还用位移载荷的工程参数来弥补图像矩的全局局限性。 利用OpenCV计算机视觉库对示功图进行了轮廓提取处理，准确的完成对上述 复杂特征的提取，为了提高传统特征识别方法的准确性，通过对比分析选取了合 适示功图识别目标的特征融合方法，对各个特征进行了处理，通过分组实验，得 出特征工程方法存在过于依赖人工先验知识的结论，也对比验证了特征融合识别 示功图方法的有效性。
其次基于示功图的抽油机故障诊断领域并没有权威统一的公开数据集，从某 油田获取的实际示功图样本是比较少的，示功图在抽油机的样本有限，因此在对 示功图的深度学习方法研究中遇到了小样本问题，本文通过对比样本增强的方法, 选取了自编码器作为示功图样本增强的方法，解决示功图的小样本问题，为后续 研究提供了完备的数据集。
为了达到无需人工先验知识实现示功图诊断的目的，考虑到利用卷积神经网 络通过非监督学习对示功图图形特征进行自行提取。但不同于常见手写数字识别 或物体识别的目标，示功图识别需要模型对于示功图曲线的细微变化有分辨能力， 因此本文通过参考经典模型，设计实验与网络结构，对比分析了卷积神经网络结 构参数对模型性能的影响，设计了适合示功图分类识别的网络结构，并且通过对 比不同的参数初始化方法，进一步提高的模型训练和识别性能。

在实际生产过程中，边缘端的计算机设备硬件配置和计算资源肯定远远差于 实验室服务器环境，甚至可能是嵌入式设备，因此模型落地移植应用前，最亟待 解决的问题就是对模型的轻量化改进，使其在性能基本保持的前提下，能够在低 计算资源的嵌入式设备上运行。基于这个目的出发，借鉴了 MobileNet网络的基 本思路，它在卷积神经网络的基础上做出了卷积层分解并引入了倒残差结构，其 目标是为了对CNN的模型结构轻量化以适应移动端的嵌入式设备。通过借鉴其 思路，对标准卷积过程进行了矩阵分解优化，在性能基本保持的前提下，很大幅 度降低了参数量和计算量。
最后针对实际应用情况中，每一次新的识别任务，都可能会带来新的未学习 数据，为了保持模型的鲁棒性和高可用性，设计了通过强化学习来对新数据进行 学习并对模型进行微调的方案，在此过程中，还需要保证模型对旧训练数据的记 忆。基于策略的算法的训练过程需要单独对策略函数进行更新，导致收敛较慢。 而基于价值的算法对连续动作以及随机策略的处理能力不足。因此本文采用了结 合策略和价值有两种方法优点的Actor-Critic强化学习策略，来设计了适合嵌入 式设备的强化学习方案，并给出了参数调整的性能对比，以适配不同的实际需求。 6.2论文下一步工作方向
在本文研究中，示功图实质上是抽油机深井泵拉力和位移在一个冲程内的闭 合曲线，目前本文主要针对了十种常见的示功图故障做了诊断分类实验，在后期 工作中，将关注更多的示功图故障类型，提升模型的鲁棒性。并且由于边缘计算 的需求，舍弃了一部分的精度需求，在嵌入式设备树莓派上对模型进行了验证， 未来还需要在真实的油田工作环境下进行实验，以进一步验证模型的高可用性， 并做岀相应的调整和完善。

参考文献
[1] 李斌，刘伟，毕永斌，等.智慧油田建设与发展[J].石油科技论坛，201& V.37;NO.193(03):51-56.
