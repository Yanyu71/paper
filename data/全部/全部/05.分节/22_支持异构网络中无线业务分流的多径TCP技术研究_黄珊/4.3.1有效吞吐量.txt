4.3.1有效吞吐量
MPTCP可以通过在多个路径上同时传输数据来为应用层提供聚合的带宽。 而MPTCP的有效吞吐量定义为：利用MPTCP有序交付到应用层的数据吞吐量。 计算公式如下：
size of N in-order packets	一 八
goodput =			 ( 4-6 )
Total receving tim e of N packets
我们通过两个典型的MPTCP场景来找出影响有效吞吐量的关键因素。假设 为两个可用路径。定义函，为MPTCP发送端对于路径i的发送间隔，即前向时 延。定义路径，的端到端时延为。,，则R即路径1的吞吐量大于路径2 o 假设一个包含N个数据分组的数据块具有连续的DSN序号，这其中N - 1个分组 从路径1发送，只有1个分组从路径2发送。这样的一个数据块分组被称为一个 有序的数据单元。定义S为以最大数据分组大小(MSS)为单位的总数据分组大 小。定义T为有序数据单元的总到达时间。则有效吞吐量的计算公式为 G = S 丨 T。
37
MPTCP源端
如图4-1所示：一个有序数据单元包含四个数据分组，DSN序号分别为1、
2^3和4,假设分组1和分组2在路径1和2的发送时间相同。AZ> =| D,- D21>	,
我们可以获得TdD并且有效吞吐量的计算公式为：
S Ar, / Ar. 4-1
G = _=	——1—
T \D
图4-2则是另一个场景即=| Q - d2 \< M。这种情况下，MPTCP需要更
少的时间来收到这个有序单元内的所有的分组，总时间为路径1收到所有N-1 个分组的时间，则有效吞吐量为：
S Az, / Ar, +1
G 		?	!—
T A/2	、，
公式（4-8）就是两条路径的聚合吞吐量（用A表示），实际上，这也是MPTCP 的最优吞吐量：
(4-9)
38
综上可知，有效吞吐量是端对端路径延迟差△。成反比的。两个路径之间 的时延差越大，则MPTCP接收端需要在有序内收到的所有数据包的时间越长， 而有效吞吐量更小。为了接近或达到有效吞吐量的上限(所有可用路径的总吞吐 量)，我们需要尽量减少传输路径之间的端至端延迟差。
由于交付时延对有效吞吐量有较大影响，首先来进行交付时延的预测：
定义预测交付时延(Estimated Deliver Delay , EDD)为：从一个数据分组被 调度到某一个子流并且该分组被对端成功地接收的时间周期。前向时延 (Forward Delay , FD)定义为：在被调度的数据分组从发送端到接收端的前向时 延。对于子流i, p,•为子流的丢包率，R7T,为子流的往返时延，R7O,•为超时重
传时延。预测的交付延迟计算公式如下：
EDD, =国二矿(1日日)诚?”，+叫
=p^TOf /(IS+ FDj
对于公式(4-10),前向时延的计算，我们不简单的使用RTT/2来估算，这是 因为对于异构无线网络，其路径特性具有不对称的特点，前向时延和后向时延 的差距较大。我们使用一种简单的方法来估算前向时延差进而计算预测的交付 时延差来用于调度。
路径1和路径2的前向时延差可以计算如下:
39
注意到这些数据在子流收到ACK的时候就能够获取，妇为发送时间戳，rH
可以放入报文的选项中通过ACK分组选项来获取。
\EDD:定义为预测的交付时延差，可以通过超时和前向时延进行计算，公 式如下：
\EDDt = piRTOi / （1 _ p,.） + FD, - pjRTO} / （1 - p丿）- FD）
=piRTOi / （1- Pi） - PjRTOj / （1- p丿）+ 函	（*12）
