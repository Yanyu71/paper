4.4.3任务管理模块
任务管理模块主要功能是设备检修或发生故障时外勤任务的调度，包括运维 管理员端和技术员端。在实际的工业生产中，设备发生故障时需要技术员进行现 场的维修或设备更换，运维管理员负责发布任务，指派特定的技术人员进行现场 的设备维修，当技术人员完成维修任务后再上传维修信息。
对于运维管理员，当运维系统检测到设备的剩余使用寿命低于正常阈值时会 发出警报，此时运维管理员进行任务发布，即工单的创建。工单内容如图4-13 所示，首选选择故障设备的所属部门，通过小程序的picker选择器组件实现，当 选择值改变时，调用bindchange对应的函数，从而给group变量赋值，代表所选 的部门。选择部门之后接着选择部门里对应的设备，然后是工单类型，包括报障 工单和检修工单。其中，报障工单是当设备发生故障，如剩余使用寿命低于阈值 时进行报障选择，常规的例行检修则选择检修类型。最后在文本框填写发布人, 然后点击发布按钮。工单生成之后会通过js文件中的wx.cloud.callFunction调用 名为createOrder的云函数，将工单数据写入云数据库中对应的工单表。
所属部门：
设备：
类型：
发布人：
注意事项
只能三管坯贡土三
图4-13管理员工单填写
48
运维管理员填写的工单进行发布之后，在对应的“我的工单页面”可以看到 增加的工单信息。这个模块用来记录运维管理员发布过的工单，如图4-14所示，
报障工单
买三
务三
报障工单
图4-14运维管理员工单管理
运维管理员工单管理页面包括“全部工单”，“处理中工单”，“未确认工单”，
“已完成工单”，以及“已逾期工单”共5种工单统计模式，其中右下角的加号 按钮用来创建新的工单，点击之后跳转到管理员工单填写页面。运维管理员工 单管理页面中通过选择不同的工单统计模式，来显示不同的工单信息。实现上 通过小程序的block组件遍历不同的工单统计模式，如处理中工单，未确认工 单，已完成工单等等。在点击不同的block时触发bindtap对应的js文件函数， 来设置activeindex的值，这个值通过赋给view组件中的hidden属性决定view 的显示与否，从而呈现不同的工单信息。其中，“全部工单”统计模式包含了运 维管理员创建的所有工单，然后工单信息显示在技术员的工单提醒页面，页面 同运维管理员工单管理页面一致，技术员点击确认之后，工单信息显示在“处 理中工单”页面，还未点击确认的则显示在“未确认工单”页面，当技术员完 成设备维修后上传维修工单，工单信息则显示在“已完成工单”页面，如果运 维管理员发布的任务在5分钟之内没有确认，则工单信息显示在“己逾期工 单”页面，由管理员直接联系对应的技术员。管理员工单发布的流程如图4-15 所示。
49
图4-15运维管理员工单发布流程
