2.4.2.5一般网络定位流程
18
LCS中一般的网络定位流程可以被分为下列三个阶段：定位准备过程，定位 测量建立过程，位置计算和释放过程。位置请求可以有不同的形式，如MT-LR （Mobile Terminated Location Request,移动终端终结的位置请求），MO-LR （Mobile Originated Location Request,移动终端起源的位置请求），NI-LR （Network Induced Location Request,网络发起的位置请求）；核心网也可以有不 同的类型，如EPC, PS或CS,根据请求的不同和核心网的不同，定位流程也有 所区别。下面以EPC-MFLR过程为例进行介绍，即EPC中移动端终结的位置请 求，如图2-10所示，其中步骤1）-6）是定位准备过程，步骤7）是定位测量建立过 程，步骤8） -10）是位置计算和释放过程。
图2-10 EPC-MT-LR流程⑷]
下面按步骤简要介绍该流程：
1）执行 PS 和 CS 域共同 MT-LR 过程（common MT-LR procedure in PS and CS domain）o简要来说，主要涉及LCS客户端向某GMLC发送LCS请求（该 GMLC被称为请求GMLC）,请求GMLC通过查询HLR/HSS,向订阅者家 GMLC发送请求；家GMLC执行隐私检查（或者请求PPR检查）；家GMLC通 过查询HLR/HSS,向拜访GMLC发送请求。类似地，也适用于LCS响应过程 如步骤10）o以后的GMLC指拜访GMLC»
19
2）GMLC发送“提供订阅者位置”信息给步骤1）中指示的拜访网络中的MME。 这个消息携带请求位置信息的类型（例如当前位置和可选的速度），订阅者的 IMSI （International Mobile Subscriber Identification Number,国际移动订阅者识别 码），LCSQoS信息（如精度和响应时间），和LCS客户端是否有重载能力。对 于和会话相关的位置请求，该消息也携带UE建立会话的APN-NI （Access Point Name Network Identifier,计入点网络标识符）。此外，也可能包含客户端名或码 字（LCS客户端或者请求者使目标UE位置请求被接受的接入码）。
2a）如果GMLC和MME支持暂时不可达UE的推迟定位报告，MME需要 发送一个“提供订阅者位置确认”的消息并带上“UE暂时不可达”。在这种情况 下，步骤9a）和9b）被执行，而不是9）。
2b）如果发生了步骤2a）, GMLC返回LCS服务响应给LCS客户端。
3）如果该GMLC位于另外一个PLMN或者国家，MME会检查是否位置请 求满足该PLMN和该国家的要求。如果不是，返回错误响应。其次，MME检查 是否UE是去附着的或者挂起的，在这种情况下返回错误响应。如果来自GMLC 的PSL消息包括表示隐私的指示，MME决定隐私相关的动作。
4）如果位置请求来自于一个增值的LCS客户端，隐私相关动作指示器指示 UE必须被提醒或者进行隐私验证，而且该UE支持，一个NAS提醒消息被发送 至IJ目标UE,指示来自LCS客户端的位置请求的类型，LCS客户端的标识和请求 者标识（如果两者都支持和可用），是否需耍隐私验证。此外，可以包含服务类 型和码字等信息。MME发送NAS定位提醒消息和定位过程并行，即继续步骤6） 不用等待步骤5）NAS定位提醒返回结果。
5）目标UE提醒使用者定位请求，如果请求了隐私验证，等待用户授权或者 拒绝。UE然后返回一个提醒结果给MME,指示请求被允许或者拒绝（如果请求 了隐私验证）。这一消息可以在步骤4）之后步骤9）之前的某一时间。如果在给定 的时间内UE没有响应，MME应该推断“无响应”。如果请求了隐私验证，用户 拒绝或者根据用户隐私配置文件无响应表示拒绝请求，MME应该返回错误响应 给 GMLC。
6） MME选择一个E-SMLC,并且发送位置请求信息给该E-SMLC。一旦该 MME选择了一个E-SMLC,它一定要在会话持续过程中继续使用。位置请求包 括位置信息类型，请求的QoS,服务小区标识，UE定位能力，服务类型（如果 可用）。
7）如果基于从MME收到的参数（小区ID）,请求的定位信息的QoS之内 的精度可以被满足，E-SMLC可以立即发送一个定位响应。如果位置请求指示上 一次已知位置，E-SMLC应该基于小区ID决定一个上一次已知位置，立即发送
20
定位响应。否则E-SMLC决定定位模式并为该定位模式发起特定的消息序列。如 -果定位模式返回位置测量量，该E-SMLC可以用它们估计位置。如果获得位置测 量量已经失败了，该E-SMLC可以采用当前小区ID的到一个大致的位置估计。 如果基于UE的定位模式已经计算返回了一个位置估计，E-SMLC可以验证它和 当前小区的一致性。如果取得的位置不满足要求的精度「而且还有充足的响应时 间，该E-SMLC可以发起进一步定位尝试，其中可以采用相同的或者不同的定位 模式。如果要求垂直坐标，但E-SMLC只能得到水平坐标，可以只返回这些。
8）当满足请求的位置类型和QoS的位置信息被取得时，E-SMLC在定位响 应中返回它给MME。E-SMLC应该在该响应中指示取得的位置估计是否满足请 求的精度。定位模式的信息可以被返回。如果不能取得位置估计，E-SMLC返回 定位响应应该包含失败原因和无位置估计指示。
9）只有当2a）不执行时执行这一步。如果MME没有初始化步骤4）的隐私验 证过程，则MME返回位置信息，它的年龄和精度指示给GMLC。如果执行了步 骤4）的隐私验证过程，只有当它收到的NAS定位提醒返回结果表示允许，MME 才返回位置信息。如果该结果指示请求没有被授权或者按照隐私配置文件未响应 表示拒绝，MME应该返回错误响应给GMLC。如果E-SMLC没有返回成功的位 置估计，但是隐私检查成功执行了，而且如果请求当前或上次已知位置，MME 可以返回目标UE上次已知位置。MME应该记录计费信息。
9a）只有2a）执行时这一步会被执行。主要内容和步骤9）相同，不同之处在 于：MME应该在订阅者位置报告中包含在步骤2）得到的任何UE标识。如果在 定位信息得到前发生MME重定位或者改变，旧MME返回错误代码，并且包括 新MME地址。GMLC可以向新MME重发定位请求。
9b）如果9a）执行，GMLC应该反馈订阅者位置报告收到确认。
10）如果在步骤1）中请求当前位置和上一次已知位置，执行PS和CS域共 同MT-LR过程。对于请求UE可用性事件的延迟位置，则执行相应的其他步骤。 2.4.3下行模式（OTDOA）
定位UE涉及到两个方面：信号测量和基于该测量估计位置（或速度）。在 LCS中定义了多种定位模式（positioning method）,网络可以根据QoS选择它们 中的一种或者多种来确定一个UE的位置。E-UTRAN支持的标准定位模式有： A-GNSS （network-assistedGNSS,网络辅助的 GNSS）,下行定位模式（downlink positioning ）,上行定位模式（uplink positioning ）, E-CID （Enhanced-Cell ID,增 强的小区ID）模式，气压传感器模式，WLAN模式，蓝牙模式和陆地信标模式。 也支持采用上述多种方式的混合使用［2%
21
LTE中定位模式中的信令交互既可以在3GPP控制平面(controlplane)中进 行，也可以基于 OMA (Operations, administration and maintenance,运营管理和 维护)SUPL在用户平面(userplane)进行，两者信令交互过程类似，但目标和 服务器不同。在控制平面环境中，目标指UE,服务器指E-SMLC；在用户平面 环境中，目标指SET ( SUPL Enabled Terminal, SUPL支持终端)，服务器指SLP。 下行模式也不例外。
.这里以控制平面环境中的下行模式为例进行介绍，以前也称为OTDOA (Observed Time difference of Arrival,观察的到达时间差)。在下行定位模式中， 基于UE取得的来自多个TP (TransmissionPoint,传输点，一个小区中地理上共 址的一组天线)的下行无线信号，测量参考信号时间差RSTD,并结合TP的位 置信息，估计UE的位置。
