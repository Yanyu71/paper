4.2.2NLOS虚拟基站生成
由于非视距误差的存在，并不能将第三章估计得到的时延和角度值用于终端位置坐 标的计算，因此本小节将从虚拟基站的角度出发解决单基站NLOS定位问题。首先以单 个反射体上的单次反射路径为例，说明虚拟基站的原理。
41
在图中，假设反射体为平滑的墙面，且所在的直线l-.Ax + By + C = 0可通过建筑平面
结构图已知。因此根据BS,辺坐标七=［兀,必F，可计算出关于直线/对称的虚拟基站
的坐标％：
-2Z cos(^ / 2 -
2L sin(龙 / 2 — 0)
其中，Z表示BS丽到直线/的距离，°作表示直线/与x轴的夹角，计算公式如下： 厶=±| Axb + Byb + C\/^A2 + B2	(4-20)
(p = - arctan" / B)	(4-21)
厶的正负取决于Axb + Byb + C的正负，当其大于0时，Z的取正值，否则取负值。
因此结合以上信息和通过大规模天线阵列估计得到的时延和角度参数，可计算终端UE
的位置坐标XJE :
其中，£•和仇分别表示第j条NLOS信号对应的传输距离和接收角度。复杂环境下 反射体的数目较多，单个NLOS信号的路径可能经过多次反射，如图4-7所示。
42
图4-7多次反射虚拟基站原理图
假设存在/个反射体，其所在直线分别表示为（厶仏‘…仏），我们可以通过对单次反射
虚拟基站生成方法进行迭代，从而生成多次反射的虚拟基站，迭代的基站初始坐标为
-2L; cos(;r/2—
® ~ X"" + _ 2L. sin(” / 2 — ％)
£ cos 3.
直至迭代至心/此时得到的XUQ即为最终得到的终端坐标值。
以上讨论的虚拟基站生成方法是基于单一的NLOS传播路径一次或多次反射的情 况，但复杂环境下，反射体数目增多，不可避免的导致终端和基站之间存在多条NLOS 路径。因此，本文将创建一个终端位置候选集合，从集合中选取正确的位置并计算相应 的虚拟基站。
假设定位场景中共有Z个反射体，”条NLOS路径，首先根据NLOS信号模型中的 假设，单个反射信号反射次数不大于2,因此将/个反射体按照任意顺序进行排列组合， 共得到Total种可能：
Total ^A'+Aj	（4-25）
其中，£表示排列数。然后通过迭代的方式计算不同反射体组合下可能的虚拟基站 坐标，构成最终的候选集C = {cl,c2,...,cnum},加劝表示去除重复元素后虚拟基站可能的 个数。对于每一条NLOS路径对应着集合C中可能的虚拟基站坐标，通过公式（4-24） 计算，可以得到第j条NLOS路径对应的终端坐标候选集U产{UE「,UEf,...,UE— 显 然，在每个终端坐标候选集U},U2,...,Un中都存在一个正确的终端位置估计坐标。因为存 在角度和时延估计误差和环境噪声，同时考虑到反射次数不超过2次，因此可以通过穷 举的方式在U„U2,...,Un中找到”个期望的终端坐标，使其之间的欧式距离最小。
43
