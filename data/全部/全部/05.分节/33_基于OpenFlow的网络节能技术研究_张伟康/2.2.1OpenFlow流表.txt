2.2.1OpenFlow流表
OpenFlow的核心思想是将网络的控制功能和数据转发功能进行分离，数据 的转发功能由OpenFlow Switch来完成，而交换机以控制器下发的流表为转发依 据，流表结构如表2-1所示：
表2-1流表组成表
包头域	计数器	动作列表
(Header Fields)	(Counters)	(Actions)
如表2-1所示，OpenFlow流表项包括三个部分，包头域(OpenFlow vl.l之 后成为匹配域)、计数器、动作：
1)包头域(header fields)
包头域主要负责数据包匹配字段的描述，其结构如表2-2所示：
表2-2包头域
Ingress	Ether	Ether	Ether	VLAN	VLAN	IP	IP	IP proto	IPTOS	TCP/UDP	TCP/UDP
Port	Src	Dst	Type	id	priority	src	dst		bits	Src port	Dst port
如表2-2所示，包头域主要是为了实现与接收到的数据包进行匹配。在 OpenFlow协议1.0中，支持了 12元组，涵盖了 TCP/IP协议组中第二层到第四 层的网络配置信息，每个元组中既可以支持精确匹配，也是支持对于任意值得匹 配。12元组的匹配方式科技更加细粒度地管理网络中的数据流。
2)计数器(Counters)：
OpenFlow协议中为每张流表、每条流表项、每个交换机端口和每个队列都 是设置了一个计数器，如表2.3所示，针对每张流表，可以统计当前活动的表项 数、数据包的査询次数、数据包的匹配次数等；针对每个流表项可以统计接收到 数据包的个数、接收的字节数、以及生存时间；针对于每一个端口，可以统计每 个端口接收和发送数据包的个数、字节数等信息；针对于每一个队列，可以统计 发送的字节数和包个数以及发送溢出(Overrun)错误次数等。
3)动作(Actions)：
OpenFlow协议中的动作(Actions)用于指示交换机在收到匹配的数据包时应 该进行的行为操作。在传统网络中，二层交换机只能对帧进行转发和修改VLAN 的信息，三层路由器只能对数据包进行转发和修改MAC (包括源地址和目的地 址)的操作，这些操作都是基于固定的协议和配置来进行，用户无法进行自定义。 在SDN网络中，OpenFlow交换机缺少了网络控制的能力，所以对匹配数据包的 处理不仅仅是简单的转发等操作，而是需要用动作(Actions)来详细地说明交换机 将要对数据包所做的处理操作。
表2-3计数器
类型（type）	计数器(counter)	位数(bits)
每张表	有效表项	32
匹配的数据包	64
査表的数据包	64
每条表项	接收的数据包	64
接收的字节	64
持续时间（秒）	32
持续时间（纳秒）	32
每个端口	接收的数据包	64
发送的数据包	64
接收的字节	64
发送的字节	64
接收出现的错误	64
发送出现的错误	64
接收的帧排列错误	64
溢出错误	64
CRC校验错误	64
帧冲突	64
每个队列	发送的数据包	64
发送的字节	64
溢出错误	64
OpenFlow交换机通过定义动作列表来描述对数据包进行的各种操作。动作 又可以分为两种类型：必备动作（Required Actions）和可选动作（Optional Actions）。 顾名思义，必备动作是所有的OpenFlow交换机必须默认支持的，而可选动作并 不是所有交换机都必须支持的。如果交换机接收到一个本身不支持的动作，则交 换机会向控制器发送一个错误消息，OpenFlow 1.0协议中规定的动作如表2-4和 2-5所示：
表2-4必备动作表
类型	名称	说明
必备动作	转发(Forward)	交换机必须将数据包转发给设备的物理端口及如下 的一个或多个的虚拟端口 ：
ALL：转发给除了入端口外的所有其他端口
Controller：封装数据包并转发给控制器
Local：转发给本地的协议栈
Table：对PacketOut消息执行流表的操作
InPort：从入端口发出
丢弃(Drop)	对于没有明确指明动作列表的流表项，交换机将会把 匹配该流表项的所有数据包进行默认的丢弃操作
表2-5可选动作表
类型	名称	说明
可选动作	转发(Forward)	交换机可选支持将数据包转发给如下的虚拟端口：
NORMAL：利用传统交换机原有的转发机制来对数据包进 行处理
排队	交换机将数据包转发到某个出端口对应的转发队列上，便 于提供QoS的支持
修改域
(Modify-Field)	交换机可选修改数据包的包头内容，可以包括： 设置VLAN ID、VLAN的优先级、剥离VLAN头 修改源MAC地址、目的MAC地址
修改源IPv4地址、目的IPv4地址、Tos位 修改TCP/IP端口，目的TCP/IP端口
