4.1基于RTT.ES算法的节能系统设计
软件定义网络(SDN)的基本架构如图2-1所示，包括应用层、控制层和基 础设施层，控制平面负责整个网络的逻辑控制功能。本文基于该网络架构，设计 了基于RTT-ES算法的网络节能系统，该系统的基本组成如图4-1所示，该系统 中主要由五个功能模块组成，分别是最小生成树模块、流量釆集模块、QOS保 证模块、设备管理模块及路由计算模块，各个功能模块分别完成相应的功能。以 上五个功能模块均属于SDN网络中的控制平面中。
图4-1基于RTT-ES的网络节能系统功能模块图
流量釆集模块主要是采集物理网络中的交换机的各个端口流量，包括发送和 接收的字节数，并根据这些流量信息计算网络活跃链路的链路利用率和权重。
最小生成树模块主要是当最佳网络节能时刻时，根据当前网络实时链路权重, 为当前网络生成最小生成树拓扑。该模块输出需要关闭的网络链路，然后交给设 备管理模块来执行具体的关闭操作。
QoS保证模块主要功能是对网络中的拥塞链路进行负载均衡。该模块根据流 量釆集模块计算出的各个活跃链路的链路利用率，根据设定的阈值，得到网络中 的拥塞链路，然后通过负载均衡算法为当前的拥塞链路计算均衡链路。在本系统 中，RTT-ES算法中阈值参数是动态的，动态阈值策略可以根据网络实时负载情 况不断更新当前网络阈值。
设备管理模块主要是根据输入的链路信息和类型对相应的链路进行开启(up)和关闭(down)的操作，该模块主要通过OpenFlow协议信令来完成相关操作；
路由计算模块主要功能是根据网络实时链路权重，为拥塞链路上的流量重新 计算最优路由。通过为相关的交换机重新下发流表，实现了为拥塞链路的数据流 重新路由。
在图4-1中，其中最小生成树模块与其他模块有所不同，最小生成树模块是 在最佳节能时刻时运行，完成网络拓扑裁剪，从而使网络达到了在保持网络节点 相互连通下的最佳节能状态。
4.2 RTT-ES算法在Floodlight控制器中的实现
在2.3.2节中，详细地介绍Floodlight控制器中基本功能模块。本节将在此 基础上，深入地讨论RTT-ES算法如何在Floodlight控制器中的实现。
为了在Floodlight控制器中实现RTT-ES算法，主要设计了三个模块，分别 是 LinkCostManager 模块、MstTopology 模块、EnergySaving 模块，其中 EnergySaving模块是网络节能的核心模块，LinkCostManager是链路信息服务提 供模块，继承了 IFloodlightService接口，向其他的模块提供链路权重和链路利用 率信息。这些模块也都实现了 Floodlight中基本模块接口 IFloodlightModuleo
以上的三个模块是RTT-ES在具体控制器中的实现，与图4-1中的网络节能 系统中的模块是相互对应。其中，LinkCostManager模块包括图4-1中的流量釆 集模块，MstTopology模块包括系统中的最小生成树模块和设备管理模块， EnergySaving模块包括了 QoS保证、部分路由计算、设备管理模块。接下来将 重点讨论这三个模块设计思想和工作机制。
1.LinkCostManager 模块
Floodlight控制器在通过Dijkstra算法计算最短路由路径时，需要链路权重参 数，在开源版本的Floodlight控制器中，链路权重设定都为1。因此，链路权重 并不能反映出网络链路的拥塞状况。为了能够实时地获取网络流量，增加了 LinkCostManager模块。该模块的主要作用是将网络实时流量映射为网络链路权 重和链路利用率参数，该模块的具体实现流程如图4-2所示，可描述如下：
(1)首先将进行网络初始化的操作，主要完成包括设定LinkCostManager 探测网络流量周期T等。在本文中，设定的探测周期是5s。
(2)控制器将向交换机发送ofp_stats_request消息来获取当前时刻的各个 OpenFlow交换机的端口的发送字节和接收字节数。
(3)控制器接收到oQ)_stats_reply消息，并将其中端口流量信息保存到 LastPeriodTraffic 中。
(4)等待一个周期时间T。
(5)控制器继续通过发送ofp_stats_request消息来获取当前时刻的各个 OpenFlow交换机端口的发送字节和接收字节数。
(6)根据当前周期内的流量信息和前一个时刻的流量信息lastPeriodTraffic, 做差值来计算链路权重和链路利用率。
(7 )将当前周期内的流量信息保存到lastPeroidTraffic中，更新 LastPeroidTraflfic。
(8)重复(4) ~ (7)。
图4-2 LinkCostManager模块流程图
2.MstTopology 模块
网络流量具有规律性，网络流量在某个时间点或者某个时间段内，总是处于 较低的范围内，此时就存在了最佳网络节能时刻。根据网络的该规律性， MstTopology模块的主要作用是在网络的最佳节能时刻，将网络拓扑裁剪为最小 生成树的拓扑，从而使网络实现最佳的网络节能。
最小生成树拓扑是整个网络实现最佳节能时的拓扑。为了实现最小生成树的 拓扑，MstTopology模块中釆用的算法是Prime算法，MstTopology模块的流程 图如图4-3所示：
［网络初始化
link Cost Manager 模块中获
取实时瑟路权重
Prime算法
r
DownLinks
+
发送0 ip_port_mod消息关
闭网纟j端口
生成最小生成树拓扑
图4-3 MstTopology模块流程图
MstTopology模块首先进行网络初始化，然后从LinkCostManager模块获取 网络实时的网络链路权重，基于实时权重信息，通过Prime算法计算出需要关闭 的链路。下一步，MstTopology向交换机发送ofp_port_mod消息关闭相关的网络 接口。当完成相关的端口关闭的操作，网络拓扑就变成了最小生成树拓扑，实现 了最佳网络节能。
3.EnergySaving 模块
EnergySaving模块是RTT-ES节能算法的核心模块，实现图4-1中的QoS保 证、路由规划的部分功能。EnergySaving模块通过LinkCostManager模块获取网 络实时的链路利用率信息，对于链路利用率超过阈值的链路，进行负载均衡。通 过为拥塞链路寻找均衡链路，利用均衡链路的均衡作用，从而降低拥塞链路的拥 塞程度，可以在保证网络QOS同时实现网络的节能。EnergySaving模块的流程 图如图4-4所小:
(1)EnergySaving模块首先是进行的是网络初始化的工作，设置模块运行 周期等参数，在仿真中设定的周期是10s。
(2)初始化完成后，EnergySaving模块将通过LinkCostManager获取网络实 时链路利用率。
(3)根据获取的链路信息和所设定的阈值，得到超过阈值的拥塞链路。如 果当前的过载链路数超过了网络开启链路数的一半时，将会进行阈值调整的操作, 否则经进行步骤(4)的负载均衡操作；
(4)负载均衡主要是首先为拥塞链路计算出均衡链路，向交换机发送 o^)_port_mod消息开启相关链路，并通过ofp_flow_mod删除与拥塞链路相关的 流表项，最后由Dijkstra算法为数据流计算最优路由，并下发流表；
(5)重复步骤(2)?(4)o
Dijkstra算法计算最优路由
发送。fp_flow_mod消息下发流表
图4-4 EnergySaving模块流程图
