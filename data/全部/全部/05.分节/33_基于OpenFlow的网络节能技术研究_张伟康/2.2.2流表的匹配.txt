2.2.2流表的匹配
前一小节中给出了 OpenFlow协议中流表项的结构，该节主要介绍交换机完 成数据包匹配和处理的具体流程，协议中规定的流程如图2.3所示。
在OpenFlow vl.O中流表项的包头域中定义了 12元组，交换机必须将数据 包中的12元组中的信息解析出来，然后进行流表匹配。如果流表匹配成功，就 应用该流表项后的动作(Actions)o如果没有匹配的流表，则将数据包通过安全通 道发送到控制器，交由控制器进行处理，具体如图2-3所示。
9
图2-3交换机处理数据流的流程图
在图2-3中存在一个可选的STP处理过程。OpenFlow 1.0版本在设计之初, 希望OpenFlow交换机和传统的二层网络交换机进行混合组网，因此为了交换机 防止存在连接环路而造成网络广播风波，一些OpenFlow交换机可以通过配置启 动生成树协议。当OpenFlow交换机接收到数据包时，首先判断是否为生成树协 议的BPDU,如果是生成树的协议的BDPU,则交由生成树协议的进行处理，否 则进行解析包头，进行匹配。
在图2-3中包头解析并没有详细的介绍，图2-4详细地描述了数据包头解析 的流程。
当OpenFlow交换机接收到数据时，初始化包头的入端口、以太网的源地址 和目的地址、协议类型，并将包头的其他元组设置为0,继续根据以太网协议类 型来决定接下来的解析流程：
1.如果以太网协议类型是0x8100,则表示这是一个含有VLAN标签的以太 网数据帧，此时就解析VLAN标签和VLAN优先级字段，然后更新二层协议类 型字段继续判断；
2.如果协议类型是0x0806,表示这是一个ARP数据包，根据ARP数据包 中的IP源地址和目的地址更新匹配包头信息，然后结束解析流程
3.如果协议类型是0x0800,表示这个IP数据包，则解析IP数据包中的IP 源地址、目的地址、协议类型和TOS字段，然后根据IP包头中的协议类型继续 解析TCP/UDP和ICMP的协议信息，至此，就得到了流表项包头域中的12元组 的信息。
数据包的解析过程完成后，就可以根据数据包的12元组信息进行后续的匹 配流程；
10
图2-4包头解析的流程图
