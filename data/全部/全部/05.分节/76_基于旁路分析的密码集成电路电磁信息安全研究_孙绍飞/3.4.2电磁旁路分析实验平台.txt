3.4.2电磁旁路分析实验平台
本小节将详细介绍本文所利用的自主研发和搭建的电磁旁路分析实验采集 平台，先对各个组成部件进行介绍，然后再进一步分析其工作的大致流程，最后 通过模块拆分来进行详细阐述。密码集成电路电磁旁路分析实验平台，如图3-7 所示，主要由密码设备，一组H-field近场探头，一个低噪声放大器，一台数字 示波器、一台苹果笔记本电脑和一台直流稳压电源构成。
图3-7电磁旁路分析实验采集平台
52
①密码设备。密码设备作为分析目标，可以是智能卡、单片机、嵌入式设备 等数字集成电路设备，本平台利用的是一块FPGA实验板一Sakura-G实验板。 Sakura-G实验板是一块专门为研究旁路分析的硬件安全而设计和开发的，实验板 上配有两块XILINX Spartan-6系列芯片，分别为主芯片和控制芯片，两块芯片均 采用45纳米的工艺制程。其中，主芯片主要负责密码算法的实现；控制芯片主 要负责为主芯片提供激励和控制时序。主芯片和控制芯片均配备了 48MHz的时 钟信号。
②H-field近场探头组。近场探头主要用来检测密码设备工作时的电磁泄漏 源并采集加密算法运行时的电磁发射信号。本平台所用的一组近场探头是Langer LF1 set,共包含四个不同直径大小的探头尺寸，其探测的频率范围为100KHz-50MHz o
③低噪声放大器。低噪声放大器紧邻近场探头，主要是对近场探头采集到的 电磁信号进行放大，同时减少杂波的影响，提高检测的灵敏度。本平台所用的低 噪声放大器是一款提供30dB增益的线性放大器，仅对电磁发射信号的幅度进行 放大，而不改变信号的频率成分。即低噪声放大器输出电压“。和输入电压%之间 满足下式的关系。
30dB = 20 x log10—或4 = 102 x %	(3- 47)
④数字示波器。数字示波器主要是用来捕捉经由近场探头获取到的电磁发射 信号，并将实时采集到的电磁信号通过网线传送给笔记本电脑进行存储。本平台 所使用的数字示波器为是德科技MSOS054A,是一个4模拟通道，带宽500M, 最大存储深度800Mpts,最高采样率可达20GSa/s的高性能数字示波器，完全可 以满足大部分实验的需求。示波器的采样率应满足奈奎斯特采样定理，采样率需 设定为目标信号最高频率的2倍及以上。
⑤笔记本电脑。笔记本电脑主要是用来存储示波器发送过来的电磁信号数据, 并对数据进行深层次的处理。同时笔记本电脑还负责与Sakura-G实验板的通信 和收发明密文等功能。
⑥直流电源。一台外接的直流稳压电源负责为Sakura-G实验板供电以减少 噪声的影响。当用笔记本电脑供电时，会存在供电不稳而引入其他干扰噪声的情 况出现。
电磁旁路信号采集流程如下：
(1)笔记本电脑通过一根标准的USB B-A线缆向Sakura-G实验板发送128 比特的明文和128比特的密钥。
(2)实验板接收到明文和密钥后开始进行加密算法的操作，并将加密完成
53
后的密文返回给电脑。加密算法在开始时会产生一个触发信号以同步示波器进行 存储操作。H-field近场探头通常置于主芯片的表面来检测电磁发射信号，通过调 整探头的角度和方向以达到最优的接收效果并保持在此最优位置直至信号采集 结束。
(3)近场探头接收电磁发射信号后，经过一个30dB的低噪声放大器提供 增益，并将信号传送给示波器。
(4)示波器捕捉到信号后将信号传送给电脑并储存下来以进行深入分析。 除此之外，一台直流电源为Sakura-G实验板供电以避免不相关的噪声给波形带 来的影响。
(5)笔记本电脑完成存储之后，再向Sakura-G实验板发送下一次的明文， 确保明密文和波形的一一对应。
(6)此过程不断重复，直到所要采集的电磁发射迹线数目满足需要为止。
该自主搭建的电磁旁路分析实验采集平台克服了传统人工操作明密文发送 费时费力的缺点，实现了对多种加密算法的数据收发存储和自动循环采集一体化 的功能，具有面向对象多样、信息采集量大、运行速度快、传输效率高、简单易 操作等优点。同时又能够避免长时间人为操作对实验环境和实验数据质量所造成 的影响，极大地提高了实验数据的采集效率。
数据发送 模.块
数据存储 模块
数据加密 模块
直流电源
薮据采集 传输模块
示波器 低噪放 近场探头
图3・8电磁旁路分析实验采集平台模块组成
电磁旁路分析实验采集平台按照模块划分主要由数据发送模块、数据加密模 块、数据采集传输模块和数据存储模块组成，如图3用所示。其中，数据加密模
54
块主要由密码设备和直流电源组成，其主要功能是进行密码算法的加解密运行, 对数据发送模块所发送来的数据进行加解密运算并输出明文或密文，本文所涉及 的加密算法为AES-128密码算法。数据发送模块与数据加密模块之间遵循USB 协议通过差分信号技术进行数据间的通信，经由USB的A型连接头进行上行连 接，B型连接头进行下行连接。
数据采集传输模块主要由示波器、低噪放和近场探头组构成，其主要功能是 对电磁旁路信号进行捕捉和传输。近场探头能够将密码设备泄漏到空间中的电磁 发射信号转化为电信号，一般而言，泄漏到空间中的电磁发射信号比较微弱，近 场探头局部定位的优势能够将探测点聚焦到密码集成电路部分的电磁发射，然后 通过低噪声放大器将电信号的幅度进行放大或者搭配滤波器进行滤波去噪，之后 再由示波器以二维形式将电信号随时间的动态变化在屏幕上可视化展现出来，并 将捕获到的电信号传送给数据存储模块从而实现对密码集成电路微弱电磁发射 信号的提取。示波器通常需要依据采集目标对采样率和存储深度进行设置以满足 要求。一般情况下，示波器在批量采集时常常设置为单次触发模式以确保明密文 的匹配。
数据发送模块和数据存储模块共同构成数据加密模块和数据采集传输模块 的上位机。上位机隶属于电脑上的应用软件，自主编写而成，其主要功能是对实 验所涉及的设备进行配置，并向数据加密模块发送明文或密钥，以及接收来自数 据采集分析模块的电磁旁路信号数据并进行存储。上位机界面如图3-9所示，可 以分成六个区域来展示。
清空	生成	匚自呢或		京椎连够③ 采集通道	哀陵O	采样疑
CO n22 3344 55 66 7?33 99AABeCCDDEEFF
口 位：					---	j	I 2511
密钥：	00 0- C2 Q3D4 05C6C7CS09DA0B0C0D0E 0F	35士	生K	口 56b;也c
□豌拉匚二				单依的百6〉 叉 3H-6	偏移电压(吟	单位电压(V) 区	!	,3	\
亚				贼发邈时⑸	触发时钟;S	科友电田切
接收：		告空.匚联消指误停止
对比：				IQt-l	FOStiirt」	11
接收方式：1	T	发送：			送耀	荣集	结索
Received: 0
图3-9电磁旁路分析系统上位机界面功能区划分
①端口控制区：该区域主要是与数据加密模块建立连接，选择合适的端口和 波特率以匹配加密设备与之进行数据通信和传送；
②采集控制区：该区域主要是对电磁旁路分析实验的采集方式进行设置，分
55
为握手方式的有无和加密次数的设置。握手方式主要是确保上一次的明文加密完 成并存储结束后再进行下一次的加密。加密次数主要是针对采集电磁泄漏信号的 发射迹数目而设置的。
③端口状态区：该区域主要是展示端口的连接状态和端口的开启关闭功能， 以可视化的形式确保端口正常连接。
④加密状态区：该区域主要是对加密过程中的明文密钥进行展示，并对密码 设备返回的密文进行校对，如果出现错误便停止，可以通过勾选右边的取消错误 停止来禁用错误停止功能。当进行多次加密时，需勾选明文自动生成功能，通过 产生不同的随机数种子来产生不同的明文和密钥，除此之外还能够对明文和密钥 的位数进行选择和固定。与此同时，可以选择单次循环和批量循环两种不同的方 式来进行电磁发射迹线的接收。
⑤示波器连接状态区：该区域主要是与数据采集传输模块进行连接并对示波 器的相关参数进行设置。示波器的参数主要包括采集通道、触发通道和采样频率 等参数。
⑥完成状态区：该区域主要是对已完成的加密次数进行统计，体现在明文的 已发送次数和密文已接收的次数，并通过对比二者之间的关系判断是否存在漏掉 加密的情况。
0. 008
0. ()06
0. 004
c 0. 002 >
0. 000 烟 整-0. 002
-0. 004
-0.006
-0. 008
0	1000	2000	3000	4000	5000
采样时间点
图3-10电磁发射迹线波形图
通过电磁旁路分析实验平台采集到的AES-128密码算法的电磁发射迹线中 的一条波形如图3-10所示。从图中可以看出，该条电磁发射迹线中一共有12个 朝下的尖峰存在。其中，第一个尖峰是由于触发信号的干扰而导致的，第二个尖 峰是由于密码设备加载明文或密钥所引起的，后面的10个尖峰依次对应着AES-
56
林 ppiwww***
128算法的十轮加密。
