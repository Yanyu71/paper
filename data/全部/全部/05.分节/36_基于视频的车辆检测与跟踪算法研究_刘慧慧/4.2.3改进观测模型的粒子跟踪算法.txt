4.2.3改进观测模型的粒子跟踪算法
利用粒子滤波对车辆进行跟踪，首先要建立观测模型，其中目标核函数颜色 直方图比较常用，因为在实际中，颜色直方图特征是一种全局特征，并且容易求 得，但是在光照较弱或者对比度相对低的环境下，颜色特征描述算子不能准确的 对车辆信息进行表达，并且颜色直方图信息缺失对空间信息表达。HOG特征岡 即方向梯度直方图特征，通过统计计算图像局部的梯度直方图信息形成特征，广 泛用于行人车辆检测中，由于某些交通视频经常会出现光线差等问题，因此通过 将改进HOG特征与颜色直方图结合起来，建立EC770G(enhanced-color HOG)观 测模型，可以使得观测模型具有较强的鲁棒性。
HOG特征通过把图像分成较小的连通区域单元，称为cell,然后通过计算cell 内像素点的方向梯度直方图，形成区域的特征描述器。具体算法实现过程是：
a.归一化图像
首先进行Gamma压缩，这种压缩可以降低局部的阴影和光照因素的影响， 并且将图像转为灰度图，便于后续处理
b.计算图像梯度
图像的梯度计算分为横坐标和纵坐标梯度计算，最后求得像素点的梯度方向， 具体计算方法为：
gxy)=/(x+^y)~ f(x - y)	(4-13)
gy (x, y) = f(x, y + 1)-/(x, y -1)	(4-14)
其中&和g＞分别为图像像素点(x,y)在横轴和纵轴上的梯度-f(x,y)代表像素点 (x，V)的像素值，据此可以计算出点(x，v)梯度的方向Z和幅度3：
A = arctanCg^, (x, y} / gx (x, y))	(4T5)
B = J(g；(x,〉) + g；(x，N))	(4T6)
c.构建方向梯度直方图
首先对图像进行细胞元划分，例如每个ce〃是8x8,则32x32像素区域包含 16个cell,通过直方图去统计每个cell的信息，通过计算每个像素的梯度方向映 射到不同区间内，假设直方图前”为9,也即梯度方向分为9个小方向，在映射 的时候通过梯度幅度加权映射，从而得到这个ce〃的方向梯度直方图，是一个9维的特征向量。
d.构造HOG描述符
将相邻cell特征向量集合成block块，假如4个cell组合成一个block块，则 这个block是一个16x16的区域，每个ce〃是一个9维特征向量，32x32的图像 区域包含9个block块，当然这些block块之间是允许有重叠的，则这幅图像区 域可以用一个324维的特征向量来表示。
改进的HOG特征通过加入图像中心block块和周围block块的差异信息，能 够让目标特征在外界环境对比度低的情况下也能很有效。如图4-1所示，block5 与其他block进行比较，公式如下
(0 = scenter(0 -Sj(0,丿= 1,2 ......9, j center	(4-17)
其中代表中心block块的第i个bin, Sj(i)表示第j个block的第i个 bin,这样图像区域的差异梯度特征为一个288维的梯度向量。
一 j—":三菱
_」	,…「 j ‘. .		■
图4-1改进HOG特征
颜色直方图特征通过计算图像的勿直方图信息得到，有一点值得注意 的是，bin的数目的选取太大或者太小都会导致差的对比度效果，在本文车辆跟 踪系统中，为H通道分配8个bin, S通道分配12个bin以及「通道分配3个 bin,整个HSV颜色空间描述器的维度是288。
改进方向梯度直方图描述器与釦HSV颜色直方图描述器相互结合，形成粒 子滤波的观测模型。在目标匹配阶段，主要的工作是找到当前帧的目标在上一帧 最匹配的跟踪物体，因此需要求得观测模板和待选区域的相似度，这里主要釆用 相似度度量Bhattacharyya系数来计算，用必/?,”)代表模板直方图和检测区域直 方图相似度函数。
N-1
dd 宇￡据	(4-18)
/~0
其中时表示观察区域第丿个粒子对应直方图特征的第［?个bin值，匕丿表示匹 配模板第丿?个粒子对应直方图的第，?个bin值。因此可通过上述公式计算出3D HSV 颜色空间直方图和HOG特征直方图权重d嬴,“和瞄史对于差异HOG特征的 权重以油皿“计算方法如下：
38
DT	,
以(4T9) i=0
利用上面三种特征的权重求出最终第j个粒子的权重：
& = (d%s"X ^HOG,n ) / ^RDHOG,n	(4~20)
粒子的权重反映了候选框和匹配模板之间的相似度程度，当d.和瞄 增大或者Dg”减少时，粒子滤波权重会增大，反之降低。
图4-2观测模型中特征提取示例
图4-2显示了对视频第1224帧图像进行改进HOG特征和釦屡卩特征提取 的具体过程，对提取到的车辆区域首先调整大小为32x32,图4-l(d)和(e)是提取 车辆的直方图信息，图4T(f)是车辆区域的HOG特征提取。
改进的观测模型被应用于粒子滤波框架中去，具体的粒子滤波跟踪流程见下 图：
