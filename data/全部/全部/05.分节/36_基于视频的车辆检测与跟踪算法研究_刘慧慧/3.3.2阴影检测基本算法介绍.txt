3.3.2阴影检测基本算法介绍
(1)基于颜色的阴影检测
利用颜色特征对阴影进行检测的主要思想是对背景像素和运动目标阴影的 亮度(V)，色度(H),饱和度(S)特征进行比较，H的取值范围为0°~360° , V和S 的取值范围是0~1。对于阴影来说，色度和饱和度的变化不大，亮度信息变化 较为明显，因此可以利用图像的HSV颜色特征进行检测侦，首先需要把图像从 RGB颜色空间转到HSV空间。
"=吨海	 	.	(3-31)
2xJ(R_G)2 + (R_B)x(G_B)
3
S = 1			G, 8)]	(3-32)
R + G+B
f = ?x(R + G+8)	(3-33)
经典HSV的阴影检测方法利用检测点与背景点的亮度比，色度以及饱和度差的特点进行判断是否为阴影，基本公式如下：
mhsv =1，a < <P^Is(x,y)-Bs(x,y) < 0S ^\lh(x,y)-Bh(x,y)\ < 0h 伝由)
0, otherwise
其中Bk(X,y)tBs(x,y),Bv(x,y)代表图像背景像素点HSV颜色空间特征， Ih(x,y), Is(x,y), Iv{x,y)表示当前帧对应像素点的HSV颜色空间特征。其中 参数a,”的取值范围是0?1之间，其中a主要依据阴影的强度，当阴影的强度 越弱时，相对a越大，相反则越小，"主要降低噪声的影响，从而提高阴影检测 的准确度。劣和劣主要为色度和饱和度的阈值，但根据经验得知，它们对结果 的影响不大。
(2)基于纹理的阴影检测
根据阴影的特点可知，阴影区域和背景区域的纹理特征很相似，在实际中， 可以利用纹理相似度网进行判断，其中最常用的纹理算子是LBP算子。LBP是 1994年由T. Ojala, M.Pietikainen和D. Harwood提出，LBP特征具有旋转不变性 和灰度单调变换不变性，主要提取图像的局部纹理特征，它反映了每个像素点与 周围像素点的关系，根据中心像素点的值对其周围像素点进行二值编码，具体形
其中戸表示以x。,％为圆心，以r为半径的圆，如果圆的半径越小，则对于图 像的纹理描述越好，但此时比较容易受到噪声的影响，如果圆的半径越大，则对 图像的纹理描述越弱，比如一些边缘细节，而受到噪声的影响会变小。&表示 像素点气,龙的像素值，g?表示距离中心像素点半径为尸的尸中第』?个像素点的 值。LBP常用的是3x3的模板，3x3邻域的8个点通过比较运算产生8位的二 进制数，从而得到该窗口像素点的LBP值。
70	　　29		I	1			I	2	4 ,
2K		　　27		I	f-	0			g
而		18		0	0	0			32
(a)		(b)		(c)
图3-13 LBP算子
图3-13(a)表示图像中3x3区域的像素值，图3-13(b)表示对此像素点进行二 值编码，假如邻域像素点比中心像素值大的像素被置1，比中心像素值小的像素 被置0,然后按照顺时针方向进行排序，从而得到编码为11000011,从图3-13(C) 可以看到整个编码的权值，贝！J最终场的值为(2°+2】+26+27)。
对于给定的当前帧像素I(x,y)以及背景像素B(x,y),通过上述LBP纹理算子 计算方法计算这些像素点以及其周围像素点的LBP特征值，并且统计邻域的LBP 特征的直方图信息，通过直方图交运对1(x,力与B(x,y)以进行纹理相似度判定， 假设所对应的直方图为內和加-
NT
p = ^min(/2；,A；)	(3-37)
z=0
其中Q是相似度系数，N表示直方图柱的数目，5分别代表当前帧像素点 和背景像素点第i个直方图柱的信息。
根据求得的纹相似度信息可以判断Z(x5y)是否为阴影，从而获得阴影的二值 掩码图。
其中皿表示在在t时刻视频帧阴影的二值掩码图，7日是对阴影判断的阈 值，可以根据不同场景设定。
(4)两种方法的结果对比
图3-15(a)为视频原图，图3-15(b)是通过ViBe检测出的视频前景图，可以 看出阴影对检测结果的影响很大。在HSV空间的阴影检测效果如图3-14(c)所 示，从结果可以看出，这种方法可以检测出大部分的阴影区域，但是由于其主要 依赖亮度信息，因此在光照强度整体比较低或者车辆的颜色特征与背景差别比较 小的时候，目标车辆也会比较容易被检测为阴影，因此只利用颜色特征并不能取 得令人满意的效果。
视频帧通过LBP纹理特征进行的阴影检测结果如图3-15(d)所示，从图中可 以看出，车辆的大部分阴影都可以被检测出来，但是由于部分车辆区域的纹理特 征与背景纹理特征存在相似性，所以会被误检为阴影。
图3-14阴影检测结果
(5)改进的阴影检测算法
基于HSV空间的阴影检测算法假设监控环境背景是固定的，而改进的无参化 算法加入了相邻三帧色度差信息，当背景存在变化时，相同位置上的光线的反射 系数大致相同，因此可以适用背景出现变化的场景。在同一帧内，由于H,S信息 对结果的影响不大，因此在判别时只考虑了亮度信息，具体思想是：
M严=上。，蘇(3-39)
0, otherwise
其中I^x,y)与B\x,y)表示在视频的第f帧的像素点的亮度值，I，和咯表的是 视频的第，和帧像素点的色度信息。在实际中，除了阴影会让图像的亮度值 发生改变以外，由于目标的运动，在很短的时间内，某一像素点的投影也会发生 改变，通过加入前后帧的亮度变化，并结合当前帧像素与背景像素亮度比，不仅 能适应背景的变化，而且使得HSV阴影检测无参化，不再需要根据不同视频场 景去调整阈值参数【却，因此比较操作简单，具有广泛适用性。
无参化的颜色特征检测法是基于阴影的颜色信息，并不能克服颜色信息本身 的不足，而单一的纹理特征检测也不能很好的检测阴影，通过无参化颜色特征和 纹理特征LBP检测的融合，可以使得阴影去除算法能够相互补充，尽量弥补各 自的不足，共同作用检测阴影。下面是对融合算法的介绍：
a.首先通过无参化颜色特征检测算法进行阴影检测得到第t帧的阴影二值掩码 图〃冲。
b.其次利用LBP纹理检测算子检测阴影得到第t帧的阴影二值掩码图M皿。
c.通过对两个模板求与得到初步的阴影二值掩码图心如如。
d.对得到的二值掩码图利用图像连通分量标记以及形态学处理方法得到较为完 整的车辆前景图。
最后的操作主要是通过连通分量标记算法标记各个连通区域，在检测出的阴 影区域中，利用尺度小的滤波器去除被错误划分的小区域，对检测出的目标区域， 也进行同样的操作。然后再通过形体学腐蚀膨胀操作获得最终的阴影检测结果，
最终检测到的车辆前景如图3-15所示
图3-15去除阴影的车辆前景图
从图3-15可以看出，相比于之前的检测算法，改进算法可以很好的去除阴影,
并且较为完整的保存车辆信息，这为后续车辆跟踪奠定了良好的基础。
