3.1.3背景建模算法
在运动目标检测领域，背景建模是比较常用的算法之一，它的基本思想就是 对视频序列的背景通过建模，利用当前图像与背景的进行作差对比，可以得到前 景目标位置。背景建模算法自提出以来，存在诸多挑战如光照变化，背景的变化， 运动物体的阴影，以及场景噪声等，因此许多改进算法相继被提出。下面是背景 建模算法主要流程框图：
图3-5背景建模流程
(1)平均背景模型
平均背景模型【叫计算方法简单，且计算速度快，但是这种方法对环境光照变 化以及背景的变化比较敏感。其基本思想是通过对连续*帧的图像中每个对应的 像素点求取平均值得到背景模板的像素BAx,y),具体的计算公式为：
i+k
Bk(x 7 >-			 (3-5)
k
当检测当前视频帧时，只需要将图像像素值I(x,y)与背景模型中对应位置的 像素值Bk(x,y)作差，得到差值D(x,y),再将其与合适的阈值进行比较得到最 终的输出图像。
D(x, y) = /(x, y) 一 Bk (x, y)
\ \D\>TH
0? otherwise
关于77/的选取，则要借助于差值图像每个像素的平均值和标准差，具体计算 方法是：
E(x,(3-8) 1 M
Udlff(x,y) = — ￡	(3-9)
z=inter+l
J
7~\	插	A
- z (月(早)-。姆(时))2	(3-10)
\ /=inter+l	丿
通常为了保证求得的平均值和标准差的准确性，M值得选取要相对大些。此 时阈值TH可以通过公式：
TH = U.(x,y) — B*di0”d	(3-H)
与此同时要进行背景模板以及相关信息的更新。
L> (x,丿)=(1 一 q) xD(x, y) + ax 7(x, y)	(3-12)
U奶(x, y) = (1 - 口) * Udlff + □ x 日(x, y)	(3-13)
d飢a (x, _y) = (1 - a) x diffstd (x, y) + ax 冋 x, y) - U'顿(x, y)\	(3-14)
此处的a是学习率，通过调整学习率的大小可以控制背景模型更新的快慢，一 般a越大，对背景的变化的适应更快。
(2)单高斯背景模型
单高斯背景模型的基本思路就是把图像中所有像素点都当成是一个个的随机 分布，如果每个像素点的出现的概率是满足一个均值为",，方差为0的高斯分布, 用公式表达为：
1	一 E)2
P(Z(x,j,r)) = -7—e 潟	(3-15)
伊0
对于t时刻的像素值I(x,y,t),可以通过以下公式判断是否是背景像素：
号(X,》)=(1 一 a) x 度J (x, y)+ax (J(x, y, t) -u, (x, y))2	(3-16)
O(x,y,0 = ￡'	IK"。*-心，力I < Ox %(时)	(3.]7)
[1, otherwise
对于图像序列的初始背景模型的建立也比较重要，这里初始的均值和方差通 过下面公式计算：
uQ(x,y) = 7(x,^,0)	(3-18)
= std _inif	(3-19)
之后更新的策略是
u, (x, y)=(l-a)x ”,_i (x, y) + axl(x, y, t)	(3-20)
号(x, y) = (l-a)x	(x, p) + a x (7(x, y, 0 -ut (x,、))	(3-21)
算法具体的流程如下：
a.首先利用第一帧图像根据公式初始化背景模型
b.通过公式判别是否为前景像素点
c.依据背景更新策略更新背景模型
d.根据更新后的背景模型重新返回b步骤，进行检测
(3)混合高斯模型
由于在实际中，背景环境可能存在着多种扰动，如光照，树木的晃动等，会 导致背景像素值的不固定，而单高斯模型中将单个高斯分布作为像素值的概率密 度分布，这不利于处理多模态背景问题，因此在单高斯背景模型的基础上，混合 高斯模型做岀改进，对于一个背景像素点用M个高斯模型来表示，进而通过加 权平均这些高斯概率密度函数来近似表达任意形状的概率密度函数，所以每个像 素点出现的概率可以表达为：
= ￡w；Q(x,u")	(3-22)
i=l
其中讨为在时刻，第，个高斯分量的权重，对于这M个高斯分量，满足以 下公式的前n个高斯分布被认为是背景模型。
"=argmin 伍叫 >丁｝	(3-23)
b I-
其中T如果选取的较大，则可以描述相对复杂的背景，『如果选取的太小,则模型就成为单高斯背景模型，通常，选取『为0.7。
如果当前像素值其乂。与选取的前〃个背景模型中的第L个高斯分布匹配， 也即I(x, ys t)在 以；-zxb；,”；+zxcr；]范围内，通常z设置为2.5,则I(x, y, t)被 认为是背景点，反之就是前景，此时输出图像表达为：
O(x, W) = (°’ 此-腿31(可刃)W + *；	(3_24)
[1, otherwise
当像素点被检测为前景像素点，表示没有与这n个高斯分布匹配，因此选取 一个新的高斯分布代替当前高斯分布中权重最小的一个，这个新的高斯分布的期 望值就是当前像素值。当像素点被检测为背景像素点，此时就对该像素的权重信 息以及与之匹配的高斯分布的均值和方差进行更新，更新算法如下：
w； =(l_a)xw「'i <L	(3-25)
u, =(1 —+ eq)	(3-26)
(#)2 = (1 —0)x(用-y + QxQQ) — ")	(3-27)
其中a是权重学习因子，月是均值方差学习因子，都在0?1之间。如果当前 像素分布与第，个高斯分布匹配，则妬为1,否则为0。
从混合高斯分布的原理以及更新策略可以看出，这种方法有效的降低了噪声 的影响，混合高斯分布尤其适用于检测运动缓慢的物体，因为在短时间内不会形 成新的高斯分布，这样就比较容易被检测出来。混合高斯分布优于普通的二值化 分割方法的原因是由于图像中每个像素的运动特性都不同，这种情况下，每个像 素点分割所需要的阈值不尽相同，而二值化分割统一阈值会导致分割结果的不准 确，混合高斯分布通过对图像进行局部分割，更加精确。
⑷ ViBe
在2011年,Olivier Bamich[12]等人提出一种新的背景建模算法，即ViBe算法。 该算法是一种快速进行背景和前景目标检测的算法，现在的许多算法是通过收集 大量的点进行建模，并在模型找出匹配的多数点，通过当前点与多数点的值进行 最终的分类，而ViBe算法通过把背景像素点集合在一起作为背景模型，当前的 点需要与背景模型中的各个点进行比较，寻找色彩空间中距离相近的点。ViBe 算法通过视频的第一帧完成建模，效率高，实时性好。
ViBe背景建模算法通过为每一个像素点建立一个包含有N个背景像素点的模 型，表达为
M{x) = \vx,v2,...,vn]	(3-28)
其中v,为背景模型中第z?个像素点的值，模型的这N个像素值来自于前一帧， 一般N取20,像素点的分类就是对M(x)分类，在欧几里得色彩空间空间建立一 个半径为R,以v(x)为圆心的圆SR(v(x)),在圆的内部寻找距离像素点x小于R的所有点，并统计其数目为。，如果满足以下公式：
6?{Sr(v(x)c(3-29) 此时当前像素点被分类为背景，反之则是为前景。
图3-6欧几里得空间背景模型以及待分类像素点的分布
从图3-6可以看出在圆内，其他点都在圆外，如果编为2的话，则两 个点都是背景点。下面将介绍ViBe主要的算法思想：
a.ViBe的初始化
ViBe算法将初始化放在第一帧进行，主要思想是从视频的第一帧中的每个像 素点的周围邻域像素点随机抽取，从而建立背景模型。通过实验表明，选取八邻 域像素点会取得较好的结果。假设对于第一帧，用N(x)代表邻域像素点，则需 要建立的背景模型为
M(x) = (v(y I y g N(x))}	(3-30)
其中v(y|yeN(x))需要随机多次，一般随机次数取20,这样就构成了 20维 度的背景模型。
b.ViBe模型的更新策略
关于模型的更新，有三点是比较重要的，首先是随机更新策略，当像素点x 被分类为背景像素点，则随机地从该像素点的背景集合选择一个像素点匕，用x 来代替V,,这种策略能有效提高背景点被保存的概率。其次是时间的二次抽样， 因为在视频帧的处理中每帧都会进行更新，当更新频率过于频繁的时候，会导致 运算速度降低，并且也没有必要，因此可以通过二次抽样降低更新的频率，具体 是对于被判定为背景点的像素，根据一定概率决定是否对其进行更新，通常概率 为l/w，〃一般为16。最后是传播背景点像素，不仅x点的值会更新自己的背 景模型〃(x),也会对x点的邻域背景模型M(yeA^(x))进行随机更新，其中, 是从邻域点中随机选取，并且更新的值也是从x的背景模型中随机取得。这样做 的好处是，当摄像机发生抖动等变化时,不会造成大量的误检，从而保证准确性。
-二
图3-10 Vi Be背景建模检测结果
图3-7中显示图像来自是三个交通视频。图3-8, 3-9, 3-10分别为平均背景 模型，混合高斯背景模型以及ViBe背景模型的检测结果。下面主要从两个方面 进行对比，首先从检测效果上，三种背景建模算法能大致检测出车辆的位置以及 轮廓，平均背景模型和混合高斯背景模型在去噪能力上效果不如ViBe算法，混 合高斯模型对于前景车辆的检测最为完整，ViBe算法较完整，而中值滤波算法 检测的车辆比较不完整。其次从算法复杂度即运算速度上来说，ViBe算法的处 理速度最快，经实验统计，ViBe处理速度约为247仙，因此可以满足系统实时 性要求。
以上分析可以看出，ViBe算法具有较好的抗噪性，抗抖动能力，并且处理速 度快，因此本文系统在此基础上进行背景建模。
