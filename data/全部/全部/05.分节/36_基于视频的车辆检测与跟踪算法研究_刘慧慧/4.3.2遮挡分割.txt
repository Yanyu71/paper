4.3.2遮挡分割
对于遮挡区域，首先将得到的图像区域块进行增强对比度，具体操作是先对 图像区域直方图均衡化，直方图均衡化能够提高图像对比度，然后在此基础上进 行灰度变换，得到强对比度图像。视频图像中某个时刻的光线总是从一个角度投 射过来，因此对于车辆来说分为阴面和阳面。
利用一维最大嫡分割法对得到的强对比度图进行分割。图像的燜是对特征的 一种统计形式，焼反映了图片中信息量的多少，对一幅灰度图像来说，由于灰度 范围是0到255,假设p?表示灰度级为，在图片中所占比例的大小，则此图片的 灰度嫡为：
H = -￡ Pi In Pj	(4-22)
而在图像分割中，需要把图像中的前景和背景目标分割开来，即把图像区域 分成两个区域，目标区和背景区。在灰度图像中，假设存在阈值T对图像进行 分割：
阈值T将图像分为灰度区间在为0-T和T-255的两个区域，对于灰度区域
0~T的区域来说，概率分布为
四)= (￡%)/"
/=0
则该区域的燜为-尸G)lnF(/),则最后总的信息嫡为
= -F(t) In F(t)-(1-F(ty)ln(l- F(0)	(4-25)
当目标可以从背景中准确分割出来，则对应的信息炳最大，因此可通过求信 息炳最大化法找到阈值T,从而完成分割，得到二值掩码图。图4-4(a)中#3号 车通过遮挡检测操作发现存在车辆遮挡问题，(b)图是将这部分遮挡区域单独提 取出来，(c)和(d)分别是对车辆进行直方图均衡化和灰度变换操作的结果，(e) 是通过最大炳分割得到的图像，可以看出得到的二值图像车辆之间不再互相粘连。 但是车辆的分割线还没确定，通过利用椭圆拟合的算法拟合二值图中车辆前景目 标，同时近似得到遮挡分割线。
图4-4车辆遮挡处理中对比度增强和最大靖分割操作
椭圆拟合常用方法是最小二乘算法，最小二乘是一种数学优化算法，主要的 思想是通过求样本数据的最小化误差平方和找到最优匹配函数，通常来说，二次 曲线方程的表达方式是：
F(a,x) = axz +bxy + cy2 +dx+ey + f -Q	(4-26)
若记A = \a b c d e刀'代表曲线的参数，u = [xj xjyj yj xt yt 1]，,其中 表示的是图像像素点坐标位置。由于对于椭圆拟合，有可能因为样本点缺失 或者周围噪声作用的因素的影响，对二次曲线的拟合有可能会退化成双曲线，对 于椭圆方程来说，必须要满足的一个条件是b2-4ac<Q ,这里将这个约束条件 简化为4ac-b2 =1 o
求最小二乘椭圆的问题可以表达为下面的公式：
a = argm$_S||i	(4-27) (4-28)
其中Q代表了进行椭圆拟合的样本点，对公式运用拉格朗日乘数法得到
DrDa = ACa
(4-30)
以上问题就转化为广义特征值求解问题，通过推导求解得到
(4-31)
其中人和为是求得的特征值和特征向量，求得a之后，椭圆相关的参数就确定 下来，比如长轴短轴信息，中心点位置等。
通过椭圆拟合操作，可以得到遮挡区域车辆信息，因为同一车道内的车辆一 般是沿着同一方向行驶，因此光照对车辆造成的影响大致相同，所以最后拟合的 椭圆长轴近似平行，如图4-5所示
图4-5椭圆拟合分离遮挡区域
遮挡分割线为位于椭圆长轴之间中心位置且平行于椭圆长轴的直线，它将遮 挡车辆真实前景图分割开，从而进行后续粒子跟踪相关过程。
