4.3.2.2VCFR信道估计子模块设计
VCFR信道估计算法是在LS估计输出后进行进一步处理，期间做时频域转换 是需要调用MAPLE-B2中的eFTPE模块。
本模块中实现难点是VCFR添加比例问题。在上行信道估计中，单个用户占 用的RB数最少可以使用1个RB （共12个子载波），最多可以使用100个RB （共 1200个子载波），RB数使用情况有34种。若在添加信道冲激响应时，采用固定 的比例，首先不利于窗函数的选择，34种RB占用情况，就需要34种窗函数及其 对于的窗函数倒数；其次，eFTPE工作时，只能处理一定数目的点数，采用固定 比例的方式会导致某些情况下无法使用协处理器完成DFT/IDFT运算。在通过仿真 确定性能差别不明显的前提下，本文采用了一种变比例虚载波添加方式。该方式 对不同RB数占用情况使用不同的VCFR数，使得添加完VCFR总点数只有256、 512、1024、2048这四种情况。这种实现方案不单简化了窗函数的使用，也保证了 所有可能的RB使用情况都能通过eFTPE完成时频域转换。具体的VCFR添加方 式如下表4-6 o
表4-6 VCFR添加数目表
子载波数目	添加完VCFR后总点数	添加VCFR数H
Number sc<240	256	256-Number sc
240<=Number sc<=480	512	512-Number sc
480<Number sc<=960	1024	1024-Number sc
960<Number sc<=l 200	2048	2048-Numbersc
54
在本模块中需要使用MAPLE-B2中的eFTPE, eFTPE有两种工作方式。方式 一是信号量模式，釆用信号量模式时，若进行eFTPE计算，DSP核被信号量阻塞, 进入等待状态直到eFTPE返回结果，DSP核取到eFTPE返回数据，继续DSP核 后续处理。方式二是消息模式，采用消息模式时，DSP核将BD配置好，将控制 和数据送入eFTPE, DSP继续后续处理；eFTPE处理完DFT/IDFT运算之后，通 过发消息模式驱动DSP核完成后续操作。在VCFR实现的场景中，考虑到 DFT/IDFT前后模块的强耦合性，若采用方式二，调度复杂，在多用户场景中使用 极为不便。另外，考虑到eFTPE的运算速率快，DSP核进入等待状态后时间开销 不大，而且采用消息机制，消息收发处理也会消耗DSP核资源。综合上述分析， 最后采用eFTPE工作方式为信号量模式。
VCFR主函数的定义如下：
表4-7 VCFR算法信道估计VCFR处理模块函数概述
函数原型	void PuschChanEst_VCFR(
RbNum, pChanEstLS, pCETempDatal, pCETempData2, pChanEstVCFR
)
功能描述	本函数根据输入控制信息得到本
输入参数	RbNum：该用户占用RB数目 pChanEst LS： LS 估计输出 pCETempDatal：使用中间临时全局数组 pCETein pData2 :使用的中间临时全局数组
输出参数	pChanEst_VCFR： VCFR信道估计输出
返回值	无
VCFR信道估计的处理流程图如下图所示:
55
图4-8 VCFR信道估计处理流程图
