4.1.2MSC8157eFTPE简介
MSC8157中MAPLE-B2提供的eFTPE提供强大的DFT/IDFT运算能力，为基 于VCFR拓展信道估计算法的高效实现提供了可能。在LTE信道估计算法实现中， 需要使用该协处理器的eFTPE,在本小节中将对eFTPE进行详细介绍目习。
eFTPE的FFT/IFFT/DFT/IDFT运算与具体协议无关，不受MAPLE-B2的操作 模式影响。在基于VCFR拓展的信道估计中，eFTPE主要运用于变换域去噪操作 时完成频域到时域的转换，以及去噪完成后完成由时域到频域的转换。MAPLE-B2 中的eFTPE为了适应LTE中的应用，其功能不单是完成快速傅里叶变换或离散傅 里叶变换，除了这些变换之外，eFTPE还有去频偏、Guard Band插入、循环前缀 去除等功能。本文中，考虑到对eFTPE的使用主要为DFT变换及DFT反变换， 对eFTPE其他在本文中不使用的功能将不做介绍。
1) eFTPE的数据结构
输出到eFTPE中的数据是由MAPLE-B2中的DMA自动获取的。输入数据在 系统中的存储位置可以再eFTPE BD中的控制比特进行配置。一旦工作完成， MAPLE-B2会通过内部的DMA将结果送到指定的存储区域，输出的存储位置也 是有BD中的控制比特进行配置。
45
•输入的数据结构
eFTPE的控制信息都是通过BD来传入的。eFTPE根据输入处理数据的格式 可分为两类：模式一支持输入数据为一个复数32bits,其中16个bit为实部，另 16个bit为虚部；模式二支持的输入数据为-•个复数16bits。由于本文中设计得数 据符号模式一，现介绍模式一下数据的输入结构。模式一时，要求每个复数点为 32bits,并且数据起始位是128bit对其。具体数据排列见下图：
图4-2 eFTPE数据排列结构㈣
在eFTPE 一个BD配置多个job时，每个job在内存中依次排列，但是每个job 中数据的起始位仍应满足128bit对齐的要求。
•输出的数据结构
一旦eFTPE完成了其处理，MAPLE-B2会将数据放回到系统内存中，输出数 据的存储位置有BD配置中的OBA字段进行配置。其输出结果的格式以输入数据 格式一致，如上图4-2所示。
2） eFTPE的内部幅值缩放调整
为了尽量避免对溢出进行饱和处理，eFTPE提供了两种幅值缩放模式。缩放 模式分别为：用户缩放和自适应缩放。除了这两种缩放方式之外，还有其他方式 可以控制eFTPE整体的幅值计算。
/总缩放量配置。该配置允许在自适应缩放模式时对最终结果进行调整来满 足对输出结果幅值的要求。
/输入调整系数。该模式会在输入eFTPE时配置调整系数，该调整指数会用 于计算总的缩放值，对数据进行调整。
/额外的缩放。该功能可以在自适应模式时根据输出值具体情况，来决定最 终的缩放结果。
由于用户缩放模式和自适应模式是常用的eFTPE系数调整模式，下面将重点 介绍着两种模式。
•用户自定义缩放模式
为了避免对溢出的DFT点进行饱和处理，用户自定定义模式根据用户的设计, 在每个DFT运算阶段结束后执行向下缩放来调整运算结果。使用该模式，需要将 BD中的SCLTYPE指示位进行置位操作。eFTPE可通过设置eFTPE BD中的 USR_SCLx（x=O,l,……4）, PM SCL以及POJCL来完成每个阶段运算结束后幅值
46
的缩放。
USRJCLx（x=Q,\,……4）域的配置可以决定在哪个阶段结束后进行调整。例如， 对USR_SCLO进行置位之后，会在蝶形运算的第一个阶段结束后根据缩放因子对 该阶段输出结果进行调整；
PACSCZ域可配置为。或1作为潜在的向下调整系数，当釆用前乘处理时，该 域置为1。
PO_SCL域可配置为0-2,作为潜在的向下调整系数，当使用后乘处理时，该域 应置为2»
•自适应模式
采用自适应模式时，如有必要，eFTPE会自动在每个处理阶段结束后执行幅 值的缩小操作。每个阶段结束后缩小的倍数会基于下一阶段运算不溢出这一前提 进行最小范围的调整。
为了激活自适应模式，需要对eFTPE BD中的SCLJTYPE域设置为1。
使用自适应模式时，各阶段的调整倍数会进行累积，并把最后输出时整体调 整倍数写入eFTPE BD中的ADP_OVA_SCL_ST域。使用者可以根据该域的值掌握 自适应模式的调整倍数。
当BD项PT被置位时,意味着在每个BD中有多个任务需要进行运算。这时， 自适应模式输出的调整倍数反馈会有多条，这些反馈回的值将不再在 ADP_OVA_SCL_ST域输出，而是根据eFTPE BD中BDJTAT_PTR中设置的内存 地址，写入指定地址中。
