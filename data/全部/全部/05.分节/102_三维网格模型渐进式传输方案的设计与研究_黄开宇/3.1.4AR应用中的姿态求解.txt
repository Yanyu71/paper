3.1.4AR应用中的姿态求解
AR应用的渲染流程与VR、3D游戏等三维场景应用相同，但是显示过程有 所差异，因为AR应用需要通过对模型的姿态求解来确定与现实世界的联系，才 能准确定位在现实世界的空间。因此，针对AR类应用，需要额外关注三维模型 的姿态求解的过程，并依据定位结果计算模型的重要程度。
在了解姿态求解过程前，需要了解相机的成像过程，前文已经介绍了具体的 坐标转换过程。现在将三个坐标系中坐标的变换过程抽象成一个公式，它的输入 是模型在空间中的顶点位置(xw,yw,zw),输出是二维图片上的位置信息(u,v),中 间需要两次投影变换，姿态矩阵变换和投影矩阵变换。模型上所有的顶点都会经 历这样一个从三维的世界坐标系投影到二维平面的投影变换过程。
其中，R为旋转矩阵，T为位移矩阵，f、uo、Vo分别代表相机焦距和主轴偏移, 虫、dy为相机视角宽髙。整个姿态求解的过程就是寻找3D模型从世界坐标系的 原点如何移动到一个特定的位置，使得模型在相机坐标系中符合需求。移动的过 程可以使用一个姿态矩阵表示，可以分为位移矩阵和旋转矩阵。位移矩阵T是相 对X轴、Y轴、Z轴的位移距离，旋转矩阵R是相对X轴、Y轴、Z轴的旋转 角度。
rll r12	r13
R T] = W r22 r23
0T 1」r31 r32 r33
姿态求解也被称为PNP(Perspective-N-Point)问题，通过现实空间中的N个特 征关键点与图像成像中的N个成像点计算出其投影映射关系，从而解决相机或 物体位姿的问题。当选择三组图像中可见的关键点(2D/3D),结合公式3-2和 3-3组成了三组投影矩阵方程，每个矩阵方程可以拆解成两个方程组，最后就得 到六个方程组。而姿态的关键变量就是平移矩阵的三个变量和旋转矩阵的三个变 量，通过六个方程组就可以求解出这六个变量。由于图像识别以及固定模型之间 存在的误差，所以常需要大于三组的关键点进行拟合运算，求出误差最小的解。 如果计算的模型是非刚体模型，计算过程会变得更加复杂，比如人脸，需要考虑 56+组的FACS系数，为了简化计算过程，本文中所指的3D模型都是刚体模型。
23
