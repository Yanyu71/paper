2.3.3到达时间
TOA法和TDOA法都是基于测距的定位算法，并且都是通过测量时间并将 时间换算成距离来实现测距，在位置估计中则通常与三边定位法结合。
TOA法通过TOA获得接收器与多个发射器之间的距离，继而估计出接收器 的位置。在TOA法中，通常是在LED的发送信号中加上发送时间戳，接收端在 接收到信号后根据本地时间戳和发送时间戳得到信号传播时间，继而可以利用信 号传播时间与信号的传播速度计算得到发射端与接收端之间的距离。
以即，九,J表示LEDi的位置，［xq,z了表示接收器的位置。LEDz•和接
17
收器的距离4可以表示为
4 = f J +(%-几 J +3 — j =c.Tj	(2-9)
其中，c为可见光信号的传播速度，即光速；马表示LEDi与接收器之间的信号 传播时间，可以根据LEDi信号的发射时间”血,和到达时间计算得到，即
务-'arrivalJ - 'depart j	(24。)
由式(2-9)可以看到，在2-D平面，每一个TOA可以确定一个圆，接收器落 在该圆上；在3-D空间，每一个TOA可以确定一个球面，接收器落在该球面上。 因此，在TOA法中，对于2-D定位,接收器需要接收到至少3个不共线的LED, 如图2-4所示，以3个LED为圆心，以它们各自到接收器的距离为半径可以获 得三个圆，这三个圆的交点即为接收器的位置。对于3-D定位，接收器则需要接 收到至少4个不共线的LED,接收器位于它们所确定的一组球面的交点。在实 际应用中，由于测量误差等原因，各圆(或各球面)往往不会交于一点，因此在 求解中通常使用最小二乘法求得最优解［6工
图2-4 TOA法原理
TOA法对时间同步要求严格，要求所有发射端和接收端都要在时间上同步, 因此在实际中较少使用。TDOA法则是对TOA法的改进，不同于TOA法中利用 TOA的绝对值，TDOA法利用的是TOA的差值，即TDOA,从而相对降低了对 时间同步的要求，只需要发射端之间在时间上同步。TDOA法通过TDOA计算 接收器与不同发射器的距离的差值，继而来计算接收器的位置。
LEDz•和LED/与接收器的距离的差值为可以表示为
d. 二 d - d y f j
=一加『+ (% 一 九『+ (马 — 4 J - J(X, — X, J +回一九 丫 + ),一 4 J
= c-Ar i j
(2-H)
18
其中，为来自LEDi和LED)的可见光信号到达接收器的时间的差值，可以 计算为
'arrival,i	'arrival, j
(2-12)
由式(2-12)可以看到，在2-D平面，每一个TDOA可以确定一个双曲线，接 收器落在该双曲线上；在3-D空间，每一个TDOA可以确定一个双曲面，接收 器落在该双曲面上。因此，在TDOA法中，对于2-D定位，接收器需要接收到 至少3个不共线的LED,如图2-5所示，以LED1、LED2为焦点，可以确定一 条双曲线，以LED1、LED3为焦点，可以确定另一条双曲线，这两条双曲线的 交点即接收器的位置。对于3-D定位，接收器则需要接收到至少4个不共线的 LED,接收器位于它们所确定的一组双曲面的交点。
图2-5 TDOA法原理
TDOA的测量是TDOA法的重要步骤。对于使用时分复用(Time Division Multiplexing, TDM)的定位系统，由于各LED的信号已经在时间上区分开，因 此可以直接测量TDOA",33］。对于使用频分复用(Frequency Division Multiplexing, FDM)或其他复用机制的定位系统，一般需要间接地测量TDOA,常用的一种方 法是通过测量信号的到达相位差来获得TDOA。在［34］提出的基于TDOA的可见 光室内定位系统中，FDM被用作复用机制，各LED在其所分配的频率上发射正 弦光信号，接收端在收到信号后利用希尔伯特变换将信号分解成同相分量和正交 分量，以计算各对信号之间的相位差，然后根据相位差、各LED的调制频率以 及光速，就能计算出对应的距离差。［35］也采用了类似的正弦光信号，不同在于 其相位差是通过测量正弦信号峰-峰波幅来获得。
TOA法和TDOA法在理论上和仿真中能达到厘米级的定位精度5,32,34 36］o 但是TOA法对时间同步要求严格，虽然TDOA法相对降低了对时间同步的要
19
求，但TDOA法和TOA法一样都需要非常精确的时间测量。然而，可见光信号 的传播速度极快，并且在室内场景中，信号的传播距离又通常较短。因而,在TOA 法和TDOA法的实际应用中，微弱的时间测量误差就会导致较大的定位误差。
