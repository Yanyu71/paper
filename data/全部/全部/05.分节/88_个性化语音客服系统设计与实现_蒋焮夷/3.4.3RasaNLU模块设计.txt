3.4.3RasaNLU模块设计
本模块的设计图如下所示，该模块基于Rasa框架搭建，将NLU处理详细的 流程分解，并单独配置，达到解耦合和可插拔的使用目的。其接收的文本消息来 源于后端请求处理模块转发的前端输入文本消息，其主要包含了 NLU模型训练、 单轮文本信息理解和重要信息提取以及后端服务器接收文本消息等功能。其文本 信息处理的p^Hne流程图如图3-11所示。
29
輪入文本
实体信息和意图信息
图3-11 RasaNLU Pipeline模块设计功能设计图
该p5)Iine构建基于前文中对于pip line各个功能部分的分析选型，结合本文 实现的点餐机器人系统这一垂直任务型对话领域的特点选用预训练的Spacy中 文词向量模型，其来自官网的基本性能数据如图3-12所示。
30
Accuracy
Type
Score
TOKEN_ACC
97.88
TAG_ACC
90.38
DEP_UAS
70.82
DEP_LAS
65.60
ENTS_P
73.71
ENTS_R
69.20
EFMTS_F
71.38
SENTS_P
78.25
SE忖TS_R
72.72
SENTS F
75.38
图3-12 Spacy模型基本性能参数图
其中UAS （未标记的附件分数）和LAS （标记的附件分数）是评估依赖性 分析的标准指标。UAS是正确分配头部的令牌的比例，LAS是头部已被正确分 配正确依赖标签（主题，对象等）的令牌的比例。UAS=a心节点正确的词数/ 总词数*100%, LAS=核心节点正确且依存关系也正确的词数/总词数*100%。 ENTS-P>ENTS-R和ENTS-F是NER任务的精确度、召回率和圧core。TAGS-ACC 是POS标记的准确性。TOKEN-ACC是令牌细分的精确度。
对于同义词实体提取器的作用主要在于一些实体并不是只有一种说法，而实 体识别本文采用了在训练语料中自己标注的方式，而训练语料的数量完全不足以 支撑训练一个包含词向量相似度的模型（这也是采用spacy预训练模型的原因）， 我们使用一个同义词实体提取器来弥补一些近义词的识别（当然也是基于任务型 对话场景范围小，基本可列举的特点来安排）。
本模块也包含了模型的训练，使用Rasa自带的训练器对pq）eline中的实体 提取器和意图识别器进行训练，语料来源于自模拟的点餐机器人语料，包含的实 体和意图信息也是可枚举设定好的，如需要加入新的实体和意图信息，需要修改 配置文件和增加语料的形式将新的实体和意图加入NLU的处理（本文针对的是 垂直的任务型对话机器人领域，所以实体和意图一定是可枚举的，不是开放型的
31
问答型客服）。
本文的实体设置依托于点餐机器人的应用场景，主要的实体围绕点餐的菜品 展开，包含菜品的名称、菜品的属性名称、菜品的价格等信息，同时跟知识图谱 的信息对齐，保留一定的扩展性要求方便之后的扩展。具体的设计图表如下表 3-1所示。
表3-1实体设计表
实体名称.
实体类型
实体介绍
菜品名
字符串数组
用于表示具体菜品（因为单句 中可能不止一个菜品实体出 现）
菜品属性名
字符串
用于标识菜品的属性（包含烹 饪方式、价格、口味等特征）
价格
数字
表示菜品的价格信息
口味
字符串
表示菜品的口味特征，主要包 含甜、辣、咸等口味
菜品类型
字符串	’
用于标识菜品的种类，如主食 类，酒水类、炒菜类、干锅类 等
除了实体的识别设置之外，关于菜品的数量识别也是一个难点，因为点餐行 为是会带上数量词的，而中文输入的数量词需要转换为阿拉伯数字类型的数量词, 且和菜品实体进行对应，因为数量词有非常多种表达，不可能穷尽可能，这就需 要一个数量词提取的模块在进行句子语义理解的时候辅助实体提取，本文采用了 一个简单算法来实现这样的功能，基本的流程如图3-13中文数量值转换阿拉伯 数字算法流程图所示。
32
图3T3中文数量值转换阿拉伯数字算法流程图
首先在处理之前，需要设置一个个位的映射表｛零:0, — ：1,二:2,两:2,三： 3,四：4,五：5,六：6,七：7,八：8；九：9｝以及一个常见的高位映射基础值映射 ｛亿:100000000,万：10000,千：1000,百：100,十：10,个：1,碗：1,份：1,杯：1｝, 通过遍历句子中的字符将在两个表中找到的中文字符连起来得到一个连贯的中 文数量值表示，然后将该中文数量值从低位开始遍历，也就是从各位开始遍历， 使用个位映射表中的对应数值乘以高位基础值映射表中的数值就能得到该进位 的值，整体遍历得到整个中文数量值的阿拉伯数值表示，然后整体句子中所有的 中文数量值遍历得到了一个包含了整个句子所有数量值的数组。且先后顺序为句 子中的出现顺序。
关于意图的识别基于前文的模型选型讨论选择了更适合本文应用场景的 Sklearn意图识别器，该意图识别器充分利用了之前Spacy预训练词向量模型的 向量化生成器使用向量机算法SVN就能完成意图的识别工作，在构建复杂度上 也比较轻量级。
33
