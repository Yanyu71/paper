3.2.2智能客服机器人总体架构
本系统属于多模块组建的高度解耦系统，各个模块之间高度解耦只存在必要 的调用关系，且互不干扰，本文系统的层级结构如图3-2所示：
17
前端视图展示
前端业务层
丈子制入
对话展示
切换音色
语奁录入
语音转换文字
修正
语音消息播
放
后端中转层
Rasa对话服务器交互
前端请求接收路由
语音生成服务器交互
后端业务层v
数据处理
与模型持久层V
Tacotron 2 语音合成模 型
图3-2智能客服机器人系统层级架构图
•前端视图层：主要为视图显示用到的前端技术，这里包含了用到的React
框架以及Ts语言和开源的前端样式库AntiDesign来完成基本页面样式的呈现。
•前端业务层：包含了前端包含的业务功能点，这里主要是一个基本的聊 天框的设计，所以功能上包含了基本的文本输入、气泡信息的显示、特色语音音 色的切换、语音的在线录音、语音识别文字信息修正和语音回复消息的播放功能，
18 这里的功能实现依赖于后端的数据提供所以同时用到了 Axios异步请求库用作 和后端交互的基本库。
•后端中转层：主要是接收前端的信息请求，进行正确的路由，然后和文 字处理Rasa模块进行交互得到文本的回复信息，再通过和语音生成服务器的交 互得到文本到语音的信息，最后将信息整合返回给前端模块。
•后端业务层：实际处理前端的用户请求服务，主要分为RasaNLU对话 理解模块理解本轮对话通过Rasa Action对话处理服务器具体处理应对逻辑，使 用Rasa策略执行器模块实现对话策略的处理以及对话管理模块管理整体对话的 关键信息插槽和重点上下文信息。在语音生成的处理上主要包含特殊音色模型的 切换和中文语音的实时性生成。
•数据处理和模型持久层：包含了系统运行过程中调用的数据和模型，这 里也是主要包含了对话管理的知识图谱数据信息、对话上下文管理的插槽信息、 中文音调的信息、中文分词器的使用、语音合成模型Ihcotron2模型的使用和 MelGAN等声码器模型的调用。
•数据采集和模型训练：包含了训练各个模型使用的数据集和模型的训练 办法，其中主要有自编的智能点餐对话数据、RasaX对话驱动产生的数据、特 色语音自录音的数据、公开数据集的语音数据（包含了清华大学加thchs3O数据 集和AISHELL-3高保真开源数据集）。模型的训练方法主要为从零开始的监督 训练以及基于现有模型的迁移训练。
上文介绍系统的整体架构，下图3-3展示了系统各个主要功能模块的协同工 作模式以及数据的流动方向
19
图3-3智能客服机器人系统交互流程图
•前端交互界面：前端交互界面负责完成智能客服机器人的交互任务，提 供可视化交互友好的前端页面并能完成文字消息、语音消息、特色语音选择等功 能。
•后台中转请求处理服务器：后端请求处理服务器负责将前端请求拦截并 进行处理，连接对话处理模块和语音回复生成模块，属于后端逻辑业务展开连接 算法模型整理结果以及与前端界面请求交互的关键模块。
• NLU对话理解模块：NLU对话理解模块负责处理单句对话的语义表达 解析。通过预训练或者自训练词向量模型进行语义解构，再通过实体提取器进行 实体的提取以及使用意图分类器进行单句对话意图的分类，并将结果信息整理给 对话管理模块进行下一步处理。
•对话管理模块：对话管理模块主要负责依据NLU对话理解模块传递的对 话中实体信息、意图信息以及存储在上下文中的插槽信息依据对话回复策略决定 调用Action对话处理服务器生成可能的回复信息并返回给后端服务器。
• Action对话处理服务器：Action对话处理服务器主要负责依据对话管理 模块传递回来的信息进行具体的逻辑判断，并使用或者设置上下文的插槽信息调 用底层知识图谱信息来生成最相关的回复，传递回对话管理模块。
•对话回复策略：对话回复策略依据对话管理模块配置的相关信息进行策 略的选择，并根据Action对话处理服务器返回信息进行相应的策略处理，如回
20
退策略和置信度过低的默认回答策略。
• Rasa X可视化对话蜩J交互界面：Rasa X可视化对话驱动交互界面是 Rasa框架的重要组成部分，是对话驱动产生新的训练集的可视化版本，能够通 过友好界面的交互来产生新的对话数据，并能及时在交互界面中进行修改使得产 生的对话数据符合预期的逻辑，并将其作为新的训练语料加入下一轮的NLU训 练。
•语音回复生成模块：语音回复生成模块主要负责将文本的回复转为生成 语音波形，其中构建了 Iacotron2模型以及在其基础上增加了一个用户语音编码 器用来编码语音音色特点，实现小样本的语音克隆，并釆用了多种声码器算法或 模型来保证语音生成波形的高质量和快速。
