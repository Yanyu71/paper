4.2.5实时定位模块
实时定位模块在数据收集、数据预处理、匹配测距等模块对数据作了充分处 理之后，通过预测待测节点的坐标和可能出现的位置范围，最终计算出定位结果。 该模块的主要功能是实现快速准确的定位，通过实时扫描Wi-Fi信号数据，匹配 测距结果，以及执行第一阶段和第二阶段的定位算法实现定位。实时定位模块的 好坏需要从两方面来评价，一是单次定位的平均时长，即时效性；二是定位的精 度。模块如果算法过于复杂则无法满足实时的要求，定位就没有意义，会导致定 位延时；定位算法太简单，则不能满足所需的定位精度。因此，该算法必须实现 实时性和精度要求之间的平衡。通过第三章介绍的基于局部线性回归和位置加权 改进后的定位算法计算，得到当前位置的坐标，流程如图4-9所示。
38
由于实时定位对定位的时间要求很高，所以在运算过程中应减少不必要的数 据转移，全部执行过程应集中在几台服务器中，避免因工作量过度均分而导致数 据迁移，浪费时间。这个阶段采用相应的定位算法来实现，通过对计算后的坐标 进行矫正，最后得到当前位置的坐标。
本定位系统的第一阶段通过三边定位法确定一个或几个定位候补，结合加权 情况对候补区域作轨迹圆，进一步计算候补位置的概率。其中最重要的是计算已 知AP信号覆盖范围，以便在求概率时能够作出适当的加权，流程如图4T0所 ZK o
39
图4-10计算已知AP信号覆盖范围的流程图
该算法的时间复杂度为O(n),空间复杂度为O(n)。第二阶段定位算法采用 位置加权的定位算法，通过统计学将定位问题转化为一个根据最大似然概率求最 优无偏估计的数学问题，并利用加权方法求得位置坐标，即可得到比较精确的待 测节点坐标位置。假设实验区域内能接收到有效Wi-Fi信号的栅格有m个，则 该算法的总体时间复杂度为O(m*n),空间复杂度为O(m+n)。
