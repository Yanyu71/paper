4.1.1设计流程
系统的设计流程根据运行的阶段大致分为三个部分，分别是数据采集阶段对 应的数据采集和整理模块，模型训练阶段对应的算法实现模块，以及定位阶段对 应的服务器定位模块。其中第一部分主要的工作是手机APP的设计和优化，这 一部分有关已知AP节点坐标信息以及RSSI、MAC地址、时间戳等诸多特征数 据集的采集部分，因而十分重要。第二部分则是基于原始数据利用局部线性回归、 位置加权、梯度下降、迭代运算等算法找到各部分的逻辑关系，最后使用 Map-Reduce的编程思想实现实现系统的定位算法，以便能够在Hadoop系统上高 效运行。第二部分是系统的核心研究部分。第三部分是系统的实现，包括搭建服 务器平台，同时利用Hadoop分布式集群的并行计算机制将系统的运算复杂度简 化，为算法的实现提供硬件及软件的支持。
系统的架构则可以分为两层，一层是数据整理功能模块，一层是定位功能模 块。定位模块是数据整理模块的下游，两大模块相对独立。图4-1展示了从数据 整理模块到定位模块的数据传输内容。这种单向传输的方式可以提高系统的稳定 性。
图4-1系统架构流程图
图4-2展示了基于MapReduce的定位系统在服务器端的子模块之间的逻辑关系。
28
室内环境区域划分
图4-2系统功能模块图
系统的两个模块负责不同的功能，这两个模块相对独立，只有数据整理模块 到定位模块的单向数据读取操作。换句话说，定位模块在定位期间仅读取下层模 块数据包，而不会将被处理的数据反馈。这种单向数据读取操作可以大大减少数 据传输的量，节省的带宽则可以用在Map和Reduce过程中，减少算法的运行周 期，减少运算时间，提高定位效率。
为了进一步提高Wi-Fi室内定位的定位效率和定位精度，将训练阶段和定位 阶段的工作相互隔离，保持相互独立，实验将分成两个主要功能模块，以实现良 好的效果。研究中，采用客户端主动定位的方案，利用手机客户端的主动操作上 传采集数据，接收、显示定位结果，如图4-3所示。
图4-3客户端定位流程图
从图中可以看出，手机终端的APP应该具有数据存储、上传和下载能力， 并且可以装载定位软件。为了使定位算法相对容易设计和实现，并且算法复杂度 相对较低，选择在服务器执行定位过程。无论是安卓还是苹果的操作系统都具有 扫描AP节点发射的信号并采集瞬时信号强度的功能，利用这一功能开发第三方
29
的数据传输APP将会更加容易实现。结合实验区域的结构图以及APP上传下载 数据的功能，客户端就能配合服务器端将定位的结果呈现在使用者面前。
