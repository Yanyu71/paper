4.1.3系统软件部分
系统的软件部分从功能执行的先后顺序上来看，流程如下：
(1)手机打开APP并扫描周边的己知AP节点，采集必要数据。
(2)用户连接外网，登录客户端并向服务端发送数据上传申请，用户终端通 过验证信息取得数据上传资格。
30
(3)等待服务端的处理，收到定位完成的提示后，开启数据下载功能，获取 定位结果。
(4)打开本地地图，将定位结果呈现在电子地图上。
图4-4展示了 Wi-Fi网络、客户端和服务端的数据传输流图。从图中可见原 始数据从Wi-Fi网络流入手机客户端后再打包送到服务端的数据整理模块，在经 过数据的预处理工作后，由定位模块接收数据并将定位信息以表结构存储于 Hadoop文件系统中。最后的定位结果被送到客户端进行呈现，方便使用者在电 子地图上查阅。图4-4的伪代码描述如下：
31
输入参数：定位AP的信息
输出参数：待测点的定位结果
BEGIN
设定常量COUNT为最大数据采集次数：
循环标量ent初始化为0；
RSSI数组rssi 口初始化为0；
WHILE(cnt<C0UNT){
接收连接请求并传输数据；
从缓存中读取数据：
格式化数据并写入定位引擎模块；
调用递归均值算法求RSSI均值；
cnt++；
)
TF(rssi [0]!=0&&rssi[l]!=0Urssi[2] !=0) { 待测点坐标初始化为(0,0);
调用局部线性回归函数计算距离；
调用定位算法函数计算可能的待测坐标； 调用位置加权函数计算待测点坐标；
}
END
