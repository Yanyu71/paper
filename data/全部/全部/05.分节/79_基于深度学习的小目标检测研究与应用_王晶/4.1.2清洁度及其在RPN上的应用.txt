4.1.2清洁度及其在RPN上的应用
传统的交叉矯损失如公式（2-2）所示，进一步可以将其改写为公式（4-1）, 如下所示：
CE(p, p*) = -p* - log(p) - (1- p*) - log(l 一 p)	(4-1)
其中p*是anchor的标签，取值为1或者0,分别代表正负样本，p是预测其 输出为1的概率，取值范围为0〜1。
而根据上节提到的anchor类别的划分依据，可以知道：
=卩，0.5 <IOU<1
P lo, 0<IOU < 0.5	b 勺
在上节中分析，anchor在上述方法打标签的时候会引入噪声，为减少其在分 类和回归过程中的影响，本节创新性的提出清洁度这一概念并将其作为anchor分 类标签应用于RPN网络。清洁度指标将与每个anchor关联，以便在训练期间自 适应调整其重要性。所以定义清洁度十分重要，它必须满足以下几点要求：1） 能够自动确定，而不是人工经验的启发式设定；2）能够反映anchor成功回归到 所需位置并分类为目标（或背景）标签的概率。
首先，针对RPN网络中的分类分支，网络本身预测的置信度在一定程度上 可以体现出噪声水平，而且它能够满足连续性要求，所以直接将它作为清洁度指 标的一项。其次，基于分类和回归的不一致性卩®,直接将回归anchor和ground truth的IOU加入清洁度指标。这样清洁度的定义如下：
{
a - locr + （1 — a） ■ clsc for b G
n	f	c /	（4-3）
0	for b e Aneg	' '
其中Zoe”和c/Sc分别表示回归精度（回归之后anchor和ground truth的 IOU）和分类置信度（RPN网络打的分数），a控制相应的比例，b为每一个anchor,
38
Apos和Aneg分别表示每个按IOU排序后的前N个正样本和负样本。
这个清洁度c可以直接当做anchor中分类的标签，即代替公式(4-1)中的 一方面能够避免模型产生一些过拟合的预测，另一方面减少了分类和回归的 不一致。表4-1展示了在RPN网络中引用了清洁度的算法流程。
表4-1引用清洁度的算法流程	 输入=1、GT、B、cls_c、loc_r> ◎、N
I：输入图像；GTi输入图像I中的ground truth; Bz anchor集
cls_c：分类置信度；locjr^ anchor的回归精度；a：调节因子，取0.5
N：正样本集的大小，取100
输出*分类和回归的损失：厶心和厶佗Q
1： 4pQs =0、^neg = 0、S= 0
2: for gt E GT do
3:	indices = argsort{10U(B,gty)	-降序排列
4:	Apos- AposU{indices[0: N]: gt}
5: end for
6： Aneg = {(B - A“s)・ indices: 0}
7: for bi € Apos do
& c= a • locr + (1 — a)・ clsc
9:	S= SU{bf:c}
10: end for
11: for b[ G Aneg do S= SU{bj： 0} end for
12： L 血=2汕£(內5)
13: Lreg = ^smooth_Ll
上述算法中的6-11行即为引入清洁度的过程，从中可以看出，利用分类和 回归分支的输出为每个anchor引入了精心设计的清洁度评分，不仅可以作为衡 量anchor回归成功与否和分类概率的指标，而且还可以在训练期间动态调整。
