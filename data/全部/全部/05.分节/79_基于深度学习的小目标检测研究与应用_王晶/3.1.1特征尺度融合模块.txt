3.1.1特征尺度融合模块
前文提到的FPN虽然都通过自顶向下的方法将各层特征融合在一起，但因 在不同层进行独立预测，计算量大大增加。本节提出的FSFM高效的将高、低特 征层融合在一起的同时，几乎未增加计算量，相较于FPN,优势显著。
图3-1 FPN与FSFM融合过程示意图
图3-1分别展示了 FPN和FSFM的融合方法,FPN的具体实现方法已在2.2.1 中详细说明，这里不再赘述。而FSFM是通过低层大特征进行最大池化、高层小 特征进行超像素卷积，从而获得特征大小相同但通道数不同的几个特征层，最后 这些特征层通过通道数叠加的方式进行融合从而得到最终融合的特征图。
(1)最大池化。目标检测框架的骨干网络不管是采用VGG-16还是ResNet- 101,池化层必不可少，它既能保持旋转、平移、伸缩等的不变性，又能减少特 征，减少参数。最大池化，即对邻域内的特征点取最大值，这样能够有效的减少 卷积层参数误差造成估计均值的偏移，保留更多的纹理信息。最大池化需要满足
18
梯度之和不变的原则：前向传播是把邻域内的特征点中最大值传递给后一层，而 其它像素的值直接被舍弃掉；反向传播是把梯度直接传给前一层的某一个像素, 而其他像素不接受梯度，也就是为零。最大池化的前向与反向传播过程如图3-2：
图3-2最大池化的前向与反向传播过程示意图
(2)超像素卷积。低层特征图(128x128x64)分辨率高且尺寸较大，通过 stride=4的最大池化可以变为高分辨率的小特征图(32x32x64),特征图尺寸变 小，分辨率和通道数不变。高层特征图语义信息丰富且尺寸较小，如何将其变为 高分辨率的大尺寸特征图呢？在2.2.1中提到，通过上采样可以实现小尺寸变为 大尺寸，但不管是最近邻上采样还是反卷积，都会引入一定的计算量和一定的噪 声且不改变其为低分辨率特征的事实。众所周知，图像超分辨率重建技术是将低 分辨率(Low Resolution, LR)的模糊图像放大到高分辨率(High Resolution, HR)空间进行图像重建而获得高清图像的一种技术。图3-3展示了图像重建过
图3-3 LR到HR重建过程示意图
输入的低分辨率图像通过骨干网络的一系列常规卷积操作得到LR特征图, 该特征图的大小相比于原图像大小不变，但是特征通道数变为r2 (r为上采样因 子)。对于一个由L层组成的重建网络，前L-1层(即图3-3中常规卷积操作部 分)的实现过程可以表示为：
19
其中，必、bt, l e (1,L-1)分别是网络学习的权值和偏差，坷是一个大小 为nz_j xniXkiXki的2D卷积张量，其中血是L层的特征数量，俭是L层上 卷积核的大小，0是长度为％的向量偏置，0是激活函数。最后一层尸将特征 图lLR转化为HR图像IHR -
在L层，也就是超像素卷积层，将每个"R上的r2个通道通过周期性像素重 排函数得到一个［HR上的一个rxr区域，即大小为HxWx?的特征图被重新排列 成田xrWxl大小的高分辨率图像。其计算方式如下：
IHR = fiQLR) = PS(Wt * /'1(卩R) + bj	(3-3)
其中PS(-)是周期性像素重排函数，具体表示式为公式(3-4)所示:
PS(T)x,y,c = Tlx/ri,[y/r],C*r*mod(y,r)+C*mod(x,r)+c
其中x,y,c分别代表重建图像的长、宽和通道数。至此完成图像超分辨率重 建。重建过程的核心步骤是超像素卷积，该过程虽然叫做超像素卷积，但是未引 入卷积操作，不会引入计算量和噪声。
本文从图像超分辨率重建技术得到启发，但不是在图像尺度上进行重建，而 是在特征尺度上，将低分辨率的高层特征图通过超像素卷积，重建为高分辨率的 高层特征图，而且还能保留丰富的语义信息。假设超像素卷积层输入的特征图大 小为HxWxC,上采样因子为r。从图3-4中可以看出，超像素卷积层通过压缩特 征图中的通道数来扩展宽度和高度。
图3-4超像素卷积
其数学公式可展示为公式(3-5), HR是高分辨率特征图，ILR是低分辨率特 征图。
LR
[x /rj ,[y /r\,r,Tnod(ytr')+mod(x#r)+c-r2
其中x,y,c分别代表高分辨率特征图的长、宽和通道数，其与低分辨率特征
20 图上对应关系为公式（3-5）所示。与使用反卷积（在反卷积操作之前，池化步骤 中必须填充霎）相比，超像素卷积没有额外的参数和计算开销。最后，计算重建 的像素均方误差（MSE）作为训练网络的损失函数。损失函数数学公式可表示为 公式（3-6）：
rH rW
£ = r^HW 工》（醪° - 閲C2）	G-6）
X=1 X=1
高分辨率的低层特征通过最大池化、低分辨率的高层特征通过超像素卷积变 成特征大小统一而通道数不同的特征层，最后将这些特征层在通道上进行叠加， 完成最后的融合。最后得到的特征图既包含低层的位置信息，又包含高层语义信 息。FSFM结构理论上可以嵌入到各种骨干网络中，且几乎未增加计算量。
