4.2.3汽车轮毂X光数据集
在汽车工业中，保证各金属部件的完全可靠性至关重要。近年来，X射线检 测虽然在缺陷检测领域得到了广泛的应用，但仍需大量极具经验的人去判别缺陷 位置及缺陷级别。利用计算机视觉和深度学习技术，结合X光图像，识别微小缺 陷势在必行。
为了建立符合实际生产的标准数据集，本节使用从Dicastal公司的数据库中 导出的汽车轮毂X光图像。轮毂X光原始图像由工业专家使用注释工具进行标 签、边框以及掩膜信息注释，以保证注释的专业性。注释文件以JSON文件保存 为MSCOC0数据集样式。X光图像的原始大小为1024x1024,工业专家按实际 生产需求，将所有缺陷按标准分为一级、二级和三级缺陷。如图4-9所示，其中 所示的两个代表性缺陷分别位于轮辐和轮毂上，都是在铸造阶段产生的。通过图
像实例可以直观看出缺陷的特征：1）缺陷相较于整个X光图像十分微小；2）部
本节采取中国科学院大学于教授团队a］对目标实例的大小定义一绝对大 小(absolute size, AS )和相对大小(relative size , RS ) □假设使用 = 来描述数据集中的第i个图像中的第丿•个目标的边界框，其中 (切，沟)表示左顶点的坐标，Wij,如是边界框的宽度和高度。Wi，厲分别表示 第i张图像的宽度和高度。故目标实例的绝对大小和相对大小计算如公式(4-20) 和公式(4-21)所示：
本节统计了汽车轮毂X光数据集的绝对大小、相对大小和长宽比的平均值 和标准差，并与COCO数据集做了对比，统计结果如表4-3所示。
表4-3汽车轮毂X光数据集与MS COOC数据集对比表
数据集
绝对大小
相对大小
长宽比
X光
从图4-8和表4-3可以得出结论：相较于以小目标著称的COCO数据集而 言，汽车轮毂X光数据集中的目标“更小”，所以，整个汽车轮毂X光图像集可 视为一个小目标检测数据集，并且所有缺陷目标实例覆盖的面积相较于原图很小, 这意味着小目标的检测难度极大。汽车轮毂X光图像原始数据分布如表4-4所 示：
表4-4汽车轮毂X光图像原始数据分布
图像(张)
实例(个)
一级
二级
三级
训练集
从表4-4可以推断出，数据集本身数量很小，缺陷目标实例太少，可能会导 致训练不出合适的模型；二、三级缺陷相较于一级缺陷数量更是稀少，但其比例 符合实际生产情况。
本节将基于旋转的数据集增强策略和基于掩膜的小目标实例增强策略应用 在汽车轮毂X光数据集上，以达到数据集扩充和缺陷实例增强的效果。
47
(a)	(b)	(c)
图4-10汽车轮毂X光图像新标注坐标的计算过程
在权衡了检测器的速度和精度后，本节在汽车轮毂X光数据集进行扩充时， 将N取为15, M取为5,即每张图像每隔15度旋转一次，共旋转6次。图4-10 展示了汽车轮毂X光图像新标注坐标的计算过程：图4-10 (a)显示出了旋转后 的标注框(红色框)不再是水平矩形，导致注释文件不能在CNN中使用。本节 使用原标注框的外接矩形框作为旋转后的新标注框(绿色框)，如图4-10 (b)所 示，此时，新标注框的注释文件能够为CNN所用。图4-10(C)即为最终的标注 框。
汽车轮毂X光数据集得到扩充后，再对具体的缺陷实例进行增强。上一节 的图4-7已具体展示了增强流程。在确定可粘贴区域时，这里需要注意将掩膜粘 贴到轮毂区域，而不仅限于整个图像区域。由于X光图像属灰度图，空白区域是 完全白色的，像素值为255,因此可以通过简单的图像二值化方法直接划分出轮 毂区域和非轮毂区域。然后随机选取一个坐标点作为缺陷掩膜的候选中心点，计 算出所选掩膜对其它缺陷实例的IOU值。如果IOU值大于阈值，就重新选择一 个候选中心点，直到候选区域满足以上两点要求。最后，重复多次粘贴过程，以 生成多个缺陷实例。
表4-5每张图像的缺陷实例增强算法
输入：带有缺陷集A的原始图像X,粘贴重复次数为N
输出：带有新缺陷集A'的增强图像X'
1:确定灰色轮毂区域：H’ = XV 255并初始化4'为一个空集
2: for k = 1 to N do
3:	随机选择一个中心点(x,y)和一个缺陷实例e A
4:	根据中心点仗,刃和缺陷实例Ai(xli,ylilx2i,y2i')iy算掩膜区域范围(x1,y1,x2,y2)
5： If Mean(Hx[x1:x2,y1:y2]) > 0.9 and Max(10U([xx: x2,y2], Anew)) < 0.1
6:	添加(衍,x2f y2)到新缺陷集灯
7: end for
实现效果如图4-11所示，黑色框为原始缺陷实例，其他红色框是通过小目 标实例增强策略生成的。
图4-11缺陷实例增强示例
