4.2.1小目标数据集增强策略
2019年，来自谷歌的Brain团队针对目标检测任务上的数据增强做了大 量的研究和工作。研究者定义了 22个数据增强运算，包括对颜色、几何变换进 行增强，将检测任务上的数据增强策略搜索视为一个离散优化问题。研究者规定 了最终的数据增强策略由K个子策略组成，每个子策略包含N个数据增强运算。 每个运算又包含两个超参数：被用到的概率P和强度Mo P和M被离散化为6 份。训练的时候，每次抽一个子策略，然后把这个子策略包含的数据增强运算应 用到图像上。这样整个搜索空间的大小为：(22XMXP)KXN = (22x6x6)5x2 « 9.6 x 1028,然后用AutoML【38】的策略进行最优数据增强方法搜索，研究者发现 目标旋转是出现次数最多的增强策略，并在多个数据集上验证了目标旋转策略能 够极大的提升目标检测的性能；此外，研究者还得出结论，训练数据集很小的时 候，数据增强方法带来的涨点最多，尤其在小目标上涨的特别多。
Brain所使用的旋转仅对目标实例而言，未改变数据集中图像的数量。本节 基于Brain团队的发现，为对小目标数据集进行扩充并改善角度不变性的限制而
43
导致小目标定位和识别性能差的问题，提出一项基于旋转的数据集增强策略。
基于旋转的数据集增强策略具体步骤如下：在训练过程中，将训练图像每隔 N度旋转一次，一共旋转M次，因此旋转后的数据集扩充至原数据集大小的(M+1) 倍，数据集得到扩充,并且训练的过程中需要各样本有一定区别。图像进行旋转， 图中的目标框也会随之旋转，但旋转后目标框的坐标不是水平矩形，使得新的注 释文件不能在CNN中使用。所以必须对旋转后图像的实例重新计算目标框坐标， 其计算过程如下:
首先计算目标框旋转后的坐标，如公式(4-18)所示，其中冬,％是图像(wxh) 的中心坐标：xc = w/2, yc = h/2, x, y是旋转前目标框的坐标，x', :/是旋转 后目标框的坐标。0是旋转的角度：
(x' = (x — xc) cos 0 — (y — yc) sin 0 + xc
\y' = (x — xc) sin 0 + (y — yc) sin 0 4- xc
则新目标框的左上角为公式(4-18)：
(xti =	瑶，竝)
[yt,z =
新目标框的右下角为公式(4-19)：
xdr = max(%i，X2，X3，x4)
其中也2为新目标框左上角的坐标，为新目标框左下角的坐标，*d,r为新 目标框右上角的坐标，『为新目标框右下角的坐标，址，必为旋转后目标框的 四个坐标。
