3.1.4移动性管理分析模型
本小节首先提出基于VDMM方案的切换延迟模型，然后对分别VDMM方 案与IETF-DMM方案从切换延时、丢包率、信令开销等方面进行数学建模。
（1）切换延迟模型
移动节点之间进行通信时，数据在无线线路和有线线路上的传输都需要 时间，因此都会产生时延。如果移动节点a与b之间的平均跳数为那 么从移动节点从a发送大小为&的数据包到移动节点b的延迟表达式为： 知=侦（务+1）	31）
其中，BW. I分别代表有线链路的带宽和传播延迟。
与有线链路相比，无线链路的传输可靠性较低，因此可能导致数据包传输失败，
并进行多次传输。本论文中用当表示无线链路传输失败的可能性。则在无线
网络发送大小为Z,的数据包的延迟表达式为：
歸=（金+。/（1-今）	（3-2）
其中，BWw. lw分别代表有线链路的带宽和传播延迟。
如下表3-3所示是本章中需要用到的相关符号以及含义。
表3-3符号及含义
符号	定义
TL2	'	2层的切换延退
^Auth	身份认证延迟
&	控制包的平均大小
Ld	数据包的平均大小
BWw	无线链路带宽
BW	有线链路带宽
k	无线链路传输延迟
I	有线链路传输延迟
Pf	无线链路失败的可能性
r	子网半径
本文中提出的分布式移动性管理方案VDMM方案在核心网釆用分布式移动 性管理架构，数据流量通过接入层锚点,（接入AP）进行转发，而不需要通过集 中锚点，因此能够有效降低通信延迟和流量负载。并且，切换完成后新会话流不 需要通过原接入AP而以最优路径转发，有效降低了数据的传输开销。此外， VDMM方案不需要建立隧道，减少了建立隧道的大量移动性管理协议信令，减 少了隧道开销和信令开销。
（2）切换延迟与丢包率
a. IETF DMM 方案
前面我们已经分析过IETF DMM方案的切换流程。在IETFDMM方案中，节点 切换前接入的锚点是sMAAR,节点切换后接入的锚点是nMAAR。在IETFDMM方案 中，用户从sMAAR切换到nMAAR后，nMAAR通过绑定更新/绑定确认消息向CMD 进行注册，CMD中存储着用户的移动上下文信息，CMD收到nMAAR的消息后通过 绑定更新/绑定确认消息通知sMAAR更新映射表项，并在sMAAR和nMAAR之间建立双向隧道用来传输数据詞。因此，切换延迟（HL）的定义是用户能够通过sMAAR 接收/发送数据包的最后的时刻tl到用户能够通过nMAAR接收/发送数据包的最 初的时刻t2之间的时间间隔肉。
Mymd(c)是在MAAR和CMD之间通过有线链路传输控制包的时间延迟，计
算公式如下:
^■MAAR-CMD (c) = (	+ WmAAR-CMD
BW
其中厶是控制包的平均大小，8所是有线链路带宽，/是有线链路传输延迟, 城2^是临迅和CMD之间经过路由器的跳数。
上面介绍了 IETF DMM方案的切换时延，丢包率也是一个衡量切换性能的重 要指标。丢包率(Packet Loss, PL)定义为用户在切换过程中丢失或减少的数 据包岡。在IETF方案中切换过程中没有数据包缓存机制。因此，PL和会话恢复 间隔和数据传输率入成正比。
会话恢复时间T^F定义为一个给定会话在切换之前发送的最后一个数据包 到切换之后收到的第一个数据包之间的时间间隔。丢包率的计算公式如下:
PL?f=&愛	(3-7)
会话恢复时间的计算公式如下：
= Q捋f —dMU_MAAR (c)) + dlMAR_MAAR (d) + dKfU_MAAR (d)
b. VDMM方案
前面已经给岀了 VDMM方案中用户的切换过程和信令流程。在VDMM方案中， 当用户接入到网络后，它将会被分配一个唯一的虚拟AP。而当控制器通过切换 预测得知用户将从一个物理AP切换到另一个物理AP后，控制器会通过信令在新 的AP上为用户克隆出一个虚拟APo由于VAP中保存着链路层和网络层的相关信 息，所以用户并不需要重新进行链路层和网络层的配置，因此切换延迟将会大大 降低。
对于用户来说，一直是同一个虚拟AP为其服务，因此用户感受不到网络侧 的变化，实现了用户在不同AP间的无缝切换。和IETF方案相似，VDMM方案的 切换延迟(HL)的定义是用户能够通过API (MN原来接入的AP)接收/发送数据 包的最后的时刻tl到用户能够通过AP2 (MN切换后的AP)接收/发送数据包的 最初的时刻t2之间的时间间隔。
VDMM方案相对于上面介绍的IETF DMM方案增加了切换预测和切换准备阶 段，因此需要对这一阶段的信令流程进行分析。VDMM方案的切换准备阶段的时 间轴如下图3T4所示。首先，API通过二层(L2)信令检测到切换即将发生并 触发切换准备过程。API向控制器发送VAP Move Request消息，消息携带MN3
即将迁移到的AP信息(AP2_IP)和MN3的虚拟AP (VAP3)的状态信息。控制器 收到VAP Move Request消息后，得知用户即将移动到AP2,控制器向AP2发送 消息VAP Duplication消息，消息携带MN3的虚拟AP (VAP3)的状态信息，状 态信息包括BSSID,操作信道等信息。AP2收到VAP Duplication消息后，通过 消息携带的VAP3的状态信息在AP2上克隆一个VAP3O AP2更新它的映射表 <MN3-IP, VAP3-ID>O控制器更新它的映射表，将MN3当前所在AP更新为AP2-IP, 映射表项为<MN3-IP, VAP3-ID, AP2-IP>0 AP2向控制器返回确认消息VAP Move
Confirm0控制器向API发送VAP Release消息，API释放VAP3。此时，切换准
备阶段工作完成。
图3-14 VDMM方案切换准备阶段
1 匸	q	土 M長一4	书			aq
T E		>
图3-15 VDMM方案切换延迟
如图3-15所示是VDMM方案的切换延迟。
与IETF的切换方案类似，VDMM方案的切换流程也包括下面三个部分:
rpVDMbd 	 rrt , rrt . rrtVDMM
lHL = 1L2 ^1Auth Binding
匕2代表链路层建立延迟，即用户接入AP时建立链路层连接的时间;
乙効代表验证用户身份的延迟，即用户接入AP时验证用户身份的延迟;
嘴議代表VDMM方案绑定注册过程的延迟。
下面计算VDMM方案的切换延迟，用户身份验证延迟一般变化不大，可以认 为是常量，因此主要计算绑定注册过程中的延迟以當，如图3T5所示，璞# 的计算公式如下：
環# =2电好）+瓏	（3-10）
MN3移动到AP2后，向AP2发送接入请求消息RS。AP2收到RS消息后， 由于此时MN3的虚拟AP己经迁移到AP2,所以MN3可以直接与AP2建立连接而 无需再执行一次连接过程，不会产生额外的2层和3层的处理消息。连接建立后， AP2返回给用户RA消息。
在公式3-10中，7#是AP的处理时间。
始“?是用户和AP之间通过无线链路传输控制包的时间延迟，计算公式 如下：
"mn-ap (c)=('
其中〔是控制包的平均大小，是无线链路带宽，九是无线链路传输延 迟，与是无线链路失败的可能性。
上面已经介绍了丢包率的定义，丢包率（Packet Loss, PL）定义为切换过程 中丢失或减少的数据包。目前在VDMM方案的切换过程中没有数据包缓存机制。 因此，和上面类似，丢包率PL和会话恢复间隔和数据传输率入成正比。
会话恢复时间洗定义为一个给定会话在切换之前发送的最后一个数据包到 切换之后收到的第一个数据包之间的时间间隔。丢包率的计算公式如下：
pT — 2 T ^rNFV-DlM
r知为枷一儿SR	3
会话恢复时间的计算公式如下：
=。曾 -+ d奸妃⑷ + dg仙（d）	（3-13）
上面的公式是在VDMM方案没有数据包缓存机制时计算的丢包率。但在上一 章的方案流程中，我们可以继续对VDMM方案进行拓展。可以拓展AP使其具有数 据包缓存的机制，这样当用户离开API后，API缓存由对端发送过来的数据包， 当控制器感知到用户的迁移后，下发指令控制用户的虚拟AP也进行迁移，此时 可以将用户的虚拟AP和缓存的数据一同迁到AP2上，这样可以最大程度的减少 丢包?
具体做法是：当MN3从API切换到AP2时，API检测到用户离开，则启动数据包缓存机制。当MN5继续向API发送数据包时，由于此时找不到MN3,则API 会将数据包进行缓存，当MN3切换并接入AP2后，控制器下发指令将MN3的虚拟 AP从API切换到AP2,同时将API中缓存的发给MN3的数据也切换到AP2,之后 MN5发送给MN3的数据包则可以直接发送到AP2,由AP2转发至MN3。这样做可 以避免用户在接入到新的AP后由于没有对数据包返回确认帧而引发TCP重传机 制重传数据包，而且可以尽可能的减少丢包。
若对VDMM方案进行上面的拓展使AP能够支持数据包缓存机制,则此时VDMM 方案的丢包率可以认为是0。
（3）信令开销
信令开销的定义是移动节点切换过程中，移动性管理信令的总开销。本方案 中信令开销的定义为切换相关的信令在发送过程中经过的路由器跳数与单个信 令消息开销的乘积之和。因此，单个信令开销越大，信令发送过程中经过的路由 器越多，则总的信令开销越大。因此，在IETFDMM方案中，如果MAAR和 CMD之间距离越小，则PBU/PBA信令开销越小，同样如果MAAR之间的距离 越小，则隧道建立过程中的信令开销也就越小；而在我们的VDMM方案中，如 果控制器Controller和AP之间的距离越来越小，则PBU/PBA信令开销越小，而 如果AP之间的距离越小，则用户在不同的AP之间切换时产生的信令开销就越 小。
根据方案描述，信令开销C可以分为2部分：1）移动节点位置更新过程的 信令开销G，“g； 2）隧道建立过程中信令开销Gsa。即
C 一 ^update + C丽肅
在IETF DMM方案中，移动节点切换后，节点之前连接的sMAAR与节点 当前连接的nMAAR通过PBU/PBA消息与CMD通信更新节点位置信息，同时 sMAAR与nMAAR之间建立隧道，因此，信令开销的计算公式如下：
(3-14) (3-15)
而在VDMM方案中，移动节点切换后，AP与Controller之间通过VAP Move Request/VAP Duplication/VAP Move Confirm消息在节点新接入的AP上为节点 克隆一个虚拟AP,而VDMM方案不需要建立隧道，因此减少了建立隧道的信 令开销 J。因此VDMM方案的信令开销为：
C = Cupdate = 4*仙,Conger * ^AP-Con	(3-17)
假设在相同网络环境下对比2个方案，则	皿与Cgc。”可近似相等，
因此从上面的分析结果可以看出VDMM方案的信令开销要小于IETFDMM的信 令开销。
