2.1.2部分分布式移动性管理方案
与完全分布式移动性管理方案不同，部分分布式移动性方案中控制层和数据 层是并不全是分布式的。其中控制层是集中式管理，而数据层是分布式管理的， 因此在此方案中需要有一个移动性管理实体来管理移动节点的上下文信息，存储 网络中移动节点的的绑定条目⑴。方案引入了一个集中的数据库CMD来收集节点 信息，网络中的移动锚点通过绑定更新/绑定确认消息向CMD注册节点的相关信 息，锚点需要节点移动上下文信息只需通过信令向CMD查询，减少了移动锚点之 间的信令交互，因此与完全分布式移动性管理方案相比，部分分布式移动性管理 方案会更加高效。
部分分布式移动性管理方案，又称为基于PMIPv6的分布式移动性管理方案。 部分分布式移动性管理方案继承了 PMIPv6的许多特性。PMIPv6协议是一个典型 的集中式移动性管理协议。在PMIPv6中，本地移动锚点LMA和移动接入网关MAG 之间建立双向隧道回。用户的上行数据由相应的MAG接收并通过隧道转发到LMA, 然后由LMA将数据包转发到网络中。类似的，下行数据则首先由LMA接收，然后 通过隧道派发到MN当前接入的MAG,再由MAG转发给MN。通过在LMA和MAG之 间使用PBU和PBA消息来协调网络状态，使LMA知道MN当前接入的MAG%
在基于PMIPv6分布式移动性管理方案中，MAG的角色被锚点MAAR替代。MAAR 作为接入路由器，负责转发来自或去往网络的数据包。同时MAAR具有移动锚定 的功能，当节点改变接入点时不会中断数据流。PMIPv6的LMA角色被CMD替代。 CMD存储每个节点的信息，包括为节点分配的所有前缀以及节点当前所在的 MAARo此外，扩展PMIPv6中的绑定更新/绑定确认消息，在节点发生切换之后由 CMD通过发送指令更新节点的移动上下文信息，将到达家乡锚点的数据通过隧道 转发至节点的当前锚点，使节点的通信不要中断或。
图2-2部分分布式移动性管理架构
如图2-2所示是部分分布式移动性管理方案的架构图，图中虚线表示信令流, 实线表示数据流，箭头表示流的方向。方案包括了几个路由器MAAR和集中管理 数据库CMDo MN初始接入的锚点是MAAR1。
图2-3部分分布式移动性管理信令流程
如图2-3是部分分布式移动性管理方案的信令流程,，包括节点接入网络和 节点的移动切换流程。MN首先向MAAR1发送RS消息申请接入网络，MAAR1收到 RS消息后检测到MN的接入。MAAR1为MN分配一个网络前缀MN:Prefixl,然后 MAAR1通过扩展的绑定更新/绑定确认（PBU/PBA）消息通知CMD关于MN的接入 信息，向CMD进行注册，注册信息包括MAAR1为MN分配的网络前缀。由于MN 是初始接入，CMD为MN创建一个新的表项来存储MN的当前位置信息和MN获得 的网络前缀的映射表项。然后MAAR1通过RA消息将网络前缀通知给MN。则MN接入网络成功。此时CN1和MN之间的数据通信通过MAAAR1进行转发，如图中的 通信 Traffic： Prefixl。
如图2-3, MN发生切换，从MAAR1切换到MAAR2,重复之前的接入过程。MAAR2 收到来自MN的RS消息后,MAAR2为MN分配一个新的网络地址前缀MN：Prefix2。 MAAR2向CMD发送PBU消息，然后CMD更新MN的数据库表项，更新MN当前接入 点为MAAR2。CMD通过PBU/PBA消息指示在MAAR1和MAAR2之家建立一个双向隧 道。隧道用于将发往家乡锚点的会话从MAAR1重新定向到MAAR2。但隧道只用于 转发节点切换之前建立的通信会话，如图中所示Traffic： Prefixl通过隧道由 MAAR1转发到MAAR2。而MN切换之后新建立的通信则不需要通过隧道和MAARL 直接经过MAAR2转发到MN,如图中的数据通信Traffic： Prefix2。
由上述描述可以看到，在此方案中，数据层是分布式的，在MAAR之间转发。 而控制层则是集中式的，都由CMD进行控制。因此这个方案又称为部分分布式移 动性管理方案。
部分分布式移动性管理方案对于流的动态控制是通过为MN分配新的IPv6前 缀来实现的。MN每移动到一个新的MAAR后，MAAR都会通过RA消息分配一个新 的前缀给它，则MN使用新的前缀来建立新的会话飯。因此，每个MAAR会有一个 IPv6的地址池，当MN进入它的接入链路时，MAAR会从地址池中选一个地址分配 给MN。因此，按照MN访问过的MAAR, MN可能会有多个IPv6地址，数据流也可 能锚定在不同的MAAR上。但为每个MAAR配备一个地址池可能会造成资源上的浪 费，而且由于节点每到达一个网络就需要为节点分配一个地址，那么就需要扩展 节点能够支持多个IP地址，这为方案的实际推广带来了一定的难度。
