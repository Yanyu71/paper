1.2.2代理移动IPv6协议(PMIPv6)
代理移动IPv6协议是一个基于网络侧的移动性管理协议。与MIPv6协议不 同的是，PMIPv6中主机不需要参与移动性相关信令，由网络侧实体代替主机来 进行IP移动性的相关管理。
MIPv6协议上面己经介绍过，在MIPv6中需要主机向家乡代理发送移动性管 理信令，在家乡代理中创建并维护家乡地址和转交的地址的绑定缓存。因此 MIPv6协议是基于主机的，需要修改主机的协议栈。PMIPv6协议提供了另一种方 法来解决IP移动性问题。在PMIPv6中，无需主机参与移动性相关信令，而由网 络侧的实体来代替节点管理移动性相关的信令。IETF工作组对移动PMIPv6协议 进行了标准化。
在PMIPv6协议中负责代替节点管理移动性相关信令的实体是LMA和MAG°LMA 中缓存着移动节点的位置信息，维护节点的可达性。MAG是节点的直接接入锚点， 负责处理节点的接入请求，对节点进行身份验证，并代替节点执行移动性相关信 令等。MAG监测接入链路中节点的移入和移出并向LMA创建绑定注册。在PMIPv6域中可以有多个LMA,每个LMA服务于一组不同的移动锚点。PMIPv6架构如图
1-2所示。
图1-2 PMIPv6协议架构
图1-3 PMIPv6网络节点接入流程
MN初始接入网络为MAGI, MAG1收到MN的接入请求后，识别MN的身份。当 MN身份验证成功后，MAG1为MN分配家乡网络前缀。然后MAG1通过绑定更新/ 绑定确认消息向LMA进行注册。LMA收到PBU消息后，创建绑定缓 存条目，并 建立了和MAG1之间双向隧道的一端。MAG1收到代理绑定确认消息后，建立双向 隧道的另一端。然后MAG1向移动节点发送路由公告消息，公告节点的家乡网络 前缀。收到路由公告消息后，移动节点使用固定或无状态的地址配置协议配置 IP地址。如图1-3所示是节点MN接入MAG1的信令流程。此时的数据通信流程 为，对端节点将数据发送至LMA, LMA通过其上缓存的映射信息判断得知此时MN 接入到P-MAG,因此LMA通过隧道将数据转发至p-MAGo p-MAG收到数据后，进 行处理后转发给MN。
图1-4 PM IPv6网络节点切换流程
如图1-4所示是移动节点从之前接入的移动接入网关p-MAG切换到新的移动 接入网关n-MAG的呼叫流程。这个呼叫流程只反映了一个可能的信息次序，并不 是固定的。MN在p-MAG中获得了初始的家乡地址，通过绑定更新/绑定确认消息 在LMA中进行注册，并在p-MAG和LMA之间建立了双向隧道用于数据的转发，具 体信令流程如图1-3□此时MN从p-MAG切换到n-MAG, p-MAG检测到MN的移出 后，p-MAG通知LMA删除MN的绑定路由状态。LMA接收到这个请求后，等待一段 时间，允许n-MAG更新绑定缓存。然而，如果在给定时间内它没有收到任何PBU 消息，则LMA判断MN已经移出此网络，将会删除MN的绑定缓存条目。
MN接入n-MAG, n-MAG检测到接入链路的移动节点后，将会通知LMA更新绑 定缓存，并在n-MAG和LMA之间建立双向隧道用于数据的转发，具体流程如图 1-3O然后n-MAG将会发送包含移动节点家乡网络前缀的路由确认消息（RA）给 MN,这会保证移动节点感受不到三层的接入接口的变化。此时的数据通信流程为, 对端节点将数据发送至LMA.LMA通过其上缓存的映射信息判断得知此时MN接入 到n-MAG,因此LMA通过隧道将数据转发至n-MAG。n-MAG收到数据后，进行处 理后转发给MN。
