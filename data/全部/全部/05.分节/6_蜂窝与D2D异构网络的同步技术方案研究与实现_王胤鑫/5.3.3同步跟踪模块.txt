5.3.3同步跟踪模块
D2D 终端开机阶段会调用同步搜索和同步决策模块，建立同步关系。建立 同步关系之后，在通信过程中，要实时跟踪同步源，维持与同步源同步的准确性 和稳定性。
同步跟踪模块的架构如图5-6所示，跟踪模块首先根据子帧号，判定子帧类 别。如若该帧是特殊子帧，即传输Sync同步信号的子帧，则判定上行所处状态，  上行状态若是D2D Slave Mode,则调用Sync 同步跟踪函数，获取同步跟踪结果 用于调整时偏和频偏，从而维持定时准确和频率对齐准确。如若该帧是下行子帧， 即包含下行同步信号的子帧，则判定下行所处状态，下行状态若是 Cell Slave Mode,则调用Cell同步跟踪函数，获取同步跟踪结果用于调整时偏和 频偏，从而维持定时准确和频率对齐准确。
45
(C)1994-2022 China Academic Journal Electronic Publishing House.All rights reserved.    http://www.cnki.net
北京邮电大学工学硕士学位论文
图5-6 Syn同步跟踪模块流程
跟踪的目的是维持同步的准确性和稳定性，所以无论是Sync 同步跟踪还是 Cell同步跟踪，所得同步跟踪结果(时偏和频偏)在没有足够高可靠性的保证下 不应直接作用于系统同步状态。经过开机的同步建立后，同步跟踪属于细同步， 同步跟踪结果无论是时偏还是频偏均应稳定在一定范围内，对于超出该范围内的 时偏和频偏，即认为是不可靠的，将其舍弃。根据经验值，本方案设置时偏范围 为-10到10为可靠范围，即samples偏移范围在10个以内；频偏范围为-1000到 1000为可靠范围，即频率偏移范围在1000以内。在本系统中，将采用可靠性范 围内取均值方法来保证作用于时间调整和频率调整的时偏和频偏值的正确性和
可靠性。该方法的具体流程如图5-7所示：
1)判定同步跟踪结果可靠性。
若时偏和频偏结果均在可靠性范围内，则将本次同步跟踪结果存入缓存 Buffer中，否则时偏和频偏只要有一个不在可靠性范围内，则抛弃本次同步跟踪
结果。
2)同步跟踪结果缓存。
按序依次将可靠的同步跟踪结果存入 Buffer 中，本方案设置 Buffer 大小为 10,当Buffer 已满，从Buffer首地址重新存储，相当于更新Buffer。 图所示的
情况为已第二次轮询到Buffer位置6,此时将结果16替换结果6,更新缓存Buffer。
3)取均值计算时偏和频偏。
在 Buffer中存有多次同步跟踪结果，当本次同步跟踪结束后，即使本次跟踪
结果被认为是可靠的，也不直接使用本次同步跟踪结果用于调整时偏和频偏，而
46
(C)1994-2022 China Academic Journal Electronic Publishing House.All rights reserved.    http://www.cnki.net
是通过 Buffer中的缓存结果联合计算，每次分别计算整个缓存 Buffer中时偏和
频偏数据的平均值作为最后的输出，用于调整系统同步状态，维持系统同步的准
图5-7 同步跟踪结果处理流程
