5.3.2功能测试
基于Windows API的恶意代码检测系统的功能测试主要覆盖数据预处理模 块和图相似性分析模块，下面将分数据预处理模块和图相似性分析模块进行测试。
1.数据预处理模块测试用例
用例标识	Vertex_Edge_init
功能名称	顶点初始化功能
功能描述	顶点与边的初始化函数主要用来对一个样本的子函数调用的函数调 用曲和每个子函数的控制流图进行初始化
用例目的	测试顶点与边初始化功能正确性
前提条件	映射码与库函数映射函数均己初始化
输入/动作	期望的输出	实际情况
54
输入/动作	期望的输出	实际情况；
将 sub_4010A4.gdl 文件配 置为碗入文件	数据库屮存储 edge_a_ sub_4010A4_fg	与 vertex_a_
sub 4010A4 fc 表	与预期一致
测试结果	}	通过
:测试A」」	王超	测试时间	2014-9-1
:审核人:"	王超	亩核时间	2014-9-10-
本文将通过Netsky恶意家族来对数据预处理模块进行测试，以此检验预处
理模块是否达到预期目标。
图 5-1 数据库中的 edge_a_sub_4010A4_fg 表
图5-1所示为将sub_4010A4.gdl文件配置为输入文件，在数据库中存储的边 信息表。由图可知，程序能够对边信息正确进行初始化。
55
图5-2数据原中的vertex a sub 4010A4 fc表
图5-2所示为以sub_4010A4.gdl文件配置为输入文件，在数据库中存储的节 点信息表。由图可知，程序可以对点信息进行正确的初始化。
2.图相似性分析模块测试用例
用例标识	Maxsimilarity
功能名称	最大似然函数
功能描述	找到样本同库中恶意家族库函数调用矩阵最大的公共部分占总体的比例，
用例目的	测试最大似然函数功能的正确性
前提条件	恶意家族库函数调用数据库已经过初始化
输入/动作	期望的输出/相应	实际情况
将Netsky-a变种的子函数 sub_4010a4提取权值矩阵， 和無意家族数据库中的 matrix_ sub_4010a4 进行对 比	100%	与预期一致
'M 'if 単	通过
图5-3所示为将Netsky-a变种的子函数sub_4010a4提取权值矩阵，和恶意家族 数据库中的matrix.sub_4010a4进行对比。由图可知，程序能够对边信息正确进行 初始化。图5-3 sub_4010a4子函数的相似性比对结果将Netsky-a变种的子函数
sub_4010a4提取权值矩阵，和恶意家族数据库中的matrix_ sub_4010a4进行对 比的结果。数据库中存储的matrix_sub_4010a4矩阵是在训练集进行训练过程 中生成的Netsky恶意家族中的子矩阵。由图可知，相似性比较函数能够正确 对两个矩阵的相似性进行计算。5.3.3算法对比测试
验证恶意代码检测算法有两种途径，一种是使用多种恶意样本检测使用此检 测方法的误报率与漏报率，另一种是使用多种算法进行比较。表5-3所示即为使 用基于Windows API的恶意代码检测系统的各恶意家族的检测结果。
表5-3 ACS系统的检测结果
^(%)
恶意样本	误报率	漏报率
W orm>Win3 2 .Netsky	11.8	29.2
DangerousObj ect.Multi. Generic	27.9	40.0
Trojan.Win32.Generic	38.0	23.1	•
Trojan.Win32.AutoRun.gen	23.9	33.5
Virus. Win32. Sality. gen	40.7	30.6
Exploit. Win32.CVE-2010-2568.gen	8.7	17.4
AdWare. Win32.DelBar.a	19.6	20.8
Trojan.Win32.Starter.lgb	51.9	27.3
续上表
测率(%)
恶意样本	误报率	漏报率
Virus.Win32.Nimnul.a	11.5	49.2
Worm. Win32. Debris, a	31.8	12.9
下表所示为算法间的平行对比，其中使用的测试恶意家族为Netsky,其中最 后的API Calling即为本系统使用的算法。
57
北京邮电大学工学硕士学位论文 表5-4各算法的对比测试
测试结藁冰、	Heuristic
Approximate	N-Grams	Optimal
Distance	API Calling
误报率	16.6	19.1	23.3	4.5
漏报率	21.5	12.3	37.6	12.4
表5-4中列举了几种检测算法用作测试结果的对比分析，输入的样本由 Netsky恶意变种、非Netsky恶意样本和正常程序样本三部分组成，其中Netsky 恶意变种163个，非Netsky恶意样本从训练集中随机取出223个，正常程序从 测试集中随机抽取正常程序样本398个。由表2可得API调用算法在检测Netsky 恶意家族具有较高的检测率，检测效果较好。
58
第六章.总结与展望
