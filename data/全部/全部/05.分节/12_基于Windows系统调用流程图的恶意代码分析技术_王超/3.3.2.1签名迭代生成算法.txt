3.3.2.1签名迭代生成算法
签名的生成过程中最后一步迭代生成恶意家族的签名，这一步迭代过程中用 到了ACS系统中重要的签名迭代算法。迭代算法的输入为多个权值矩阵，每个权 值矩阵表示一种样本的库函数调用偏序关系,ACS系统中对权值的度量是以出现 次数作为基准的，即变种k对应的权值矩阵Mk中第i行j列的元素Vij的含义是第i条 命令与第j条命令的偏序对在程序中的权重，其计算公式如下：
% = Nj /潇％ £醫林	公式3-1
公式3-1中，Nj表示在当前样本中第i条命令与第j条命令的偏序对出现的次数, 分母表示为当前样本中偏序对的总数。公式3-1中的权值为每个样本的权值。同 样的，每种恶意家族都有一个对应的权值矩阵，其中的每个元素综合体现了每个 样本相应位置的值，恶意家族权值矩阵M中第i行j列的元素Vij的含义是第i条命令 与第j条命令的偏序对的权值，其计算公式如下：
Vy „ew = Vy Q + Vi]old ( 1 - Q )	公式3-2
由于恶意家族权值矩阵是由每个样本对应位置的矩阵元素迭代计算产生的， 在公式3-2中通过new与old进行识别。另外：公式3-2中，0 = l/(n+l), 〃为当 前己处理恶意文件的数量。恶意家族权值矩阵各边权值随新增样本对应边的权值 而改变。由于本实验是建立在统计的基础上，所以误差不可避免。样本选取的差 异、匹配库的选取等环节都可能引入误差引入权值矩阵的主要目的是提升测试结 果的准确性，在相似性比对过程中做了详细的阐述。下图所示为签名迭代算法的 流程图：
28
计算矩阵各 位置的权值
图3-3迭代算法流程图
图3-3表示恶意家族签名的生成流程，先通过公式3-1分开计算同属一个家族 的每个变种的权值矩阵，然后再根据公式3-2,迭代的进行计算，最终获得整个 恶意家族的权值矩阵。此权值矩阵包含了相应恶意家族中各个变种的完整信息， 全面体现了整个家族的行为特征，故此权值矩阵即是恶意家族的签名。下面将给 出迭代算法的伪代码：
SIGNATURE-RECURSIVE-GENERATION
1for i in m line
2for j in m row
3dom[i]|j] = m[i]|j]/sum
4for each sample(k) in training set
5for m in m line
6for n in m row
7do m[m][n] = m[m][n] * — + m(k)[m][n]*—
