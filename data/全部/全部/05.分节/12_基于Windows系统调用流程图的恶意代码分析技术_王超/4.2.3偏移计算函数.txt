4.2.3偏移计算函数
偏移计算函数的主要功能是计算两个矩阵的偏移量，偏移量体现了数据的 波动性，本函数的目的是挑选出偏移量在可控范围内的矩阵。其具体流程如下： 首先通过数据预处理得到样本文件的权值矩阵，从数据库中依次使用恶意家族 权值矩阵得到两个权值矩阵，这两个矩阵作为程序的输入；然后程序具体实现 了公式3-8,计算出样本程序的偏移量；最后，将此偏移量同数据库中存储的 恶意家族偏移量进行比较，若落在此范围内则将此样本程序判定为属于此恶意 家族。偏移计算函数的流程图如下：
输入样本文
件
(签名库Q
/恶矗族/
7权值短阵/
计挤偏移	、/偏移量A
量	飞普 U
rz
〔结束)
图4-9偏移计算函数流程图
下面将给出计算偏移量函数的函数体：
def getOffset(set/, matrixSource, matrixTarget):
offset = 0
for i in range(0J128):
for j in range(0>128):
offset += (matrixSource[i][j]-matrixTarget[i][j])*\ (matrixSource[i][j]-matrixTarget[i][j]) return offset
图 4-10 getOffset 0 函数
50
如图4-10所示，getOffsetO函数将对源矩阵matrixSource与目标矩阵 matrixTarget在相同位置上的元素的差方进行累加，最终返回这个累加值offset 作为样本target相对于source的偏移量。
43小结
本章从具体实现的角度介绍了基于Windows API检测系统。与第三章相对 应，本章灰数据预处理和图相似性分析两个方向分别介绍了 ACS系统的具体实 现。数据预处理模块从使用的数据结构与具体函数的实现两个方面进行了介绍。 图相似性分析模块也从这两个方面进行了介绍。
51
第五章.系统测试
本章对系统进行一系列测试，测试按目的分为两种，一种是功能性测试，主 要用来测试系统的各个功能是否能够按照预期正常执行；另一种是算法对比测试, 通过与同类检测算法进行横向对比，验证此系统使用的方法是否具备优势。
