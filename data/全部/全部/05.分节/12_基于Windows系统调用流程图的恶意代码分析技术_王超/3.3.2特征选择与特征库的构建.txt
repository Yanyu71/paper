3.3.2特征选择与特征库的构建
特征，本文亦称之为签名，是指能从语义层级反映一段恶意代码行为特征的 一段代码。由于签名反映了恶意代码的行为特征，并且同属一个恶意家族的不同 26
变种具有相近的行为特征，所以本文基于这样的背景试图通过分析各变种的特征 归纳出恶意家族的整体特征，并按照二元组的方式进行映射处理，方便后续的比 较等操作。ACS系统的输入集合分为训练集和测试集，分别用于生成签名和进行 后续的测试。签名的生成依赖训练集，ACS系统通过对训练集的分析学习最终得 到恶意家族的签名。ACS系统使用的训练集中有Netsky恶意变种58个，这些样本 取自VX Heaven"签名的生成流程如下所示：
如图3-2所示，签名的生成步骤分为4步：首先，将exe格式的训练集样本文 件进行脱壳处理，本系统使用的脱壳工具为PEiD；然后，使用反汇编工具IDA Pro 将脱壳后的exe文件进行反汇编，得到程序的汇编指令；之后提取汇编指令中的 call指令，并将操作数进行存储，同时进行映射处理，具体映射关系见表3.1-表3.5； 再根据API调用的偏序关系构建系统调用矩阵图。其中系统调用矩阵即是二元组 映射步骤中提到的128*128的抽象化的矩阵，其中第i行j列中元素的含义是第i条 命令与第j条命令的偏序对在程序中出现的数量。将同属一个恶意家族的变种作 为输入多次迭代，即能得出相应恶意家族的签名。
27
