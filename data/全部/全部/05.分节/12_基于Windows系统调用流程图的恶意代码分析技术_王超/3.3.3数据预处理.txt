3.3.3数据预处理
ACS系统使用的输入集分为两部分，分别为训练集和测试集，且其文件格式
29
均为exe格式。训练集用于对系统训练学习，分析恶意家族行为特征并生成恶意 家族签名，测试集用于对系统进行测试，通过误报率与漏报率来对系统使用的算 法进行验证，用以检测其进行恶意检测的准确性。数据预处理使用的样本均来自 训练集。由于样本的获取途径有限，本系统使用的Netsky样本均取自VX Heaven<> 这些样本普遍经过模糊处理，直接分析极难获取有用信息.考虑到恶意样本极有 可能经过加壳等处理，在分析的时候如果不先行进行分析，运行时存在很大可能 出现异常状况，所以在对样本进行分析前需要首先对这些样本进行相应的脱壳和 解密操作。ACS系统使用PEiD对样本进行脱壳操作。由于预处理阶段的处理流程 较为繁杂，故本系统将其单独划编一节进行讨论。数据预处理的具体流程如下图 所示：
可执行
文件
脱壳处理
/子函数
偏序图
库函数
调用集
如图3-4所示，首先对输入文件进行脱壳处理；然后将脱壳处理后的文件进 行反汇编，得到程序的汇编指令；之后取出汇编指令中的call语句，此处将分两 个分支继续进行，其中一支将call语句的操作数提取出来得到库函数调用集，并 根据另一支则提取出子函数的调用关系，得到其偏序集合；最后，将上述两个集
30
合合并起来即可获得一个能够反映时序关系的库函数调用关系，即是此变种的权 值矩阵。
本文的数据预处理阶段提出的检测方法提取了程序的语义层面的信息，一定 程度地克服了原始的静态检测方法的缺陷，与基于字节序列签名反病毒检测技术 相比具有一定的优势。本系统使用训练集对数据进行预处理，并通过训练集生成 恶意家族的签名。然后通过训练集对原始签名进行迭代增量分析，使用图相似性 比对算法将各变种的特征增加到家族签名中。最后通过测试集对本系统进行测试, 验证本文使用算法的有效性。本文使用典型恶意家族Netsky对ACS检测方法进 行评估。
