4.3.2数据发送服务
在同步状态已经建立的情况下，D2D终端物理层数据的发送是建立在系统帧 格式的基础上的，数据发送的基本单位是一个子帧。一个D2D终端不会在每个子 帧上都进行数据发送，因此D2D终端的数据发送是突发的。出于这样的定位，层 0的发送端向物理层提供Burst式的数据发送服务。
数据发送服务也由前端线程、变采样线程和后端线程三个线程提供。物理层 在提交发送数据的请求时，会将一个子帧的数据准备好，并通过物理层维护的时 间戳与帧号的对应关系，计算出所发送子帧对应的物理层时间戳，与数据一同提 交给层0发送端前端线程。前端线程以非阻塞的伦询方式读取物理层要发送的数 据，每次读取的数据量定义为一个子帧，粒度为30720个采样值，读取完成后， 前端线程将这一个子帧的数据拆分为40个长度为768的packet,依次传递给变采 样线程。变采样线程每收到一个packet后，对该packet执行滤波降采样，转换为 625个采样值，然后计算给packet的物理层时间戳对应的USRP时间戳，将转换 后的packet及其对应的USRP时间戳发送给后端线程。后端线程接收到的packet 已经符合USRP信号采样率，由后端线程通过调用UHD接口发送给USRP执行 发送操作。
59
变采样线程
后端线程
前端线程
空口
图4-25层0数据发送服务
60
