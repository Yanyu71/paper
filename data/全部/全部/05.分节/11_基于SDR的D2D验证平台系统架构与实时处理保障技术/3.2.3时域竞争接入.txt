3.2.3时域竞争接入
D2D通信流程引入了同步分时隙CSMA/CA机制进行时域竞争接入，但传 统的CSMA/CA不能满足D2D通信的全部需求，特别是D2D广播通信的需求。 根据D2D业务的特殊需求，本论文方案对竞争接入方式进行了一些定制化，具 体流程如下。
一次D2D数据通信从发送端发送RTS请求开始。D2D终端已完成系统初始 化后，协议栈即可与网络层实现连通，允许网络层向D2D协议栈下发数据进行 发送。当D2D协议栈检测到发送队列非空时，即启动一次RTS请求。设RTS请 求所在的系统无线帧号为n, D2D终端可以通过RTS竞争接入帧号为n+2的无 线帧内的上行子帧，以进行D2D数据传输。每次竞争粒度为一个子帧，即竞争 的D2D终端可以申请只占用该无线帧内的一部分上行子帧资源。
在D2D的点对点通信场景中，D2D通信的接收端在接收到RTS后，在帧号 为n+1的无线帧向发送端发送一个CTS反馈，而接收到该RTS的其它D2D终 端将不再对该RTS指定的时域资源发起竞争。如果D2D通信的发送端收到了 CTS反馈，则一次握手完成，发送端将启动频谱资源探测和无线资源调度，在竞 争接入成功的上行子帧向D2D通信的接收端发送D2D通信数据和解码控制信令; 如果D2D通信的发送端没有收到CTS反馈，则认为RTS发生碰撞或丢失，执行 随机退避算法，尝试稍后重新发起竞争接入。D2D通信的接收端在制定子帧先 接收解码控制信令，根据其中携带的D2D数据传输所使用的频域资源块(RB)和 调制编码信息(MCS),对D2D数据进行解码。若解码正确，D2D终端将解码的 结果通过协议栈上报给网络层，完成一次数据的传输。根据解码的正确与否， D2D通信的接收端将在帧号为n+3的无线帧向D2D通信的发送端反馈ACK或 NACK消息。
由于广播通信中不存在反馈链路，因此在D2D的广播通信场景中，接收到 RTS的D2D终端都是潜在的数据接收者，只需在帧号为n+2的无线帧准备接收 数据，而不需要进行CTS反馈。D2D通信的发送端发出RTS后默认竞争接入成 功，在竞争接入的上行子帧内发送D2D数据和解码控制信令即可。无论解码正 确与否，D2D通信的接收端也都不需要向发送端反馈ACK或NACK消息。
在纯竞争的情况下，如果一个申请广播通信的RTS与其它申请进行广播通 信的RTS发生了碰撞，那么广播通信中RTS发出即默认接入成功的假设将不成 了。为了保证该假设成立，本方案中引入了专用RTS的机制。
RTS请求将被分为RTSO和RTS1两种。其中RTSO是由一个D2D终端专用 的，一个无线帧内专用RTSO的D2D终端由无线帧号、当前D2D网络规模和 D2D终端ID号共同决定，D2D终端可以通过RTSO对点对点通信和广播通信进
18 行竞争接入；所有D2D终端都可以通过RTS1竞争子帧的接入权，但只能通过 RTS1对点对点通信进行资源竞争。由于RTS1的时序在RTSO之后，为了避免 ACK子帧发生碰撞，当RTSO被使用，且用来对点对点通信进行资源竞争时， RTS1被禁用。但在RTSO用于竞争广播通信所用资源时,D2D终端可以通过RTS1 竞争广播通信未占用的剩余子帧。这样的设计不仅保证了广播通信的可行性，同 时，也通过RTSO保证了终端接入的公平性，通过RTS1提高了无线资源的利用 率。此外，专用RTS机制的设置也可以保证D2D网络在节点数量较多时仍然可 以通信，降低了竞争碰撞导致的网络性能损失。
n th frame	n+1 th frame	n+2 th frame	n + 3 th frame	n + 4 th frame
图3-3 D2D通信中的CSMA/CA时序流程实例
图3-3中的绿色、黄色和红色分别表示了三次典型的时域竞争接入过程。绿 色表示通过RTSO占用了第n+2帧的全部四个上行子帧进行的点对点通信，黄色 表示通过RTSO占用了第n+3帧的前两个子帧进行的广播通信，红^^表示通过 RTS1占用了第n+3帧的后两个子帧进行的点对点通信。该图也可以体现 CSMA/CA流程的流程延时，其中D2D终端通过RTSO接入子帧2、3、7、8进 行通信的CSMA/CA流程延时分别是22、23、27、28ms,通过RTS1接入子帧2、 3、7、8进行通信的CSMA/CA流程延时分别是18、19、23、24ms。
