5.6.2以太网卡的配置优化
层0接收链路延时的降低除了可以三段式的流水线方式实现以外，还需要通 过对网卡参数的配置进一步增强。Intel的以太网卡有一个配置参数为 InterruptThrottleRate,该参数可以控制网卡每秒钟能够产生的最大中断次数，可 以通ethtool -C rx-usecs N 命令改变该参数。InterruptThrottleRate 值越小，网卡 的两次中断之间的最长时间就会越大。两次网卡中断之间，网卡会将接收到的数 据缓存在网卡自身的缓冲区内。在取值范围上，0,1,3为特殊的参数值，代表的不 是最大中断次数，而是预设的策略编号。
在进行优化之前，层0接收到完整的子帧数据的时间相对于其第一个样本的 时延如图5-10所示，最大延时约为200us。这是因为InterruptThrottleRate的默认 值为3,即操作系统使用较为保守的策略对每秒的最大中断次数动态控制。由于
USRP与以太网卡之间的通信非常频繁，因此可能会出现6~7个以太网帧被网卡 缓存，通过同一个网卡中断提交给用户程序的情况。
69
图5-10网卡参数优化之前的延时分布
为此，我们将该值设为0,即令网卡在收到以太网帧后必须立刻产生网卡中
断向操作系统提交数据，不允许在网卡缓存数据。在对该参数进行修改后，大部 分延时降低到60us以下，如图5-11所示。
图5-11网卡参数优化之后的延时分布
70
