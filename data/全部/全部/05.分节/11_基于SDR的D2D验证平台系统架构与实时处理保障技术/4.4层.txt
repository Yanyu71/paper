4.4层
系统软件部分的层0主要实现基带与USRP之间的数据通信。从数据流向上 看，该层主要提供两个服务，即数据接收服务和数据发送服务。基带釆样率为 30.72MSps,而USRP提供的最接近的采样率支持为25MSps。因此，层0部分除 了基本的数据服务外，还需要在接收端将来自USRP的25M数据流升采样到 30.72M再提交到物理层，在发送端将来自物理层的30.72M数据流降釆样到25M 再发送给USRP,采样率转换比为625:768o由于ETE基带信号只有频带中心的 20MHz信号是有效的，再加上D2D-CCCH占用的5个RB,也仍小于25MHz, 因此变采样中的低频滤波操作不会造成明显的信号损失。
57
非硬实时的操作系统不能提供精准的时钟信号，而USRP上的FPGA则可以 通过标准的硬件时钟提供准确的时钟信号。为此，UHD提供了一种时间戳机制以 实现与USRP硬件的时钟同步。时间戳是一个无符号的长整形数，每一个时间戳 对应了 USRP的一个釆样周期。UHD提供了一个接口，约定某一时刻系统的时间 戳为0,即基准时间。接下来系统的时间戳会随时间周期增长。举例说明，若USRP 的釆样率为25MSps,且一个时刻的时间戳为25,000,000,那么这个时刻相对基准 时间晚了精确的1秒。
USRP接收到的每一个复样本都对应着一个时间戳以标记USRP接收该样本 的时间，而发送给USRP的每一个样本也都对应着一个时间戳，以告知USRP在 空口上发送该样本的时间。软件系统可以先对接收到的信号进行同步，将帧号与 该帧物理层信号的第一个釆样点的时间戳进行对应，从而将系统上层的帧号与 USRP的时间戳对应起来。软件系统要发送数据时，通过帧号与时间戳的对应关 系，计算出要发送的帧所对应的时间戳，并将计算出的目标时间戳与数据一同传 输给USRP完成数据发送。这样的机制下，数据与USRP时钟保持同步，软件部 分通过时间戳异步地访问数据，即可实现对空口数据的定时控制。
由于采样率的差别，USRP上的时间戳不能直接应用到基带信号，但由于存 在625:768的釆样率转换比，物理层可以按照基带信号釆样率维护一个物理层时 间戳，并与USRP时间戳按采样率进行转换。这样的转换在非整除的情况下会存 在舍入误差，但该误差不仅只有不到一个釆样周期，而且不会随着时间累积，因 此不会影响系统的定时准确性。
