4.2.3RLC层设计
不论是对于蜂窝终端还是D2D终端，在每一子帧的传输过程中，MAC及以 下层经过RRC或RRM实体调度所提供的传输能力，不一定能与来自业务层的IP 数据包的长度实现良好匹配。这就需要协议栈根据底层传输能力对IP数据包进行 分段和级联的操作。当底层传输能力可以传输多个IP数据包时，RLC层可以将 这些IP数据包组成大的RLCPDU进行发送，由接收端拆解后分别上报；当底层 传输能力只能传输一个IP数据包的一小部分时，RLC层可以将这个IP数据包根 据底层传输能力进行拆分，通过多次发送完成传输，由接收端按序组强后上报。 相比于一次传输发送一个IP数据包的策略，RLC层分段级联的机制保证了底层 提供的传输能力不会因为单个IP数据包长度过小而浪费,也保证了长度较大的IP 数据包在传输过程中不会因为底层提供的传输能力不足而丢失数据。
图4-5 RLC数据分段和级联操作示例
虽然ETE系统的帧号是顺序的，但是由于HARQ机制，一个子帧可能在多 次传输后才被正确解码，因此多个子帧被正确接收的顺序可能与发送时不同。甚 至当HARQ机制也无法保证数据正确有效传输时，这一子帧的数据甚至可能丢失, 这就要求RLC层提供数据包按序到达高层的保证。为此，RLC层的接收端维护 了一个重排窗口和一个重排定时器。当重排定时器超时时，RLC层判定该 RLC-PDU发生丢失，丢弃该PDU并将重排窗口后移。
ETE的协议体系结构中，RLC可以根据业务需求的不同提供3种工作模式， 即透明模式(TM)、非确认模式(UM)和确认模式(AM)。其中，TM模式的RLC只 对数据进行包头的增加和去除，不支持分割和级联，只适用于系统信令的传输， 而不适用于数据的传输；UM模式的RLC支持分割、重组和按序传递，不支持
35
RLC级别的重传，适用于对时延要求敏感，而对正确性要求不很高的业务；AM 模式的RLC不仅支持分割、重组和按序传递，也支持RLC级别的重传，适用于 对正确性要求高，但对时延要求不很敏感的业务。为了降低系统复杂度，本论文 在D2D验证平台的软件协议栈中只实现了 UM模式的RLC,对于TCP类型的业 务，重传将由操作系统实现。
本系统中RLC层的行为与文献［29］中规定的UM RLC行为基本一致，RLC PDU的格式也与EIE的UM RLC PDU格式类似，不同的是使用了 UM RLC pDU 格式中预留的3个bit表示该RLC PDU的来源。RLC PDU格式如图4-6所示：
TXID	FI E SN
SN
Fl	LH
~LH	E	LlT~
LI2
DATA
图4-6 RLC PDU格式
在D2D验证平台的实现中,RLC层根据数据流向被分为TX和RX两个部分。 根据本节开头所述，本论文中D2D协议栈的“无线承载”与D2DID对应而非如 ETE协议中与业务对应。如无特殊说明，本节下文中的“无线承载”特指与D2DID 对应的无线承载。
