4.3.2发送链路设计
物理层的发送链路从协议栈接收Sched Msg,根据消息类型对数据进行相应 的物理层处理，并通过L0以子帧为基本单位进行发送。为保证Sched Msg被及 时接收，而不会被正在执行的数据发送任务所阻塞，物理层的发送链路使用一个 额外的schedmsghandler线程，轮询式地获取来自协议栈的Sched Msg下发，并根 据Sched Msg的类型分发到物理层相应的发送队列中。
与接收链路完全收时序驱动不同，物理层的发送链路的数据准备可以在收到 Sched Msg后马上执行，信号处理完成后，将该子帧数据的帧号转化成物理层时 间戳与要发送的子帧数据一起发到L0层，并提交到USRP进行发送等待即可。 而且由于数据的发送通常都与数据的接收有关，因此数据发送准备的提前量通常 也仅在几毫秒的量级，且不会随时间而增长。发送链路向L0层发送数据的接口 为 write_subframe_from_phy_directly()函数，如表 4-24 所示：
55
表4-24 PHY向L0发送数据功能接口
函数接口定义
write_subframe _from_phy_directly(short* data src)
从使用的线程资源来看，物理层发送链路仅使用了一个发送主线程和一个 schedmsghandler线程，所有的发送端数据处理任务均由发送主线程完成。
