4.2Zigbee密钥系统介绍
Zigbee协议的安全服务由四个方面构成，包括密钥的建立和传输、设备管理和帧的 保护。这些安全服务作为安全体系的基本结构单元，对整个Zigbee网络提供安全保护。 整个设备是开放信任模式：通信协议栈的不同层和运行在单个设备上的所有应用相互信 任。这种开放信任模式允许在同一设备的不同层次结构之间重复使用同样的密钥材料，
22 默认为通信设备任意两层之间为信任关系，只考虑在不同设备之间实现端到端的安全。
Zigbee的整个密钥体系包括主密钥、密钥传输密钥、密钥加载密钥、链路密钥和网 络密钥。其中主密钥是执行对称钥密钥建立协议过程中使用的一个共享密钥。主密钥是 两个设备之间长期安全的基础，并可用于生成链接密钥；密钥传输密钥由链接密钥派生, 用于保护承载一个非主密钥的密钥传输信息；密钥加载密钥由链接密钥派生，用于保护 承载主密钥的密钥传输信息；网络密钥用于加密流出NWK的帧，也可以用于处理流入 NWK的帧；链路密钥是用于且仅用于两个设备对等应用层实体之间共享的密钥3］。
其中最重要的就是链路密钥和网络密钥。网络密钥共128个比特，全网设备都使用 同一个活动网络密钥。网络密钥主要负责对网络层信息和广播信息进行加密。而链路密 钥主要用于对等实体之间的信息加密。两个对等设备通过密钥协商机制，向信任中心请 求链路密钥，每一对对等节点共享同一个链路密钥。节点设备通过密钥运输、密钥建立 或预先安装来获得链路密钥；通过密钥运输和预配置来获得网络密钥〔35］。
Zigbee可以高层应用进行配置，选择加密方式。协议提供了一套在MAC帧上执行 的一系列安全操作，包括对称加密算法、模式和完整性比特长度。这些安全套件由一个 字节指定。节点根据字节标示符的值，采用不同的加密引擎和密钥资料对帧进行加密操 作。其中标识符0x00表示没有使用安全模式。
表 4-1 NLME-LEAVE. indication 原语参数
标识符	安全组件名称	安全服务
接入控制	数据加密	帧完整性	序列更新
0x00	None
0x01	AES-CTR	X	X		X
0x02	AES-CCM-128	X	X	X	X
0x03	AES-CCM-64	X	X	X	X
0x04	AES-CCM-32	X	X	X	X
0x05	AES-CBC-MAC-128	X		X
0x06	AES-CBC-MAC-64	X		X
0x07	AES-CBC-MAC-32	X		X
以下为采用密钥加密的Zigbee帧格式示意图:
23
图4-2应用层加密帧格式示意图
由于Zigbee网络的低成本特性，节点的制作简单，抵抗物理攻击能力薄弱。如果攻 击者获得了该节点的网络密钥和链接密钥，就能够监听整个网络的基础信息。同时由于 对端节点不知道该节点已经离开网络，仍保留有对应的链接密钥。攻击者可以伪装该节 点与其余节点进行通信，对网络安全造成较大损害。
