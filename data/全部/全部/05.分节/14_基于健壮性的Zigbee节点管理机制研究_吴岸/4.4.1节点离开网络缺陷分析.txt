4.4.1节点离开网络缺陷分析
根据Zigbee协议，当一个节点离开网络时，将会由其他节点(如它的父节点)通知 信任中心该节点已离开网络。节点通过原语NLME-LEAVE.request来请求一个设备离开
26
网络。
表 4-2 NLME-LEAVE. request 原语参数
名称	类型	有效值	说明
DeviceAddress	IEEE地址	任何有效的
64bitIEEE 地址	从网络上移除的实体的64bitIEEE地 址。如果设备从网络上移除自身时，此 值为NULL
RemoveChildren	布尔类型	TRUE 或者
FALSE	如果被要求离开网络的设备同时被要
求移除它的子设备时，此参数为TRUE,
否则它的值为FALSE
MACSecurityEnable	布尔类型	TRUE 或者
FALSE	此参数允许高层控制MAC层的 SecurityEnable参数。如果已执行的网 络层能够正常地请求安全策略应用于 开销分离通知命令帧，此参数的值为 TRUE,即允许执行请求的安全进程， 值为FALSE即禁止它执行。如果已执 行的网络层不能正常地请求开销分离 通知命令帧的安全进程，此参数的值被 忽略
网络设备节点接受此原语后，且DeviceAddress不等于NULL,网络管理层实体判 断指定设备是否存在于它的邻居表里。如果请求的设备不存在，网络管理实体发出状态 为UNKNOWN_DEVICE的NLME-LEAVE.confirm原语。如果请求的设备存在，网络管 理层实体将试着将该节点从网络上移除。如果RemoveChildren参数为TRUE,设备将请 求也移除它的子设备。在移除之后，网络管理层实体发出一个NLME-LEAVE.confirm原 语，其DeviceAddress等于被移除设备的64bitIEEE地址。如果移除成功，Status参数为 SUCCESS,否则Status参数为LEAVE_UNCONF1RMED。最后，与移除设备相应的邻居 表关系域将被设置为0x03,显示无关系。信任中心将会删除该节点对应的路由表入口和 应用支持子层的映射表入口。
遗憾的是，Zigbee协议没有提及如何处理存储于对等节点的应用链接密钥。即是说, 离网节点的对等节点并未意识到该节点的离开。它们仍然保留着离网节点对应的应用链 路密钥。如果攻击者获得了离网节点内存储的应用链路密钥，他将能够窃听利用该密钥 加密的信息，甚至伪装离网节点同对等节点通信。
27
