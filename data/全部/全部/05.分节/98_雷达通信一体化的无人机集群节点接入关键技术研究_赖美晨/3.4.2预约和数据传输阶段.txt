3.4.2预约和数据传输阶段
在接收邻居广播之后，无人机网络更新邻居表信息和拓扑结构，可以得到无 人机网络节点的数目N,则在控制信道中预留N个时隙给每一个无人机节点进 行预约。无人机根据ID的大小依次在控制信道的时隙进行预约。两跳范围之外 的节点可以进行信道复用，因此本文考虑两跳节点的情况。
本文的信道资源分配以接收节点选择的方式进行分配，无人机节点如果有发 送需求，按照ID大小依次在控制信道中向目的节点发送RTS数据包，告知发送 节点自己可用的信道、时隙资源以及在信道和时隙资源下可用的波束。目的节点 接收到RTS数据包之后根据发送节点的可用资源和自己的可用资源选择相应的 信道、时隙资源和波束，回复CTS数据包。发送节点成功接收CTS数据包之后 将把预约信息广播出去，即广播BCTS数据包。控制信道上一次成功的预约过程 如图3-6所示，协商的过程和DCA协议中节点在控制信道的协商过程〔76］相似，
27
不过改进了竞争接入的方式，以预约的机制无冲突接入，并且在收发节点协商的 内容中增添了波束等信息。
节点预约成功后在预约的时隙中定向传输数据包，数据信道中的数据包将以 雷达通信一体化信号的形式进行传输。为了解决雷达的扫描方向只能朝向通信方 向导致的无人机飞行不安全问题，本文设置了合理的信道使用策略。当节点得知 两跳内邻居的数目N小于数据信道数目时，每个节点可以通过预约获得一条信 道的使用权，如图3-7(a)所示，预约完成后节点将在预约的信道中向待发送节点 定向发送一体化信号，此时处于RC模式，信息传输完毕之后切换回R模式进行 雷达探测。当节点两跳内邻居的数目大于信道的数目时候，接收节点选择一个可 传输的时隙，预约成功之后，将在预留的时隙切换到相应的数据接口中进行定向 通信。为了保证无人机在复杂环境中的飞行安全，将业务数据包切割成小数据包 且补充包头部等信息进行传输，目的是通过传输小数据包的形式使帧的长度保持 在较小的值，近似认为无人机保持着对周边环境的全方位探测，信道使用策略如 图3-7(b)所示。
数据信道N
(a)两跳邻居数目小于信道数目时候的信道使用策略
28
为了避免雷达回波对通信的干扰,在数据传输完毕后需要保留一段雷达回波 间隔，在本文中设置雷达回波间隔为雷达向可探测的最大距离处的障碍物发送波 束到接收到回波的时间。在经过一个雷达回波间隔和一个短帧间间隔(SIFS, Short Interframe Space)之后，接收节点开始反馈确认信号(Acknowledgement, ACK)o值 得注意的是，雷达回波发射的距离是通信信号的两倍，雷达回波信号比通信信号 弱，引入雷达回波间隔也避免了雷达信号湮没在接收节点的确认信号中。在本文 的协议中节点接收雷达回波信号时也不会与其它节点发送信号相叠加，解调雷达 信号时候受到的干扰仅有噪声干扰，因此也可以保障雷达的探测性能。其中，雷 达的分辨率性能与系统的带宽B成反比，并且有dm=CHB, C为光速。为 了保障雷达处于相对较高的分辨率，信道的带宽不能太小，例如系统至少需要保 障10m的雷达距离分辨率，信道的带宽需要15MHzo为了适应802.11n协议旳 中相关设置，我们将每条信道的带宽设置为20MHz,保障雷达的正常探测能力。
当所有的无人机完成时隙预约之后，可以知道完成所有数据包传输所需要的 最长时间，动态设置一帧的长度，传输完成后进入探测和邻居表维护阶段，继续 下一帧的传输过程。通过这种预约机制保障无人机在邻居节点变化迅速的情况下, 系统的性能也能够处于相对稳定的状态。
