4.2.1.4降采样滤波器的硬件实现
降釆样滤波器的FPGA实现采用Verilog HDL硬件编程语言，借助Xilinx公 司提供的免费LogicCORE IP FIR Compiler v6.3,使用Matlab平台设计出的滤波 器参数进行例化FIR Compiler IP核，根据系统的设计要求和接口规范，进一步 对接口和时钟等参数进行封装,便完成降釆样抗混叠滤波器模块的FPGA硬件实
现。
1
Set to Display: 1	Range: 1..1
Passband	Stop band
Range : 底一］. 际赤］碩将-际
Min -0.038331 dB
Max 0.046747 d8	-51.208593 dB
Ripple : 0.085078 dB
图4-10 FIR Compiler IP生成时的频率响应曲线
图中，红色为理想的频率响应曲线，蓝色为定点化之后的频率响应曲线，可 以看到红色线和蓝色线几乎重合。且通带和阻带的频率点也正好吻合， 60MHz/163.84MHz = 0.3662, •为通带截止频率，1-0.3662=0.6338为阻带截止频率， 与图中参数基本吻合。通带最小衰减-0.0383dB<0.1dB,最大衰减0.0467dB<0.1dB, 同带内波动0.085078dB<0.1dB,各项参数均满足要求。
滤波器模块的接口信息见表4-5。整个滤波器工作在当个时钟频率之上，时 钟大小等于ADC釆样率的大小，为163.84MHz,输入侧除了复位信号和时钟之 外，主要是滤波器的AXI-Stream Slave接口的三个简单信号，valid信号和ready 信号分别来自前一级设备和当前设备，只有当两者均为高电平时才表示握手成功, 当前传输的16bit数据才会有效，被输送到滤波器运算单元。输出侧的信号主要 与下一级的AXI-Stream Slave接口相连，这里只有一个valid信号和一个40bit的
数据信号，滤波器内部包含2倍的抽取操作，所以输出数据平均两个时钟输出一 个有效数据，valid用来标示有效数据的位置，输出侧没有ready信号，表示输出 侧不能被阻塞，如果下一级不能按时接收数据，滤波器模块会直接丢弃数据。40bit 的数据是因为运算过程中保留了所有的精度，直到最后滤波器输出之后再进行位 宽截取和定点化处理。
表4-5滤波器模块设计接口信息
163.84MHz 时钟
图4-11滤波器封装Wrapper的功能结构图
滤波器模块编写完成并使用Modelsim仿真验证之后，需要对其进行封装和 必要跨时钟域处理。滤波器封装Wrapper的功能为：首先对IQ数据进行分离， 分为I、Q两路信号分别进行滤波处理，每一路滤波和抽取之后会进行一个定点 化处理，两路处理完成之后再次进行IQ数据合并，低16为表示I数据（实部）， 高16位表示Q数据（虚部），IQ数据合并之后需要经过一个跨时钟域的数据缓 冲处理，因为降采样滤波之后的是基带信号处理部分都运行在200MHz时钟下， 所以需要在输出时做一个跨时钟域的处理。滤波器封装模块内部完全釆用流式处
41
理的结构，属于有握手功能的流式处理，不需要额外的控制信息便可稳定正常运 转。滤波器封装Wrapper模块的功能结构图如图4-11所示。
