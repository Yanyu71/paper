5.2.2AXI配置总线模块仿真与测试
AXI_TO_IP_BRIDGE是本文设计用以完成AXI-Lite总线到基带处理链路子系统 各模块配置的总线桥，完成频谱感知硬件控制功能。由前面3.4.2节可以知道， AXI_TO_IP_BRIDGE 模块共包括 AX1_TARGET、AX1_ASYNC_COUPLER、AXI_SINK 和 AXI_RESPONES_ABITRATOR四个部分。AXI配置总线模块的测试主要是测试两种类 型的配置接口，对其读和写操作是否如预期的正确无误的下发到具体的IP设备 或模块。测试分为基于Modelsim的功能仿真测试和基于Chipscope工具的FPGA 硬件测试。
图5-13 REG_TARGET接口写事务的仿真时序图
Modelsim仿真测试中，编写Testbench,使用task封装各个接口的配置功能。 对REG_TARGET类型接口的仿真测试通过向其指向设备的地址空间的target设备 发起读请求和写事务，如图5-12所示是REG_TARGET类型接口进行读请求时候的 仿真时序图，AXI-Lite总线发起请求，向16位地址的从设备targetO读取其FIFO 配置缓冲深度，图中显示读请求正确无误的传递到targetO设备，并且读数据rdata 也正确返回。图中可以看到读请求之前，配置总线己经向target。设备进行了 4 次写事务，所以读出的rdata值为4,正确无误。图5-13是REG_TARGET类型接 口进行写事务时的仿真时序图，图中看出，当AXI-Lite总线发起请求，向16位 地址的从设备targetO进行写事务请求时，写请求通过各个模块的传递，成功传 递到targetO设备，并targetO正确接收写事务的配置信号后，正确返回bresp信 号。图5-14和图5-15显示了对应FPGA硬件测试中REG_TARGET接口配置总线 的Chipscope抓取图形，图中可以看到，Chipscope抓取的读写事务时序图与 Modelsim完全匹配,REG_TARGET配置总线正确无误地下发配置到基带各个单元。
图5-14 REG_TARGET接口读请求的Chipscope捕捉信号
68
图5-15 REG_TARGET接口写事务的Chipscope捕捉信号
对MEM_TARGET类型接口的仿真测试见图5-16=图5-14是控制系统在向起 始地址为4096的MEM_TARGET类型设备target4连续写入若干配置数据后的仿 真时序图，可以清晰的看到，几次连续的写事务事件都能正确无误地到达target4 设备。因为MEM_TARGET类型的测试时，target4设备使用了一个Block Memory 存储下发的配置信息，所以可以通过频繁的写事务和读请求来验证总线读写的正 确性，图中可以看到写的数据大小和读出的配置数据大小都是相同的，验证读写 事务均正确无误。图5-17和图5-18显示了硬件测试MEM_TARGET接口总线桥时 Chipscope捕捉到的信号，图中可以看出，读和写事务的配置均正确下发到target 目标设备，并正确返回数据和响应信号。
图5-16 MEM_TARGET类型接口总线配置的仿真时序图
69
图5-17 MEM_TARGET类型接口写事务的Chipscope捕捉信号
图5-18 MEM_TARGET类型接口读请求的Chipscope捕捉信号
