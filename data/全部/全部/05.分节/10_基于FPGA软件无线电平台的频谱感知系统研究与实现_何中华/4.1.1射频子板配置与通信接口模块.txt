4.1.1射频子板配置与通信接口模块
AD-FMCOMMS1射频子板的功能框架图如图4-1所示，射频系统共包括四个 功能模块：发送链路、接收链路、时钟管理、电源管理。
在发送链路上，主要有四个芯片来完成发送链路的射频发送功能，其各个芯 片的功能和特性详见表4-1。在发送方向上，系统主要功能是将IQ复信号转化为 为对应的射频信号通过天线发送到空中。AD9122数模转换器通过内插数据提高 频率使得IQ数据变换到基带。复基带信号通过L。频率从直流搬移出去，并且镜 像频谱可以很容易地被过滤掉或抑制。通过适当的滤波器和匹配阶段，它被进一 步转换为指定的RF输岀频率，IQ复基带信号从DAC输入转换为模拟输出馈送至 ADL5375正交调制器进行调制。之后信号通过一个镜像抑制滤波器传递到 ADL5602进行一个+ 20dB固定增益的信号放大。RF射频输出功率控制是通过调 整基带数据的数值大小来完成的，即使在4GHz的高频点射频输出的发射功率也
29
可咼达7.5dBm。
图4-1 AD-FMCOMMS1射频板功能框架图 表4-1发送链路关键芯片及功能特性
AD9122	双通道，16-bit,高达1200MSPS转换速率，自带直流偏置、相位 和增益补偿的数模转换器。
ADL5375	支持频率400MHz~6GHz范围内的宽带正交调制器。
ADF4351	集成VCO压控振荡器的宽带频率同步器（支持频率范围35MHz~
4400MHz）「
ADL5602	支持频率范围50 MHz ~4.0GHz的射频/中频固定增益（20dB）放 大器。
在接收链路上，主要由四个芯片完成主要功能，各个芯片的详细功能参数详 见表4-2。在接收方向上，链路的主要功能是将一个射频信号转换成IQ复信号。 RF射频信号直接传至ADL5380正交解调器解调，解调岀一个稳定的复基带信号 <-3dB 带宽范围：DC~400MHz） =
所得的IQ复基带信号进行滤波滤除频谱上的谐波镜像，然后传送到AD8366 的DVGA （数字可控增益放大器），提供高达4.5dB到20.5dB增益的信号放大。 抗混叠滤波器主要用于信号在AD9643处被转换为数字信号之前去除高次谐波及 其它带外信号。
表4-2接收链路关键芯片及功能特性
ADL5380	支持频率范围400 ~ 6000 MHz的宽带正交解调器，带宽500MHz。
AD8366	支持频率从直流到600MHz的数字可调功率放大器，增益范围4.5dB ~
20.5dBo
AD9643	14bit、最高支持250MSPS釆样率的双通道模数转换器。
ADF4351	集成VCO压控振荡器的宽带频率同步器（支持频率范围35MHz ~ 4400MHz）。
时钟资源的管理主要依赖AD9548芯片和AD9523-1芯片，二者的特性参数 详见表4-3。射频板的系统时钟可以选择通过板上晶体（50MHz的）产生或从FPGA
（通过FMC）引入。时钟路径主要由AD9548, AD9523-1和2个ADF4351产生， 提供到发射和接收链路的各个单元。当多块射频板使用外部同步功能时，从射频 板必须从主电路板引入时钟。
表4-3时钟资源管理的关键芯片及特性
AD9548 四路/八路输入网络时钟发生器（lHz~750MHz）。
AD9523-1低抖动时钟发生器（lMHz~lGHz）,带有14路输出。
AD9548的REFA输入绑在FMC连接器的LA_17_[PN]_cc引脚，这允许从FPGA 板卡提供一路时钟至AD9548，该时钟被清理（抖动）后用于驱动AD9523-1的 REFB。AD9523 ±变频此时钟至3GHz左右，然后再通过一个dividor进行任意整 数倍的降频。
在ADI公司提供的参考设计中，AD-FMC0MMS1执行以下操作：
>FPGA利用Xilinx时钟发生器产生的30MHz的固定时钟频率；
>此30MHz的时钟通过FMC接口传送至AD9548；
>AD9548的输出时钟去抖之后，进一步传输至AD9523；
>在AD9523处，创建以下三种时钟频率：
/ 491.52 MHz的DAC的采样率
/ 245.76 MHz的ADC的釆样速率
/ 122.88兆赫的参考时钟为L0的PLL
上述这些时钟都是数字可调、灵活可变的，关键是要注意是AD9523直接驱 动 ADC 和 DAC=该 AD9523 有两个时钟区域，bankO： 0-3 和 10-13, bankl： 4-9-
对不同bank的输出必须是彼此的整数倍。
射频板的电源管理主要依靠ADP2323, ADP7104, ADP150/1、ADP1740,他 们的功能特性和详细参数详见表4-40射频板的所有的能量来源均通过FMC接口
31 取自于FPGA板卡，即Xilinx ML605 FPGA开发板。
表4-4电源管理的关键芯片及特性
ADP2323	双通道3A、20V降压转换器
ADP7104	高精度500mA低压差线性稳压器
ADP150/1	超低噪声150/200mA低压差线性稳压器
ADP1740	低输入电压2A低定差线性稳压器
FPGA ML605开发板与AD-FMC0MMS1射频子板之间使用FMC-LPC插槽相连, 其中包括用于寄存器配置的l2C总线和ADC/DAC I/Q数据端口，在FPGA的RTL 驱动代码中分别设立了两个module处理这两个接口的功能模块。在本文的频谱 感知链路系统中只用到ADC数据链路，因此本节主要介绍ADC数据链路的各个 接口模块和&总线接口模块。
图4-2 ADC接o模块逻辑框图
ADC接口模块工作原理的逻辑框图见图3-4, ADC的釆样时钟来自于AD9548, 其采样频率可由软件编程配置，配置后的时钟输出经去抖等处理后传输至ADC 芯片的时钟引脚。差分输入缓冲器IBUFGDS〔i41的作用是将输入的差分信号转变为 单端信号，因为ADC的IQ数据信号额时钟信号都是差分信号的形式。FPGA开发 板的PCB走线会产生时钟漂移、10延时等问题，所以在IBUFGDS的输出处也即 数据输入端口处插入可控延时单元IDELAY,以便于对准输入数据的釆样时刻。信 号下一步进入IDDR模块，IDDR模块的功能是将双沿触发的信号分离为单沿触发 的信号，对ADC输入侧的双沿触发信号进行处理，通过模式选择模块Mode Select 将两路信号的延时适当的调整，分离出IQ实部、虚部采样信号。IDELAY模块的 可控延时信息是通过监测特定训练序列的PN码而得到的，使用特性的训练序列 PN序列输入到PN_Monitor模块，并将ADC配置为训练模式，检测出在特定延 时控制下的PN码序列的采样结果，分析采样结果的眼图，眼图张开最大位置的 时刻即为最佳ADC釆样时刻。
通过通用IIC总线，可以轻松访问和改写射频板上面的ADC、DAC、混频器、
放大器等芯片的寄存器，实现灵活的配置，使其在较宽的幅度和频域范围内工作。
32
FPGA母板上通过Microblaze平台的IIC IP核可以借助FMC接口与AD-FMCOMMS1 射频子板上的各个功能芯片进行通信，射频子板上有一个专门的PIC单片机会对 FPGA发来的IIC总线请求进行翻译，再通过SPI总线将翻译后的FPGA请求发送 到对应的射频板芯片中，芯片收到配置后会返回一个响应结果，PIC再将芯片的 响应结果通过FMC返回给FPGA母板，FPGA通过返回的响应代码判断此次配置 是否成功执行或者监测射频板的工作状态。Microblaze平台上的IIC IP核可以通 过基于Microblaze CPU的嵌入式C语言编程来控制读写内容和时间，C语言借助 AXI-Lite总线实现对IIC IP核的控制，在Firmware软件中对射频板的各个芯片的 配置和映射都是通过IIC IP核来实现的，Xilinx对IIC IP的读写提供了响应的功能 函数，使得软件可以很方便的实现对射频板的控制。
