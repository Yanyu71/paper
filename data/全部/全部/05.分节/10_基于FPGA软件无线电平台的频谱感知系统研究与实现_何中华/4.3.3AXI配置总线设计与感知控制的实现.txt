4.3.3AXI配置总线设计与感知控制的实现
为了获得频谱感知系统的高吞吐率和稳定性，基于Microblaze的SOC控制 系统稳定工作在100MHz的时钟频率下，而频谱感知的前端ADC釆样率是 163.84Msps,运行在163.84MHz下，基带处理子系统运行在200MHz时钟频率下， 所以控制系统总线从Microblaze软件层面下发到基带处理的RTL代码需要经过跨 时钟域的处理。系统设计中跨时钟域的处理采用异步FIFO来实现，基于各个模 块之间的接口均是AXI-Stream的，所以考虑设计一个AXI-Lite接口的总线桥用以 系统软件层面的配置信息。将基带处理子系统各模块的寄存器映射到Microblaze 系统的总线地址空间，按照AXI-Lite协议一次下发各个模块的配置，配置信息经 过一个跨时钟域的FIFO作为缓冲,传送到200MHz时钟下的基带处理单元模块。
AXI (Advanced extensible Interface)总线协议是 ARM 公司推出的 AMBA (Advanced Microcontroller Bus Architecture) 3.0 协议族中最重要的一部分【囘，是 一种面向低延时、高带宽、高性能的片上总线协议，它的数据传输可以允许数据 并不对齐，并且可以在临时触发的传输中只提供起始地址即可，类似于哈佛的思 想它的数据读和写通道也是分离的，而且支持乱序、无规则的地址访问以及大数 据的持续数据传输，此外，AXI总线更容易也更适合在FPGA硬件中实现，它的 时序可以满足高速率、高吞吐量的要求，更容易得到收敛，对复杂的FPGA硬件 系统是一把不可多得的利器。而AXI-Lite协议是AXI协议的一个子集，它简化了 AXI协议的传输操作和接口定义，专门用来作为系统级的元件module之间数据 通信和配置传输，AXI-Lite采用简化的接口设计来完成对应地址的映射关系，使 得它的重要接口只剩下valid和ready的握手操作来完成前后级的匹配与对接， 这样的设计会占用更少的资源、逻辑易于实现、便于硬件调试和验证、简化接口 连接、且接口较小。AXI-Lite接口有很多表现优秀的特性：通信数据的猝发长度
56
均为1,前后级通信的数据宽度和大小、总线宽度均相等，并支持多种类型的数 据宽度（32位和64位），其对互斥性的操作并不提供支持。总结来说，AXI-Lite 总线一共包含五个通道：读数据通道、写数据通道、读地址通道、写地址通道、 和写应答通道，每个通信通道都有valid和ready信号握手操作。
如图4-25所示，AXI-Lite to IP bridge模块主要分为四个部分：AXI_SINK, AXI_RESPONES_ABITRATOR, AXI_ASYNC_COUPLER 和 AXI_TARGET。AXI_SINK 模块 负责对从Microblaze平台上AXI总线上写下的读写地址进行译码翻译，判断其地 址是否属于频谱感知基带处理子系统各个处理单元的地址空间，如果是属于基带 处理子系统的处理单元的地址，则会写地址、写数据、读地址收下，并转发给 AXI_ASYNC_COUPLER模块。接着，AXI_ASYNC_COUPLER模块中针对各个配置通 道各有一个跨时钟域处理的异步FIFO,用以将通道的数据和地址进行跨时钟域的 处理。然后，AXI_RESPONSE_ARBITRATOR模块将读写的请求通过广播传给其下的 TARGET模块，并等待接收TARGET模块对读写请求的应答和响应。TARGET模块 有两种：第一种为AXI_REG_TARGET,它的地址空间对应一个寄存器，仅当读或 写的地址与TARGET对应寄存器地址完全一致的时候才会对读、写请求进行响应， 对AXI_REG_TARGET发起的写操作会使得目标寄存器所需要更新的配置字的值发 送到对应的REG_TARGET中，而发起的读操作会去读取REG_TARGET中对应的缓 冲写入配置字的数目；另一种TARGET模块叫做AXI_MEM_TARGET,它的地址端 对应一段由内存映射而成的连续空间，当读写地址位于该地址范围时，对读和写 的请求进行相应。REG_TARGET寄存器类型的TARGET用于寄存器类型的配置通 道进行访问，而MEM_TARGET类型的TARGET则用作内存映射式的配置信息的访 问和读取。MEM_TARGET模块会将读、写的请求收下，然后将写的数据输送至与 其相连的基带处理子系统处理单元并产生对应的写应答，对于读请求，从与它相 连的基带处理子系统处理单元中读取对应的值，产生读数据进行回传。如果所有 的MEM_TARGET都没有产生应答，会导致AXI_RESPONSE_ABITRATOR计时器超时 报警，对于写请求方面，会产生错误指示的响应，而对于读请求，会返回0作为 读数据。假如有TARGET产生了应答响应，则TARGE会将应答的结果数据回传给 AXI_ASYNC_COUPLER模块，对应答信息经过跨时钟域处理后返回给AXI_SINK, AXI_SINK进一步将其返还给AXI-Lite总线。假如长时间没有收到写请求或者读请 求的应答，并且AXI_SINK的计时超时，也会触发AXI-Lite总线产生应答，目的是 为了防止总线锁死、系统进入死循环。
57
Configl Config2 Config3
图4-25 AXI-Lite到基带处理子系统总线桥逻辑框图
通过AXI to IP Bridge总线桥单元，可以将基带处理子系统处理模块对应的配 置空间映射到Microblaze软件层面可以访问和控制的总线地址空间中，而控制系 统总线的配置信息可以可靠地传递到基带处理子系统的处理模块。
