4.2.43均值模块的实现
使用MULT18X18S乘法器模块求出频谱能量值之后，对每一帧的6000个点 60MHz的频谱能量值做一个保存，存储在双口 Block RAM中，每一次保存之前先 做一次累加，与前N帧的对应频点能量值相加后写入对应地址的RAM空间。使 用两个Block RAM组成乒乓缓冲的结构，这样就能连续的处理流式数据，最终取 128帧能量数据的均值作为最后的输出。
图4-22 '求均值模块的乒乓缓冲处理结构图
128帧感知数据的频谱能量均值实现流程如图4-22所示，每一帧的6000个 点的值均与双口 Block RAM中对应地址中的值一一对应，对之后每一帧的数据， 找到当前点对应的Block RAM中的地址，根据地址取出Block RAM中的存储值， 累加之后再次存储到Block RAM的对应地址中，同时有个计数器和尾指针指示当 前帧的末尾处。每来一帧6000个点的频谱能量数据，都会依次与Block RAM中 存储的值完成依次累加，设置一个状态机，控制累加帧的个数达到128次之后输 出128次频谱能量值累加的结果，然后状态机的状态紧接着进入下一次128次求 平均之中。而对128个帧数据累加后的和数据，整除128得到每个帧中各个点的 频谱能量值的平均值，128取值的原因正好是2的整数幕，二进制做除法的时候 可以轻松去掉低7bit的数据，并根据第7bit的大小决定四舍五入的值，以此可 在一个时钟周期内快速完成求平均值的除法，并取了四舍五入的结果。
