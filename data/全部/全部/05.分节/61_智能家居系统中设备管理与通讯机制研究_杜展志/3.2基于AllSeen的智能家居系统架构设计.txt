3.2基于AllSeen的智能家居系统架构设计
明确了智能家居系统的整体设计目标，就可以根据相应的功能设计系统架构。 整体来说，系统架构的设计离不开通讯协议和通讯设备的选择。其中通讯协议不仅 决定了通讯设备的基本类型，也决定了通讯设备的连接方式。本文考虑到当前智能 家居系统中协议的多样性和普适性以及课题时间的局限性，最终决定选择在系统中 暂时先实现Wi-Fi和ZigBee两种通信协议，并预留出蓝牙协议的接口。具体系统架 构如示意图3-1所示：
图3-1智能家居系统架构
智能家居系统通过Wi-Fi、ZigBee和蓝牙协议将系统内的设备紧紧联系在一起。 其中系统内设备根据所处的环境可以分为本地设备和云端设备两大类，其中云端设 备通过云连接到系统内的网关上，本地设备则直接和网关交互。由于云端设备是本 地设备在云端的注册，因而云端设备只是与本地设备对应的一个概念镜像，因而云 端设备在物理结构上并没有额外对应的设备，对云端设备的操作最终都将转换到其 注册时对应的本地设备。所以不需要考虑云端设备的选型。
本地设备由真实物理设备充当并且和网关直接交互。根据使用通信协议的差异, 该智能家居系统中的本地设备又可以分为:AllSeen设备、ZigBee设备、蓝牙设备、
35
控制设备和网关。
AllSeen设备为实现了 AllSeen服务框架的智能设备，根据设备内是否包含 AllSeen路由又分为AllSeen标准设备和AllSeen瘦客户端设备。由于本文是搭建基 于AllSeen服务框架的智能家居系统，AllSeen设备是该系统的最基本的控制对象， 也是该系统拓展ZigBee协议和蓝牙协议的基础。篇幅限制，下图3-2给出了在搭建 具体的智能系统时选择的部分AllSeen设备，还有部分设备由Arduino开发板组成网。
图 3-2 控制设备 a) FreeWings 音响 b)Hitache 音响 c)Freewings 音箱
ZigBee设备因为其价格低廉、功耗低而且在短距离通信中性能优异，在智能家 居领域也占据着越来越重要的角色。这也是本文选择ZigBee协议作为本智能家居系 统的底层通信协议之一的原因。图3-3-a给出了本智能家居系统中的部分ZigBee设 备，包括门磁传感器、温湿度传感器和智能灯。
图3-3控制设备a) ZigBee设备b)控制设备c)网关
蓝牙设备目前在智能家居领域也起着不容小觑的作用，由于受限于课题研究时 间，本文将只对蓝牙协议这一部分进行可行性理论方案设计，而不将其纳入实际搭 建的智能家居系统。
控制设备是整个智能家居系统的入口，系统通过借助控制设备的图形界面向用 户展示设备状态和信息和获取用户的操作指令。考虑到安卓手机在市场的占有率， 本文最终选择了它作为控制设备。由于智能控制设备涉及到整个智能家居系统的大 部分功能，因而是本文开发量最大的设备，通过分析控制设备上应用的系统框架可 以帮助梳理整个智能家居系统。从图3-1的系统架构图可以看出控制设备既可以控制
36
本地设备也可以控制云端设备，而与其所处环境和位置无关。
网关是整个智能家居系统的核心画】,如图3-3-C所示。它既充当了局域网的AP, 负责提供本地设备的底层通信渠道，也和云端相连负责云端和本地的数据交互。此 外，本智能家居系统的网关为定制版，除了实现以上基本的数据交互功能外，还需 要开发额外的应用功能，包括设备管理模块、ZigBee设备转换模块和蓝牙设备转换 模块。
从图3-1可以看出本智能家居系统对设备的最终控制都需要转换为对AllSeen设 备的控制，系统中的非AllSeen设备：ZigBee设备和蓝牙哑设备都需要通过网关的 转换模块转换为虚拟AllSeen设备（包括虚拟标准AllSeen设备和虚拟AllSeen瘦客 户端设备）。智能家居系统中的所有设备都需要转换为AllSeen设备才能注册到云端 成为云端设备，以保证控制设备处于远程控制模式时，操作的对象也依然是AllSeen 设备，从而保证设备控制的一致性。
由于本文课题只是利用云端存储注册设备的数据，并不涉及其它复杂的功能， 所以云类型的选取对于本智能系统并不会造成太大的影响。
