3.6.5蓝牙HE设备组网方案设计
目前AllSeen的服务框架并不支持蓝牙哑设备的自由组网，考虑到蓝牙协议在智 能家居领域占据的地位越来越重要，本文结合蓝牙协议和AllSeen服务框架地特点, 提出了一种和现有AllSeen Wi-Fi协议组网相一致的蓝牙哑设备动态组网方案。
图3-11描述了蓝牙设备组网方案的物理结构，为了能让两个蓝牙哑设备动态组 网，该组网方案在组网过程中引入了一个带有图形界面的标准设备在组网的哑设备 间传递消息，此外，该方案的网关实现了蓝牙协议，并在完成组网时，充当蓝牙哑 设备网络的主机和管理设备。为了实现这一方案，标准智能设备需要实现蓝牙主机 的功能，哑设备需要实现蓝牙从机的功能，而网关作为最终的主机和管理设备则需 要同时实现蓝牙主机和从机两部分的功能。此外，为了方便标准智能设备区分周围 需要配置的蓝牙哑设备和可以充当目标主机的网关，本方案规定需要配置的蓝牙哑 设备名称以AJ_开头或是_AJ结尾，可以充当主机的网关设备则以AM_开头或是_AM 结尾。
图3-11蓝牙哑设备组网物理结构图
图3-12描述了蓝牙哑设备的详细组网流程。首先用户会通过标准设备的控制应 用去搜索周围的蓝牙哑设备，由于周围的蓝牙哑设备会进行周期性地广播，所以标 准设备会维护一张周围的蓝牙设备列表，并根据需要配置的哑设备和管理设备的命 名规则过滤出周围需配置的蓝牙哑设备和管理设备，并将这些信息通过标准设备展 示给用户。然后用户通过标准设备选择需要配置的哑设备和目标管理设备，标准设 备将先和需要配置的哑设备建立会话，并将该设备的广播信息和安全验证信息存储 在标准设备中。然后断开连接，连接到目标管理设备，并将存储的需要配置的哑设 备信息发送给目标管理设备，包括其广播信息和安全验证消息，然后管理设备就可 以通过这些信息开启主机模式连接到需要配置的设备，从而完成组网过程。
45
用户
智能设备 （带输入功能）
请求搜索周围的配置设备
搜索周围需要配置的哑设备
返回维护的周围哑设备列表 k-------------
：用户选择配置设备
搜索设备成功
与用户选择的配置设备建立单点会话
请求搜索周围的管理设备
会话建立成功
；将用户选定的设备的详细信息和配 ;对密码存储在智能设备中，并标记 为配置设备信息
搜索周围的管理设备
性
返回维护的周围管理设备列表:
<---------------卜
用户选择管理设备
与用户选择的管理设备建立单点会话
将所储存的配置设备信息传递给管理设
-备，包括配对密码-
管理设备
搜索设备成功
会话建立成功
<
与配置设备信息建立连接:
-----------工
会话建立成功
图3・12蓝牙哑设备组网流程图
图3-13描述了最终的组网效果图，在此需要强调的是，该组网方案不仅可以将 蓝牙哑设备连接到网关形成蓝牙微微网，也可以将网关连接到网关形成散射网，因 而其具有很强的可扩展性。
图3・13蓝牙哑设备组网效果图
46
组网完成后，控制设备就可以通过管理设备来控制和管理其它的蓝牙哑设备。
标准设备充当蓝牙主机且连接到管理设备，管理设备在接到命令之后，将通过转换 层，将命令以主机的形式发送给受控设备，然后受控设备完成相应的操作，具体示 意图如图3-14所示。
图3-14蓝牙哑设备控制流程图
