2.3.1AllSeen总线和路由
AllSeen系统在实现D-Bus总线协议的基础上，通过增加新的标志和头文件成功 将D-Bus通信模块拓展到分布式总线场景。AllSeen总线，作为AllSeen服务框架最 抽象的基础概念，为分布式系统提供了一种快速轻量序列化的消息传递方式【⑸。 AllSeen总线分为系统总线和会话总线两类，系统总线负责设备内部消息传递，会话 总线负责设备间消息传递[⑹，这两种逻辑总线均由AllSeen路由实现，具体结构如图 2-5和2-6所示，其中直线代表系统总线，折线代表会话总线。
图2-5 AllSeen系统总线	图2-6 AllSeen会话总线
路由，作为AllSeen的核心概念，实现了 AllSeen逻辑总线的功能，具体包括广 播和发现应用的服务、建立会话连接、广播信号和数据以及转发消息、，使得服务端 或客户端的应用程序能够通过调用AllSeen服务框架的核心功能实现与总线的通讯 [17],如图2-7所示。
图2-7 AllSeen路由示意图
11
从本质上来说，AUSeen服务框架是一个端对端的通信协议，最终设备与设备之 间的通信就是路由与路由之间的通信。应用消息需要通过路由才能广播到总线，对 于每一个特定的路由都可能处于两个状态，或者绑定在特定的应用之内，或者作为 一个独立的应用存在同时为被多个应用提供服务，如图2-8-a和2-8-b所示。
图2-8 a）应用捆绑路由b）应用共享路由
在此，需要特别强调的是，只有AUSeen标准设备才有路由口阴，瘦客户端设备由 于受限于功率、内存、和CPU, 一般都只包含应用代码和AUSeen瘦客户端核心库， 并不包含路由，那么瘦客户端程序又怎么将应用的消息广播到总线呢？运行在 AUSeen瘦客户端的轻量级应用会寻找近邻网络中标准客户端的路由，并借助该路由 进行广播和发现，以及与其他设备建立连接。瘦客户端通过TCP协议与标准客户端 的路由进行通信，具体示意图结构如图2-9所示：
瘦客户端AHSeen设备
标准AUSeen设备
应用
服务框架	应用服务
应用
服务框架	应用服务
AllSeen瘦客户端核心库
AHSeen核心库
AHSeen路由
图2-9瘦客户端与标准客户端路由通信才匡架
12
