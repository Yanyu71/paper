2.4.4AllSeen数据交互
AllSeen服务框架通过接口成员进行数据交换。服务端应用通过总线对象实现服 务的具体逻辑并通过AUSeen总线接口向外暴露提供的服务。客户端与服务端建立会 话后，通过调用相应的代理总线对象访问服务端特定对象路径下的总线对象，并调 用相应的总线方法或总线信号，从而实现设备之间的交互⑷],如图2-12所示。
Unique名字
AllSeen 路由
会话状态 会话I信息 会话n信息
图2-12 AllSeen数据交换图
19
图2-13描述了 AllSeen设备使用总线方法在路由间交换消息的流程。首先，服 务端通过总线对象实现相应的总线接口，并通过广播服务向近邻网络暴露提供的服 务并设置会话监听器等待客户端加入会话。当客户端进入到近邻网络，服务端和客 户端通过广播和发现模块检测到彼此的存在并建立会话。然后，客户端调用本地的 代理总线对象的方法，并将请求数据以METHOD_CALL消息通过合适的路由节点 发送给服务端。服务端接收到消息报文后会进行相应的解析，并根据传送的数据调 用总线对象上相应的总线方法。如果客户端不需要服务端返回结果，客户端可以将 METHOD_CALL消息的NO_REPLY_EXPECTED标识设置为1,否则客户端将通过 METHOD_RETURN消息响应客户端。如果方法调用发生异常,则返回ERROR消息、。
服务端应用
应用	［AS草心库］
连接
服务端AS路由
|消费端AS路由］
消费端应用
［AS/心库］|应用|
连接
注册总线对国 （加里不叫।
|Jo_REPLY_EXP|
CTED）
|绑定会话端口
添加方法调用器
2
会话端口，会话 选项，会话端口 监听器
1 1 1 1 1	选择路由端点f 发送 METHOD CALL I （ 消息	I
调用方法注册 的处理器
发送 METHOD_CALL 消息 序列号扎 NO_REPLY_EXPECT ED标识，对象路径， 接口名，成员，会话I Id.输入参数.
AllSeen服务和发现
AllSeen会话建立
连接
连接
得到代理总20 对象（唯一标 识名，对象路| 径,会话IdJ 总线接口）I
发送
METHOD_ CALL消息
选择路由端点
从代理总线' 对象获取总I 线接口 I 调用总线接I 口的方法
代理对象产 生一个I AJ.METHODJ &LL消息
调用方法
方法没有响
> 方法产生响也 q	产生 METHODRETU RN消亮 发送 METHOD_RET URN消息)	先送METHOD RETURN }	消息「	选择路由端点 发送
选择路由端点
回复序列号扎会话u Id,发送者，输出参, 数…
METHOD_RET URN消息
输出参数
P
图2/3 AllSeen通过总线方法进行数据交换
20
除了使用总线方法外，AUSeen设备还可以通过总线信号进行数据交互。图2-14 描述了 AllSeen设备通过总线信号传送数据的具体流程。首先,服务端通过总线对象 实现具体的服务并通过总线接口将服务广播到近邻网络中，然后，设置会话监听器 等待客户端加入。客户端注测相应的信号监听器，当客户端进入到近邻网络通过广 播和发现模块检测到服务端，首先，客户端与服务端建立会话，并设置路由接收信 号。当服务端向外发送SIGNAL信号时，需要传送的消息通过总线发送到客户端。
服务端应用		消费端应用
|应用|	| AS核心库|	|服务端AS路由|	|消费端AS路由|	| AS核心库|	|应用|
1	1	1	1	1	1
। _连接J 一连接 「	। 一 连接「一连接」
注册总线	「	1	r	n
1	较 ■	।	। C添加方法1	1		1	1 ।	।
（	*处埋器		। ।
|绑定会话端Q		J	1	। ।
।	［会话端口，会话1	।
・选项，会话端口 ।		1注册信号处।
1理器（接口।
1	।	1	1	।名，信号।
।	I	I	I	nrap	|名，接收对］
। ।	1	匹配	।象.处理方।
1	1	1	L			1法，源）।
1	1	|	| Type="	signal ” ］	I
1	1	।	.接口名	信号.
1	1	名，源对象路径;
!< ।	| AllSeen服务和发现 ］	r A
!<L !	! ai— !	!
1	1 1	1 1	-	1 ,用发送信号］	।	। 1	1 1	1 1	1 I	I	1	1 1	1 1	1 1	1 1	1
V 1 1调用总线对象.	1	1	1	1
1信号，产生।	1	1	1	1
| SIGNAL消息 |	1	1	1	1
1	1			1	1	1
|	］发送SIGNAL消息］	|		1	1
1	1诜择路由端点O	1		1	1
了发送SIGNAL消息:
1	1 |	|	|接口名，信号名，会|	1	1 1	1
1	1	। 话Id,信号参数…	1	1
1	1	c?根据匹配规则过!
1	1	滤信号1
1	1	।发送SIGNAL消息।
1	1	1	1			4	1
1	1	1	1	1调用注册的'1
1	1	1	1	1信号处理器1
图2-14 AllSeen通过总线信号进行数据交换
21
此外，AUSeen服务框架也可以通过总线属性进行数据交换，由于总线属性的获 取和修改是通过总线属性的setter和getter方法,因而数据交互流程与总线方法一致， 在此不再赘述。
