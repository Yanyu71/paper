2.3.2AHSeen总线附件
绑定在服务端或客户端应用中的路由往往以后台程序运行，而应用则与用户在 前台交互。这意味着路由和应用位于不同的进程中，无法实现直接通讯。然而，应 用消息需要通过路由广播到总线上，为了解决这一问题，AllSeen服务框架在AllSeen 应用中创建一个实体类来代表路由实现和应用的通讯。这个位于应用进程的路由''代 理”，被称之为AllSeen的总线附件口叫 负责到每条AllSeen总线上的连接。每一个 需要和AllSeen总线连接的进程都需要通过总线附件来转发消息。
创建总线附件时，可以通过定义枚举值BusAttachment.RemoteMessage来设定总 线附件对远程消息的处理策略，当枚举值为Ignore时代表不接收来自远端设备的消 息，当枚举值为Receive时代表接收来自远端设备的消息。
由于总线上会连接许多总线附件，为了保证消息能在总线上准确传输，总线上 的每处连接都必须具有唯一的标识符。因而AllSeen服务框架在创建总线附件时会自 动为每个总线附件分配一个全球唯一的标识符(GUID)作为临时总线名称。虽然 GUID有效地保证了每个总线附件的唯一标识性，但每次重新启动AllSeen路由时， AllSeen服务框架就会重新给总线附件分配新的GUID,且往往不同于上次，因而 AllSeen服务框架无法通过GUID来长期标识特定总线附件。为了解决这个问题， AllSeen AllSeen引入了 WKN (well-known name)名称用来长期标识总线附件。WKN 名称命名规则符合D-Bus协议的命名惯例和准则。具体来说，总线附件在向路由请 求WKN名称时会通过如表2-1所示的标识符来确保WKN名称的唯一性。
表2-1 AllSeen的数据类型
标识符	意义
ALLSEEN_REQUESTNAME _FLAG_DO_NOT_QUEUE	如果不能马上获取请求的名字， 那么该请求失败
ALLSEEN_NAME_FLAG _ALLOW_REPLACEMENT	允许其它总线附件覆盖当前总线附 件拥有的名字
ALLSEEN_REQUESTNAME _FLAG_REPLACE_EXISTING	允许当前总线附件覆盖申请名字， 即使其它总线附件已使用该名字
13
