3.1基于AHSeen的智能家居系统的设计目标
一套完整的智能家居系统应该具有高效的设备发现机制、灵敏的设备心跳机制、 有效的设备管理机制、便捷的设备通讯机制和可靠的安全机制。本系统也针对这五 点进行了如下的功能设计： 1、高效的设备发现机制
巧妇难为无米之炊，同样，智能家居系统也离不开对基本智能设备的操作。设 备操作的前提在于系统拥有一套高效的设备发现机制，能迅速发现网络中的可操作 设备。根据本文的研究目标和内容,本文搭建的智能家居系统需要能迅速发现AllSeen 标准设备、AllSeen瘦客户端设备、ZigBee设备和云端设备，因而系统也针对这四种 类型的设备分别设计了对应的发现机制。
系统通过实现About机制来进行标准设备服务的广播和发现，控制设备通过注 册相应的监听器监听总线上的About信息并根据监听到的信息发现标准设备；对于 AllSeen瘦客户端设备，则通过借助AllSeen的Onboarding服务框架，使用控制设备 的Wi-Fi扫描模块实时检测周围的AP信息从而发现目标设备；本系统对于ZigBee 设备的发现需要转换为对ZigBee设备在网关虚拟的AllSeen设备的发现，采用转换 模式可以避免系统再重新开发一套完整的基于ZigBee协议的设备发现和管理机制， 并为进一步拓展蓝牙协议、Zwave协议提供参考。云端设备的发现需要控制应用连 接到相应的云端账户并通过网络数据获取云端的存储数据，然后再根据预定义的数 据格式来解析这些数据为云端设备。
2、灵敏的设备心跳机制
33
一套好的智能家居系统应该具有灵敏的心跳机制，从而能实时监测和更新设备 的在线、离线状态并以此保证操作的可靠性。由于对ZigBee设备的发现最终需要转 换为对虚拟AllSeen设备的发现，因而本文搭建的智能家居系统主要考虑了 AllSeen 已入网设备、AllSeen未入网设备和云端设备的心跳机制。具体来说，本系统主要使 用了 AllSeen的NGNS服务设计了相应的心跳机制算法来监测已发现设备的实时状 态；对于未入网的AllSeen设备则通过AllSeen的Onboarding框架加以实现；云端设 备的心跳机制需要本地设备的配合，系统每次检测到设备的更新状态之后都将通过 总线方法将设备的新状态发送到网关，再通过网关实时更新云端的存储数据从而来 保证云端设备的心跳机制。
3、有效的设备管理机制
智能家居系统的最终目的是实现用户对于设备的智能控制，设备的发现和心跳 机制都是作为底层技术来确保受控对象的可靠性。本文搭建的智能家居系统会系统 内的设备控制提供了丰富多彩的方式，主要有Control Panel、Bus Object、Config以 及Event-Action四种方式。其中Bus Object为最底层的方式，控制设备通过服务的广 播信息和Java的动态编译实现对设备的单点控制；Control Panel和Config是AllSeen 服务框架提供的基础服务模块，通过实现这两个基础服务模块，系统可以实现对设 备的图形化控制和基本信用控制；Event-Action机制作为用户友好型的控制方式，为 用户提供了设备的联动控制，进一步提升了用户体验。
4、便捷的设备通讯机制
智能家居系统与传统家居系统的最大区别在于智能家居系统打破了系统内设备 间通讯的障碍，让设备对话成为可能。本智能家居系统也为系统内设备提供了丰富 的通讯方式，具体包括单点会话、多点会话和AllSeen的Notification基础服务框架 三种方式。其中单点会话主要发生在设备控制时，控制设备主要通过AllSeen的会话 机制与被控设备建立会话渠道传送控制命令和交换信息；多点会话则主要发生在网 关的设备组管理中，网关主要通过多点会话来获取当前网络的设备信息。
5、可靠的系统安全机制
智能家居系统作为一套完整的智能服务方案，在给用户带来新体验的同时也需 要保障通讯的安全。AllSeen的服务框架在设计之初便考虑到了安全性，因而对其通 讯内容进行了加密处理。此外，为了进一步加强系统的安全性，本文在存储设备相 关信息时也采用了 MD5的加密方式。
34
