3.3设备应用层框架分析
根据第二章2.2.2介绍的AllSeen协议栈可知基于AllSeen服务框架开发的智能 家居系统的开发主要集中在应用层，为了能更好地整体把握系统的整体功能和通信 流程，本节描述了系统内各类型设备的详细应用层框架。由于系统中的ZigBee设备 和蓝牙设备最终都要通过网关的转换模块转换为本地网络的虚拟AllSeen设备，本身 并不实现AllSeen的服务框架，因而这里就只介绍标准AllSeen设备、AllSeen瘦客 户端设备、控制设备和网关的应用层框架。
标准设备拥有自己的路由和图形用户界面，因而可以实现自由动态组网，所以 不需强制实现Onboarding服务框架，除非该标准设备希望充当Onboarder角色。标 准设备需要向外提供服务和功能，所以需要实现About和相应的设备控制机制。通 知模块也是加强功能，各设备根据自己开发功能的需求选择是否实现该框架。总体 来说，AllSeen标准设备的系统架构具体如图3-4所示。
37
Al 1 seen标准设备应用层架构详解
图3-4 AUSeen标准设备应用层架构
AllSeen瘦客户端设备没有自己的路由和图形用户界面，因而无法实现自由动态 组网，所以需要借助Onboarding服务框架联网。瘦客户端设备需要向外提供基础的 服务和功能，所以需要实现About和相应的设备控制机制。考虑到本智能家居系统 希望加强对设备状态的管理，所以AUSeen瘦客户端将实现通知服务框架。本系统中 的AllSeen瘦客户端设备的系统架构如图3-5所示：
Allseen瘦客户端设备应用层架构详解
瘦客户端设 备应用通知
通知发送
Notification
设备服务与功能
设备信息	设备控制
标准设备广播 About	Control Panel	Config	Event Action	Bus Object
设备组网
Onboarding
图3-5 AllSeen瘦客户端设备应用层架构
控制设备需要与系统内的所有设备进行交换，因而需要实现所有的功能，包括 实现Onboarding基础服务框架支持瘦客户端设备的组网，实现Notification基础服务 框架通知发送模块。以及实现设备的发现、控制和管理。控制设备的具体系统架构 如图3-6所示：
38
控制设备应用层架构详解
通知获 取模块
设备控制
设备管理
设备控制
设备信息	心跳机制
设备控制
通知接收
Notification
标准设备发现	瘦设备发现
About	Onboarding
设备组网
Onboarding
图3-6 AllSeen控制设备应用层架构
网关作为系统的核心，需要实现Notification基础服务框架来接收通知，和云端 交互，以及实现ZigBee设备的转换模块，和一些设备管理机制。网关的具体系统架 构如图3-7所示：
网关应用层架构详解
服务与功能
设备心跳机制
通知处理模块
设备信息
设备控制
通知发送接收
Notification
瘦客户设备广播
About
Bus Object Conf ig Event: Act ion
Zigbee
白W
E
图3-7 AllSeen网关应用层架构
