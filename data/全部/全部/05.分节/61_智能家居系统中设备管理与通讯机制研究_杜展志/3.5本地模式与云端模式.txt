3.5本地模式与云端模式
本智能家居系统采用外界可达AllSeen网络拓扑结构，同时实现云端模式和本地 模式。由于云端模式和本地模式实现的技术手段不同，本地模式使用AHSeen技术实 现对设备的管理、组网、通讯和控制，云端模式通过网络数据在云端和网关进行通 讯交流，且这两个模式下设备的交互流程也相互独立，因而具有独立性。
考虑到人类复杂的社会活动，这两个模式虽然具有独立性，但并不具备互斥性。 举个最简单的例子，用户生活的家庭和工作的地方有可能是两个物理相隔离的智能 家居系统。但存在用户需要同时控制着两个系统的情况，在这种情况下，本地模式
40
和云端模式又是同时存在的。
考虑到本地模式的独立性和非互斥性，如果简单地将本地模式和云端模式独立 设计为用户可以选择的模式，那也在一定程度上削减了系统的智能性。此外，由于 云端设备是本地设备注册的虚拟设备，所以同一设备可能同时存在本地在线和云端 在线两种状态，在这种情况下，设备选择何种方式通讯也值得深入思考。
考虑到本地AllSeen设备通讯发生在同一局域网内，通讯成本较云端外网更低, 速度更快，因而本文优先选择本地模式。具体实现方法如下，控制设备默认开启本 地模式自动检测用户所处环境的设备，这些设备即为本地设备。采用显性入口由用 户决定是否开启云端模式。如果采用云端自动开启模式，控制应用程序需要提供一 个后台进程或线程来保持和云端的互联互通并周期性获取设备信息，这样的无限循 环在无须开启云端模式和云端模式异常时对于资源的浪费极其严重的。考虑到控制 设备资源有限，本文最终选择优先本地模式。此外，如果对于同一个设备，本地模 式和云端模式该设备都处于在线状态，控制设备将按照本地模式的通讯方式进行处 理。
