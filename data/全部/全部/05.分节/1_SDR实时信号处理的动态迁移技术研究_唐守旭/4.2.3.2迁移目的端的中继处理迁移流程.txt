4.2.3.2迁移目的端的中继处理迁移流程
在迁移目的端恢复迁移发起端的中继处理业务之前，需要先通过迁移发起端 发送过来的路由表信息来配置迁移系统中的路由表信息变量，以避免重建路由表 信息所花费的大量时间。
在迁移发起之前，迁移目的端会首先接收到迁移发起端通过ZMQ机制发送 过来的要求配置迁移系统路由表信息变量的控制指令一一set_route。迁移目的端 接收到该指令后，会继续接收相应的路由表信息，然后利用该信息配置迁移目的 端迁移系统的变量routejist,保存在迁移系统中以供迁移时使用。配置完成后会 向迁移发起端返回配置展功与否的结果。
迁移发起时，迁移目的端首先接收到迁移发起端发送的控制指令- start_d2d,然后主控程序会按照动态迁移系统中的流程启动D2D进程。当D2D 启动成功时，会利用迁移系统的routejist变量对D2D程序中的route_t结构体进 行配置，并返回route_t结构体配置结果信息给迁移发起端。如果D2D进程启动 失败，则终止此次操出，退出。
在本次操作都成功执行完毕之后，主控程序会创建一个新线程来定期采集
62
D2D程序的route_t结构体信息，以更新迁移系统中的变量，使迁移系统维护最 新的路由表信息，如图4-4中绿色方框所示。
迁移目的端动态迁移系统中，完成中继处理业务迁移任务的相应处理流程如 图4-4所示。
动态迁移主 控程序启动
(	set route	1—start d2d―i
接收迁移发起
端的路由表信	启动D2D进程一启动失败-
息睪量
启动成功
V	▼
疏冨誰| GO
!取路由表信息丨
图4-4迁移目的端中继处理业务迁移任务相关处理流程
