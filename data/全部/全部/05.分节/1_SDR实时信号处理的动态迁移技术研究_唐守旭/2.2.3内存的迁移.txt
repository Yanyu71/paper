2.2.3内存的迁移
内存的迁移是虚拟机动态迁移中最难而且最重要的部分，不仅因为存储内存 数据的结构本身很复杂，而且这些内存数据本身也非常重要，决定了迁移之后， 客户机能否恢复。从理论上讲，在完成整个虚拟机的整体的动态迁移操作，其中 需要对内存部分进行专门的迁移操作，该操作流程大体上会包括三个不同部分： Push阶段，Stop-and-Copy阶段和Pull阶段。接下来会对三个不同部分作简单描 述阴:
•Push阶段：在“推送”阶段，如果在虚拟机运行的过程中，虚拟机的内 存页面如果满足迁移的要求，那么就会把这些符合要求的内存页通过网 络从源端主机迁移到目的端主机。但是在迁移的过程中，虚拟机的内存 页面可能会继续被改写，因此需要采用某种适当的策略把那些仍然符合 迁移要求的内存页面发送到目的端主机。
•Stop-and-Copy阶段：在“停机复制”阶段，在源端主机上运行的虚拟机 将会根据不同的迁移策略把源端主机上的相应的虚拟机内存数据发送到 目的端主机。例如在预拷贝算法中，在“停机复制”阶段，发送那些剩 余的未同步的内存脏页。在传送完毕这些内存脏页之后，目的端系统中 的虚拟主机的状态能够与源端系统中的虚拟主机达到同步，这时候会在 目的端系统上的建立起虚拟机，并将原来的创建的虚拟机所占有的资源 释放掉。
•Pull阶段：在“拉取”阶段，如果发现在“停机复制”阶段建立在目的 端主机上并且己经启动的虚拟机出现有内存页面被访问但还没有被复制 传送过来，那么在此阶段，会从源端主机将对应位置上的该页面复制过 来。
