3.4.4实时信号处理迁移功能模块
当主控程序接收到输入终端输入的控制指令为“M"或者"Migration”时,
35
主控程序将会跳转到启动将实时信号处理D2D程序向迁移目的端迁移的处理模 块，并逬行一系列的迁移操作工作。
首先迁移发起端利用ifconfig指令获取本地的虚拟网卡ip地址，并将该地址 保存在动态迁移系统中的tun_ip变量中，然后通过ZMQ通信机制向迁移目的端 发送配置虚拟网卡ip地址的遂制指令一一“set_tun_ip”和需要配置的虚拟网卡 ip值一一“tun_ip”，然后等待迁移目的端返回亙置盘拟网卡ip操作结果。如果 迁移目的端的虚拟网卡ip配置成功，则迁移发起端将会继续迁移的后续操作； 如果迁移目的端返回虚拟网卡ip配置失败的结果，则结束配置迁移操作，并打 印迁移失败报告。
在接收到迁移目的端虚拟网卡ip配置成功的返回结果之后，迁移发起端的主 控程序会继续利用ZMQ机制向迁移目的端发送启动接收控制信令的实时信号处 理程序相关的D2D进程的控制指令—— “start_d2d”，同时也将通过ZMQ机制 将保存在动态迁移系统的“Control”字典变量中的相关控制信息和标志信息参数 ucontrol_flag=l ”一并发送到迁移目的端，表示启动包含控制信息的D2D进程， 然后等而移目的端返回的启动进程处理的相关结果。如果迁移目的端的实时信 号处理程序相关的D2D进程启动成功，则迁移发起端可以继续进行下一步操作； 如果迁移目的端返回D2D进程启动失败的结果，则迁移发起端将会终止本次的 实时信号处理程序的迁移操作，并打印迁移操作失败报告，然后跳出本次执行操 作模块。
在通过ZMQ机制接收到迁移目的端启动D2D进程成功的结果之后，迁移发 起端的迁移系统主控程序将会继续通过ZMQ机制向迁移目的端发送创建USRP 实体的控制指令一一“make_usrp",然后根据迁移目的端返回的处理结果来决定 是否继续下一步的操作。如棄接收到迁移目的端返回的创建USRP实体操作成功 的结果，迁移发起端将会继续执行迁移操作的流程；如果迁移目的端返回了创建 USRP实体操作失败的结果，则主控程序将终止迁移操作的后续流程，并向迁移 目的端发送“kill_d2d”控制指令，以结束前面在迁移目的端己经成功启动的D2D 进程，然后打印迁移失败报告，跳出迁移功能模块。
当迁移发起端通过ZMQ机制接收到创建USRP实体成功的信息之后，迁移 发起端将开始调用killProcess函数，结束本地正在运行的实时信号处理相关的 D2D进程和USRP进程。如果迁移发起端本地的实时信号处理相关进程结束操 作执行成功，则主控程序会进一步将eth3端口的ip修改为192.168.20.2,以避免 ip冲突的问题，然后在进行迁移的后续操作；如果本地的实时信号处理相关进程 结束操作失败，那么主控程序则会终止本次迁移操作，并且主控程序向迁移目的 端发送“double_kill”控制指令，令迁移目的端同时结束之前在迁移目的端已经 成功启动的D2D进程和USRP实体进程，然后打印迁移失败报告，退出本次迁 移操作模块。无论结束本地实时信号处理相关的D2D进程和USRP进程是否执 行成功，都将停止另一线程中釆集D2D程序控制信息的操作，并结束该线程。
当迁移发起端实时信号处理相关的D2D进程和USRP进程都被成功地结束 T，并且eth3网络端口的ip也被配置为非USRP设备子网内的适当值之后，主 控程序将会执行迁移的最后一步，利用ZMQ机制向迁移目的端发送建立USRP 实体与USRP设备之间数据链路连接的控制指令一一“link_usrp”，然后等待迁 移目的端返回的连接操作处理结果。如果通过ZMQ机制接板到迁移目的端返回
36
USRP实体与USRP设备己经建立起数据链路连接的结果，主控程序将会打印迁 移成功报告，并成功的完成此次迁移工作，结束本次迁移操作；如果主控程序接 收到迁移目的端返回的建立数据链路连接失败的结果，主控程序则需要通过 ZMQ机制向迁移目的端发送将前面己经在迁移目的端成功启动的D2D进程和 USRP实体进程结束的控制指令——“double_kill”，然后打印迁移失败报告，并 以失败结束本次迁移操作，退出迁移模块。
在迁移发起端IBM Serverl中，将实时信号处理程序从迁移发起端迁移到迁 移目的端的整个迁移流程中，迁移发起端所进行的相关迁移操作流程如图3-12 所示。
37
屢时信号处理程序腐 迁移发起端迁移到迁 〈移目的端处理模块丿
获取本地虚拟网卡ip, 并向迁移目的端发送 配置虚拟网卡ip指令
配置成功
向迁移目的端发送
Control控制信息、标志
位和启动D2D进程指令，
并等待返回处理结果
涣时信号处理程序蚀
囈处理模塡反行结矿
图3-12实时信号处理动态辻移过程中迁移发起端的相关处理流程
38
