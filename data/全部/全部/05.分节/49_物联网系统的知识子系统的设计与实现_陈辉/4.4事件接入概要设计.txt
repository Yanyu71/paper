4.4事件接入概要设计
事件接入模块主要是解决系统中事件的接入问题。所有的物联网事件都存储在发布 订阅系统消息中间件中。数据的订阅模块则负责数据的订阅和过滤功能。基于配置的订 阅模块可以决定订阅哪些主题的信息，当消息中间件中有这些主题的事件出现则交给推 理模块进行处理。如果是向发布订阅系统订阅，就会解析出订阅主题并向发布订阅系统 请求订阅，若是要退出订阅，就会向发布订阅系统请求退出订阅。发布订阅系统受到相 应的请求后会做出响应并返回处理消息。
事件接入模块存储了订阅主题信息供用户查询，同时判断订阅者订阅的主题是否存 在，如果不存在会创建订阅主题。事件接入模块会向发布订阅系统获取主题树，事件主 题是以主题树的形式存储的，在进行匹配时都是从根节点逐渐到子节点开始匹配，直到 找到对应的节点，用户订阅主题、取消订阅和发布事件所用的主题都是从主题树获取， 如果所订阅主题不在主题树中，可以请求建立主题，如果没有建立相关主题，就会订阅 失败。
结构图如图4-12所示。
图4-12事件接入模块结构图
订阅方需要基于需求进行相关主题的订阅，本课题主要是基于用户的目标进行推理 从而实现事件处理功能。所以用户的目标定义中需要包含相关的主题信息，此主题信息 也属于领域信息的范畴。通过解析用户的目标，获取相关主题信息，就可以订阅相关卽 主题。订阅流程图如下图4-13所示： :
图4-13主题订阅流程图
