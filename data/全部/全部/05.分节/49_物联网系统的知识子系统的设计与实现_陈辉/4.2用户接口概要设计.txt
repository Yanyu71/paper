4.2用户接口概要设计
用户界面模块提供用户一个直观的Web用户界面，用于定义推理目标、推理结果 展示和简单的知识库査询管理，因此包括前端和和应用后端两部分。结合需求分析，前 后端的的交互主要釆用Json数据格式，同时由于本应用属于轻应用，所以选择Jetty作 为Web后台。
用户可进行的基本的知识管理操作包括知识库的添加、删除、备份和查询操作。通 过在界面提供相应的页面和功能实现，用户的操作会经过处理发送到后台，然后后台根 据操作的不同进行相应的响应。基本流程图如图4-2所示：
图4-2前端基本管理流程图
推理目标界面主要提供用户参数的可选输入项，用户通过选择这些参数项进行目标 定义，这些参数与知识库中的概念实例相对应。
在用户界面规则定义界而，首先用户选择知识库，将知识范围限定在选中的知识库 中。然后，为了将事件与知识库中的知识映射起来，需要进行知识对象和事件之间的映 射定义，系统提供…些用户可以选择的映射机制，系统会根据用户选择的选项采取不同 的映射机制，这样动态的可以事件与知识库中对象映射起来。与此对应，在用户界面， 用户接口会根据用户选择的知识库获取知识库中的知识对象，以列表的形式供用户选择。 事件方面，用户可以选择领域信息，此领域信息包含事件主题，接口会根据此主题信息 获取事件的schema,然后渲染界面提供事件的一级属性供用户进行绑定。比如可以将 出租车的数据映射到知识库中的位置Position概念，此机制需要后台相应的实现，并在 前端只提供用户绑定的对象名称和属性。
在绑定了事件与知识对象之后，用户需要选择事件的推理范围，只有属于推理范围 内的事件才需要进行处理，比如可以选中某一条具体的道路实例作为推理范围来推理此 道路是否拥堵。系统同样会根据用户选择的知识库提供用户相应的选择列表，比如用户 选择traffic知识库，提供的列表只会包含traffic知识库中存在的道路实例名，请求提交 之后系统会自动根据选择的道路实例名查找知识库获取相关的信息。
结合需求分析和实际需求，为了利用一阶逻辑推理来处理事件，目标事件的组成还 需要提供相应的参数以及参数的约束。对于具体的道路，用户需要定义拥堵事件的参数。 例如，数据最小个数、缓速的临界值、缓速车量占观察车量的比例等。用户选择这些相 关选项和输入参数之后，接口会将推理请求提交发送到后台，系统后台会将其解析生成 一阶逻辑推理器Z3中的一阶逻辑表达式，然后利用推理证明的方式来验证这些条件是 否成立，如果成立则意味着拥堵。
用户定义目标的流程图如下图4-3所示：
开始
选择领域信息
目标参数设置
定义相关目标约束
提交推理请求
结束
图4-3目标定义流程图
例如，结合本课题使用的深圳出租车数据，用户可以定义如下目标：首先选择特定 的道路作为推理范围，然后定义道路拥堵的条件，如设置当前道路上缓速车量占比达到 一定比例可视为拥堵条件，这其中缓速车的数量与占比的比例数值均是构成目标的约束 条件。
定义好推理目标之后，用户提交推理请求，推理目标携带id提交到后台进行推理， 处理结果存储在MongoDB数据库中，同时附上用户此次推理的唯一标志ido
处理结果的呈现：对于处理结果的呈现，用户界面采用轮询的方式向平台后端发送 请求，请求包括推理时提交的唯一 id,系统后台每接到数据请求时就利用此id从 MongoDB数据库获取结果并返回给用户界面。用户界面将返回来的处理结果利用开源 的图形库渲染界面，过一段时间再次对后台提交请求结果。图4-4是结果展示流程图：
图4-4结果获取流程图
如上图所示，前端采用轮询的方式获取结果数据,如果有结果返回则更新前端界面， 如果没有结果返回则结束获取流程。
