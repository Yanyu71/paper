5.2PCS模块功能仿真测试
PCS模块包括TX通道和RX通道。其中TX通道由64b/66b编码器、扰码器、 TX变速箱组成；RX通道由RX变速箱、Sync_Block同步模块、解扰器、64b/66b解 码器组成。PCS模块的主要功能是将由XGMII接口发送过来的数据进行编码、扰码 等处理，将66bit进行64bit转换后发送到PMA子层；同时将由PMA子层发送过来 的64bit数据进行66bit转换后进行同步，同步后再进行解扰、解码等处理，最后将 64bit数据发送到XGMII接口。
为了能够测试PCS整体模块的功能，采用仿真测试环境中的回环路径，即由10G Ethernet PCS/PMA (10GBASE-R/KR)的 IP Example Design 产生数据激励源，首先经 过PCS模块的RX通道，再由TX通道发送出去，在这一过程对PCS模块进行仿真， 可验证其功能的正确性，其中主要对Sync_Block同步模块和RX变速箱以及PCS模 块整体进行仿真，其他模块的仿真放在PCS模块整体中进行仿真。
(1)Sync_Block同步模块仿真测试
对于Sync_Block同步模块以及RX变速箱的仿真测试主要关注在设计中的两个 滑动指针：RX变速箱中的Index以及Sync_Block同步模块中的header_count。在设 计中，同步头的锁定标志为header_count>=64,即block_sync信号置1。
如图5-2所示，高亮显示的gtx_Index信号和Sync_counter信号表示第四章设计 的RX变速箱中的Index和Sync_Block同步模块中的counter□在第四章分析过， Index在Sync_Block同步模块接收了 32次的66X32bits数据后通知RX变速箱向后 移动一位进行发送。图中的Sync_counter信号显示为325h20,换算成十进制为32, 表示其已经接收了 33次的66X32bits数据。因此，gtx_Index信号向后移动一位，由 6匕04变为65h05=此时同步头还未锁定。
57
图5-2同步头锁定功能整体仿真图
当block_sync信号置1时，表示同步头锁定，如图5-3所示。此时 sync_header_count 信号为 85h41,即 header_count 为 8，h41,换算成十进制为 65,表 示已经连续收到超过64个Block,并且同步头全为01或10。以上结果表明RX变 速箱和Sync_Block同步模块的相关功能正确。
图5-3同步头锁定成功
(2)整体功能仿真测试
在整体测试PCS模块功能中，对RX通道以及TX通道进行仿真测试，包括 64b/66b编解码、扰解码以及变速箱功能。
a.RX通道
RX通道将激励源接收进行位宽转换、解扰以及解码处理后，发送到XGMII接
58 口中。如图5-4所示，高亮显示的pma_data_i信号表示由PMA子层发送过来的64bit 数据；gearbox_data信号表示经过RX变速箱的位宽转换后变为66bit的数据； descram_result信号表示经过解扰后的数据，此信号表明解扰器功能正确； pcs_data_out信号表示RX通道输出到XGMII接口的信号，是经过64b/66b解码后 输出的信号，在未同步之前，激励源发送IDLE字符，其已经经过XGMII接口转码 变成0x07,根据附图2,其代表含义为IDLE字符，此信号表明64b/66b解码器将数 据正确解码，功能正确。上述结果表明RX通道各模块的相关功能正确。
图5-4 RX通道整体仿真
b.TX通道
由于是回环路径，TX通道将由RX通道接收到的数据进行发送，再次发送到 PMA子层，在此过程需要完成64b/66b编码、加扰以及位宽转换处理。
如图5-5所示，xgmii_data信号表示XGMII接口发到PCS模块的发送数据，其 已经经过10GBase-R协议转码变成0x00,同样根据附图2,其代表IDLE字符。因 此，从激励源发到PCS模块的数据，被PCS模块准确接收，并形成回环由MAC层 发回了 PCS模块；data_scramble信号表示经过加扰后的数据，此信号表明扰码器功 能正确；gearbox_data_o信号表示经过TX变速箱进行位宽转换后，66bit变为64bit 的数据，此信号表明TX变速箱功能正确；pma data o表示发送到PMA子层的数 据；在上述过程中，data_encode_en信号每经过32个高电平的时钟周期后拉低1个 时钟周期，表示停顿编码一次，此信号表明64b/66b编码器功能正确。上述结果表明
59
