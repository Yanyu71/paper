5.3MAC地址卸载加速模块仿真测试
在MAC地址卸载加速模块中，主要包括解析模块、配置模块、匹配查找模块以 及动作模块，其功能是按照用户自定义的MAC地址将满足匹配条件的数据包进行 卸载，从而判断是转发还是丢弃，其中匹配查找模块是本部分的核心模块。在匹配查 找模块中，本文将48bits的MAC地址分成6段分别进行匹配，即一次匹配查找操作 需要在6块CAM存储器中进行，只有都匹配成功才说明MAC地址匹配成功，匹配 成功的等待执行动作，匹配失败的则被丢弃。
为了测试这一部分内容，同样采用回环路径，即由10G Ethernet PCS/PMA (10GBASE-R/KR)的IP Example Design产生数据激励源，经过PCS模块处理后进入 此模块，其中主要对匹配查找模块进行仿真测试。
(1) 整体功能仿真测试
如图5-6所示，nic_smac信号表示需要匹配的MAC地址，这部分由驱动通过配 置模块进行配置，在这里将需要匹配的MAC目的地址设置为4c:e0:00:00:00:00,此 信号表明配置模块功能正确；real_rxd信号表示实际收到的MAC地址，是由解析模 块将需要匹配的字段即MAC目的地址发送过来，此信号表明解析模块功能正确。在 本文中被分成了 6段分别进行匹配查找，只有addr_mat_0~5信号全部置为1,才代 表匹配成功；否则代表匹配失败；rx_begin信号表示开始进行匹配；addr_mat信号表 示匹配成功的状态，当addr_mat_0~5信号置1时，此信号持续置1； dropjpkt信号 表示匹配失败时执行丢弃动作，与addr_mat信号极性相反。上述结果表明，MAC地 址卸载加速各模块功能正确。
图5-6匹配查找模块整体仿真
(2) 匹配查找模块仿真测试
如图5-7所示，在real_rxd信号中，收到了一整帧，但只对MAC目的地址进行 匹配。其中①表示以太网的前导码D5-55,由物理层封装好；②表示收到的MAC目 的地址，显示顺序为倒序00, e0, 4c, 00, 00, 00；③表示每个CAM存储器进行匹
60
配后的结果，可以看出，addr_mat_O负责匹配的字段为00,只要有00进入，则匹配 成功，addr_mat_l负责匹配的字段为e0, addr_mat_2负责匹配的字段为4c,
addr_mat_3~5负责匹配的字段为00,这些都由驱动在匹配之前进行配置；④表示匹 配状态，可以看出，当有addr_mat_0~5信号置1时，此信号则置1,当全部 addr_mat_0〜5信号匹配成功时，addr_mat信号置1,表示匹配成功。
如图5-8所示，在real_rxd信号中表示收到了另外一帧，①表示前导码；②表示 此帧的MAC目的地址，倒序为00, aa, 3c, 33, ee, 9b,显然并非预期的MAC目 的地址;因此在③中，只有addr_mat_0> addr_mat_3~5对00匹配成功;④表示drop_pkt 在匹配失败后将此帧执行丢弃动作。上述结果表明，匹配查找模块以及动作模块功 能正确。
图5-8匹配失败执行丢弃动作
61
