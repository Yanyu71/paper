2.1.2应用场景分析
高速智能网卡作为满足高效处理协议、支持多种网络功能以及提供高速的网络 速率的产物，其用场景广泛，主要包括网络协议处理、网络功能处理以及金融算法交 易，下面将从以上场景进行介绍。
(1) 网络协议处理
网卡作为一种网络设备，最基础的应用场景是对网络协议进行处理。目前网络 协议繁多，高速智能网卡普遍支持标准的以太网和标准的Infiniband以及自定义的网 络协议，有些高速智能网卡甚至支持NVMe-oF存储方面的协议〔⑹。
以微软公司为例，其高速智能网卡在初期已经将TCP/IP协议族中的部分协议进 行卸载，如 TCP 减负引擎(TCP Offload Engine )、UDP 减负引擎(UDP Offload Engine) "I,处理此类协议时，高速智能网卡通常以流水线方式进行处理。为了应对密集型 的网络流量，在之后引入了 RSS〔27]以及Flow Director卸载引擎，以支持用户自定义 网络协议的卸载。近年来，在虚拟化的云计算场景中，NVGRE以及VxLAN〔28]等协 议也在网卡中进行卸载，此类协议对网卡的并行能力和隔离性有着一定的要求。
(2) 网络功能处理
网络功能的作用是传统网元在组网时对数据包所进行的检测和修改，比如防火 墙(Firewall服务质量(QoS)、负载均衡(LoadBalance)等，此类网络功能通常 采用流水处理的实现方法。高速智能网卡主要对软件自定义网路(Software Defined network, SDN)、网络功能虚拟化(Network Function Virtualization, NFV)等新型网 络功能进行处理，此类网络功能需要较高的计算复杂度。
比如Xilinx公司最新发布的Alveo™ SmartNIC系列，代表产品Alveo™ SN1000[29] 面向各类功能卸载提供了软件定义硬件加速功能，既可以直接卸载CPU密集型任务 以优化联网性能，又可以卸载SR-IOV和OVS以加速网络数据处理。在2.1.1小节 提到的ConnectX-6产品同样支持此类网络功能，其充分利用了软件定义和硬件加速 等先进技术，支持先进的虚拟化和容器化功能处理、加速交换和数据包处理(ASAP2) 等，保障了高性能的可扩展网络处理功能。
(3) 金融算法交易
目前在一些金融证券交易场所，业内均采用软件进行行情解码，提供行情服务， 但基于软件的行情解码无法满足服务时延需求，基于硬件的高速智能网卡越来越多 的应用于此场景。
比如Xilixn公司发布的Alveo™ U50I30],其可提供超高吞吐量、小数据包性能与 超低时延，旨在解决金融算法交易等场景中服务时延大的问题。主要通过低时延关 键值存储技术(Low latency Key-Value Store, KVS)实现，其时延可控制在400ns以 下，搜索速率可达150M次搜索/秒，充分降低时延和用电成本。
综上所述，如表2-2所示，目前高速智能网卡在不同的应用场景中的侧重点不 同，主要对计算复杂度、并行能力、隔离性以及流水处理能力这几点具有一定的需 求，本文在基于FPGA架构对网卡进行设计实现，可保证上述需求基本得到满足。
表2-2不同应用场景网卡的特点对比
应用场景
网络协议处理
网络功能处理
金融算法交易
计算复杂度
较低
较高
较高
并行能力
较高
较低
较高
隔离性
高
较高
较低
流水处理能力
较高
较高
低
典型产品
Microsoft
catapult
Alveo™SN10005
ConnectX-6
Alveo™ U50
经过上述对不同架构和不同应用场景的网卡产品进行分析分比较，可以看出,
目前智能网卡提供的功能大致可以归纳如表2-3。
表2-3典型产品基于功能划分
典型产品
Microsoft catapult,Mellanox ComiectXJntel FPGA PAC N3000
网络侧带宽
双端口 10/25/50/1 OOGbps
硬件加速功能
RoCE、NVME-oF存储加速卸载；TCP/UDP、OVS网络协 议功能卸载
主机侧接口
PCIE Gen2/3/4 x 8, PCIE Gen2/3/4 x 16
1. 在网络接口部分，提供支持lOGbps甚至更高速率的以太网协议；
2. 在网卡内部，提供可编程的硬件加速卸载功能，比如网络协议卸载(TCP、UDP 等)，网络功能卸载(OVS, RSS等)；
10
3. 在主机侧接口部分，采用高速PCIE总线接口，普遍支持PCIE2.0 X 8通道(4GB/s) 以上速率。
本文目的在于提供智能网卡的整体设计思路，同时满足目前智能网卡的基本功 能需求，因此本文将从以上三方面进行设计开发。
