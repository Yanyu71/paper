2.4.2各模块功能分析
(1)物理接口
物理接口主要包括物理介质相关子层(Physical Medium Dependent Sublayer,
19 PMD)和物理介质连接子层(Physical Medium Attachment Sublayer, PMA)。其中 PMD 层对各种实际的物理媒体完成真正的物理连接，根据不同的物理接口进行不同的信 号转换，比如光电转换等。PMA层主要负责完成串并转换，将以太网线路的串行速 率转换成并行数据。之所以将这两部分放在一起进行讨论主要由于PMD和PMA位 于物理底层，与物理媒体介质关系紧密，已经固化到硬件，不是本文的设计重点。
(2) PCS模块
PCS模块是物理编码子层，同样位于物理层，为物理层的上层部分，与PMA和 10G 介质独立接口 (10 Gigabit Media Independent Interface, XGMII)接口相连，主 要完成64b/66b编解码工作，PCS模块全部功能主要围绕64b/66b编码进行设计囚〕。 在接收过程中，由于PMA和XGMII接口位宽不同，XGMII数据接口为64bit位宽， PMA接口可根据选16bit、32bit、64bit,因此PCS模块将接收到的数据首先进行位 宽转换；然后在lOGbps数据率下完成同步操作，找出数据的起始位置；最后进行解 扰以及解码操作,恢复原始数据，在通过XGMII接口以lOGbps的数据率发送到MAC 层。发送过程为接收过程的逆操作，但不需要进行同步对齐。此部分内容为本文的设 计研究重点。
(3) MAC地址卸载加速模块
此部分内容主要完成基于MAC地址匹配和转发功能。首先将从PCS模块发送 过来的数据包头进行解析，然后提取48bits的MAC地址(目的地址或源地址)进行 匹配查找，最后按照匹配规则对匹配上的数据包执行动作，丢弃或者转发到不同接 收队列。发送过程不进行匹配查找，直接在MAC中进行处理。由于MAC层中主要 对数据进行拆包以及校验计算等操作，接近协议栈的工作内容，在MAC层中进行协 议栈功能的卸载符合设计要求。此部分内容是本文的设计研究重点。
(4) FIFO 缓冲
FIFO缓冲主要用来解决前后模块之间数据接口类型不同、数据位宽不同以及时 钟不同的问题。对于lOGbps的数据率来说，需要10.3125Gbps的线路速率，PMA层 中采用64bit的位宽，线路侧的时钟频率设计为10.3125G妙s十64阳心161.13MHz。为 了减少跨时钟操作，MAC层同样采用此时钟频率。但对于PCIE2.0X8通道来说， 其传输速率为4GB/S,采用128bit的位宽，PCIE端的时钟频率设计为 4GB/SX8一 128加7 = 250辭。由于两端的时钟、位宽不同，需要FIFO缓冲对数据 进行缓冲。考虑到以太网帧最大为1500Bytes,本文将FIFO容量设计为10倍的最大 以太网帧长度，即128bits宽，深度为940,工作时钟频率为200MHzo
(5) PCIE DMA 模块
数据经过FIFO缓冲后将通过PCIE接口转发到主机内存中。本文采用DMA方 式进行数据搬移，DMA与PCIE接口紧密相连，需要依靠PCIE接口进行传输。本
20
文使用PCIE2.0X8通道模式，其理论传输速度为4GB/S,满足万兆以太网的线路速 率。在接收过程中，数据以DMA写的方式通过PCIE发送引擎从网卡写入到内存中； 在发送过程中，数据以DMA读的方式通过PCIE接收引擎从内存读到网卡中进行发 送。此部分内容为本文的设计研究重点。
