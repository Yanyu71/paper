3.4.1系统任务集合
为了使本章节的阐述更加清晰，根据现有的广域物联网环境并结合热力领域 26
的实际需求，设计这样一个窄带物联网硬件系统，该系统可以实现对于热力管网 环境的监测控制，提供的功能包括但不限于采集热力管网环境的温度数据、压力 数据、流量相关数据以及井盖异常震动数据,硬件部分与对应的服务器双向通信, 硬件部分通过NB-IoT通信模组实现系统的数据上报以及命令下达。
1	.任务1：热力管网温度数据采集，该任务由具有低功耗模式的温度变送 器完成，任务计划每2小时采样一次热力管网温度信息，通过MCU计 算得到实际物理环境数据与本地数据进行比对，若温差大于等于0.5C, 则启动任务5进行数据上报，若温差小于0.5C,则不启动通信任务，同 时更新本地数据。
2	.任务2：热力管网压力数据采集，该任务由具有低功耗模式的压力变送 器完成，该任务原理类似于任务1,数据上报的压力差阈值为（MMpa。
3	.任务3：震动异常数据采集，该任务由LIS3DH传感器完成，任务的数 据采集以及数据传递均通过SPI的通信方式完成。值得注意的是，该任 务并非周期采样，而是不定时发生中断，当LIS3DH传感器判断有异常 震动发生时会输出高电平中断信号，系统微控制单元在接收到中断信号 之后会启动任务5。
4	.任务4：流量数据采集，该任务采集的数据包括：瞬时流量数据、累计 热计量值、入口温度、出口温度等多种类别数据，多功能流量表以发送 数据包的形式通过RS485接口与系统微控制单元进行通信。每隔2小时， 由系统为控制单元唤醒流量表，流量表在被唤醒后将数据包发送到系统 微控制单元，待取出关键数据后启动任务5进行通信。
5	.任务5： LPWAN通信，该任务由系统的通信模块，即NB-IoT模组完成， 任务1至4在采集到数据后并且MCU确认数据需要发送时，都需要经 过通信模块完成相应的发送任务。
6	.任务6：系统后台，该任务由MCU完成，在系统上电后，该任务保证系 统的各模块完成相应的初始化工作，并且根据各模块的工作状态对应地 调节各模块的工作模式。此外，该任务还利用任务间通信接收来自其他 任务的报警信息。因此，后台程序是整个任务调度方案能否顺利实现的 关键。
为了在广域物联网环境实现基于状态的低功耗解决方案，结合工程的实际情 况,在硬件系统中，通过模块化设计实现了该工程中需要的所有进程,具体包括： 异常震动采集进程，热力管网ADC温度数据采集进程，热力管网ADC压力数 据采集进程，流量数据采集进程，NB-IoT模组进程以及后台调控进程，各个进 程的周期如表3-1所示。
27
表37任务集合表
进程	周期单位/min	进程性质
热力管网温度采集进程Pl	120	非守护进程
热力管网压力采集进程P2	120	非守护进程
异常震动检测进程P3	不确定	非守护进程
流量数据采集进程P4	120	非守护进程
通信进程P5	不确定	非守护进程
后台进程P6	不确定	守护进程
