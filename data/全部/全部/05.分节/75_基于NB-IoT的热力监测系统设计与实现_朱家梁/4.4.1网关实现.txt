4.4.1网关实现
NB-IoT设备应用层部分使用CoAP协议传送至指定目标IP,而在本文的系 统架构中，指定目标IP以及对应的端口号地址指向的是中国电信CDP Server, 该平台在整个系统中充当网关的角色，对NB-IoT设备产生的数据进行收集、暂 存以及转发等操作。
具体地讲，中国电信CDP Server负责收集在该平台上面已经在注册的 NB-IoT设备上报的数据包，并会将数据包存储到CDP平台对应的数据库当中， 该数据库具有时效性，每当NB-IoT设备上报的数据包对应的时间戳超过七天, 平台对该数据将不再显示，数据将被删除。
45
除了对于NB-IoT设备上报的数据包进行接收和暂存外，该平台还会为开发 者提供两种获取该平台上暂存的数据的方式，包括主动获取以及订阅通知的方式。 主动获取方式为开发者使用自身所开发的服务，结合自身需求与服务端的负载能 力,主动去电信平台获取对应的NB-IoT设备设备数据，而采用订阅通知模式则 是开发者使用所开发的服务被动式的等待平台的数据推送。而无论开发者采用任 何一种具体方式去获取平台的数据，得到的消息协议格式均为HTTP协议，这说 明在该平台内部存在着CoAP协议与HTTP协议之间的协议转换。在本文所描述 的架构中，由于在服务端应用中存在对应的报警事件定义，例如，异常震动数据 的上报，系统服务端应用与中国电信CDP Server的接入方式为订阅通知，即有 平台侧向应用侧进行数据推送，数据推送的格式为json,当推送的数据当中存在 触发服务端事件定义时，服务端应用将采取对应的措施。
