符号说明
(k,l)频率索引为k,符号索引为1对应的资源单元
akJ	资源单元0U)上对应的数值
NCP	循环前缀的长度
N?	在一个资源块中PUCCH格式1/la/lb混合了格式1/la/lb和格式2/2a/2b的
循环移位的个数
Nr	接收端接收天线的个数
N密 PUCCH格式2/2a/2b可用的带宽，以N?为单位
N3	物理层小区标识
鶴讥最小上行带宽配置，以为单位
N搭，從最大上行带宽配置，以N辭为单位
一个上行时隙中SC-FDMA符号的个数
频域上资源块的大小，以子载波的个数为单位
4cch PUCCH格式1/la/lb的资源索引
n^ccH PUCCH格式2/2a/2b的资源索引
"prb 物理资源块综述
ns	一个无线帧中的时隙索引
4	一个无线帧的长度
Ts	基本的时间单元
7；10t 一个时隙的长度
/3	格式1/la/lb检测算法中的调整系数
第一章绪论
1.1TD-LTE系统
1.1.1TD-LTE背景简介
20世纪80年代，第一代移动通信系统实现了大规模的商用，第二代移动通信系统 全球移动通信系统（GSM）的发展，让全球范围内的通信成为了现实。技术的进步使得 移动终端更为小巧、时尚，电池的使用寿命更长，促使了 GSM被广泛接受，直到现在 这个系统也没有被淘汰。随着互联网的发展以及人们对移动数据服务的要求，GSM系 统所能提供的数据业务的速率己经远远不能满足人满的需求，因此出现了第三代移动通 信（3G）,包括中国电信的得到的CDMA2000,中国联通得到的WCDMA以及中国移 动得到的TD-SCDMA。在2012年，中国己经基本普及了第三代移动通信。在2013年 12月4日，国家向国内的主要运营商发放了 4G牌照，这表明中国LTE的时代即将到来。 在2014年，中国移动大力推广TD-LTE系统，并且该系统在国内部分城市已经实现了 覆盖。
LTE（Long Term Evolution,长期演进）项目是第三代移动通信技术的演进，一般称之 为3.9G技术。LTE是由3GPP组织制定，是基于正交频分多址技术（OFDMA）的全球 通用的标准，分时双工模式（TDD）和分频双工模式（FDD）是其包含的两种模式。TD-LTE 就是LTE的TDD模式。在2005年6月，LTE系统需求得到了完善和细化，具体需求为 包括减少连接建立和传输的延时、提高用户数据传输速率、提高小区边界的比特率以保 证业务的一致性、提高频谱效率、频谱利用灵活、简化网络结构、实现无缝的移动性、 终端的功耗合理等。
LTE通信系统与第三代通信系统相比，具有无可比拟的优势：
1）	LTE 系统灵活支持 1.4MHz、3MHz、5MHz、10MHz 和 20MHz 的带宽；
2）	下行使用OFDMA技术，速率可达100Mbps；
3）	上行使用单载波频分多址技术（SC-FDMA）,在确保系统性能的同时有效的减 少了峰均比，从而降低了终端的发送功率，且速率可达50Mbps；
4）	其频谱效率为3G Release 6的3到5倍；
5）	每个小区可以支持多个用户，仅5M带宽下就能够支持多达200个用户；
6）	进行时间/空间/频率三维的快速无线资源调度，保证了系统吞吐量和服务质量⑴
1.1.2 TD-LTE系统网络结构
LTE不同于以往蜂窝系统所釆用的电路交换模式，仅支持分组交换业务，目的是在 用户终端UE和分组数据网络间建立起无缝的移动IP连接。LTE既包含通过演进陆地接 入网（E-UTRAN）的无线接入技术演进，也包含系统架构的演进（SAE）, SAE含有演 进后的分组交换核心网（EPC）〔2】。
LTE和系统架构演进共同构成了演进分组系统（EPS）, EPS由核心网、演进基站 （eNodeB）和用户设备（UE）三部分构成，如图1-1所示。从公共分组数据网网关到 用户终端的IP路就由演进分组系统提供。其中核心网负责对用户终端的全面控制盒有 关承载的建立，接入网E-UTRAN负责所有与无线承载相关的功能。
LTE的接入网E-UTRAN仅由eNodeB构成，对于普通的用户流（非广播），在 E-UTRAN中没有中心控制节点，因此可以说E-UTRAN采用的是一种扁平架构。
eNodeB通过接口 X2互相连接，通过接口 S1与EPC连接，更确切的说，通过接口 S1-MME连接到移动管理性实体（MME）,通过接口 S1-U连接到业务网关（S-GW）。 eNodeB与UE间的协议为接入层（AS）协议。
E-UTRAN负责的无线承载相关的功能包括无线资源管理、IP报文头压缩、安全性、 定位和与EPC的连接，这些功能都位于eNodeB中。

图1-1 EPS总体架构
1.2研究现状
国内外的学者在TD-LTE检测接收算法上进行了非常深入的研究，不同的处理方法 的对系统的接收性能影响不同，算法的复杂度不同，在工程实现上的难度也不同。信道 估计的常见算法可以分为大致三类：第一类是利用参考信号辅助，来进行信道估计；第 二类是全盲估计;第三类是半盲估计。在工程上，往往利用第一类算法来进行信道估计， 因为全盲和半盲估计有计算复杂度高和误差传播的缺点。.半盲检测的估计算法，比较适 用于低速、低码率或小负载、低参考信号占用率的情况下，然而其计算复杂度随着上行 控制信息（UCD比特数的增加呈指数型的增长。对于第一类算法在信道环境较好时， 信道估计性能较好；在信道环境恶劣时，信道估计的性能受到很大的影响。MIMO系统 常用的检测算法有ZF检测、MMSE检测、0L检测、SIC检测以及集中算法综合起来的 检测算法。从性能上来看，MMSE-SCI检测算法的性能较好，ZF检测算法的性能相对 最低。
1.3研究内容
本文重点研究TD-LTE系统物理上行控制信道的检测与接收算法，然后在Freescale MSC8157多核DSP平台上对PUCCH这一信道进行了 DSP设计与实现。
本文首先对TD-LTE系统的帧结构、物理资源以及关键技术等系统的知识做了详细 介绍，然后对物理上行控制信道（PUCCH）的作用及其承载的信息进行了描述，并且 总结了 PUCCH发送端处理控制信息的流程。之后，我们研究了不同PUCCH的检测算 法与接收算法。接收算法包括基于快速哈达玛变换的Reed-Muller译码接收算法和基于 半盲检测的接收算法。其中半盲检测的接收算法在PUCCH格式2的条件下，性能要好 于第一种算法，但是该算法的计算量远远高于第一种算法。因此，我们对其中的半盲接 收算法进行了计算量上的优化，优化结果使得半盲接收算法的计算量大幅度下降。在论 文的最后，在Freescale MSC8157多核DSP平台上对PUCCH这一模块进行了 DSP设计 与实现，并且使用不同的测试用例，在正确性和及时性方面进行验证。
本论文仅讨论常规CP,不讨论扩展CP,本文也不讨论探测参考信号SRS与PUCCH 共存的情况。
1.4论文结构
为了比较清晰的论述本文的研究内容，本论文的结构安排如下：
第一章 	_绪论，主要介绍了 TD-LTE系统的背景，并且对研究现状进行了总结， 说明了论文的研究内容，对论文的结构做了描述；
第二章——TD-LTE系统物理层以及上行控制信道，介绍了 TD-LTE系统物理层帧
结构、物理资源及关键技术，并针对其中的物理上行控制信道进行了详细的介绍，总结 了 PUCCH的发送过程；
第三章——TD-LTE系统PUCCH检测接收算法的研究，这一章节大致根据PUCCH 的格式分为两部分，格式1/la/lb的PUCCH检测接收算法与格式2/2a/2b的接收算法， 在第二部分，又针对半盲接收算法进行了优化，使其更加易于工程实现；
第四章——TD-LTE系统PUCCH检测接收的实现，这一章在Freescale MSC8157多 核DSP平台上对PUCCH进行了设计，给出了不同的测试用例进行测试，对运行结果进 行了验证，统计T PUCCH链路耗费的时间；
第五章一一总结与展望，对本论文的研究内容和完成的工作进行总结，并提出文章 的理论研究和实现能够更加完善的地方。.
第二章TD-LTE系统物理层以及上行控制信道
2.1 TD-LTE物理层
2.1.1帧结构
LTE的TDD模式采用帧结构2,如图2-1所示。无线帧由两个长为153600式=5ms 的半帧组成，每个无线帧长4=307200・7；=10ms。每个半帧由五个子帧组成，每个子 帧的长度为1ms。TDD模式支持多种上下行配置，具体可支持的配置见表2-2。表2-2 中，符号D表示用于下行传输的子帧，符号U表示上行传输的子帧，符号S表示三种 特殊子帧（DwPTS、GP 和 UpPTS）, DwPTS 和 UpPTS 的长度见表 2-1, DwPTS、GP 和UpPTS三个特殊子帧的总长度固定为30720乂 =1 ms。每个子帧z•对应于2个时隙2Z
和2/ + 1,每个时隙长为孩=0.5 ms。
LTE TDD模式支持5ms和10ms的上下行切换周期，特殊子帧的位置与上下行的切 换周期有关。如果下行到上行切换周期为5ms,特殊子帧既存在于第一个半帧中，也存 在于第二个半帧中；在下行到上行切换周期为10ms的情况下，特殊子帧只存在于第一 个半帧中，在第二个半帧中没有特殊子帧。
子帧0、子帧5以及下行特殊子帧DwPTS规定用于下行传输，不可用作上行传输； 上行特殊子帧UpPTS和紧跟着该特殊子帧的后-了帧专用于上行传输，其余没有提到 的子帧根据配置来决定用于上行还是下行。
由于TD-LTE不需要成对的频谱资源，因此能够使用在零散的频段上进行配置，频 谱配置相对于FDD来说相当灵活，频谱利用率也较高。从表2-2还可以看出，无线帧 的上下配比可以进行灵活的配置，以便支持非对称的业务。
无线帧，7>=3O72OO7；= 10 ms
v--	►
半帧.1536（X17； = 5 ms
V	A


表2-2 UL/DL配置囲
上行-下行 配置	下行-上行 转换点周期	子帧号
0	1	2	3	4	5	6	7	8	9
0	5 ms	D	S	u	u	U	D	S	U	U	U
1	5 ms	D	S	u	u	D	D	s	u	U	D
2	5 ms	D	s	u	D	D	1)	s	u	D	D
3	10 ms	D	s	u	U	U	D	D	D	D	D
4	10 ms	D	s	u	U	D	D	D	D	D	D
5	10 ms	D	s	u	D	D	D	D	D	D	D
6	5 ms	D	s	u	U	U	D	S	U	U	D


2.1.2物理资源
一个资源格用来表示一个时隙中的传输信号，资源格如图2-2所示。MX 个子 载波和乂京b个SC-FDMA符号组成构成了每个资源格。N器的值与小区中配置的上行传 输带宽有关，其值满足式2-1。
Armin,UL < at-UL < x7max,^L
；VRB — 7VRB — 7VRB
其中，蟬冒削=6是R9协议规范中支持的最小上行链路带宽，蚱*l=[]0是R9 协议规范中支持的最大上行链路带宽。
一个时隙中SC-FDMA符号数取决于高层配置的循环前缀（CP）长度，在常规循环 前缀的情况下，一个时隙中SC-FDMA的符号数为7o
One uplink slot *心

资源格中的每个单元称为资源单元（Resource element, RE）,并在时隙中每个资源 单元都有唯一的序号对（歸）定义，其中*和/分别是频域和时域索引。资源单元（齢）中 存储一个复数值印,,，其中k = 0,...,-1. 1 = 0,...,-1 o如果一个时隙中物理 信道或物理信号中，这个资源单元不用于发送，那么该资源单元的叫丿值应置为0。
时域中连续的A；；、个SC-FDMA符号和频域中连续的叫？ =12个子载波定义为一 个物理资源块（Resource block, RB）。1个时隙和频域的180kHz,对应上行链路中的一 个物理资源块，这个物理资源块由N錦x 个资源单元组成。
2.1.3上行物理信道结构
LTE单载波频分多址上行链路为数据和控制信令的传输提供了分离的物理信道，上 行链路的物理层传输包括三种物理信道和两种信号。三种物理信道根据他们各自的作用， 分为物理随机接入信道（PRACH）,物理上行共享信道（PUSCH）和物理上行控制信道
(PUCCH)；两种信号指解调参考信号(DMRS)和探测参考信号(SRS)地 图2-3 总结了上行物理信道与高层信道之间的关系。
CCCH	DCCH	DTCH

图2-3上行物理信道与高层信道的关系

只有当一个用户设备(UE)的上行传输时间同步后，这个用户设备才能被调度进 行上行传输。LTE随机接入信道(RACH)用于非同步UE的接入，在非同步UE与LTE 上行的无线接入的正交传输方案的接口之间扮演了关键角色。随机接入过程中随机接入 前导序列部分和在PRACH上的物理层对应。PUSCH用于传输传输信道UL-SCH上的 数据，PUCCH用与传输上行的控制信令。PUCCH是本文的主要研究内容，其详细的说 明在后续的小节中详细给出。
与上行PUSCH数据或者PUCCH控制信令相关联的的解调参考信号主要用于相干 解调的信道估计，会在发送的每个上行时隙中出现，并且在每个时隙中，参考信号可以 理论集中在一个位置，也可以被分割到多个位置。上行探测参考信号与上行数据和控制 传输并无关联，主要用于信道质量估计，使上行链路中的频率选择性调度成为可能。
2.1.4 TD-LTE系统物理层关键技术
LTE系统在物理层采用OFDM技术和MIMO技术两种先进技术，使得系统的吞吐 量得到了大幅度的增长。
2.1.4.1OFDM 技术
OFDM技术是利用一组正交的低速率子载波，合成提供高速数据传输的一种调制方 式。基于OFDM的LTE系统，上行采用单载波频分多址技术SC-FDMA，该技术具有 较低的峰均比，来解决终端的成本和电池的寿命问题；下行釆用正交频分多址技术 OFDMA,根据用户所处的不同环境，灵活地为不同用户分配最佳的子载波资源，实现 多用户分级增益。
从图2-4可以看出，与传统的FDM相比，频率选择性带宽信道被划分为重叠但正
8 交的非频率选择性窄带信道，从而不需要使用保护带宽来使载波分离，使得OFDM技 术具有更高的频谱利用率。OFDM技术还可以有效的减少无线信道的多径干扰，并且 IFFT和FFT的处理非常容易实现。另外，利用OFDM技术，上下行调度时可以使用不 同数量的子信道，提供多变的传输速率和灵活的资源分配，有效的对抗频率选择性衰落。 在OFDM系统中，接收机中的子信道能够完全分离，因此接收机的实现复杂度得到了 减少，因此OFDM系统对高速移动数据传输非常具有吸引力，LTE下行链路就是其中 的一例。LTE的下行链路将OFDM、信道编码以及HARQ组合起来，克服发生在子信 道上的深度衰落回。
SC-FDMA与OFDMA类似，将传输带宽分为多个并行的子载波，利用循环前缀CP 或保护间隔在频率选择性信道中保持正交性。CP的存在还达到了消除了 SC-FDMA信 息块的符号间干扰的目的。然而SC-FDMA与OFDMA也有不同之处，对于每一个 SC-FDMA符号周期内的所有SC-FDMA子载波，每个子载波携带一个数据符号的分量， 因此SC-FDMA系统和单载波系统有类似之处，具有单载波系统的特性，其峰均比远低 于多载波系统的峰均比。

（a）传统FDM频谱	（b） OFDM频谱
图2-4传统FDM频谱与OFDM频谱

但是OFDM技术容易受到频率偏差的影响，且下行发送信号的峰均比较大。
2.1.4.2MIMO 技术
MIMO技术采用多天线发射接收，充分利用空间维度，是一种空分复用技术。若采 用复用技术，发射的高速数据被分成几个并行的低速数据流，在同一频带通过多个天线 发射出去，空口速率将成倍提高；若用分集技术，使用多根天线进行发送和（或）接收， 则可以产生解调增益⑺。复用和分集产生的增益对用吞吐率和可靠性的提升是一对矛盾， 牺牲其中的一种增益可以得到另一种增益。
MIMO技术可以同时在eNodeB和UE上使用，可以提升用户吞吐率、小区的容量 和覆盖，并且很容易和OFDM技术融合起来，即自适应多天线技术冏。自适应多天线技 术根据信道特性调整传输参数，在链路稳定性和系统容量之间取得最佳折衷，且支持多 种模式的多入多出技术。在LTE的Realease 8和9中，不支持从一个UE的多天线上同 时进行发送，支持来自具有多天线UE的上行链路中的闭环天线选择发送分集。LTE系 统的基本配置是下行2发送天线和2接收天线，上行1发送天线和2接收天线，最大可 以支持4发送天线和4接收天线。
2.2上行控制信道PUCCH
2.2.1 PUCCH 简介
在TD-LTE系统中，PUCCH负责传输上行控制信息（UCI）,主要包括上行调度请 求SR、混合自动重传请求的HARQ应答（ACK/NACK）、用于下行编码方案和调制方 式选择的信道质量指示器（CQI）、用于下行MIMO传输的秩指示器（RI）和预编码指 示器（PMI）図。
上行调度请求（SR）,是用户向基站申请上行无线资源配置的请求信令。如果UE 没有上行数据要传输，则eNodeB不需要为该UE分配物理资源，UE需要告诉eNodeB 自己是否有上行数据需要传输，以便eNodeB决定是否给UE分配上行资源，给UE分 配多少上行资源取决于eNodeB的实现，较为常见的做法是分配不少于UE发送BSR的 资源oeNodeB不知道UE发送上行数据的准确时刻，即不知道UE发送SR的准确时刻。 因此，eNodeB需要检测是否有SR上报。
LTE系统在下行传输中使用HARQ的传输方式，通过PUCCH将HARQ的反馈 ACK7NACK反馈给eNodeB。如果UE正确接收并解调发送的数据，则反馈ACK, eNodeB 将发送新的数据块；反之如果UE没有正确接收并解调发送的数据，eNodeB将发送旧 数据块的信息比特和更多的冗余比特，来提高解码的成功率。
LTE系统支持两种形式的CQL PMI和RI上报，通过PUCCH进行周期性的上报， 通过PUSCH进行非周期性的上报。CQI反应了 UE与eNodeB之间的信道质量，eNodeB 参考CQI来决定下行数据的编码方案和调制方式。根据传输模式的不同，PUCCH还会 传输RI和PMI-
PUCCH中的控制信令在系统带宽边缘的频率区域进行发送，-个子帧中PUCCH 的一次传输占用每时隙边缘或靠近边缘的1个RB,如图2-5所示：


将控制信道定位在系统带宽的边缘，可以通过频率跳变实现最大化的频率分集，可
10
以最大化可用的PUSCH数据速率。
2.2.2PUCCH发送格式
UE在一个子帧中传输的控制信息量取决于可用的SC-FDMA符号数量，根据不同 的PUCCH发送格式，PUCCH的一次传输可能发送包含调度请求SR、PDSCH中下行 数据包的HARQACK/NACK、信道质量指示CQI、与MIMO反馈相关的RI和PMI的 一种或多种控制信息。截至Release 10, PUCCH共支持8钟不同的格式第7钟与第8 种本文暂不讨论，前六种格式所承载的控制信息如表2-3所示
表2-3 PUCCH格式及其控制信息闵
PUCCH格式	上行控制信息（UCI）
格式1	调度请求SR
格式la	1 比特 HARQACK/NACK,有/无 SR
格式lb	2 比特 HARQ ACK/NACK,有/无 SR
格式2	20比特信道状态信息CSI （可包含CQI、RI、PMI）
格式2a	CSI 和 1 比特 HARQ ACK/NACK
格式2b	CSI 和 2 比特 HARQ ACK/NACK

2.2.3 PUCCH的参考信号及码分复用序列
在TD-LTE系统中使用Zadoff-Chu （ZC）序列来作为上下行的解调参考信号、随机 接入信号、主同步信号和PUCCH的码分复用序列。ZC序列是非二进制单位振幅序列， 具有恒包络零自相关性的特性：
1）	包络恒定，每个元素的幅值保持一定；
2）	理想的周期自相关和良好的互相关；
3）	傅里叶变换的性质，在时频域转换的过程中仍然保留序列原有的性质。
PUCCH中所使用的解调参考信号序列和码分复用序列岩定义为基序列九"） 的循环移位，按照下式进行，即有：	'
0<n<12	式 2-2
一个基序列和这个基序列的不同循环移位值a构成了多个参考信号序列。基序列 如,（〃）被分为多组，其中MS{0,1,...29}表示组号，V表示组内基序列号。序列组号“和组内 序号v会随着时间而变化，其变化规律详见［3］的5.5.1.3和5.5.1.4节，在这里不再赘述。
基序列九,、,（"）定义为：
ru,v（n） = eM, 0<w<12	式 2-3
其中（p（n）的定义如表所示2-4
11
表2-4『(")的定义
u		■
0	-1	1	3	-3	3	3	1	1	3	1	-3	3
1	1	1	3	3	3	-1	1	-3	-3	1	-3	3
2	1	1	-3	-3	-3	-1	-3	-3	　1	-3	1	-1
3	-1	1	1	1	1	-1	-3	・3	　1	-3	3	-1
4	-1	3	1	-1	1	-1	-3	-1	　1	-1	1	3
5	1	-3	3	-1	-1	1	1	-1	-1	3	-3	1
6	-1	3	-3	-3	-3	3	1	-1	3	3	-3	1
7	・3	-1	-1	-1	1	-3	3	-1	　1	-3	3	1
8	1	-3	3	1	-1	-1	-1	1	　1	3	-1	1
9	1	-3	-1	3	3	-1	-3	1	　1	1	1	1
10	-1	3	-1	1	　1	-3	-3	-1	-3	-3	3	-1
11	3	1	-1	-1	3	3	-3	1	3	1	3	3
12	1	-3	　1	1	-3	1	　1	1	-3	-3	-3	1
13	3	3	-3	3	-3	1	　1	3	-1	-3	3	3
14	-3	1	-1	-3	-1	3	　1	3	3	3	-1	1
15	3	-1	　1	-3	-1	-1	　1	1	3	1	-1	-3
16	1	3	　1	-1	1	3	3	3	-1	-1	3	-1
17	-3	1	　1	3	-3	3	・3	-3	3	1	3	-1
18	-3	3	　1	1	-3	1	-3	-3	-1	-1	1	-3
19	-1	3	　1	3	1	-1	-1	3	-3	-1	-3	-1
20	-1	-3	　1	1	1	1	3	1	-1	1	-3	-1
21	-1	3	-1	1	-3	-3	-3	-3	-3	1	-1	-3
22	1	1	-3	-3	-3	-3	-1	3	-3	1	-3	3
23	1	1	-1	-3	-1	-3	　1	-1	　1	3	-1	1
24	1	1	　3	1	　3	3	-1	1	-1	-3	-3	1
25	1	-3	　3	3	I	3	3	1	-3	-1	-1	3
26	1	3	-3	-3	　3	-3	　1	-1	-1	3	-1	-3
27	-3	-1	・3	-1	-3	3	　1	-1	　1	3	-3	-3
28	-1	3	-3	3	-1	3	3	-3	3	3	-1	-1
29	3	-3	-3		-1	-3	-1	3	-3	3	1	-1

循环移位Q在下面的小节中给岀，根据PUCCH不同的发送格式有所区别。
2.2.4 PUCCH发送端处理流程
所有的PUCCH格式在每一个符号中都要用到一个循环移位序列，其中用 于计算不同格式的循环移位值。的值通过符号数/和时隙号％计算得出，计算 公式见式2-4：
《?3，/)=旗：挪8冷"久+8/ + )2	式2-4
其中伪随机序列c(i)根据式2-5,由长度为31的黄金序列产生。
长度为Mpn的输出序列c(〃)(〃 = 0,1,..."pn-1)定义为
12
c(w) = (x1(H+7Vc) + x2(w + 7Vc))mod2
X! (w + 31) =(X] (« + 3) + xt («)) mod 2	式 2-5
x2(n + 31) = (x2(n + 3) + x2(n + 2) + x2(n + 1) + x2(n))mod2
其中 Nc =1600 > 第一个 m 序列初始化为X] (0) = 1,X](") = 0,〃 = 1,2,...,30。第二个 m 序列以式Cm =/辭》2。・2' =N普在每个无线帧的开始进行初始化。
2.2.4.1 格式 1/la/lb
PUCCH格式1/la/lb,每个时隙的第1、2、6、7个SC-FDMA符号用于发送调制符 号，第3、4、5个SC-FDMA符号用于发送解调参考信号。
对于PUCCH格式1,传输的调度请求SR使用开关键控，假定d(0) = l。
对于PUCCH格式la/lb,分别传输1个和2个ACK7NACK比特3(0)或8(0)顷1),生 成调制符号d(0),其星座映射可以用图2-6表示。




DTX/NACK=O
-o	>
+1
(NACK, ACK)=01
o
▼
OPSK
PUCCH 格式 lb/2b
图2-6 PUCCH的ACK/NACK星座点映射
复值符号d(0)将乘以长度为12的循环移位序列序列#?(〃)，即：
贝〃)= d(0) •漿(〃)，	〃 =0,1,...,11	式 2-6
复值符号块贝0),...j(ll)按照式2-7的方式，使用S(z)和正交序列叫,“⑺进行加扰 和块扩频：
z(12w'W™cch +12叫 + 〃) = S(nJ-(叫)• y(n)	式 2-7
PUCCH解调参考信号〃ucch(.)为
尸PUCCH (12冰僧CCH +12叫 +〃)=讦(叫)噌)S)	式 2-8
13

mx	=0,..	　A7-PUCCH
•5 NSF	-1
m2	= 0,.	　xrPUCCH
.・，/Vrs	-1
n =	1
冰=0,1

if ”'("s)mod 2 = 0
otherwise
冰=0表示一个子帧中的前一时隙，秫'=1表示一个子帧中的后一时隙。
对常规PUCCH格式1/la/lb,第一个时隙与第二个时隙的TV腊cch值都为4；对于短 PUCCH格式1/la/lb,第一个时隙N記cch的值为4,而第二个时隙德^源的值为3。叫。<） 如表2-5所示，讦（秫）如表所示，〃'（〃s）在后面定义。
表2-5.1正交序列［w（0）… w（N岩。ch_］）］（戒肾命=3）
序列指示 偽c（"s）	rw（o）…w（^cch-i）i
.正交序列l	sf	j
0	[+1 +1 +1 +1]
1	[+1-1 +1 -1]
2	[+1 -1 +1 -1]


表 2-5.2 正交序列[w(0)…w(N辭ch_])] (aa™cch=4)
序列指75
〃oc（〃s）	　　　　「w(0) , ♦ ,
正交序列L ' 7	　h«CCH	T)]
0	IJ 1	1]
1	1	伽阴
2	1	/2〃3
用于PUCCH格式1, la和lb传输的资源由资源索引那次CH确定，正交序列索引 "°c（〃s）和循环移位以仏,/）根据下面的式子由福CCH确定，其中C = 3 ：
”*）+饥）•△常仆'」
必久,/）=	•%（%，，）/繹
肅久，（仏）•△盘E+（〃°M）mod£*））modv］ mod<13
JM? if*cH<c・M”△新 h
otherwise
式 2-10
一个子帧的每个时隙中，由哪一个资源块来负责传输PUCCH由下面两式决定： 当仏mod 2 = 0,有:
14
f<CH	if 硼△职1
s	1("cch -c•冷仏貰H)m°d(c.繹仏篇CH) otherwise
式 2-11
当 ns mod 2 = 1,有：
一 1) + 1)] mod«B/A^CH+1)-1 见ch 25""
|_A / cJ + (/? mod c^N'/ A™^CH	otherwise	式 2-12
其中，/2 = （"S-l） + a）mod（cN7&；”〃），对常规CP有d = 2。参数△篇財由高层 给岀。
PUCCH格式1/la/lb的发送过程可以由图2-7表示：




图2-7 PUCCH格式1/la/lb发送过程

2.2.4.2 格式 2/2a/2b
PUCCH格式2/2a/2b,每个时隙的第1、3、4、5、7个SC-FDMA符号用于发送信 道状态信息（CSI）的编码调制符号，第2个SC-FDMA符号用于发送解调参考信号， 第6个符号在格式2时发送解调参考信号，在格式2a/2b时ACK/NACK调制生成的调
15
制符号绑定在解调参考信号上，对应的星座映射方式在上一小节己经给岀。 包含CQI、PMI和RI中一种或多种信息的CSL通过Reed-muller编码卩°】为20比
特8(0),...,5(19),然后由UE指定的扰码序列进行加扰。按照式2-13产生一个扰码比特 块方(0),...,片(19)：
b(i) = (b(i) + c(Z)) mod 2	式 2-13
其中扰码序列c(f)在2.2.4中已经给岀，在每一个子帧开始的时候由初始值 =d«s/2j+l)-(2^S" +l)-2I6 + WRNn 初始化’其中"皿 为 C-RNTL 片(0),...,5(16)由 表2-7给出的QPSK调制方式调制成d(0),...,d(9),每一个d(0),...,d(9)乘以一个长度为 12的循环移位序列祜；)(”)：
zgccH.g)*"?⑴
〃 =0,1,...,9	式 2-14
2 = 0丄...,11
PUCCH解调参考信号/UCCHQ为
rPuccH (12財理bh +12m + ”) = z(m).矽;)(时
m = 0,l	式 2-15
n =	1
冰=0,1
在格式2a/2b时，当秫=1时，z(m)等于刁(10)；否则z(秫)等于1。冰=0表示一个 子帧中的前一时隙，冰=1表示一个子帧中的后一时隙。
用于PUCCH格式2/2a/2b传输的资源由资源指示n^CCH确定，循环移位如」)由 n^CCH通过下面的式子计算得到：
a(ns,l) = 27r-ncs(ns,l)/N^	式 2-16
其中，
a(ns, /) = 2tt ■ «cs (ws, /)/式 2-17 且当〃s mod 2 = 0时有,:
|<CHmod<	if 媼:ch <繆鴻
"久［(福ccH+N?+l)modN3 otherwise	： 2 总
«smod2 = 1 时有：
16

'[繆(”ST) + l)]mod(繆+1) -1 if<CH<«
(滯-2 - 端cch ) mod 滯	otherwise
PUCCH格式2/2a/2b的发送过程可以由图2-8表示：



表2-7 CSI的QPSK调制方式
b(i),b(i + l)	1	Q
00	1Q	1/損
01	1/次	-iM
10	-1/V2	i/損
il		-1/V2

2.3本章小结
本章主要对TD-LTE系统物理层以及上行控制信道进行了详细介绍。描述了 TD-LTE 系统物理层帧结构、物理资源及关键技术；针对其中的物理上行控制信道进行了详细的 介绍，对不同的PUCCH发送格式的发送过程，建立了各自的发送模型进行说明。
I7
第三章TD-LTE系统PUCCH检测接收算法的研究
LTE PUCCH不同格式所承载的控制信息以及发送的方式不同，因此不同的格式的 检测接收算法也不相同。可以根据PUCCH的格式将接收算法大致分为两类，格式1/la/lb 和格式2/2a/2b；检测算法只针对格式1/la/lbo
3.1 PUCCH系统模型
PUCCH系统包括发送端和接收端两个部分，发送端在UE侧，接收端在eNodeB侧。
UE将上行控制信息经过信道编码、调制加扰之后，通过长度为12的正交循环移位ZC 序列，码分复用在每个SC-FDMA符号上，在映射到相应的物理资源之后经天线发送出 去。

图3-1 PUCCH发送接收过程
对于eNodeB端，每一根天线上所接收到的信号R仏幻可以表示为:

U
R (微)= £&(/)*心/)*ZC“仏幻*/(//) + »(/,幻,/ = 0...13,k=0...11
"=1
式3-1
其中"为用户编号，/为符号索引，力为子载波索引，ZC"(l,k)为正交循环移位序列 (ZC序列)，为对应的信道冲击响应，N(l,k)为噪声，％(/)为每个符号上的调 制信号，叫(/)为每个符号上的时域扩频序列。针对不同的格式，$“(/)与吼(/)具有不同 的形式，格式2/2a/2b没有进行时域扩频，具体可以见表3-1：
18
表3-1接收信号中不同格式的s,(Z)和吧④
格式	S&)	w“(/)
l/la/lb	{d° , dq , 1, 1, 1, dg , dq & 9 , 1,1,1, dq, d.Q}	(w0,wl,w'0,w'l,w'2,w2,w3
w0,wl,w'0,w'1,w'2,w2,w3)
2	{d°, 1,4,’ 1，"4 仏 91, 5 dj, q J, dg}	{1,1,1,1,1,1,1
2a/2b	{d° 丄4, d?,仏,4 0, dq d$ ,1,	9	dg}	1,1,1,1,1,1,1}
注：4°为格式2a/2b绑定的ACK/NACK符号

3.2 PUCCH格式1/la/lb检测与接收算法
3.2.1格式1/la/lb检测算法
由于PUCCH中不连续发送状态(DTX)的存在，对于PUCCH信道中的信息不能 直接通过星座图得出SR、ACK和NACK信息，需要设立一个合适的门限值，用来区分 DTX状态，若判决出状态为非DTX状态，才能使用接收算法得到具体的控制信息。
LTE中，上行通常采用一发多收的SIMO系统，对于最基本的一发双收的配置，其 最大比合并的算法表达式可以表示为式3-2：
$ _础i+砌2 . z &*% +窗巧
44+外用	44+用4
式3-2-1.1中s为发送信号，扌为发送信号s的估值，4和用分别为天线1和天线2 的信道冲击响应，&和晨是他们的估值，％和〃2为高斯白噪声。式3-2中第二项是由高 斯白噪声而产生的，令
式3-3

信道下的DTX判决可以根据高斯概率分布函数来确定固定门限值风，根据协议要求, 虚警概率不超过1%，
RACK | DTX) = 1 一 0)(—2.) = 0.01	式 3-4
(T
根据式3-4可以得出风=%6
式3-1中第一项为接收到的有用信号，因为信道估计存在一定误差，因此接收到的
19

有用信号存在一定程度上的失真，为了适应信道变化的情况，我们将固定门限风乘以 一个信道变化的因子，取发送信号估计值的幅值来作为信道变化的因子。在这之后为了 使虚警概率小于1%,还需要乘以一个调整常数％,因此最终的动态门限乃可以由下式 表示［⑴：
Th = a2-a,-（y-\s\
=a • cr-151	工'
最终的判决表达式为：
| f |> or < 必 61 |	式 3-6
即（|*|2.+|爲 |2）2>or<Q（|&FE+|^|2.EM = a2	式 3-7
尸可以通过仿真来得到，使得虚警概率小于1%。
3.2.2格式la/lb接收算法
若通过检测算法得岀接收端SR或ACK7NACK信号，对于格式1可以直接将SR上 报给高层；对于格式la/lb,采用具体的接收算法来得到具体的ACK/NACK信息㈣同。
3.2.2.1 LS信道估计
如2.2.4.1节所述，格式la/lb每个时隙中有三个解调参考信号，其参考信号占用率 高达42.8%,并且釆用了 8比特的重复编码，通常情况下，直接采用最小二乘（LS）信 道估计的办法，就能达到协议36-104中所要求的性能。
图3-2给出了接收端一根天线上一个时隙的LS信道估计的过程：
ZC	w,
3*12*n ant	孕,3*n ant
——►Z—> CE.
1 1
图3-2 PUCCH格式1/la/lb信道估计
三个载有解调参考信号的SC-FDMA符号，经过解资源映射之后，首先与对应符号 上用户“的ZC序列的共轴相乘（一个RB）,然后将一个符号上的12个子载波相加，假 设不同子载波上的信道估计近似相等，根据ZC序列的恒包络零自相关特性，有 宀*芸 zq（/,盼.云“I （//）=1
式3.8 =0,〃1 工 u2
即相同用户的ZC序列的共轴相乘相加为1,不同用户的ZC序列共轴相乘相加为0。
20
我们把这种运算称为ZC序列的去相关操作。
在进行完ZC序列的去相关操作后，消除正交扩频序列产生的时域扩展，将三个解 调参考信号对应符号上的结果相加，就得到了一个天线上第一时隙的用户”的信道估计
C知t =支傥& （M）.瓦0盼］冲	式3.9
』=2烦=0	）
同理，第二个时隙的用户“的信道估计以"
式 3-10
本小节各式中的各符号的含义己在3.1小节中给出。
3.2.2.2均衡和解调
均衡的过程可以由图3-3表示：
ZC	叫	CEu
上官丄占土」一 z-4—s：一＞忽
0	0,1,6,7	0 0
图3-3 PUCCH格式la/lb均衡过程
位于每个时隙的第0、1、5、6个SC-FDMA符号承载着格式1/la/lb的控制信息。 首先通过和对应符号上用户“的ZC序列共轴相乘，然后将一个符号上的12个子载波进 行叠加，消除ZC序列的影响和其他用户的干扰，这里同样用到ZC序列的恒包络零自 相关特性。在消除正交扩频序列的影响后，通过与相应的信道频域响应做共辗乘法，就 得到了调制信号的星座图。对于不同的天线的星座图，我们可以釆用等增益合并的方式 进行合并。用户”的信道均衡的结果可以由下式表示，其中E0”为一个子帧中第一个 时隙的均衡结果，E0,2nd为一个子帧中第二个时隙的均衡结果：
、 -
（i,kyzcu（i,k）-w（z）•赤心
丿 _
(11		 \
E0& = Z £尺(罹)之＜?"0幻 M(/) ・CE“,2nd
|_/=7,8,12,13^4=0	丿 _
诳*E"吼2nd)
21
格式la与格式lb的判决域如图3-4所示:


图3-4 PUCCH格式la (左)与格式lb (右)解调判决域划分
格式la釆用BPSK调制，ACK映射到x轴的负半轴，NACK7DTX映射到x轴的正 半轴。我们可以根据E0的实部来解调，若实部小于0,则判决为NACK；若实部大于 0,则判决为ACK,如式3-12所示：
real{EQu) < 0,5(0) = ACK
real(EQu) > 0,6(0) = NACK	式弘口
格式lb釆用QPSK调制，(ACK, ACK)映射到-1, (NACK, NACK)映射到1,
(ACK, NACK)映射到j, (NACK, ACK)映射到-j,解调可以按照式3-13来进行：
reaKE0)-imag(E0) < 0,6(0) = NACK
real{EQl() - imag{EQu) > 00(0) = ACK
real(EQJ + imag(EQu) < 0,5(1) = ACK	式 3'13
real{EQu) + imag(EQu) > 0,6(1) = NACK
3.2.3格式1/la检测接收算法仿真
为了验证上述的算法性能，本文在3GPP相关的TD-LTE物理层协议的基础上，利 用计算机软件Matlab作为仿真软件平台，搭建了 PUCCH仿真链路o PUCCH仿真链路 包含发送部分、信道部分和接收部分。发送部分模拟UE的发送过程，输出出发送到空 口的信号；信道部分根据配置参数，模拟多种信道环境，输入空口信号，输出经过信道 之后的信号；接收部分模拟eNodeB端的接收过程，上述的算法主要在接收部分体现。 通过分析仿真结果，详细探究本文所述算法的性能。
根据协议36-104中的描述，PUCCH需要在单用户和多用户两种情况进行性能验证, 协议中还给出了具体的信道模型。本文对协议中性能需求接收天线数为2的部分进行了
22
漏检概率和虚警概率的仿真。
在发送部分，经过调制之后，生成控制信息域和解调参考信号域的信号，映射到对 应位置的物理资源上产生PUCCH的子帧，经过SC-FDMA调制之后产生空口信号。在 信道部分，依照配置的信道类型和接收天线的数量，产生响应类型对应数量的衰落信道, 模拟多径信号的生成过程，然后在接收部分之前添加高斯白噪声。在接收部分，首先通 过FFT将时域信号转换成频域信号，然后根据资源解映射解出相应位置上PUCCH信 号，经过DTX判决以及控制信息解调等步骤。最后将通过相应的统计模块统计仿真性 能。DTX开关是为了模拟用户DTX的情况，此时，DTX开关断开，相当于用于没有 发送信号，接收端仅接收到高斯白噪声。
多用户复用链路中发送端各用户端处理流程大体相同，只有目标用户需要进行 DTX情况的模拟有DTX开关模块，因此目标用户DTX的情况下，接收端不仅接收 到高斯白噪声，还有其他用户的干扰信号。
3.2.3.1传播模型
协议36-104给出的多径信道模型的时延扩展和相对功率如表3-2泌]所示，多径信道 模型包括扩展行人信道模型EPA、扩展车辆信道模型EVA和扩展典型城镇信道模型ETU。 本文模拟的信道环境同协议给出的信道相一致。
表 3-2.1 冋	表 3-2.2㈣	表 3-2.31'4'
扩展行人信道模型(EPA)		扩展车辆信道模型(EVA)		1 广展典型城镇4	言道模型(ETU)
时延扩展
[ns]	相对功率
[dB]		时延扩展
[ns]	相对功率
[dB]		时延扩展
[ns]	相对功率
[dB]
0	0.0		0	0.0		0	　　　-1.0
30	-1.0		30	-1.5		50	　　　-1.0
70	-2.0		150	-1.4		120	　　　-1.0
90	-3.0		310	-3.6		200	　　　0.0
110	-8.0		370	-0.6		230	　　　0.0
190	-17.2		710	　　　-9.1		500	　　　0.0
410	-20.8		1090	-7.0		1600	　　　-3.0
1730	-12.0		2300	　　　-5.0
2510	-16.9		5000	　　　-7.0

3.23.2仿真参数
表3-3给出了 PUCCH格式la仿真的具体参数，根据协议的要求，我们对单用户格 式la和4用户格式la进行了仿真，系统带宽为10MHz和20MHz：
23
表3-3 PUCCH格式la仿真参数
参数	取值
系统带宽	10/20MHZ
天线配置	1x2
用户数	1或4
成
"PUCCH (多用户)	2 （目标用户）.1, 7, 14
干扰用户信号相对功率[dB]	0, -3, 3
CP类型	Normal
噪声模型	AWGN
系统同步	理想同步
传播模型	EPA 5Hz/EVA 5Hz/EVA 70Hz
ETU 70Hz （多用户）
ETU 300HZ
物理信道	PUCCH格式2
仿真样本数	10000 个 PUCCH 子帧

3.23.3仿真结果以及小结
这一小节给出了 DTX门限仿真，确定了参数”，并且根据协议36-104的要求给出 了格式la在不同信道环境下的仿真。
3.2.3.3.1 DTX门限仿真
我们对3.2.1小节的取值进行仿真，通过调整的值，使得能够满足P(ACK| DTX)虚警概率不超过1%。在EPA 5 Hz多径信道下，-8dB〜-2dB的仿真信噪比范围内 对不同的0进行虚警概率的仿真，漏检概率随着0的增大而下降。虽然増大”值能够在 DTX的情况下将更多的噪声限制在正确的范围，有利于降低虚警概率，但是这将会导 致非DTX的漏检概率的增加。在此，我们选择小=0.063,使误警率稍微彳氐于1%, 保持一定的余量。下一节我们将使用此门限值进行PUCCH接收性能仿真，验证格式la 接收算法误码块率的性能表现。检测算法仿真的结果如图3-5所示：








SNRMR
图3-5 [3 =0.063时EPA5Hz信道下的虚警概率
24

3.2.33.2格式la单用户接收仿真
3GPP协议中建议在只有一个用户使用该RB,并且虚警概率不超过1%的情况下, ACK的最低性能如表3-4所示：
表3-4单用户PUCCH format la最低性能要求
接收算法的仿真结果图3-6所示，图3-6给出了在EPA5Hz、EVA5Hz和ETU300Hz 信道条件下，信道带宽分别为10M和20M,循环前缀为常规循环前缀的仿真图。其中 信噪比为-8dB〜-2dB,仿真点数为20000点。图中蓝色曲线为误块率BLER的曲线，红 点为协议规定的最低要求：
从仿真的各图可以看出，上述算法在多种传播条件下均能满足协议要求，且至少有 0.6dB的余量。
25

3.23.3.3格式la多用户接收仿真
多用户PUCCH格式la最低性能要求如表所示，多用户具体的仿真参数在3. 2. 3. 2 小节中己经给出。
表3-5多用户PUCCH格式la最低性能要求
接收天线 数	循环前缀	传播条件
(Annex B)	信道带宽	/SNRfdB]
1.4 MHz	3 MHz	5 MHz	10 MHz	15 MHz	　20 MHz
2	Normal	ETU 70*	-4.1	-4.4	-4.4	-4.6	-4.6	　　-4.4
图3-7给出了 PUCCH格式la在ETU70Hz信道下多用户的虚警概率和误码块率的 仿真结果，信噪比为-8dB~-2dB,仿真点数为20000点。蓝色曲线对应误码块率，绿色 曲线对应虚警概率，红点表示协议所规定的最低门限。


ETU70 10M 4UE








SNR/dB
图3-7 PUCCH格式la四用户虚警概率和误码块率仿真图

除多用户配置外，其它仿真条件与单用户相同，在ETU 70信道条件下的仿真结果 如上图所示。仿真结果显ETU 70信道下的误码块率为1%处所对应的信噪比分别为约 -5.8dB,满足协议规定的性能指标要求。在虚警概率接近协议要求的情况下，误块率比 协议要求好大约1.2dBo
由于PUCCH格式la的解调参考信号相对较多，因此用简单的LS信道估计的办法 就能得到不错的效果；并且格式la/lb采用1/10的重复编码，一个BPSK/QPSK符号用 十个不同的SC-FDMA符号进行发送，接收性能进一步提升，因此在工程上采用上述算 法即可。
3.3 PLCCH格式2/2a/2b接收算法
本小节讨论了两种针对格式2/2a/2b的接收算法。算法一通过解调参考信号做信道 估计，均衡后通过Reed-muller译码器进行译码，最终得到CSI信息；算法二利用全部 的符号信息，釆用半盲检测的方法做信道估计，最后根据最大的相关值求出对应的CSI 信息。算法一计算复杂度低，通过DSP实现简单，处理时间长度较小；算法二的性能
要好于算法一，但是计算量较大，需要比较多的处理时间，且需要额外的辅助空间来存 储预测信息。
3.3.1基于快速哈达玛变换译码的PUCCH接收算法
该算法首先对接收信号进行信道估计以及信道均衡，经过解调解扰，在得到20个 编码比特顷0),.•展(19)之后，经过Reed-muller译码器[,6](17][18][,9]得到控制信息。其中 Reed-muller是基于快速哈达玛变换来实现的。
3.3.1.1格式2信道估计
格式2的解调参考信号位于一个子帧中的每个时隙上第二个和第五个SC-FDMA符 号上。在格式2a/2b的情况下，第五个SC-FDMA符号还绑定了一个QPSK符号的 ACK/NACK信息，在一个时隙内发生显著信道变化的多普勒环境中，仅仅依靠单个解 调参考信号进行相干检测会降低ACKVNACK和CSI的性能，因此格式2a/2b通常不采 用此种方法，可以釆用盲解码或者不同ACK7NACK组合的多个假设检验小】。
对于格式2,我们可以根据解调参考信号得到两个符号上的信道频域响应，之后可 以通过插值的方法来近似推导出其他符号上的信道冲击响应，低速信道下，7个符号的 信道估计可以认为近似相等，本文采用后面一种方法进行处理，其过程可以由图3-8表
ZC
图3-8 PUCCH格式2信道估计
不同于格式1/la/lb,格式2并没有对其进行时域扩展，处理起来更为简单。第一个 时隙和第二个时隙的信道频域响应分别为：
CEw=££R(l,k).云 W)
/=1,6 心 n	式 3-14
CE睥=£玉
Z=8,I2 A=0
3.3.1.2均衡、解调和解扰
格式2均衡的过程由图3-9表示，每个符号上的数据在进行去ZC序列相关的运算 之后，乘以频域信道响应的共辄，然后不同天线上的结果进行合并：
27
ZC	CEu
12*10*〃 an, —	& 丈 ”K
一~►E—*^0—	► d(0),...,d(9)
I	1
图3.9 PUCCH格式2均衡
每个SC-FDMA上的QPSK符号由式3-15给出,
o= £R(l,k/&k) •瑟jst,1 = 0,2,3,4,6
\k=0	>
s(/) =(£r (/,幻•互“(/,幻］赤“,2ndJ = 7,9,10,ll,13	式 3T5
\k=0	丿
{邳d(9)} = {s(0),s(2),s(3),s(4),s(6),s(7),s(9),s(10),s(l l),s(13)}
必0),...,必9)为QPSK符号，理想情况下分布在坐标轴的角平分线上，必0),...,必9)按 照式3-16的方式进行解调。
6(2 *z) = -real(d(i))
~z “	式 3-16
b(2*i + l) = —imaged (j.y)
次(0),...,d(9)解调之后就得到了扰码比特块月(0),...,片(19),对片(0),...,片(19)解扰后得 到Reed-muller编码比特块3(0),...,6(19),将顷0),...,贝19)送到Reed-muller译码器进行译 码处理。8(0),...,£(19)的解扰过程和加扰过程相同，如式3-17所示：
b(i) = (p (0 + c(z))mod 2
3.3.1.3 Reed-muller 译码則
信道质量指示CS1采用的是（20, A） Reed-Muller编码方式，相当于不完全的（32, A） Reed-Muller编码方式，这里A的长度由CSI的比特数确定，和CSI的比特数一致。 编码基序列由表3-6给出，从编码基序列可以看出，表的第一列是一个全1序列，而表 的第二列到第六列是长度为32的Walsh码一部分，由长度为32的Walsh码打掉12个 比特形成，表剩余的七列是7个基本的掩码序列。
表3-6 Reed-muller编码基序列
i	ML
0	Mi,!	Mi.2	Mi3	Mi,4	Mi,5	Mi,6	Mi,7	Mi.8	Mi.9	MiJO	Mi. 11	Mi,12
0	　1	　1	　0	　0	0	0	0	　0	　0	　0	1	1	　　0
1	　1	　1	　1	　0	0	0	0	　0	　0	1	1	　　1	　　0
2	　1	　0	　0	　1	0	　0	1	　0	1	　1	1	　　1	　　1
3	　1	　0	　1	　1	0	　0	0	　0	　1	0	1	　　1	　　1
4	　1	　1	　1	　1	0	　0	0	　1	0	0	1	　　1	　　1
5	　1	　1	　0	　0	1	　0	1	　1	　1	0	1	　　1	　　1
6	　1	　0	　1	　0	　1	　0	1	　0	　1	　1	1	　　1	　　1
7	　1	　0	　0	　1	1	　0	0	　I	　1	0	1	　　1	　　1
28

表3-6 Reed-muller编码基序列(续上表)
i	Mi,
0	Mi.l	Mi.2	Mi.3	Mi,4	Mi.5	Mi,6	Mi.7	Mi,8	Mi,9	MiJO	MiJl	Mi,12
8	　1	　1	　0	　1	　1	0	0	　1	0	1	1	1	　　1
9	　1	　0	　1	　1	　1	0	1	　0	　0	1	1	1	　　1
10	　1	　0	　1	　0	0	1	1	　1	　0	1	1	　　1	　　1
11	　1	　1	　1	　0	　0	1	1	　0	　1	0	1	　　1	　　1
12	　1	　0	　0	　1	0	1	0	　1	　1	1	1	　　1	　　1
13	　1	　1	　0	　1	0	1	0	　1	　0	1	1	　　1	　　1
14	　1	　0	　0	　0	　1	I	0	　1	0	0	1	　　0	　　1
15	　1	　1	　0	　0	1	i	1	　1	　0	1	1	　　0	　　1
16	　1	　1	　1	　0	　1	1	1	　0	　0	1	0	　　1	　　1
17	　1	　0	　0	　1	　1	1	0	　0	　1	0	0	　　1	　　1
18	　1	　1	　0	　1	　1	1	1	　1	　0	0	0	　　0	　　0
19	　1	　0	　0	　0	　0	1	1	　0	　0	0	0	　　0	　　0

要进行FHT输入的序列必须是2的幕，而(20,13) RM译码器的输入为长度20的 双极性序列，所以在交织处理之前，先将长度扩展到32,即在序列高位添加12个0；
译码输入比特由bob|b2b3---b|7bi8bi9扩展为棚1)山2毎"七2购(^31，后12位为0。
Reed-muller译码的算法步骤如图3-10所示：

图3-10 Reed-muller译码步骤

1)经过软判决之后软比特信息要进行交织处理，输入码子高位添加12个0,使得 长度变为32。编码矩阵M,是在(32,11) RM编码序列的基础上，打掉一部分比特， 然后对处理后的序列增加两列掩码序列所构成。扩展为32位之后，将输入码字进行与
(32,11)相同的交织处理，即将输入码字的顺序由bOb1b2b3...b29b3ob3l变换为b3ibob2O b| b2 bii bj 64 622 bs b& b?3 b? bg by b?4 bi9 b?5 bio bn b】2 如 b26 坛 b. b?8 b” b〕7 也8 b?9 b3° 同时 也对掩码序列进行交织处理。
2)消除掩码影响处理，7个掩码序列的线性组合可以产生27=128个掩码矢量，每 个掩码矢量的长度都是32,这些掩码矢量分别与接收码字相乘后(交织处理后的码字与 交织后的掩码矢量分别相乘)，其中一个掩码矢量与发送组合相同，从而消除了掩码部 分的影响，只剩余M1-M5对编码序列的影响。
3)M,-M5编码序列都是Walsh码，这些序列的32种组合正好是哈达玛矩阵的行向 量，可以利用IFHT来求相关值，得到128*32的相关值矩阵。
以8阶沃尔什一哈达玛变换为例，其快速算法快速哈达玛变换(FHT)及逆快速哈 达玛变换的蝶形图如图3-11所示：
29


图3-11 8阶IFHT与FHT蝶形图
4)搜索相关矩阵中的绝对值最大数，其行号就对应为bitl-bit7,列号对应bit8-bitl2o
5)bitO则根据绝对值最大数的符号来确定，正号则译为0;负号译为1。
设计(20, A)译码器是需要用到3个矩阵，一个矩阵存储128个掩码矢量，为128*32 矩阵，一个存储快速哈达玛变换之后的输出矩阵为32*32矩阵，一个为快速哈达玛变换 之后取绝对值的矩阵，同为32*32矩阵。
PUCCH格式2/2a/2b的13位CSI的Reed-muller译码结构可以由图3-12表示：
根据符号确定
3.3.2基于半盲检测的PUCCH接收算法
PUCCH格式2,每个时隙仅有2个解调参考信号，解调参考信号占用的比例仅为 28.57%,仅仅使用解调参考信号来做信道估计并不能得到较为理想的性能。在格式2a/2b 时，第二个解调参考信号还需要绑定一个QPSK符号的ACK/NACK信息，只能用一个 参考信号来做相干检测，信道估计的性能进一步下降。
PUCCH信道负责发送数据的符号，使用和解调参考信号相同的ZC序列的不同循 环移位，若能使用7个符号的信息做信道估计，信道估计的性能应有所提升，半盲检测 算法就是利用了这一点。通过仿真发现，在低参考信号占用率、低码率、信道属于低速 信道的情况下，半盲检测算法对于接收性能有一定程度上的改善[21][22]0
3.3.2.1半盲检测算法的信道估计
在半盲检测算法中，我们假设己知发端的CSI信息。若CSI信息的比特数为N,所 以CSI在经过Reed-muller后编码的20个比特信息序列共有2N种情况。若CSI为4比 特，我们设第一种CSI为0000,第二种CSI为0001,依次类推，第16种CSI为1111。 这16种CSI对应16种20比特的Reed-muller编码序列。而加扰方式在接收端是已知的,
30

加扰结果的种类的多少没有影响，仍然为20种。不同格式的比特序列数由表3-7所示: 表3-7半盲检测算法不同格式的比特序列数(N为CSI比特数)
格式	比特序列数
2
2a	2n+1
2b	2n+2
对于第n种比特信息序列，接收端的信号可以表示为：
U
7?(罹)=七“(/) * ZG(罹)* %仏幻 +Z(/)* ZC"(/,幻 * 比仏幻 + N(l, k)
u=2
=s} n(/) * ZC](/, k) * Hl (/,k) +NQ,幻,/ = 0,1,13,k = 0,1,... 11
式中N")为噪声和其他用户的干扰。第一个用户一个符号上的信道估计可以由下 式表示：
H“k，k) = R (/,k)*Si〃(/)*ZC】(/,*), / = 0,1,13,k = 0,1,... 11
我们将一个时隙上7个符号信道估计的平均作为每个时隙的信道估计，以减小噪声 和干扰所产生的误差。一个子帧中的两个时隙存在跳频，因此两个时隙的频域信道估计 需要分开计算，若用表示第一个时隙的频域信道响应，用%心仙)表示第二 个时隙的频域信道响应，则有：
1 6
皿。)=寻跖,(微),1< = 0丄...11
/ 1=0 1 13
冋心,饵)亏£匕(册)，1< = 0,1,...11
/ 1=1
3.322噪声方差计算与最大比合并
定义C仏幻= s(/)*ZC(/,k),显然有|C(//)|=1,则每个时隙的噪声方差〔23］可以 由接收信号R(i,k),每个符号上的调制符号s(/)以及对应的正交序列ZC(/,k)计算得出, 如式3-21所示：
1116
1 Z / k=G /=0
1	11 13
=用 Z SIM k) - C,,„(/, k) * HWml (k)
1 Z • k=0 1=1
Nr根天线上的信号的最大比合并可以在噪声方差估计之后获得:
31


Ri,”,is, 0 4) - 丸	?~,,=0,1,..., 6

啓而确忝)* R'Q，k)
R宀(罹)=£ m片丿	I，勺=7,8,...,13
tr 91,心汩)
33.2.3相关系数的计算与比较
我们可以计算幻、RWnd(l,k)与s(%,*ZG(/,k)的相关系数，通过比较相关 系数来确定CSL第n种比特序列的相关系数为：
6 11	 	 13 11
corrn = ZZ R，"W 偽幻 *	(7,幻 + £Z R，"，2nd(，, k) * CI n(I, k)	式 3-23
/=0 ^=0	1=7 k=O
将2村个或2n+\ 2n+2个相关系数依次计算出来，通过比较 con\,corr2,...,corr2K(...,cor^+l,...,cor^+2),得到其中的最大值，将其转换成2进制的比 特序列，就得到了最后的CSI信息。例如，接收到的应是4比特CSI的信息，最大的相 关系数为corn，那么CSI为0011。
3.3.3格式2两种接收算法的性能仿真与对比
仿真的环境在3.2.3小节已经给出，下面给出具体的仿真参数和仿真结果。
3.3.3.1仿真参数
表3-8给出了格式2的仿真参数，分别在低速传播环境和高速传播环境下，在CSI 比特数为4的时候，对算法一和算法二进行了仿真对比。
表3-8 PUCCH格式2仿真参数
参数	取值
系统带宽	10
天线配置	1x2
用户数	1和4
CP类型	Normal
噪声模型	AWGN
系统同步	理想同步
传播模型	ETU 3km/h
ETU 350km/h
物理信道	PUCCH format 2
仿真样本数	10000 个 PUCCH 子帧
CSI长度	4
32

3.3.3.2仿真结果
图3-13给出了 PUCCH格式2两种不同算法的仿真，CSI的比特数为4,仿真用户 数为1UE和4UE。上图是在ETU 3km/h的低速信道条件下进行的仿真，下图是在ETU 350km/h的高速信道条件下进行的仿真。




图3-13 PUCCH格式2误码块率仿真

33
从仿真结果可以看出，在低速信道的情况下，釆用半盲检测算法大约有1个dB的 增益；在高速信道的情况下，大约有0.5个dB的增益。
3.3.4基于半盲检测接收算法的优化
从仿真的结果来看，算法二的性能要明显好于算法一，但是其计算量远大于算法一。 在CSI比特数为4时，算法二的计算量大约是算法一的16倍，每增加一个比特，算法 二的计算量翻一番。随着CSI比特数的增加，算法二的计算量呈指数型的增长。由于算 法二的计算量过于巨大，因此在工程上难以实现。我们尝试对算法二，即对半盲检测算 法进行计算量上的优化，减少该算法的计算量。
表3-9给岀了算法二各个运算模块的计算量统计
表3-9半盲检测接收算法各模块复乘次数统计
半盲检测接收算法模块	复数乘法次数（n = CSI长度）
信道估计	12*14*2n*NR
噪声方差估计与最大比合并	12*14*3*2。*Nr
相关系数	12*14*2。
总计	12*14*2n*(5NR+l)

3.3.4.1优化推演过程
本小节对半盲检算法的各个模块的优化过程进行了详细的描述，在优化的过程中， 我们主要采用了消除冗余计算的方法以及公式的深度推导的办法，将多余的计算过程删 除，将重复的计算集中计算，然后尽可能少的使用中间的变量，以此来达到减少计算量 的目的。
3.3.4.1.1半盲检算法信道估计的优化
考虑到H “是一个只有4种取值的QPSK符号，并且正交循环移位序列仅与用户有关, 与编码后比特序列的种类编号n无关。因此在式3-19中有大量的重复计算，我们可以 通过集中计算的方式，一次性将所有可能的结果计算出来，以消除重复计算。在式3-24 中，H"）是用户1的4种可能的频域信道响应之一，解调参考信号符号位置上 的频域信道响应在四种频域信道响应中是相同的。
34

Hb°W)=即,盼*同而*e-齐
_3 .
HyK，k) = 云前* 次」
_5 .
Hg*) = R0 幻* ZC") * e了	式 3-24
_7 .
§明队40幻=即，幻*珂而*厂”妇=0,2,3,4,6,7,9,10,11,13
H'symboiALk) = HiymbollQ，k) = HXsymbol2 (#)=
HgMk) = HnGk)=即，盼* 瓦京J = 1,5,8,12
我们将到马如如4(依)全部计算出来，根据假设发送的比特信息来组合 式3-3-4-1-1.1中得到的结果，求出对应的频域信道响应，这样一共花费大约12*14*4次 复数乘法。例如，若CSI调制的10个QPSK符号为
写玲写写»易易• Z屛k易
同(0)...d"(9)]=[e4 G 0 ,e4 0 0 0 0 您 0 丿]	式 3-25
将四组频域信道响应的计算结果根据10个QPSK符号组合起来，得到对应的信道 频域响应为：
[凡”(0,幻,...，4,.(13,幻]=
[H] symboii (0,k\ HX syn)bojQ(1, k),H\ 哪31 (2, A),丛,旳由3(3,幻,丑顷如4 (4, k), 哪如羚(5, k),
symbol] (6, k\ HXsyniholl (7 ,k),	*)，Hi”” 她 3(9,幻,H\网,瑚4 (10,上),(11,幻，
^X.symbolO^	symbol! 0 3,们]
我们通过集中计算的方式，减少了大量的冗余计算，复数乘法次数变为一个常数， 而不是根据CSI的比特数呈指数型增长的一个较大的数。CSI的比特数越多，这种办法 的计算量减少的收益就越大。
3.3.4.1.2噪声方差的再推导
式3-21给出了一种噪声方差的计算方法，然而这种噪声方差的计算方法需要用到 接收信号、假设的调制符号、正交循环ZC序列和对应时隙的频域信道响应，耗费了半 盲检测算法中一大半的计算量。若我们将式3-21展开，噪声方差的计算可以按照式3-27 进一步推导下去，我们发现噪声方差与式3-21中的Clw(/,k)并无关系，仅与频域信道响 应有关，频域信道响应已经由上一小节计算得出。
35
1	6 .	2

尸顷泌=点/£网叫-GW，k）*H],”,W）
丄匕, k /=0'

6
-ZE&（E*W,k）*Hg您） k 7-0

空支砲* W，k）*Hg岡）	式I']
k 1=0
=営&加"七叡心商
I	/
1 f 13	2	2、
b 1必,2前-12*7 席网，钏-7?| Hi,”,2nd（"）| I \ 丿
3.3.4.1.3相关系数的苒推导
在半盲检测算法中，最大比合并与相关系数的计算所耗费的复数乘法的次数巨大， 若将式3-22代入式3-23中，可以得到一个比较长的公式式3-28：




g=支丈y建）*鶯％再+丈丈勇也”灣）*：；（經*页而
i=o A=O rT （b miw丿	/=7 *=o 〃=1	】5、2nd）
式 3-28 通过观察式3-28,可以发现式中的R\l,k）与C0幻可以合并，合并之后的结果恰好 为每个符号上的频域信道响应，将式3-20代入式3-28中，可以得到式3-29：

6	11 Nr TTI	 	 13 11 Nr fTr fJ-'）
corrn
M） k=0 r=l （b mi京）	/=7 *=0 心 （b 1.2nd）
11 Nr TJr 任、6		 11 Nr H， （k} 13
=世7尸2*文史0幻*顷，幻+有交7户八2）*》’（罹）* CM） 卜0 心（b 1/,却）	/=0	k=0 r=] W 1,/7,2nd） 宜
=7 责五亙也业堕+ 7寸宇可m（幻*矿成神（幻 ~ M 91"）	白 4	（*gnd）2
式 3-29 从式3-29中我们可以看出，相关系数仅与频域信道响应和噪声方差有关，而频域 信道响应已经在33.4.1.1节中计算得出，噪声方差在3.3.4.1.2小节中计算得出，因此我 们只需要12*14*Nr次复乘运算就可以得到相关系数。
36
33.4.3优化前后计算景对比分析
式3-24通过减少重复的计算来达到减少计算量的效果，复数乘法的次数与CSI比
特数n无关，总是12*14*4*Nr,所有可能出现的值计算一次便可得到。
式3-27通过进一步的推导，得到了噪声方差艺収也和b,顷可以通过分别计算
11 13	2	11	2	11,	2
支党网，幻I ,力乩丽（切和（幻|得到，RQ，k）同样与CSI比特数n无关, 卜0 ）=7	k=0	k=0
11 13	2
因此钏在不同的情况下只需计算一次，即耗费12*14*Nr次复数乘法。
k=0 /=7
从式3-29我们可以看出，最后的相关系数仅与频域信道响应模的平方以及噪声方 差有关，而这两个值均在前面的步骤计算过。
综上所述，除去噪声方差、频域信道响应H好）以及他们模值的平方14,”（幻K，
其余所有的复乘运算结果均可以在2“种不同的情况下重新利用。经过优化和进一步的推 演，半盲检测算法的计算量大幅度下降。
表3-10给出了优化前后的计算量的统计，
表3-10半盲检测算法优化前后计算量对比
半盲检测算法模块	　　　优化前的复数乘法次数
（n = CSI 长度）	优化后的复数乘法次数 （n = CSI K:度）
信道估计	　　　12*|4*2'|*Nr	　　　12*14*4*Nr
噪声方差计算	　　　12*l4*3*2n*NR	　　　12*2 *2n*NR
+ 12*14* Nr
最大比合并	　　　12*14 *2n*NR
相关系数计算	　　　12*14*2n
总计	　　　12*14*2n*(5NR+l)	　　　(70+2*2。* 12 Nr

图3-14和图3-15分别给出了 Nr=2和Nr=4时，优化前后的计算量对比，蓝色曲线 为优化前，红色曲线为优化后。在Nr=2, CSI比特数n=4时，优化前算法的复乘次数 为29568次，优化后这个数字降低到了 2448次，大约为优化前的1/12；在Nr=2, CSI 比特数n=8时，优化前算法的复乘次数为473088次，优化后这个数字降低到了 13968 次，大约为优化前的1/34。可以看出这个方法计算量的优化幅度非常巨大，并且CSI 比特数n越大，这个优化方法的收益就越大。
37


表3-11给岀了在CSI比特数为n时，剩余的复乘次数占优化前复乘总次数的百分 比。可以看出半盲检测算法的计算量至少降低到了原来的l/13o
38

表3-11剩余的复乘■次数的百分比
n	Nr=2	Nr=4
4	8.28%	8.67%
5	5.44%	5.70%
6	4.02%	4.21%
7	3.31%	3.47%
8	2.95%	3.09%
9	2.77%	2.91%
10	2.69%	2.81%
11	2.64%	2.77%
12	2.62%	2.74%
13	2.61%	2.73%

3.4本章小结
本章详细的研究了 PUCCH不同格式下的检测与接收算法。我们给出了格式1虚警 概率和漏检概率的仿真，以及格式la的单用户和多用户的误码率仿真，仿真结果达到 了协议36-104的要求。对于格式2,我们使用两种算法分别在低速信道环境和高速信道 环境下进行了误码块率的仿真，在对比了两者的性能之后，得出了在一定条件下，半盲 检测算法性能较好的结论。在本章的最后，针对半盲检测算法计算量大的缺点，对其进 行了优化，使其计算量大幅度降低。
39
第四章TD-LTE系统PUCCH检测接收在DSP上的实现
4.1 Freescale MSC8157 多核 DSP 平台
4.1.1平台介绍
Freescale MSC8157是基于飞思卡尔SC3850星核技术而研制的一款六核DSP,能够 用于制作无线宽带设备。这个高度集成的DSP釆用45纳米的工艺技术，性能相当于主 频为6GHz的单核设备。这款DSP将帮助设备制造商和运营商为下一代移动通信（如 3G-LTE, HSPA+LTEA和WiMAX）提供服务与解决方案。
MSC8157多核DSP将许多数学和基带密集型任务分流到了另外一个处理模块增强 型MAPLE-B2上，这样，处理器的六个内核被释放，更好地处理其他任务。浮点MIMO 处理模块由MAPLE-B2模块执行，能够大大减少浮点DSP内核实现的时延就是其中一 例。除此之外，MAPLE-B2模块通过为OEM提供了单个硬件平台，来达到支持多种模 式的操作目的，它还允许使用一个并不复杂的软件交换机满足额外需求。MSC8157的 灵活性不仅提高了扩展设备创建的速度，还便于服务提供商缩减成本，减少开支，提高 系统吞吐量。
MSC8157可以实现LTE 20MHz带宽下的最高吞吐量，在上行实现300Mbps的速率 以及在下行实现150Mbps的速率，用过使用下行4*4MIMO和上行2MMIMO以及其他 消除干扰的方法，能够支持数百名用户。该DSP还可以以多种模式同时运行LTE和 WCDMAo
MSC8157多核DSP还集成了多种硬件加速器，包括前端加速器、FFT/DFT加速器、 MIMO最小均方误差和最大似然解码器灵活均衡器以及通过结合浮点运算和组合抗干 扰功能接收器实现的矩阵反转。
MSC8157将高速DDR接口、充足的内部存储器、CPRI6G天线接口和两个串行 RapidlO Gen 2接口集成在了一起，达到了在每通道上实现5G的功能和先进的通讯能力 的目的㈣。
MSC8157中包含6个SC3850内核，每个SC3850内核包括：
1）	32Kbyte的8路一级指令高速缓冲存储器（LI ICache）；
2）	32Kbyte的8路一级数据高速缓冲存储器（LI DCache）；
3）	512Kbyte的8路联合二级指令/数据高速缓冲存储器（L2 Cache/M2 Memory）；
4）	存储管理单元（MMU）；
5）	增强的可编程的终端控制器（EPIC）；
6）	调试和优化单元（DPU）；
7）	2个32bit的定时器。
40
4.1.2 开发环境 CodeWarrior
CodeWarrior Development Studio是用于编程应用中硬件的集成开发环境。使用 CodeWarriorIDE,编程人员可以采用平台和处理器之间的通用功能性，它包括构建平台 和应用所必须的所有主要工具。该开发环境也可以根据开发人员的需求，插入他们自己 所喜爱的工具，使他们以自由的方式工作。
CodeWarrior Development Studio将高端的调试技术与完备开发环境的简易性融合. 在一起，将C和C++源级薊调试和嵌入式应用开发带入新的阶段。
CodeWarrior Development Studio for StarCore 是对应于 MSC8157 的一个开发环境， 提供一个结合了构建、调试、仿真和分析工具的框架。结合这些组件，开发人员可以将 高性能DSP的潜力完全挖掘出来四。
该开发环境具有以下特性：
1）	特性丰富的基于Eclipse的IDE；
2）	高性能C/C++编译器；
3）	多核调试器，且该多核调试器具有多核运行控制命令功能；
4）	多样化的的软件分析工具，具有分析和跟踪功能;
5）	具有广泛驱动支持的SmartDSPOS；
6）	具有两种仿真器，指令集仿真器（ISS）和性能确切性（PACC）仿真器。
4.2方案设计
4.2.1 TD-LTE系统上行链路总体框架
LTE上行信道包括物理上行共享信道（PUSCH）,物理上行控制信道（PUCCH）, 物理随机接入信道（PRACH）等，SRS是探测参考信号，使用其中一片MSC8157处理。 而MSC8157有6个核，将core。作为主核，负责系统初始化，无线资源控制与物理层 接口处理，媒体接入控制层和物理层接口处理，FPGA与DSP接口处理及各个任务的调 度工作。鉴于每个上行信道任务处理速度和任务间时序的约朿，在Corel〜core5上运行 的信道任务进行如下分配：PUSCH及SRS的处理在corel~core3上面运行，PUCCH处 理在core4上面运行，PRACH的处理在core5上面运行。这样，PUCCH、PRACH采 用全静态核映射，而SRS、PUSCH釆用全动态核映射。上行整体的设计和PUCCH在 DSP中的分布如图4-1所示。
在小区建立，无线资源控制层参数配置，媒体接入控制层参数配置这一系列步骤完 成之后，根据FPGA传输的数据、控制信息和中断，来激活上行的任务，以达到最大化 的节省上行信道占用的DSP资源。每一个中断会触发一次任务的激活和运行，一个子 帧当中会触发4次中断，即共有4个任务。在前期做参数配置、初始化表的生成以及任 务表的生成，每个任务受到FPGA中断的影响，在中断到来时激活和执行，在下一个任 41

务到来时，必须对执行完毕的任务进行回收工作，并且对任务表进行刷新，以确保下一 个任务激活与执行的实时性，使得整个系统的时序正常而不紊乱［26H29】。

图4-1上行整体设计及PUCCH分布

4.2.2 PUCCH功能描述与性能要求
PUCCH 子系统在 MSC8157DSP (RX_BPP)的 core4 上运行。
PUCCH子系统完成PUCCH的UCI译码，输出UE上报的CQLPMLRI, ACK/NACK 值。鉴于本子系统在每个1ms子帧的符号3,符号6,符号10和符号13接收到来自FPGA 的中断，其时间间隔为0.27ms, 0.22ms, 0.27ms, 0.22ms□ PUCCH处理是在core4上的 全静态映射，当一个任务处于运行状态吋，其他的任务只能处于等待状态，为了实时的 进行任务的处理，对我们每个任务的性能有一定的要求：每个任务的执行时间应当小于 0.2ms,在每个1ms子帧的最后一个任务中信号处理完成之后，还需要向高层反馈UCI 信息，因此最后一个任务的处理时间可以稍长于其他任务［3°】。
4.2.3 PUCCH 接 口设计
coreO至0 core4之间的通信消息可以由图4-2表示:
42

图4-2 coreO与core4之间的新消息通信

1）	消息 STRU_CRMPHY_CELL_SETUP_REQ 为 core4 提供小区级别参数，core4 将在符号中断3到达时，如果小区状态是新建立提交或更新，那么就需要更新并保存消 息中与PUCCH相关的小区级参数。
2）	消息O_RACPHY_RL_SETUP_REQ为core4提供用户级别参数，core4将在时 隙中断3到达时，如果某用户链路状态是新建立或更新，那么就需要更新并保存消息中 与PUCCH相关的用户级参数。
3）	消息 STRU_MACPHY_UL_SUBFRAME_CONFIG_IND,应在每个子帧的时隙 中断3前到来，提供子帧级别的信息。
在每个子帧的符号中断3,6,10,13时，core。给core4的Task发送消息，告知core4 相应的数据地址，同时捆绑帧号，时隙号和符号编号一同发送。在core4处理完成1个 子帧的数据时，发送UCI信息给coreO,消息O_PHYMAC_UL_UCI_IND反馈UCI信息 给 coreOo
下面为消息的具体内容，仅列出消息中PUCCH相关的参数（消息中或包括其他信 道的相关信息）
4.2.3.1 coreO 到 core4 的接口
core。负责给core4发送无线帧号、时隙号、符号索引以及当前子帧的数据地址等基 本信息，如表4-1所示。还需要为core4提供用户级别和小区基本的参数信息，如表4-2 所示。
43


表4-1 coreO给core4发送的基本信息

core4将在每个子帧符号中断3到达时，判断小区状态，如果小区状态是新建立或
有更新，那么就需要更新并保存如下与PUCCH相关的小区级参数：
表4-2从STRU_CRMPHY_CELL_SETUP_REQ中提取的小区级别参数

core4将在子帧中断3到达时，判断某用户链路状态是新建立或更新，以便将更新 并保存消息中与PUCCH相关的如表4-3所示的用户级参数。
表4-3从O RACPHY RL SETUP REQ中提取的链路级别参数

44








































core4将在符号中断3到达时，将该子帧的配置实例化，如表4-4所示。
表4-4从STRU MACPHY_UL_SUBFRAME_CONFIG_IND中提取的子帧级别参数
接口结构体	类型	描述
STRU MACPHY UL SUBFRAME LOCAL	struct
-> AirFrameNum	unsigned int	空口无线帧号0-1023
-> SubFrameNum	　unsigned char	无线子帧号取值范围0~9
-> Cellld	　unsigned short	小区ID,保留
-> NumOfPUCCHUe	　unsigned char	上行PUCCH的ue个数
-> Reserved[3]	　unsigned char
-> astruPucchPara[MAX_USER_NUM]	STRU_
PUCCH PARA
・・>UeMId	　unsigned short	UE的唯一标识
—> RntiType	　unsigned char	确定本次该RNT1的类型：
枚举
—>Rnti	　unsigned short	RNTI的值
—> UciFormat	　unsigned char	上行控制信道格式：0〜5对 应格式 l/la/lb/2/2a/2b
—> nPucchl	　unsigned char	由MAC配置
—>BandType	　unsigned char	宽带/子带
—>TransMode	　unsigned char	传输模式
->PMIFlag	　unsigned char	有无PMI

4.23.2 core4 到 coreO 的接口
core4在处理完PUCCH的消息之后，将解码的物理上行控制信息发送给coreO,然 后由coreO发送给高层。具体的接口如表4-5所示：
表4-5 core4反馈给coreO的消息结构体
接口结构体	类型	描述
O PHYMAC PUCCI! UCI IND	struct
-> AirFrameNum	unsigned int	空口无线帧号
-> SubFrameNum	　unsigned char	无线子帧号取值范围0~9
-> NumOtUe	unsigned char	ue个数
-> Cellld	unsigned short	小区ID
-> STRU_UL_UCI_1ND [MAX_USER_NUM|	struct	每个UE上报的UCI信息
->UeMId	unsigned short	ue唯一标识
—>UciType	　unsigned char	0-5 对应格式 l/la/lb/2/2a/2b
->SR	unsigned char	SR调度请求
—>CS I Length	unsigned char	CSI有效R度
->CSI[13]	　unsigned char	0〜13
->HARQ[2]	unsigned char	Ofor NACK.l fbrACK

45
4.2.4任务划分及模块划分
PUCCH的任务处理逻辑上分为三个阶段，即符号处理阶段、时隙处理阶段和子帧 处理阶段。
1）	符号处理：在PUCCH的任务符号级处理过程中主要有ZC序列去相关，即对接 收到的PUCCH信道子载波数据符号与本地基序列做相关，分别得到解调参考信号和数 据。在FPGA的中断到来时，会激活该符号处理过程。符号3中断到来，开始符号0〜 符号3的任务（命名为Job_PUCCH_Symb3Int）处理，在Job_PUCCH_Symb3Int处理释 放完毕，符号6中断到来后，开始执行符号4〜符号的任务（Job_PUCCH_Symb6Int） 处理；同样的Job_PUCCH_Symb3Int处理释放完毕，符号10中断到来后，开始符号7〜 符号 10 的 Job_PUCCH_SymblOInt 处理；Job_PUCCH_SymblOInt 处理释放完毕，符号 13中断到来后，开始符号11〜符号13的Job_PUCCH_Symb 13Int处理。
2）	时隙处理：符号6的中断触发Job_PUCCH_Symb6Int处理，在处理完符号级流 程后，此时时隙0的符号级处理己完成，可以进行时隙0的信道估计和数据估计。而符 号13的中断触发Job_PUCCH_Symbl3Int,在处理完时隙1的符号级流程后，进行时隙 1的信道估计和数据估计。
3）	子帧处理：符号13触发Job_PUCCH_Symbl3Int,在处理完该子帧所有符号的 处理和时隙的信道估计和数据估计后，进行信道均衡、格式1/la/lb的UCI信息的检测 或格式2/2a/2b的UCI信息的检测。然后将解码后的UCI信息反馈给高层，让高层做下 一歩处理。4个任务的逻辑结构和所包含的功能如图4-3和表4-6所示：

图4-3 PUCCH 4个任务的逻辑结构

46

表4-6 PUCCH 4个任务所包含的功能
任务	包含功能
Job_PUCCH_Symb3Int	计算PUCCH资源位置
计算Ncs, Noc和u
ZC序列去相关
Job_PUCCH_Symb6Int	ZC序列去相关
信道估计、均衡、DTX判决
Job_PUCCH_SymblOInt	计算PUCCH资源位置
计算Ncs, Noc和u
ZC序列去相关
Job_PUCCH_Symbl3Int	ZC序列去相关
信道估计、均衡、DTX判决
解调、解扰
对格式2/2a/2b进行Reed-muller译码
对格式2/2a/2b进行CQI、PML RI的提取

4.3 PUCCH函数详细设计
core4上所包含的函数的定义以及功能由表4-7给出，eNBRxPucch为PUCCH处理 过程的入口函数，其中包含了计算PUCCH资源位置、计算ZC序列参数、生成ZC序 列并去除ZC序列的相关性、信道估计和均衡、DTX判决及噪声计算、解扰解调、产生 伪随机序列以及Reed-muller译码几个模块□ eNBRxPucch的处理流程以及函数间的调用
关系如图4-4和图4-5所示:
小区建立或重配置
保存小晟别参数
保存用户级别参数



图4-4 eNBRxPucch处理流程图
47



Pucch_NcsNocCal()	j 	: Common_gold _gen()

Pucch ZcDeCorr()

Pucch DTXChEstEq()


Pucch_DemoDeScrmb()	:…… 		:Common_gold_gen() 1

Pucch DeReedMuller()
图4-5 eNBRxPucch函数调用关系
表4.7给出了 Pucch的函数列表：
表4-7 Pucch函数列表及功能说明
函数亿	　　　说明（功能及所在模块）
void Pucch (
STRU_UL_HARQ_PROCESS*pHarqProcess
STRU_UL_CQI_IND *pCqi!nd
)	PUCCH处理模块
void PUCCH RsrcIdxCal (unsigned char Tsldx)	计算PUCCH频域上资源位置
void Pucch_NcsNocCal(unsigned char Tsldx)	计算PUCCH中使用Ncs, Noc和u 参数
void common_gold_gen ( unsigned int Cinit. unsigned short OutPutLen. unsigned char *pOutPut )	Gold序列生成，属于计算PUCCH 中使用Ncs, Noc和u参数模块
void Pucch ZcDeCorr (
short *pData!nO,
short *pDataInl,
short *pDataOutO,
short *pDataOutl,
STRU_PUCCH_ZC_DECORR_PARA*pPucchZcDeCorrPara )	去除ZC序列影响和其他用户的十 扰
void Pucch_DTXChEstEq(
short *pDataInO,
short *pData!nl,
STRU_PUCCH_DTX_CHEST_EQ_PARA *pStruPucchDtxChEstEqPara.
unsigned char *pPucchDtxFlag. short *pDataOut.
)	PUCCH的信道估计，均衡，以及
DTX判断
void Pucch_DemoDeScrmb ( short *pData!n.
unsigned char *pAckNack. char *pCsiSoftBit
)	PUCCH解调解扰

48

表4-7 Pucch函数列表及功能说明（续上表）
函数名	说明（功能及所在模块）
void common_gold_gen ( unsigned int Cinit, unsigned short	OutPutLen.
unsigned char	*pOutPut
)	Gold序列生成
void PucchDeReedMulIer ( char *pData!n, STRU_PUCCH_REEDMULLER_PARA * pPucchReedMullerPara unsigned char *pDataOut,
)	解 Reed-Muller 码

4.3.1计算资源位置功能设计
实现函数为 void PUCCH_RsrcIdxCal （unsigned char Tsldx ）。 当符号3中断到达后，计算子帧第1个时隙的PRB的位置； 当符号10中断到达后，计算子帧第2个吋隙的PRB的位置。
PUCCH在一个时隙上只使用一个资源块进行传输，用于PUCCH传输的物理资源 块位置与时隙久有关，由式4T给出：

if(777 4-/7s mod 2)mod 2 = 1
其中m值取决于PUCCH格式。对格式1, la和lb有:



图4-6说明了物理上行控制信道上资源位置映射方式。
在探测参考信号和PUCCH格式la或lb同时传输的情况下，探测参考信号占用了
SC-FDMA的最后一个符号，因此PUCCH上的最后一个SC-FDMA符号被打掉。
49


〃PRB = °








◄	One subframe	►
图4-6 PUCCH资源映射方式
根据上述描述，得到图4-7的设计流程图,
开始
Symbol 3中断
由参数ulCpType,
N_RB_2,uINScRB n_pucch_l, N_cs_l, detl_shift_pucchz 得蓟'参数天
由参数m, ulNRB, tsldx,得 到参数n_PRB_tsO,或者 n_PRB_tsl
UE个 数？=numUE /
TS个数？ =2
结束










图4-7 PUCCH资源位置计算流程图
50

4.3.2计算ZC序列参数功能设计
当符号3中断到达后，计算子帧第1个时隙的U, 当符号10中断到达后，计算子帧第2个时隙的U, ZC序列参数计算的流程如图4-8所示。


开始





















结束
J
图4-8 PUCCH ZC序列参数计算流程图
对于每个时隙的每个用户，根据不同的格式，有如下处理过程：
1）	计算ZC基序列所需参数u,首先由Group-hopping-enabled和N^'计算得到扁（仁） 和X：ucch ,然后计算“=（扁皿）+為）mod30 O
2）	对于格式1/la/lb,计算ZC序列所需％（«），%（佐，。，首先调用伪随机产生模
块得到「⑴，由c（i）计算亡'〃（久,/）,然后计算正交序列索引%血）和循环移位％（%/）；
3 ）对于格式2/2a/2b,计算ZC序列所需，首先调用伪随机产生模块得到c（i）,
51
由c(i)计算《：〃(％/),然后计算循环移位nW) o
4.3.3去除ZC相关的功能设计
实现函数为
void PucchZcDeCorr (
short *pDataInO,
short *pDataInl,
short *pDataOutO,
short * pDataOutl,
STRU_PUCCH_ZC_DECORR_PARA*pPucchZcDeCorrPara
)°
该函数的处理过程如下所述，流程图见图4-9：
1)产生PUCCH的ZC共辘序列
预先将30个参数u对应的ZC基序列存在表gZCBasicPhaseTable[30][ 12]里，预先 将本地ZC共辆序列存在gZCBasicConjTable[42]M,由计算ZC参数模块得到的参数u 和从 gZCBasicPhaseTable[30] [ 12]取出值 faValue,将 foValue 做相应变化后成 faValueldx, 根据 faValueldx 和 gNcs [7]在表 gZCBasicConjTable[42]中得到 ZC 共辄序列；
2)去除ZC序列
根据资源位置计算模块得到资源位置，得到相应12个子载波PUCCH数据，然后 跟ZC共轴序列相乘。
开始
Symb
由参数gu和
gNcs[symbldx]得到 ZC
共辘序列
去除ZC相关
否:数ML



图4-9去除ZC序列相关性流程图
52
4.3.4信道估计及均衡功能设计
实现函数为
void Pucch_DTXChEstEq(
short *pDataInO,
short *pDataInl,
STRU_PUCCH_DTX_CHEST_EQ_PARA *pStruPucchDtxChEstEqPara,
unsigned char *pPucchDtxFlag,
short *pDataOut,
)°
格式1/la/lb实现流程如图4-10所示：

是

结束
、 	丿
图4-10 PUCCH格式1/la/lb信道估计均衡流程图 流程中涉及到的算法有：
53
信道估计及均衡：
1）	取出每个用户数据DataZCed,将其分成数据部分DataZCed[dataIdx][12]和参考 信号 DataZCed[rsIdx][12],其中 dataldx =0,1,5,6, rsldx =2,3,4；
2）	参考信号DataZCed[rsIdx][12]每个符号的12个子载波值相加后与并进行解扩， 得到信道估计值CE,并计算信道功率powerH；
3）	数据部分DataZCed[dataIdx][12]每个符号的12个子载波值相加后，对数据部分 4个符号进行解扩，得到dataBefbreEq；
4）	dataBefbreEq乘以信道估计CE的共氟 得蓟每个用户一个时隙上均衡植 dataEqed[TsIdx]。
噪声估计和DTX判决：
D数据部分DataZCed[dataIdx][12]每个符号的12个子载波值相加后，对其4个符 号进行不同于上述数据的解扩，得到该时隙噪声项，计算功率NoisePower。
2）将两个时隙上NoisePower相加，也将两个时隙上powerH相加，然后两天线上 NoisePower和powerH加权，判断得到是否为DTX。
格式2/2a/2b的处理过程为：
1）	取出每个用户数据DataZCed,将其分成数据部分DataZCed[dataIdx][12]和参考 信号 DataZCed[rsIdx][12]» 对于常规 cp,对于格式 2, dataldx =0,2,3,4,6 为数据部分，rsldx =1,5为参考信号部分；对于格式2a/2b, rsldx =0,2,3,4,5,6为数据部分，rsldx =1为参考 信号部分。
2）	对DataZCed [rsldx][12]的12个子载波值相加，将两个或1个符号和并共辘，得 到信号估计值；
3）	将DataZCed [dataldx][12]的数据部分12个子载波相加得到数据解扩值 dataBefbreEqe[6]；
4）	将dataBeforeEqe[6]中每个值与信道估计值共轴分别相乘，即得到每个用户一个 时隙上均衡值dataEqed[6]o
4.3.5解调解扰功能设计
实现函数为
void Pucch DemoDeScrmb （
short *pDataIn,
unsigned char *pAckNack,
char *pCsiSoftBit
）°
对于格式la/lb和格式2a/2b中的ACK7NACK信息,解调流程如图4-11左图所示； 格式2/2a/2b中的CSI信息，其解扰解调过程如图4-11右图所示。具体的算法描述可以 参见第三章。
54


图4-11解调解扰模块流程图，ACK/NACK （左），CSI （右）

4.3.6 Reed-muller译码功能设计
实现函数为
void Pucch DeReedMuller （
char *pDataIn,
STRU PUCCH REEDMULLER PARA * pPucchReedMullerPara unsigned char *pDataOut,
）°
ReedMuller译码只作用于PUCCH格式2/2a/2b中的CSI。具体实现过程为：
1）	将输入的软比特变为双极性数据，将20bit数据后添12bit的0,变为32bit；
2）	消除掩码影响：7个掩码序列可以产生128个掩码矢量（存于masktable中）， 这些掩码矢量分别与接收码字相乘后即可消掩；
3）	利用交织表对数据进行交织，交织表为interleaver[32]；
4）	将交织后的数据128*32进行快速哈达玛变换（FHT）,找出输出数据128*32的 绝对值最大的数（数值，数所在的行号、列号）；
5）	对处理后的数据进行译码：译码的第0位，正号译为0,负号译为1；译码1〜5 位为列号；译码6〜12位为行号。
55
4.4测试验证
4.4.1测试方法
利用计算机软件Matlab的仿真软件平台，使用PUCCH仿真链路中的发射机模块和 信道模块，模拟产生空口数据；使用接收模块来产生测试节点的输入数据。对于测试节 点的定义见下一小节。对于单元测试，我们将每个测试节点的节点数据输入DSP当中 进行测试；对于离线测试，我们将模拟的空口数据注入DSP平台中运行，查看结果是 否与Matlab运行的结果一致，来验证DSP平台代码的有效性。我们还使用开发环境提 供的软件分析工具统计运行时间，来确定是否能在足够的时间内处理完成整个PUCCH 链路。
本文对DSP平台上的PUCCH链路进行了单元测试与离线测试，通过单元测试对实 现过程的每一个模块进行测试，通过离线测试对PUCCH整个链路进行测试。
4.4.2单元測试
本文首先对DSP上的实现代码进行了单元测试，如图4-12所示，从上到下四个模 块分别为对应PUCCH处理过程的4个任务，模块中的数字为测试节点编号。每个测试 节点的数据来源与输出的数据的结构在表4-8中给岀。其中节点1输入数据由CoreO给 出，由Matlab仿真出的空口数据模拟得到，因此每个节点的输出内容也应该与对应测 试数据的Matlab的输出一致。


图4-12 PUCCH模块结构划分
56

表4-8 PUCCH测试节点定义
NO.	测试节点定义	来源	数据结构
1	时隙号0-19	corcO
2	不同用户的ncs, noc 初始输入数据	M3,计算	g aFFTData [14*1200*2* ANT_NUM]
3	不同用户的ncs, noc 初始输入数据	M3,计算	g aFFTData [14*1200*2 * ANT_NUM]
4	去除ZC相关后的数据	eNBRxPucchZcDeCorr	AZC[C MAX N USER* 12* 14*2]
5	不同用户的ncs, noc 初始输入数据	M3,计算	g aFFTData [14*1200*2* ANT_NUM]
6	不同用户的ncs, noc 初始输入数据	M3,计算	g aFFTData [14*1200*2*
ANT_NUM]
7	　　去除ZC相关后的数据	eNBRxPucchZcDeCorr	DataAZC[C_MAX_N_USER* 12* 1
4*2]
8	均衡后的数据	eNBRxPucchDTXChEstEq	　DataAEq[C_MAX_N_USER* 12]
9	解调解扰后的数据	eNBRxPucchDemoDeScrmb	ACK/NACK.RI.未解码的 CSI
10	　　　　解码后的CSI	eNbRxPucchDeReedMuller	l-13bit

我们使用Matlab ±行链路的仿真平台，根据不同的高层配置，在每个节点产生多 组测试向量，对每个节点的输出进行测试，输出结果均与Matlab ±行链路仿真平台的 输出相一致，这里就不再逐一列举测试用例了。
4.4.3离线测试
本文对格式1、格式la、格式lb、格式2、格式2a和格式2b分别使用不同的测试 用例来进行测试。表4-9给出了 PUCCH链路离线测试的部分测试用例列表。
表4-9 PUCCH链路部分测试用例列表
测试用例编号	测试项目	测试代码及测试数据文件
TEST_PUCCH_2_001	单用户，测试PUCCU整个链路在格式1下能 否正确工作，有SR	pucchTestCaseOOl Dataln.h
以及高层参数配置信息
TEST_PUCCH_3 _002	单用户，测试PUCCH整个链路在格式1下能 否正确工作，无SR	pucchTestCase002Datal n .h
以及高层参数配置信息
TEST_PUCCH_6 003	单用户，测试PUCCH整个链路在格式格式la 下能否正确解出NACKo	pucchTestCase003 Dataln.h
以及高层参数配置信息
TEST_PUCCH_7 _004	单用户，测试PUCCH整个链路在格式格式la 下能否正确解出ACKO	pucchTestCase004 Dataln.h
以及高层参数配置信息
TEST_PUCCH_8 _005	单用户，测试PUCCH整个链路在格式格式1 b 下能否正确解出NACK/NACK。	pucchTestCase005 Datal n. h
以及高层参数配置信息
TEST_PUCCH_ll_006	单用户，测试PUCCH整个链路在格式格式lb 下能否正确解出ACK7ACK。	pucchTestCase006 Dataln.h
以及高层参数配置信息
TEST_PUCCH_12_007	单用户，测试PUCCH整个链路在格式格式2 下能否正确解码出4bit的CSI	pucchTestCase007DataIn.h
以及高层参数配置信息

57

表4-9 PUCCH链路部分测试用例列表（续上表）
测试用例编号	测试项目	测试代码及测试数据文件
TEST_PUCCH_15_009	单用户，测试PUCCH整个链路在格式格式2a 下能否正确解出4比特CSI和NACK	pucchTestCase009DataIn.h
以及高层参数配置信息
TEST_PUCCH_16_010	单用户，测试PUCCH整个链路在格式格式2a 下能否正确解出8比特CSI和ACK	pucchTestCaseO lODataln.h 以及高层参数配置信息
TEST_PUCCH_19_011	单用户,测试PUCCH整个链路在格式格式2b 下能否正确解出4比特CSI和ACK/NACK	pucchTestCaseO 11 Dataln.h
以及高层参数配置信息
TEST_PUCCH_20_012	单用户，测试PUCCH整个链路在格式格式2b 下能否正确解出8比特CSI和ACK/ACK	pucchTestCaseO 12 Dataln.h
以及高层参数配置信息
以测试用例TEST_PUCCH_12_007和测试用例TEST_PUCCH_16_010为例。
4.4.3.1 测试用例 TEST_PUCCH_12_007
用例编号：TEST PUCCH 12 007；
测试内容：单用户，测试PUCCH整个链路在格式2下能否正确解码出4bit的CSI； 测试步骤：
1.调用函数eNBRxPucch Handle,按照matlab配置参数；
2,检验译码后的decodedBits是否正确； 输入数据：pucchTestCase007DataIn.h
高层参数配置表信息如表4-10所示； 被测代码：Core。和Core4各个函数的代码； 预期输岀：期望输出CSI值为1010；
u8 WideBandCqi Value0= 10。
表4-10 TEST PUCCH 12 007部分配置参数
C	elllnfb 控制	配置值	Cellinfo 控制	配置值
Cellld	1	　　　　PhyCellld	80
UlBandWidthlndex	0 (10M)	　　　　UICpType	　　0 (Normal cp)
SubSfnConifg	0	　　SSubSfnConflg	7
UlSeqGroupHoppingFlag	0	　　SeqHoppingFlag	0
u8N2Rb	1	NICs	6
DeltaPucchShift	3	N1 Pucch	4
Radio link into 控制	配置值	　　Radio link info 控制	配置值
Cellld	1	Crnti	0
ISrs	0	UeMId	0
nPUCCH2	14	　　AckCodingMode	0
subframe 控制	配置值	subframe 控制	配置值
AirFrameNum	1	　　　　u8Cell!d	1
NumOfPUCCHUe	1	　　u8NumOiPUSCHUe	0
Pucch	　　UE	参a	故名	值	参数名	值
子帧控制	BandType	0	Bandlype	　　　　　1
aPucchPa	TransMode	0	TransMode	　　　　　1
ra	　　UEl	UeMId	0	　　　　NumOfLayers	　　　　　0
nPUCCHl	4	　　　　PMIRIReportFlag	　　　　　0
UciFormat	FORMAT2
58
4.4.3.2 测试用例 TEST_PUCCH_16_010
用例编号：TEST_PUCCH_16_010；
测试内容：单用户，测试PUCCH整个链路在格式2a下能否正确解出8比特CSI 和 ACK；
测试步骤：
1.调用函数eNBRxPucch Handle,按照matlab配置参数；
2.检验 pPhyMacHarqInd->HarqProcess[NumOfA.ckUe].Ack 是否正确；
3.检验译码后的decodedBits是否正确；
输入数据 pucchTestCaseO 1 ODataln.h:
高层参数配置表信息如表4-11所示；
被测代码：Core。和Core4各个函数的代码；	-
预期输出：8bitCQI(01U0001)+ACK；
u8WideBandCqiValueO=7 ；
u8WideBandCqiValue 1 =7 ；
表4-11 TEST PUCCH 16 010部分配置参数
Celllnfb 控制	配置值	Cellinfo 控制	配置值
Cellld	1	PhyCellld	80
UlBandWidthlndex	1 (20M)	UlCpType	0 (Normal cp)
SubSfnConifg	0	SSubSfhConfig	7
UlSeqGroupHoppingFlag	0	UlSeqHoppingFlag	0
N2Rb	1	NICs	6
DeltaPucchShift	3	N1 Pucch	4
Radio link into 控制	配置值	Radio link into 控制	配置值
Cellld	1	Crnti	0
ISrs	0	UeMId	0
nPUCCH2	1	AckCodingMode	0
subframe 控制	配置值	subframe 控制	配置值
AirFrameNum	1	Cellld	1
NumOfPUCCHUe	1	NumOfPUSCHUe	0
Pucch 子帧控制 aPucchPa ra	UE	参数名	值	参数名	值
UE1	BandType	1	NumOfLayers	2
TransMode	5	PMIRIReportFlag	1
UeMId	0
nPUCCH2	1
UciFormat	FORMAT_2a

4.43.3离线测试小结
我们将PUCCH链路的所有模块级联起来，进行了离线测试，测试结果表明，PUCCH 整条链路在DSP上实现的代码所运行的结果与Matlab仿真平台产生的结果相一致。
59
4.4.4运行时间统计
每个函数的运行时间根据PUCCH格式的不同而有所差异，总体上来看，格式1/la/lb 运行的时间略小于格式2/2a/2b行的时间，测试用例TEST_PUCCH_7 _004和 TEST_PUCCH_12_007得出的具体数据见表4-12。
表4-12 PUCCH函数运行时间统计
任务	函数	耗费时间(格式la) (us)	耗费时间(格式2) (us)
Job_PUCCH_Symb31nt	PucchNcsNocCal	7.25	5.722
Pucch ZcDeCorr	15.892	16.148
Job_PUCCH_Symb6Int	PucchZcDeCorr	13.152	13.246
Pucch DTXChEstEq	16.088	16.928
JobPUCCHSymb 1 OInt	PucchZcDeCorr	16.548	16.3
Job_PUCCH_Symbl3Int	PucchZcDeCorr	13.336	13.412
Pucch DTXChEstEq	16.724	16.332
PUCCH DemoDeScrmb	7.24	11.85
总计	106.23	109.938

从总的处理时间上来看，本文在DSP上实现的PUCCH链路处理一个用户大约需要 O.llmSo
4.5本章小结
本章完成了 PUCCH在多核DSP平台上的设计与实现。本章首先对Freescale MSC8157多核DSP及其开发环境进行了介绍，然后给出了在该多核DSP平台上TD-LTE 系统的总体框架。我们使用了其中一核来完成PUCCH的处理，并对核间的接口以及核 内部的函数功能以及人物划分逬行了详细的设计。
在实现了该系统之后，本章使用测试用例来逬行测试验证，证明了该系统的正确性; 给岀了 PUCCH处理过程所需要的时长，证明了在一定用户数下该系统能够达到实时处 理的要求。
60
第五章总结与展望
5.1论文总结
TD-LTE系统己经逐渐在全国各地开始使用，其上网速度能够达到TD-SCDMA几 十倍，使无处不在的高速网络成为可能。物理上行控制信道是TD-LTE中非常重要的信 道，它所承载的上行控制信息对LTE系统调度和链路自适应技术有着非常大的影响，在 eNodeB端对该信道信息的正确解析并且及时的上报给高层至关重要，信号检测与接收 算法是非常值得研究的问题。本文围绕TD-LTE系统中的物理上行控制信道，对其检测 与接收算法进行了研究，并对重点的模块进行了仿真和DSP的设计与实现。
本文首先对TD-LTE的物理层的基本知识进行了介绍，包括帧结构、物理资源和部 分关键技术，目的是对物理层有大致的了解。然后对物理上行控制信道的上行控制信息 的编码调制和发送过程做了详细的描述。在论文的第三章，我们针对不同的PUCCH的 发送格式，对不同格式的承载的控制信息和对控制信息的检测与接收算法进行了重点研 究。格式1承载调度请求信息SR,格式la/lb承载混合自动重传请求HARQ的反馈信 号ACK7NACK,格式2包含了信道状态信息CSL格式2a/2b在格式2的基础上绑定了 1个符号的HARQ反馈信息ACKTNACKo对格式1/la/lb,先检测信号是否存在，若存 在才对其解析；对格式2/2a/2b,本文除了给出了传统的Reed-muller的接收算法之外， 还给出了一种半盲检的接收算法，并且在Matlab仿真平台上对两种算法进行了对比。 在第三章的最后，本文对这种半盲检的接收算法在计算量上进行了优化。本文的第四章 在Freescale MSC8157多核DSP上对TD-LTE系统的物理上行控制信道进行了 DSP设计 与实现，通过实际运行在DSP上的代码，将结果同Matlab仿真平台的结果对比，并利 用CodeWarrior的时间统计工具，证明了代码的正确性和及时性。
5.2未来展望
本论文在一些方面还需要改进和完善。本文在第三章描述的半盲检测接收算法，在 格式1/la/lb的情况下与传统算法性能相当，因此在格式1/la/lb情况下采用传统算法较 好。格式2的性能明显好于传统的算法。对于格式2a/2b,该算法的的性能如何，本文 并没有讨论，在今后的研究中我们可以对该算法进行更加完备的讨论。
虽然本文在第三章给出了性能更加优秀的半盲检测的接收算法，并且对其计算量进 行了优化，但是在第四章具体到DSP实现上，仍然使用了传统的接收算法。在格式2 的情况下，处理一个用户需要花费0.11ms,考虑多用户的情况，如果所有用户的PUCCH 发送格式均为格式2,该DSP上的代码仅能支持9个用户。因此下一步的工作是对DSP 上的PUCCH链路各模块的代码进行优化，尽可能的缩短处理时间，这样可以处理更多 的用户，或者支持性能更优但计算量较大的算法。
61
参考文献
[I]许爱装，陈传红.TD-LTE的发展概况[J].《移动通信》.2008(23):21-24.
⑵ Erik Dahlman, Stefan Parkvall, Johan Skold and Per Berning. 3G evolution: HSPA and LTE for Mobile Broadband[M]. 2nd ed.2008 Elsevier Ltd ISBN: 978-0-12-374538-5.
[3]刘晶.UTRA-UTRAN长期演进与3GPP系统结构演进[J].《科技风》.2009(2):64.
[4]3GPP TS 36.211 V9.1.0 (2010-03), Evolved Universal Terrestrial Radio Access (E-UTRA); Physical channels and modulation (Release 9)[S].
[5]赵光辉.LTE系统中控制信道的检测技术[D].北京邮电大学:北京邮电大学.2012.
[6]王文博，郑侃.宽带无线通信OFDM技术[M].人民邮电出版社,2003.
[7]Farhoodi A A,Biguesh M.Robust ML detection algorithm for MIMO receivers in presence of channel estimation error[C], Personal,Indoor and Mobile RadioCommunications,2006 IEEE 17th International Symposium on.IEEE,2006:l-5
[8]沈嘉，索士强,全海洋等.3GPP长期演进(LTE)技术原理与系统设计.人民邮电出版社,2008.
[9]3GPPTS 36.213 V9.3.0 (2010-09) Evolved Universal Terrestrial Radio Access (E-UTRA); Physical layer procedures (Release 9)[S].
[10]3GPP TS 36.212 V9.4.0 (2011-09) Evolved Universal Terrestrial Radio Access (E-UTRA); Multiplexing and channel coding (Release 9)[S].
[II]赖国清.LTE上行控制信道信号检测算法设计[D].华南理工大学:华南理工大学.2012.
[12]任旭.TD-LTE物理上行控制信道接收端的研究与实现[D].重庆邮电大学:重庆邮电大学.2013.
[13]高冬冬.TDD-LTE上行链路信道估计算法研究[D].西安电子科技大学：西安电子科技大学.2011.
[14]3GPP TS 36.104 V9.13.0 (2012-09) Evolved Universal Terrestrial Radio Access (E-UTRA); Base Station (BS) radio transmission and reception(Release 9)[S].
[15]Texas Instruments, R1-080190: Embedding ACK/NAK in CQI Reference Signals and Receiver Structures[C], www.3gpp.org, 3GPPTSG RAN WG1, meeting 5Ibis, Sevilla, Spain, January 2008.
[16]Ilya Dumer. Soft-Decision Decoding of Reed-Muller Codes:A Simplified Algorithm[J].IEEE Transactions on Information Theory,2006,52(3):956-963.
[17]F Yang. Soft-decision decoding of Reed-Muller codes based on simple multi-stepSISO module[J].IEE Proc.-Commun 2005, 152(2):144-150.
[18]陈发堂，何坚龙.LTE系统中Reed-Muller编译码算法[N].重庆邮电大学学报,2010.8,Vol.22,N0.8.
[19]连立杰.LTE中的Reed-Muller编译码方法及实现[J].中国科技论文在线.
[20]陈乔.基于Intel通用处理器LTE上行链路的设计与实现[D].北京邮电大学:北京邮电大学.2012.
[21]Cui. T, Tellambura. C. Semiblind channel estimation and data detection for OFDM sytems with optimal pilot design[J]. IEEE Transcations on Communications, vol. 55, pp. 1053-1062, May 2007.
[22]Hu Yang, Astely.D. Semi-Blind Multi-User Detection for LTE PUCCH[C]. IEEE. Wireless Communications and Networking Conference, pp. 1-5, April 2009.
[23]Sandrine Boumard. Novel noise variance and SNR estimation algorithm fbr wireless MIMO OFDM systems[C]. GLOBECOM 2003. IEEE, 2003, vol. 3: 1330-1334.
[24]Freescale Semiconductor. MSC8157 Six-Core Digital Signal Processor. 2013.
[25]Freescale Semiconductor. Software Analysis Tips and Tricks Using CodeWarrior for StarCore DSPs. 2011.
[26]Sirnko M, Wu D, Mehlfahrer C.Implementation aspects of channelestimation for 3GPP LTE terminals[C]. Wireless Conference 2011-SustainableWireless Technologies(European Wireless), 11th European. VDE, 2011:1-5.
62
参考文献
[27]Li Xiao wen,Pan Di, Implementation of LTE-TDD uplink channel estimation based on DSP[J]. Journal of Chongqing Univerity of Posts and Telecommunications(Natural Science Edition), vol.22,no.l,: 14-18,Feb.2010.
[28]Dan Wang, Shizhong Yang, Yong Liao,Yu Lm.EfBcient Receiver Scheme for LTE PUCCH[J].IEEE COMMUNICATIONS LETTERS, 2012, 3,VOL.16,NO.3・
[29]Icaro L.J.Da Silva, Andre L.F. de AImeida.Multiuser Receiver for PUCCH Signaling with Transmit Diversity[JJ.2011 IEEE 12th International Workshop on Signal Processing Advances in Wireless Communications.
[30]陈世民.LTE上行控制信道技术研究与DSP实现[D].武汉理工大学:武汉理工大学.2012. f
63
自2012年6月进入范网无线通信教育部重点实验室以来，己经过了三个春夏秋冬。 在这里，我包涵诚挚的心情，对同窗的同学、热情的师兄师姐、敬爱的导师以及在背后 默默支持我的家人表示深深的感谢！正因为有了你们给予的帮助和指导，我才能取得至 今的进步与成绩。
首先感谢我的导师胡春静老师，胡老师对我的日常生活与学习方面给予了悉心的指 导，帮助我克服学业上的困难，渡过难关。
感谢实验室的彭涛老师，彭老师是无线移动通信领域的专家，对LTE的知识有着深 入的研究，除了丰富的理论知识之外，彭老师还有着相当丰富的项目经验。在实验室的 三年多的时间当中，我跟着彭老师先后参与了两个重大项目，彭老师带领我们推进项目， 帮助我们解决项目中遇到的种种难题，在物理层的算法方面给予我们启迪。在彭老师的 悉心指导下，我不仅对第三代移动通信和第四代移动通信有了更为深入的了解与研究， 也对项目开发的流程和方法有了一定的认知。
感谢实验室的林德平老师，林老师在TD-SCDMA方面有着非常深入的研究，在DSP 开发方面有着雄厚的基础以及丰富的经验。林老师对我在TD-SCDMA物理层的学习上 悉心指导，在对协议的学习以及对DSP软件开发上有着莫大的帮助，在Matlab仿真和 DSP代码的编写方面也给予了我非常多的帮助。
感谢实验室的王文博老师，王文博老师管理着整个实验室，让实验室成为一个科研 氛围浓厚、团结互助的大家庭。
感谢12级3班的全体同学，我丰富多彩的研究生生活离不开3班这个大家庭，一 同娱乐、一同学习、一同进步；感谢范网无线通信教育部重点实验室的师兄师姐，你们 在实验室所做的积累以及对我们的指导是我们成功的基础；感谢胡楚君和谢丽君师妹， 有了你们的帮助才能让项目完成的更加出色。
感谢实验室所有和我一同学习与进步的同学们，三年的时间里，有你们的陪伴我非 常荣幸和开心，在这里我祝大家前程似锦。
感谢我的父母，你们无私的在背后默默的支持着我的生活和学习，是给我的最大的 动力，你们的爱是我在求学道路上最大的精神支柱，我将在今后的工作中报答你们。
最后，感谢参与本论文评审的专家和教授们，您们辛苦了，感谢你们！
64
攻读学位期间发表的学术论文目录
[1] Pang Yilong, Hu Chunjing, Peng Tao. An Optimization based on semi-blind detection for LTE PUCCH.Chinacom 2014.Aug 2014.
65
