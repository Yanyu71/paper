
第一章绪论
1.1移动性管理的产生和发展
近年来，随着移动互联网技术的飞速发展，智能终端的数量急剧增长。由智 能手机和平板电脑产生的移动流量要远远大于台式机和PC端产生的流量，因此， 为了满足互联网中大量的移动终端的需求，移动性管理技术越来越重要，成为了 未来通信网络中最具挑战也最有研究价值的技术之一⑴。
传统的IP移动性协议如基于集中式的移动锚点，移动锚点为所有注册的移 动节点提供移动性支持。当提出这些协议时，移动网络架构是基于集中分层的架 构，因此当时考虑部署的是集中式的移动锚点。基于主机的移动IPv6协议 (MIPv6),选择了家乡代理(HA)作为移动锚点；还有基于网络的代理移动IPv6 协议(PMIPv6),选择了本地移动锚点(LMA)作为移动锚点。集中的移动锚点 不仅管理移动节点的移动上下文，还管理接入节点的数据通信，因此集中式移动 性管理协议可以很容易的控制移动上下文和路由、气
集中式移动性管理方案最初是为语音通话设计的，语音通信一般并不是爆发 式的通信，更多的是可预测的通信，而现在随着互联网通信流量的迅速增长，集 中式移动性管理已经逐渐不再适合当前的网络发展。也就是说，随着网络通信流 量的激增，集中式移动性管理的优势正在逐渐缩减例如，集中式的移动锚点， 管理着网络中中所有节点的移动上下文和路由，随着注册节点数量的增加可能会 造成单点失败的问题。而且集中式移动锚点还可能会导致次优路由因为所有发往 移动节点的数据都需要首先路由到集中式移动锚点然后再发往目的地，因此会降 低端到端通信的性能。
为了适应现在移动网络流量的飞速增长，具有扁平化移动网络架构的分布式 移动管理引起了国际上通信和网络协会的注意。在分布式移动管理架构中，移动 锚点分布的部署在接入网络层面，移动节点可以找到与它相近的一个锚点来为它 服务。因此，网络中的节点可以接入到不同的移动锚点，则与节点相关的数据流 量就自然是分散式的并且可以得到最佳的路由，因为移动锚点是用户接入网络的 第一个路由器同。此外，一个移动锚点的失败只会影响接入这个锚点的移动节点, 因此，不会产生单点失败的问题。
分布式部署的移动锚点解决了集中式移动性管理方案中的单点失败和三角路由的问题。但分布式移动性管理方案仍存在着一些不足之处，如用户需要拓展 支持多个IP地址，以及方案仍存在转发路径非最优的问题，还有随着用户移动 不断增长的隧道开销等。因此人们对下一代网络移动性管理的探索从未停止。随 着人们对移动性管理的研究越来越深入，人们发现软件定义网络技术和网络功能 虚拟化技术在移动性管理方面存在着很大的研究价值，近年来关于将SDN/NFV 应用到移动性管理中的文章也不在少数，具体的研究情况将在之后进行介绍回。
总的来说，移动性管理技术使得移动节点在切换时能够保证通信和网络服务 不间断。近年来互联网的飞速发展使得对移动性管理的需求不断增大，传统网络 架构的移动性支持己经逐渐不能满足用户的需求，因此推动了人们对下一代网络 架构的研究。
1.2传统网络中移动性管理相关研究
1.2.1 移动IPv6协议(MIPv6)
移动IPv6协议，是一个基于主机的移动性管理协议。因此需要修改终端的 协议栈来支持移动性管理。IETF工作组对移动IPv6协议进行了标准化。
MIPv6协议是一个基于主机的移动性管理协议，因此需要修改MN的协议栈。 当移动节点切换到新的网络时，外地链路会为节点分配转交地址，而节点的家乡 地址则依然保留，在节点的家乡代理上缓存节点的HoA和CoA的绑定关系。这样 节点移动前的数据通信会被首先路由到家乡代理，再由家乡代理通过隧道进行转 发。因此当节点移动到新的链路时依然保持着原来的数据通信不中断。
如图1-1所示是MIPv6协议的移动性管理架构，协议的数据通信流程如图中 箭头所示。MN的家乡代理为HA,家乡地址为HoA, MN从家乡链路AR1移动到外 地链路AR2,外地链路AR2为其配置转交地址CoAo AR2向HA发送消息绑定MN 的家乡地址和转交地址。由于对端节点CN并不知道MN发生了移动，所以CN依 然向HoA发送数据，则数据会首先到达家乡代理，然后家乡代理将数据封装后通 过隧道转发到MN的新位置AR2,再由AR2将数据转发给MN。

图1-1 MIPv6协议架构

由上述通信过程可知，MN和CN之间的通信存在三角路由的问题。为了解决 三角路由问题，MIPv6协议引入了路由优化机制。当移动节点收到来自对方的数 据后，判断CN还不知道MN的转交地址，则MN向CN发送它的转交地址，CN收 到后缓存MN的HoA和CoA之间的绑定信息，则之后CN可以直接向MN的转交地 址发送数据,数据可不经过HA直接到达MN的转交地址，避免了三角路由的问题。
1.2.2代理移动IPv6协议(PMIPv6)
代理移动IPv6协议是一个基于网络侧的移动性管理协议。与MIPv6协议不 同的是，PMIPv6中主机不需要参与移动性相关信令，由网络侧实体代替主机来 进行IP移动性的相关管理。
MIPv6协议上面己经介绍过，在MIPv6中需要主机向家乡代理发送移动性管 理信令，在家乡代理中创建并维护家乡地址和转交的地址的绑定缓存。因此 MIPv6协议是基于主机的，需要修改主机的协议栈。PMIPv6协议提供了另一种方 法来解决IP移动性问题。在PMIPv6中，无需主机参与移动性相关信令，而由网 络侧的实体来代替节点管理移动性相关的信令。IETF工作组对移动PMIPv6协议 进行了标准化。
在PMIPv6协议中负责代替节点管理移动性相关信令的实体是LMA和MAG°LMA 中缓存着移动节点的位置信息，维护节点的可达性。MAG是节点的直接接入锚点， 负责处理节点的接入请求，对节点进行身份验证，并代替节点执行移动性相关信 令等。MAG监测接入链路中节点的移入和移出并向LMA创建绑定注册。在PMIPv6域中可以有多个LMA,每个LMA服务于一组不同的移动锚点。PMIPv6架构如图
1-2所示。

图1-2 PMIPv6协议架构
图1-3 PMIPv6网络节点接入流程

MN初始接入网络为MAGI, MAG1收到MN的接入请求后，识别MN的身份。当 MN身份验证成功后，MAG1为MN分配家乡网络前缀。然后MAG1通过绑定更新/ 绑定确认消息向LMA进行注册。LMA收到PBU消息后，创建绑定缓 存条目，并 建立了和MAG1之间双向隧道的一端。MAG1收到代理绑定确认消息后，建立双向 隧道的另一端。然后MAG1向移动节点发送路由公告消息，公告节点的家乡网络 前缀。收到路由公告消息后，移动节点使用固定或无状态的地址配置协议配置 IP地址。如图1-3所示是节点MN接入MAG1的信令流程。此时的数据通信流程 为，对端节点将数据发送至LMA, LMA通过其上缓存的映射信息判断得知此时MN 接入到P-MAG,因此LMA通过隧道将数据转发至p-MAGo p-MAG收到数据后，进 行处理后转发给MN。

图1-4 PM IPv6网络节点切换流程
如图1-4所示是移动节点从之前接入的移动接入网关p-MAG切换到新的移动 接入网关n-MAG的呼叫流程。这个呼叫流程只反映了一个可能的信息次序，并不 是固定的。MN在p-MAG中获得了初始的家乡地址，通过绑定更新/绑定确认消息 在LMA中进行注册，并在p-MAG和LMA之间建立了双向隧道用于数据的转发，具 体信令流程如图1-3□此时MN从p-MAG切换到n-MAG, p-MAG检测到MN的移出 后，p-MAG通知LMA删除MN的绑定路由状态。LMA接收到这个请求后，等待一段 时间，允许n-MAG更新绑定缓存。然而，如果在给定时间内它没有收到任何PBU 消息，则LMA判断MN已经移出此网络，将会删除MN的绑定缓存条目。
MN接入n-MAG, n-MAG检测到接入链路的移动节点后，将会通知LMA更新绑 定缓存，并在n-MAG和LMA之间建立双向隧道用于数据的转发，具体流程如图 1-3O然后n-MAG将会发送包含移动节点家乡网络前缀的路由确认消息（RA）给 MN,这会保证移动节点感受不到三层的接入接口的变化。此时的数据通信流程为, 对端节点将数据发送至LMA.LMA通过其上缓存的映射信息判断得知此时MN接入 到n-MAG,因此LMA通过隧道将数据转发至n-MAG。n-MAG收到数据后，进行处 理后转发给MN。
1.3移动性管理面临的挑战
在上面描述的传统网络中的集中式移动性管理方案MIPv6和PMIPv6中，锚 点的集中式部署方便了对网络中节点的统一管理，但随着网络通信流量的激增， 集中式移动性管理的优势正在逐渐缩减。如管理着网络中中所有节点的移动上下文和路由的集中式移动锚点，随着注册节点数量的增加可能会造成单点失败的问 题。而且集中式移动锚点还可能会导致次优路由，因为所有发往移动节点的数据 都需要首先路由到集中式移动锚点然后再发往目的地，即所谓的三角路由。因此 会降低端到端通信的性能。而且在上面的两个集中式移动性管理方案中，都需要 为移动节点分配家乡地址和转交地址，这造成了传统IP网络架构的双重语义问 题。而且需要拓展终端使其能够支持多个IP地址，这增加了方案部署的困难。
为了解决集中式移动性管理方案中存在的问题，IETF工作组提出了分布式移 动性管理(DMM)的概念。在DMM方案中移动锚点是分布式部署的，解决了集中 式移动性管理方案中由于集中部署锚点带来的单点失败和三角路由的问题。这是 对集中式移动性管理方案的改进，但DMM方案并不完美，它仍存在以下的移动性 管理问题。
(1)目前IETF DMM方案中，用户在切换过程中的需要的移动上下文信息需 要移动锚点通过信令向集中的位置管理实体CMD获得，而移动锚点和CMD 一般相 距较远，因此IETF DMM方案中用户的切换时延较长，对一些实时性要求较高的 业务会有一定的影响；而且方案中仍然存在数据包转发路径非最优的问题。在 IETF DMM方案中，节点从sMAAR切换到nMAAR后，需要更新路由器中的绑定缓 存条目，并在sMAAR和nMAAR之间建立双向隧道。用户在切换前的通信仍然先到 达sMAAR, sMAAR收到数据后，发现节点此时并不在sMAAR上，然后sMAAR通过 隧道将数据转发到nMAAR上。从上述过程可知，用户在切换前的会话先到达家乡 锚点，再由家乡节点通过隧道转发到当前锚点，即数据包的转发路径并不是最优 的。
(2)方案中节点从家乡锚点切换到当前锚点后，需要在节点的家乡锚点和 当前锚点之间建立双向隧道用于转发数据，因此为方案增加了额外的隧道开销。 而且节点每移动到一个新的锚点，都需要建立新的双向隧道，因此双向隧道的数 量不断增加。则建立和管理隧道所需要的开销也不断增加。
(3)分布式移动性管理方案需要对终端进行扩展，节点每次接入新的网络 都必须获取新的IP地址，这使得移动终端必须扩展能够支持多个IP地址。
在文章的第三章中，基于以上几个问题，我们提出一个基于虚拟化的分布式 移动性管理方案来解决它们，并对提出的方案的性能进行了数学建模和性能分 析。
除了上面分析的分布式移动性管理方案中存在的问题，移动性管理中的资源 优化问题也一直是人们关注的重点。众所周知，现有的WLAN网络中普遍存在一 个问题，就是AP负载不均衡的问题。最近几年，随着互联网络的飞速发展，智 能移动终端的数量也在迅速增长。在2014年无线网络的渗透率己经就己经增长到了 91. 5%,而这个数字在8年前才是14%。为了满足无线网络WLAN中用户的流 量负载，我们周围部署了越来越多的AP。而且AP的数量还在不断的增长。在一 些场景中（如会议，教室等），数以百计的无线设备试图在短时间内连到一个 AP上，这有可能会导致AP过载。而在无线网络WLAN中AP过载会造成吞吐量低 和负载不均衡的问题。因此在这些场景中，负载均衡变成了一个非常严重的问题。
在文章的第四章中，首先分析了目前网络中存在的AP负载不均衡问题，并 对这个问题提出了一个自适应负载均衡算法,介绍了算法的执行过程并给出了算 法的代码，最后对算法进行仿真模拟，给出仿真结果并进行分析。通过仿真结果 可知，文章提出的自适应负载均衡算法解决了网络AP负载不均衡的问题，提高 了网络的吞吐量。
1.4论文的组织结构
第一章主要介绍了移动性管理的产生和发展过程。介绍了两个集中式移动性 管理协议MIPv6和PMIPv6的网络架构和方案的主要场景，分析了目前移动性管 理面临的研究现状以及面临的挑战。
第二章主要介绍了分布式移动性管理的发展情况，包括部分分布式和完全分 布式移动性管理方案的整体架构和方案流程,分析了两个方案的优势和存在的不 足之处。然后介绍了下一代网络移动性管理的两个关键技术,软件定义网络（SDN） 和网络功能虚拟化（NFV）。介绍了这两个技术的体系架构，功能优势以及目前 的研究现状。
第三章主要是对本文提出的分布式移动性管理优化方法的设计与实现。首先 分析现有分布式移动性管理方案存在的切换时延较长、转发路径非最优、以及隧 道开销等问题。为了解决上面的问题，提出了本文的基于虚拟化的VDMM方案。 方案釆用了虚拟化的设计思想，为网络中每一个接入用户分配一个唯一的虚拟 AP,将用户的切换转换为虚拟AP的切换。由于虚拟AP拥有链路层和网络层中连 接建立所需的相关状态信息，用户切换后能够迅速与新的网络建立连接，缩短了 用户重新建立连接的时间，减少切换时延；同时，该方法不需要建立双向隧道， 减少了隧道开销。接着介绍了方案的主要场景和信令潦程。方案的场景包括用户 接入AP、用户从一个AP切换到另一个AP以及用户在切换前，切换中和切换后 的数据通信流程。然后对提出的VDMM方案进行了数学建模和性能分析。根据方案的主要场景和信令流程，分析了用户在切换过程中信令流程，对VDMM方案和 IETF DMM方案的切换时延和丢包率分别建模分析，并得出了数学公式。根据数 据公式画出分析图。由分析图的对比可以看出，VDMM方案相比于IETFDMM方案 切换时延和丢包率都有所优化，实现了用户在AP间的无缝切换。
第四章是针对WLAM网络中普遍存在的AP负载不均衡的问题提出了一个自适 应负载均衡算法。算法釆用了第三章中VDMM方案的网络架构，同时考虑了信号 强度和AP负载两个因素，当网络发生AP负载不均衡时，不断将用户从负载高的 AP上切换到负载较低，信号强度较高的AP上，直到网络中AP负载均衡。然后 给出了算法的具体步骤和代码实现，并对算法进行仿真部署和性能分析，通过仿 真结果可知此算法解决了 AP间负载不均衡的问题，提高了网络吞吐量。
第五章是对全文进行了总结和展望，总结了文章的主要思想，说明了文章存 在的不足之处以及下一步的研究方向。
第二章分布式移动性管理关键技术研究
本章主要研究了分布式移动性管理的相关技术。首先介绍了分布式移动性管 理的研究现状。然后分别介绍了 IETF提出的完全分布式和部分分布式移动性管 理方案的整体架构和方案流程，分析了两个方案的优势和存在的不足之处。然后 介绍了下一代网络移动性管理的两个关键技术，软件定义网络（SDN）和网络功 能虚拟化（NFV） o介绍了这两个技术的体系架构，功能优势以及目前的研究现 状。
2.1分布式移动性管理协议概述
为了在移动节点改变位置时保证会话的连续性，保持IP地址不变是移动性 管理的主要特性之一。在当前的移动性管理的方案研究中，主要有两种方法，一 是集中式移动性管理，另一个是分布式移动性管理。分布式移动性管理方案的提 出，是为了解决集中式移动性管理中存在的如动态路由和IP地址分配的问题。 然而，为了支持移动性，集中式移动性管理方案存在很多信令消耗。
现在的网络层的移动性管理协议会部署一个移动锚点来保证移动节点的可 达性，即节点移动到另一个网络后可以正确的接收或发送数据包。而移动锚点是 集中部署的，在集中式移动性管理中，每个数据包都必须通过一个管理移动节点 的锚点。这种方式是一种比较有效的管理移动节点的方法。也就是说在运营商网 络中数以百万计的移动节点的通信量是由同一个节点来管理的。但是如果这个锚 点失败了，那么将会影响整个网络的通?信旧。集中部署移动节点来管理IP会话 的方式存在许多问题。为了解决这些问题，分布式移动性管理架构应运而生。分 布式移动性管理，即在网络中分布式的部署多个移动锚点来管理与用户相关的移 动性工作。主要分为完全分布式和部分分布式移动性管理方案。下面分别对这两 个方案进行介绍。
2.1.1完全分布式移动性管理方案
完全分布式移动性管理方案在控制层和数据层都采用分布式的方法。方案不需要加入额外的实体，而是通过信令在不同的移动锚点之间传递节点信息。因为 所有的移动锚点都需要得到节点的信息，因此完全分布式方案可能会存在信令过 载的问题。此外，这个方案可能不支持路由优化。完全分布式移动性管理方案架 构如图2-1所示。

图2-1完全分布式移动性管理架构

完全分布式移动性管理方案中包含了几个路由器MAAR。MAAR的功能类似于 移动锚点，主要负责移动节点的路由和管理功能，处理与节点相关的移动性工作。 此方案是完全分布式的，即方案中数据层和控制层都是分布式的，方案中没有一 个集中的控制实体来管理整个网络中节点的移动上下文信息，因此移动锚点若想 得到节点的移动上下文信息，就需要通过信令向节点之前接入的锚点进行查询。
如图2-1所示是完全分布式移动性管理方案的整体架构，图中虚线表示信令 流，实线表示数据流，箭头表示流的方向。
从图中可以看到，将MN初始接入的锚点作为pMAAR, MN接入此锚点后，pMAAR 为MN分配一个网络前缀MN:Prefixlo此时MN与CN1之间的通信需要经过pMAAR 的转发，如图中实线Traffic： Prefixl所示。MN从pMAAR切换到nMAAR后，nMAAR 为MN分配一个新的网络前缀MN2:Prefix2o nMAAR通过绑定更新/绑定确认消息 向MN之前的锚点pMAAR发送MN的位置信息，锚点更新节点的移动上下文信息。
从图中可以看到，此时CN1并不知道MN已经离开pMAAR,依然向pMAAR发送 数据，即CN1与MN之间的通信Traffic： Prefixl首先到达家乡锚点pMAAR,再 由pMAAR通过隧道转发至节点当前所在锚点nMAARo节点切换后与CN2之间新发 起的通信Traffic： Prefix2则可以直接路由到MN的当前锚点nMAAR,再由nMAAR 转发给MN,而不需要家乡锚点的转发。
由上述通信过程可知，为了在节点的家乡锚点和当前锚点之间进行数据的转 发，需要在节点的家乡锚点和当前锚点之间建立双向隧道，因此方案需要额外的 隧道开销。而且随着节点的不断移动，隧道开销也会不断增加。

而且完全分布式移动性管理方案中移动锚点为了得到网络中移动节点的移 动上下文信息，锚点之间需要通过信令交换节点信息，目前在锚点之间交换信息 的方法有几种，可以采用广播方法或维护节点之前的路由前缀。但无论是哪一种 都要增加额外的信令开销，而且随着节点的移动，信令开销会不断增大。这对移 动性管理方案来讲是一个不小的开销。
因此尽管完全分布式的方案能够解决集中式移动性管理存在的一些问题，但 它本身也存在一些问题，如为了收集节点信息而产生的信令使整个网络的信令负 载过大。因此目前完全分布式移动性管理方案的研究并不多。
2.1.2部分分布式移动性管理方案
与完全分布式移动性管理方案不同，部分分布式移动性方案中控制层和数据 层是并不全是分布式的。其中控制层是集中式管理，而数据层是分布式管理的， 因此在此方案中需要有一个移动性管理实体来管理移动节点的上下文信息，存储 网络中移动节点的的绑定条目⑴。方案引入了一个集中的数据库CMD来收集节点 信息，网络中的移动锚点通过绑定更新/绑定确认消息向CMD注册节点的相关信 息，锚点需要节点移动上下文信息只需通过信令向CMD查询，减少了移动锚点之 间的信令交互，因此与完全分布式移动性管理方案相比，部分分布式移动性管理 方案会更加高效。
部分分布式移动性管理方案，又称为基于PMIPv6的分布式移动性管理方案。 部分分布式移动性管理方案继承了 PMIPv6的许多特性。PMIPv6协议是一个典型 的集中式移动性管理协议。在PMIPv6中，本地移动锚点LMA和移动接入网关MAG 之间建立双向隧道回。用户的上行数据由相应的MAG接收并通过隧道转发到LMA, 然后由LMA将数据包转发到网络中。类似的，下行数据则首先由LMA接收，然后 通过隧道派发到MN当前接入的MAG,再由MAG转发给MN。通过在LMA和MAG之 间使用PBU和PBA消息来协调网络状态，使LMA知道MN当前接入的MAG%
在基于PMIPv6分布式移动性管理方案中，MAG的角色被锚点MAAR替代。MAAR 作为接入路由器，负责转发来自或去往网络的数据包。同时MAAR具有移动锚定 的功能，当节点改变接入点时不会中断数据流。PMIPv6的LMA角色被CMD替代。 CMD存储每个节点的信息，包括为节点分配的所有前缀以及节点当前所在的 MAARo此外，扩展PMIPv6中的绑定更新/绑定确认消息，在节点发生切换之后由 CMD通过发送指令更新节点的移动上下文信息，将到达家乡锚点的数据通过隧道 转发至节点的当前锚点，使节点的通信不要中断或。

图2-2部分分布式移动性管理架构

如图2-2所示是部分分布式移动性管理方案的架构图，图中虚线表示信令流, 实线表示数据流，箭头表示流的方向。方案包括了几个路由器MAAR和集中管理 数据库CMDo MN初始接入的锚点是MAAR1。

图2-3部分分布式移动性管理信令流程

如图2-3是部分分布式移动性管理方案的信令流程,，包括节点接入网络和 节点的移动切换流程。MN首先向MAAR1发送RS消息申请接入网络，MAAR1收到 RS消息后检测到MN的接入。MAAR1为MN分配一个网络前缀MN:Prefixl,然后 MAAR1通过扩展的绑定更新/绑定确认（PBU/PBA）消息通知CMD关于MN的接入 信息，向CMD进行注册，注册信息包括MAAR1为MN分配的网络前缀。由于MN 是初始接入，CMD为MN创建一个新的表项来存储MN的当前位置信息和MN获得 的网络前缀的映射表项。然后MAAR1通过RA消息将网络前缀通知给MN。则MN接入网络成功。此时CN1和MN之间的数据通信通过MAAAR1进行转发，如图中的 通信 Traffic： Prefixl。
如图2-3, MN发生切换，从MAAR1切换到MAAR2,重复之前的接入过程。MAAR2 收到来自MN的RS消息后,MAAR2为MN分配一个新的网络地址前缀MN：Prefix2。 MAAR2向CMD发送PBU消息，然后CMD更新MN的数据库表项，更新MN当前接入 点为MAAR2。CMD通过PBU/PBA消息指示在MAAR1和MAAR2之家建立一个双向隧 道。隧道用于将发往家乡锚点的会话从MAAR1重新定向到MAAR2。但隧道只用于 转发节点切换之前建立的通信会话，如图中所示Traffic： Prefixl通过隧道由 MAAR1转发到MAAR2。而MN切换之后新建立的通信则不需要通过隧道和MAARL 直接经过MAAR2转发到MN,如图中的数据通信Traffic： Prefix2。
由上述描述可以看到，在此方案中，数据层是分布式的，在MAAR之间转发。 而控制层则是集中式的，都由CMD进行控制。因此这个方案又称为部分分布式移 动性管理方案。
部分分布式移动性管理方案对于流的动态控制是通过为MN分配新的IPv6前 缀来实现的。MN每移动到一个新的MAAR后，MAAR都会通过RA消息分配一个新 的前缀给它，则MN使用新的前缀来建立新的会话飯。因此，每个MAAR会有一个 IPv6的地址池，当MN进入它的接入链路时，MAAR会从地址池中选一个地址分配 给MN。因此，按照MN访问过的MAAR, MN可能会有多个IPv6地址，数据流也可 能锚定在不同的MAAR上。但为每个MAAR配备一个地址池可能会造成资源上的浪 费，而且由于节点每到达一个网络就需要为节点分配一个地址，那么就需要扩展 节点能够支持多个IP地址，这为方案的实际推广带来了一定的难度。
2.2下一代网络移动性管理相关研究
2.2.1 SDN移动性管理
由于移动通信数据量的激增，现代移动网络正面临着可扩展性差和网络性能 下降的问题。而且，集中部署的锚点不仅要管理数据包还要管理控制包，则移动 数据的激增对IP移动性环境有明显的影响。如，在移动IPv6网络中，为了提供 位置管理，家乡代理HA要处理与绑定相关的信令消息。同时，所有到达MN的数 据包都要首先到达HA,再由HA通过隧道转发给MN,这会为HA带来非常明显的 处理压力。同理在代理移动IPv6中，本地移动锚点LMA也需要同时处理数据包 和绑定相关的信令消息。

由此我们可以看出，集中的IP移动性方案在处理大量的移动性数据时存在 一定的局限性。由于集中部署的移动锚点既要管理移动性相关信令，又要为注册 的所有节点转发数据包，所以存在以下几个弊端：1）缺乏动态移动性支持，2） 次优路由，3）可扩展性差，4）单点失败等。
为了克服这些缺点，IETF DMM工作组一直致力于分布式移动性管理的研究， 并且将其作为5G中非常有前景的移动性管理技术。即使现在还没有特定的DMM 协议被标准化，但DMM协议的基本操作是基于将数据包从原接入路由器转发到新 的路由器。也就是说，数据包是由AR在接入网进行处理的，不需要注入到核心 网中。
即使DMM协议能够减轻集中部署的移动锚点的负载，但是DMM中增加了隧道 开销，DMM中需要在用户之前的锚点和用户当前锚点之间建立双向隧道来转发数 据。若用户之前接入的锚点和用户当前所在锚点不是直接连接的，那么隧道开销 就不可忽略，这是因为此时两个锚点之间没有直接连接，那么隧道可能会包含一 些物理站点，这会导致次优路由和切换延迟。
为了进一步提高DMM协议的性能，引入了 SDN （软件定义网络）技术。SDN 在解决移动性管理的问题中存在着一定的优势。首先，SDN中的可编程网络设备 能够减轻甚至消除移动性管理中的三角路由问题问。这是因为控制器中存储着网 络中节点的绑定缓存条目，控制器通过节点的相关信息能够找到节点之间传输数 据的最优路径，然后控制器向移动锚点下发流表控制数据的转发；其次SDN中的 集中控制能够降低网络协议的复杂性。
软件定义网络能够以动态的方式控制、改变和管理网络和网络设备的行为。 SDN将控制层从数据层中解耦。控制层被移动到一个逻辑控制器上，由控制器决 定数据包如何通过整个网络。换句话说，在SDN架构中，网络设备只是作为一个 简单的转发硬件而不是像传统网络中会运行一系列的路由协议。此外，网络运营 商能够能够明显减少在网络操作、设备维护和服务升级上的开销[13'14]o
软件定义网络（SDN）的目的是通过使用可编程的通用的软件驱动的服务和 方法替换传统的基于硬件的专有设备和服务来打破固有的网络架构。SDN架构中 一个重要的协议是OpenFlow协议，这个协议能够控制着网络基础架构元件和网 络控制层实体之间的通信算。OpenFlow由ONF维护，而且今天所有主要的网络 设备供应商都支持这个协议。SDN架构中的核心的是SDN控制器，它负责业务和 相关资源的供应，管理和控制。为了这个目的，控制器提供了所谓的北向接口给 应用，提供了南向接口给资源。使用这些接口，用户和应用可以直接和网络相连。 通过SDN控制器的北向接口，授权应用可以调用其他的应用或者改变南向接口的 资源状态mm。


如图2-4所示是一个典型的基于SDN的移动性管理架构。架构包含一个SDN 控制器和几个路由器MAAR。MN的初始接入锚点为MAAR1。MN接入网络时通过 PBU/PBA消息向SDN控制器进行注册，控制器缓存节点的相关信息。当移动节点 从MAAR1切换到MAAR2后，为节点配置新的IP地址，并更新控制器中的缓存条 目。控制器下发流表到路由器上，控制数据流从MAAR1重定向到MAAR2。

图2-4基于SDN的移动性管理架构

如图2-5是SDN的体系架构。在SDN架构中，控制器使用南向应用程序接口 (API)与转发设备连接。一个典型的南向接口是OpenFlow协议网。OpenFlow 交换机通过它上面的流表来执行数据包转发功能。通过使用OpenFlow协议，控 制器能够通过判断当前的情况来对流表进行操作(如安装，更新或删除流表)。
在SDN架构中，网络服务会被作为一个应用部署在控制器的顶端。控制器和应用 之间的通信将通过北向接口来完成O


目前已经有一些文章考虑将SDN应用于IP移动性管理中。在文章［18］中,

作者提出了将5G作为一组应用，将移动性管理作为应用部署在SDN控制器的顶 部。在文章［19］中，作者讨论了如何将SDN部署到电信领域，尤其关注通过网络 层转发数据。作者提出了将IP移动性作为一个用户实例。在文章［20］中，作者 提出了一个基于SDN的移动网络，用两种不同的控制器类型：单独的控制器和分 层的控制器。在文章［21］中，建议DMM可以作为一个SDN应用。然而，并没有说 明它是如何工作的。在文章［23］中，作者提出了一个基于SDN实现DMM中路由优 化的方案。作者的想法是，控制器能够更新CN侧OpenFlow交换机的流表直接将 数据包路由到MN当前的OpenFlow交换机而不需要经过MN之前接入的交换机。 值得注意的是，切换之后，首先，数据包需要遵循从原来的交换机到新的交换机 的路由。然后数据包在新的交换机和CN侧的交换机之间重新定向。因此，可能 会导致过程一个复杂的过程和较高的信令消耗。在文章［34］中，作者分析了目前 SDN的研究现状和在5G中应用SDN技术的优势，介绍了目前SDN的实现方式以 及未来SDN的发展方向。阐述了 SDN和NFV技术相结合的优势和现在仍然存在的 一些问题。
2.2.2 NFV移动性管理
随着智能设备和应用的不断增多，IT业务在我们日常生活中国扮演着越来越 重要的角色。最近几年，IT业务的质量和恢复能力逐渐引起了大家的重视。人 们意识到优化业务的延迟，抖动和丢包率的重要性，以及如何在破坏发生之前能 够将业务转移到安全的位置。而且目前移动通信网络正在向5G架构演进，复杂 的5G网络架构需要一个有效的网络管理架构来对5G架构中不同层面多种网络资 源进行统一连贯的管理和编排。网络功能虚拟化以及网络管理和编排为运营商提 供了解决问题的有效方法口。在网络实现新的业务时，网络功能虚拟化能够降低 网络开销和复杂性，维护网络服务并管理网络资源。因此，目前国内外对网络虚 拟化技术的研究如火如荼。
当前，虚拟化机制的优势已经逐渐被人们所了解，虚拟化机制已经越来越多 的被使用在现在的数据中心网络和其他架构中。将软件从硬件中分离，使用虚拟 机来管理多种多样的云服务。目前通用的硬件技术，云计算技术和灵活的软件定 义网络技术加速了传统网络功能的虚拟化，如传统的路由器，防火墙等。这些网 络功能之前一般部署在专有的网络硬件上，而现在可以使其作为软件应用运行在 虚拟设备上绸韻。虚拟机可以部署在一个物理主机上，而且可以从一个主机迁移 到另一个主机。而虚拟机的在线迁移，就是将虚拟机从一个物理设备迁移到其他的物理设备，而不打断其上运行的业务。虚拟机在线迁移是虚拟化数据中心能够 灵活且动态的管理资源的基本技术逐淘。通过部署这项技术，可以优化IT业务 的各种参数，如可以通过动态的调整虚拟机的位置来优化延迟、丢包率等，还有 可以通过虚拟机迁移使在故障发生之前将业务由危险的位置迁移到相对安全的 位置
网络功能虚拟化即NFV,釆用了虚拟化的技术，目的是将传统的网元设备从 专用硬件中解耦，使用X86通用硬件对网络功能进行虚拟化，使网络功能不再依 赖于传统的硬件设备网。在NFV的方式下，新业务上线，传统的设备更新等过程 可以转换为软件加载过程，因此可以大大缩短建设周期,加快网络发展进程网网。
NFV网络架构如图2-6所示，NFV架构由三部分组成：虚拟网络功能（VNF）、 网络功能虚拟化基础设施（NFVI）、NFV管理和编排。
VNF是网络功能的软件实现，能够运行在网络功能虚拟化的基拙设施即NFVI 上；
NFVI是实现网络功能虚拟化的基础设施，包括多种物理资源，以及实现它们 的虚拟化；
NFV管理和编排，包含物理基础设施虚拟化，软件资源的业务流程和生命周 期的管理，以及VNF生命周期的管理，主要是管理所有可能在NFV中虚拟的各种 任务。
虚拟隆各功能<VNFs>




图2-6 NFV参考架构
NFV是5G研究中非常重要的一项技术，目前已经有一些文章考虑将NFV应用 于IP移动性管理中。在文章［33］中，基于3GPP标准将NFV技术应用到LTE网络 中以减少网络的切换延迟，文章中指出在LTE网络中服务网关（S-GW）和移动性 管理实体（MME）都可以使用虚拟机进行替换，并且可以釆用NFV技术通过使用 一个单独的设备来进行整体的操控。NFV通过虚拟层提供了一个更好的控制，并 且可以通过服务器上的软件控制来代替传统的切换机制，这样可以降低操作的复杂性，减少网络开销；在文章［36］中，讨论了 SDN和NFV技术在5G架构中的应 用以及网络架构的设计思路。文章首先分析了目前移动通信网络中存在的一些问 题，阐述了 SDN和NFV技术在5G网络架构中的优势和作用；其次，介绍了国内 外专家对SDN及NFV在移动网络架构方面的研究进展，分析了基于SDN/NFV技术 在网络架构的设计中的应用；最后初步研究了基于SDN/NFV的5G网络架构演进, 提出了需要解决的主要问题以及目前面临的技术挑战。
文章［34］中指岀，目前通信网络正在逐渐向5G架构进化。5G网络旨在提供 了一个灵活的，可扩张的，敏捷的，可编程的网络平台，在这个平台上可以部署 和管理不同需求的网络服务。下一代移动通信网络需要创新的网络概念和架构。 网络功能虚拟化(NFV)和软件定义网络(SDN)技术是下一代网络研究中的核心 技术，也是实现5G架构的关键技术。文章中给出了 5G架构的分层图，5G网络 主要分为3层，最底层是物理资源层，用这些物理资源来虚拟第二层，第二层是 网络功能和一些增值业务功能的虚拟实体。最上层是网络提供的多种服务的 APIo然后文章介绍了 5G架构中的网络切片的概念。网络切片的概念就是将现在 的物理网络划分为多个虚拟网络，每一个虚拟网络根据不同的服务需求，比如时 延、带宽、安全性和可靠性等来划分，以灵活的应对不同的网络应用场景。之后 文章还介绍了网络管理和网络编排，并介绍了 SDN的关键技术。但文章主要还是 基于分析的层面，缺少实际的网络环境的支持。
2.3本章小结
这一章主要研究了分布式移动性管理中的关键技术。文章在2.1首先介绍了 分布式移动性管理的两个方案，即部分分布式移动性管理方案和完全分布式移动 性管理方案。分析了两个方案的关键技术、主要流程以及方案存在的一些问题。 然后在2. 2介绍了下一代网络移动性管理的发展。介绍了目前移动性管理中用到 的非常有前景的技术，软件定义网络(SDN)和网络功能虚拟化(NFV)。并介绍 了关于SDN和NFV目前国际上的发表的一些文献，描述文献提出的方案以及方案 存在的一些不足之处。这一章的相关技术介绍主要是为下一章提出我们的方案做 准备。

第三章分布式移动性管理切换优化方法设计
本章针对分布式移动性管理方案中存在的切换时延较长、转发路径非最优、 以及隧道开销等问题，提出了一个基于虚拟化的分布式移动性管理方案。本章介 绍了的主要设计思想、网络架构以及方案的主要场景，并对方案的性能进行了数 据建模和分析。
3.1移动性管理切换优化方法设计(VDMM)
3.1.1问题分析
传统的分布式移动性管理方案即IETF DMM方案解决了集中式移动性管理方 案中存在的单点失败等问题。分布式移动性管理分为部分分布式移动性管理和完 全分布式移动性管理，由于完全分布式移动性管理方案不同于部分分布式移动性 管理方案，没有CMD来管理移动上下文，因此在路由器之间传递节点移动上下文 消息需要使用广播消息，由此带来了信令负载过大的的问题，因此目前对完全分 布式移动性管理方案的研究很少，大家的关注点都集中在部分分布式移动性管理 方案上吧
部分分布式移动性管理方案相对于传统的集中式移动性管理方案存在明显 的优势，方案中锚点的分布式部署解决了集中式管理方案中由于锚点集中部署引 起的单点失败等问题网。
但分布式移动性管理方案中仍存在一些问题，具体如下。
(1)目前IETF DMM方案中，用户在切换过程中的需要的移动上下文信息需 要移动锚点通过信令向集中的位置管理实体CMD获得,而移动锚点和CMD 一般相 距较远，因此IETF DMM方案中用户的切换时延较长的问题㈣的；而且方案中仍 然存在数据包转发路径非最优的问题。IETF DMM方案中，节点从sMAAR切换到 nMAAR后，更新路由器中的绑定缓存条目，并在sMAAR和nMAAR之间建立双向隧 道。用户在切换前发起的数据仍然到达sMAAR, sMAAR收到数据后，发现节点此 时并不在sMAAR上，因此sMAAR通过隧道将数据转发到nMAAR上。从上述过程可 知，用户在切换前的会话先到达家乡锚点，再由家乡节点通过隧道转发到当前锚 点，即数据包的转发路径并不是最优的问。

（2）	方案中节点从家乡锚点切换到当前锚点后，需要在节点的家乡锚点和 当前锚点之间建立双向隧道用于转发数据，因此为方案增加了额外的隧道开销。 而且节点每移动到一个新的锚点，都需要建立新的双向隧道，因此双向隧道的数 量不断增加。则建立和管理隧道所需要的开销也不断增加妃盗。
（3）	方案需要对终端功能进行扩展，节点每次接入新的网络都必须获取新 的IP地址，这使得移动终端必须扩展能够支持多个IP地址；
为了解决分布式移动性管理方案中存在的切换延迟高，隧道开销大的问题， 在第三章中提岀了基于虚拟化的分布式移动性管理方案VDMM方案，通过和IETF DMM方案的性能对比分析可知,VDMM方案在切换延迟和丢包率两个方面都比IETF 方案有所优化，即VDMM实现了用户在不同AP间的无缝切换。
3.1.2系统结构

图3-1 VDMM方案架构图

如图3-1给出了 VDMM方案的架构图，方案架构包含了一个控制器 Controller,两个AP分别是API, AP2,和四个用户分别是MN1, MN2, MN3和MN4。 下面分别对网络中的实体进行介绍。
Controller是控制器，对域内的AP和用户有整体的管控作用。控制器中存 储了一张映射表，映射表中存储着域内的用户、用户的VAP以及用户所在物理 AP之间的一一对应的映射关系。用户原来接入的AP （即API）通过切换预测得 出用户即将切换到AP2,并报告给控制器。控制器得知用户即将切换到AP2,控 制器将向API发送指令将用户的虚拟AP从API切换到AP2,并更新API, AP2和 控制器上的映射表。
API和AP2是方案中的物理AP,是网络中用户的无线访问接入点。每一个接入物理AP的用户都会被分配唯一一个虚拟的AP即VAPo虚拟AP在功能上和物 理AP相同，对用户来说，虚拟AP和物理AP没有区别，用户感知不到虚拟AP 的存在。每一个AP上存储了一张映射表，表中存储了用户的IP地址和为用户分 配的唯一的虚拟AP的标识之间的映射关系。
3.1.3 VDMM方法流程
针对上面提出的现有的分布式移动性管理方案中存在的切换时延长、隧道开 销等问题，我们设计了一个基于虚拟化的分布式移动性管理方案即VDMM方案来 对分布式移动性管理中的切换过程进行优化。
方案的主要思想是在传统的分布式移动性管理方案中引入虚拟化的思想。将 传统WLAN网络中的物理AP进行虚拟化设计，为每一个物理AP上接入的用户分 配一个唯一的虚拟AP,虚拟AP拥有链路层和网络层中连接建立所需的相关状态 信息，如BSSID, MAC地址，AP IP地址，UE IP地址等。用虚拟AP和用户之间 的信令和数据交互来代替用户和物理AP之间的信令和数据交互。这样对于用户 来说，虚拟AP在功能上和物理AP完全相同，用户感知不到虚拟AP的存在。因 此，当用户从一个AP切换到另一个AP时，无需为用户分配新的IP地址或者建 立双向隧道，只需将为用户分配的唯一的虚拟AP从用户原来接入的AP切换到新 的AP即可。将用户的切换转换为虚拟AP的切换，由于虚拟AP拥有链路层和网 络层中连接建立所需的相关状态信息，用户切换后能够迅速与新的网络建立连 接，缩短了用户重新建立连接的时间，减少了切换时延和隧道开销。
在一个物理AP上，可以创建多个逻辑上的虚拟AP,每个虚拟路由器都单独 地运行各自的路由协议实例，并且都有自己专用的I/O端口、缓存、路由表和网 络管理软件等。虚拟AP的架构与传统AP类似，包括与用户的交互模块，通过配 置实现OSPF, BGP, RIP作为动态路由协议，并可以通过配置文件的形式决定启 用哪一个动态路由协议。此外还有管理模块，负责配置管理的生成和更新路由表 等操作。
下面将介绍方案的详细流程，包括虚拟AP的创建过程、用户接入AP的具体 过程以及用户在不同AP之间切换时的的信令流程和数据通信过程。
(1)虚拟AP的创建过程
文章E54］中给出了在软件定义的WLAN中虚拟AP的创建、管理和迁移过程。 文中定义了两种虚拟AP, 一种是公共静态虚拟AP (PS-VAP)，作为网络的接入口，所有注册和非注册的用户都可以接入；另一种专用动态的虚拟AP (DD-VAP) 是当用户需要的时候专门为用户创建的。
公共静态虚拟AP (PS-VAP)的创建过程如下，首先在物理AP上安装一个程 序或固件，物理AP发送请求到集中处理器。集中处理器返回一个基本的配置给 物理AP,如公共静态虚拟AP的配置文件。这个配置文件包含服务设备标识符 (SSID)和操作信道。然后物理AP可以基于这个配置文件创建一个虚拟AP。这 个创建的VAP可以接入任意用户而不用身份验证。因为这种创建的VAP是物理 AP上创建的第一个VAP,能够一直存活直到物理AP关机，这种虚拟AP命名为公 共静态虚拟AP (PS-VAP) o专用动态的虚拟AP (DD-VAP)是当用户需要的时候 专门为用户创建的。
动态的虚拟AP (DD-VAP)的创建过程如下，当一个注册用户想要接入网络 时，它会监听控制信道，等待一个PS-VAP的信号。当用户监听到一个PS-VAP 的信号时，它知道那是一个可能的PS-VAPo用户发送一个包含注册的服务设备 标识和它的ID (如MAC地址)的请求消息。物理AP会转发一个VAP建立请求(请 求至少包含基站，SSID和物理AP的ID)到服务器。服务器通过使用基站ID和 SSID检查是否这个用户是一个有效的注册用户。如果用户是一个有效的用户， 服务器将会读取用户资料，检查现在的物理AP的资源是否足够支持这个用户。 如果足够，服务器将会返回一个VAP建立响应(包含用户信息)给物理APO PS-VAP 发送Probe Reply给用户。然后物理AP使用服务器提供的配置信息为用户创建 DD-VAP0用户和这个创建的DD-VAP进行身份验证，连接和数据通信。在身份验 证的过程中，DD-VAP是一个中继节点。真正的身份验证流程是在服务器上完成 的。
参考上面的创建虚拟AP的过程，如图3-2所示给出本文虚拟AP创建的信令 流程。
(a)首先用户发送一个包含注册的服务设备标识和它的ID的请求消息给物 理AP。
(b)物理AP收到用户的请求消息后，发送一个VAP建立请求(请求至少包 含用户ID, SSID和物理AP的ID至少)到控制器。
(c)控制器收到消息后，检查这个用户是否是一个有效的注册用户。如果用 户是一个有效的用户，控制器将会读取用户资料，检查现在的物理AP的资源是 否足够支持这个用户。如果足够，控制器将会返回一个虚拟AP建立响应(包含 用户信息)给物理AP。
(d)物理AP发送Probe Reply给用户。
(e)物理AP使用配置信息为用户创建虚拟AP0用户和虚拟AP之间可以进行身份验证，连接和数据通信。


Probe Request
(SS^D, UserJD)
VAP Setup Response
Probe Reply :	(User_profile)


图3-2虚拟AP的创建过程
(2)接入网络过程
和其他的移动性协议相同，本方案中为每一个接入的节点(Mobile Node, MN)分配一个主机标识，也可以称为家乡地址(Home Address, HoA)。当节点 发生移动的时候，家乡Milt HoA是不会变化的，因此家乡地址HoA可以作为节点 的主机标识。
也就是说当MN接入一个新的网络时，并不需要为MN重新分配地址，相关的 移动性工作由网络侧来完成，MN不需要参与移动性工作，即对终端是透明的。
从上面描述可以知道本方案是基于网络的，基于网络侧的方案有相较于基于 主机的方案来说有一定的好处。首先网络中的移动性工作对终端透明，那么就不 需要扩展终端的协议栈，降低了方案部署的复杂性，使得方案能够更好的兼容现 有的协议。



图3-3 VDMM方案接入过程
本方案中MNi的HoA分别为MNi-IP,以MN3为例，如图3-3所示，具体的 接入注册流程如下：
(a)MN3接入API,向API发送RS消息申请接入。
(b)API收到RS消息,检测到MN3的接入,API得到MN3的家乡地址MN3-IP。
(c)API査询映射表中没有MN3的映射表项，判断MN3是第一次接入API, API向控制器发送绑定更新消息PBU,将节点的IP地址和AP1-ID传给控制器。
(d)控制器收到API的PBU消息后，查询映射表中没有MN3的表项，判断MN3 是第一次接入这个域。因此控制器为MN3分配一个新的虚拟AP,即VAP3,虚拟 AP的标识为VAP3-ID。控制器为MN3新建一个表项，将MN3的IP地址、为MN3 分配的VAP的标识和MN3接入AP的地址〈MN3-IP, VAP-ID, AP1-IP＞存入映射表 中，如表3-1所示。
表3-1 Control ler的映射表项
MN	VAP	AP
MN1-IP	VAP1-ID	AP1-IP
MN2-IP	VAP2-ID	AP2-IP
MN3-IP	VAP3-ID	AP3-IP
MN4-IP	VAP4-ID	AP4-IP
MN5-IP	VAP5-ID	AP5-IP


(e)控制器向AP返回确认消息PBA。
(f)API收到控制器的消息后，为MN3分配一个虚拟AP,即MN3-VAP, MN3-VAP
拥有链路层和网络层中建立连接所需的相关状态信息，MN3的上行和下行数据都

由MN3-VAP进行处理。
(g)API为节点的IP地址和为节点分配的VAP标识建立缓存表项将MN3的 IP地址和为MN3分配的VAP的标识＜MN3-IP, VAP3-ID〉，存储在API的映射表中, 如表3-2所示。
表3-2 AP1的映射表项
MN	VAP
MN1-IP	VAP1-ID
MN2-IP	VAP2-ID
MN3-IP	VAP3-ID


(h)API向MN3返回申请确认消息RAo 具体的信令流程如图3-4所示。


图3-4 VDMM方案接入信令流程
(3)移动切换过程
上面介绍了本方案的用户接入流程，介绍了具体的切换过程和信令流程。下 面主要介绍当用户从一个AP移动到另一个AP时的切换过程和相应的信令流程。 我们上面介绍过，在部分分布式的移动性管理网络架构中，当用户从一个网络移 动到另一个网络时，新接入的MAAR需要向CMD通过PBU/PBA消息查询用户之前 的接入信息，并在用户之前接入的MAAR和用户当前MAAR之间建立双向隧道，之 前的会话需要先到达家乡MAAR,然后通过隧道转发给当前MAAR。
从上面的流程中可以看出，部分分布式移动性管理方案中仍然存在转发路径 非最优的问题，即会话需要先到达家乡锚点，再由隧道转发到用户当前接入的锚 点。其次在用户的家乡锚点和当前锚点之间需要建立双向隧道，而且随着用户不 断移动，隧道的数量不断增加，因此隧道开销也会不断增大，这在整个网络中来
看也是一笔不小的开销。且目前部分分布式移动性管理方案的切换时延较长。
VDMM方案主要是针对上面两个问题来设计的，方案中用户自始至终只有一个 地址，也可以成为家乡地址，这个地址标识了用户的身份和位置，当用户移动到 新的网络时不需要给用户分配新的IP地址，因此方案无需对终端进行扩展。方 案中为每一个用户分配唯一的虚拟AP,当用户移动后，虚拟AP也跟着用户移动， 这样对于用户来说接入的一直是同一个AP,因此可以降低切换过程中的时延， 而且无需建立双向隧道也减少了隧道开销。
在VDMM方案中，引入了虚拟化的思想，为每一个用户分配唯一的虚拟AP, 网络中有一个控制器。控制器管理着整个域内接入的用户信息，包括用户的IP 地址，为用户分配的虚拟AP的标识，以及用户当前接入的AP的IP地址。
当用户接入到网络后，它将会被分配一个唯一的虚拟AP。用户切换时，原 AP可以通过二层切换预测得知用户即将切换到的AP,并将新AP的信息发送给控 制器，控制器会通过信令控制它的的虚拟AP也从原物理AP切换到新的物理AP。 由于VAP中保存着链路层和网络层的相关信息，所以用户并不需要重新进行链路 层和网络层的配置，因此切换延迟将会大大降低。
为了获取用户切换后即将接入的AP的信息，方案借鉴了 FH-PMIPV6方案的 思想岡。用户在足够短的时间间隔内向其接入网汇报包含MN ID和AP ID的底层 信息报告。当用户移动到两个AP的重叠区域内时，接入网络在恰当的时间向用 户的接入AP发送特定的切换指示消息。用户接入AP可通过二层（L2）扫描预测 用户将要发生切换并推导出用户即将接入的AP的信息，并将信息报告给控制器， 控制器通过信令控制用户的虚拟AP进行切换。

如图3-5所示，以MN3的切换为例，具体的切换流程如下：
(a)MN3移动到API和AP2的重叠区域。
(b)API通过二层(L2)机制预测到用户即将切换到AP2；
(C)API向控制器发送VAP Move Request消息，消息携带MN3即将迁移到的 AP信息(AP2_IP)和MN3的虚拟AP (VAP3)的状态信息。
(d)控制器收到VAP Move Request消息后，得知用户即将移动到AP2,控 制器向AP2发送消息VAP Duplication消息，消息携带MN3的虚拟AP (VAP3) 的状态信息，状态信息包括BSSID,操作信道等信息。
(e)AP2收到VAP Duplication消息后，通过消息携带的VAP3的状态信息在 AP2上克隆一个VAP3。AP2更新它的映射表＜MN3-IP, VAP3-ID〉。
.(f)控制器更新它的映射表，将MN3当前所在AP更新为AP2-IP,映射 表项为＜MN3-IP, VAP3-ID, AP2-IP＞o
(g)AP2向控制器返回确认消息VAP Move Confirm。
(h)控制器向API发送VAP Release消息，API释放VAP3。
(i)MN3移动到AP2后，向AP2发送接入请求消息RS。AP2收到RS消息后， 由于此时AP2上已经存在MN3的虚拟AP,所以MN3可以直接与AP2建立连接而 无需再执行一次连接过程，不会产生额外的2层和3层的处理消息。AP2返回RA 消息。
至此，切换完成。
如图3-6所示，是切换过程的信令流程。

:NAP Move Request(AP2-IP,NAP3 Status) r~	' ?
NAP Duplication(NAP3 Status)

Cont rust gP for MM3
NAP Move Confirm
NAP Release
RS(MNAP):
RA
图3-6 VDMM方案切换信令流程
(4)切换过程中的数据通信
上面介绍了本方案中用户从一个AP切换到另一个AP时的切换流程以及信令 流程。在用户的切换过程中存在着数据通信，包括用户在切换前的AP上发起的 数据通信、用户切换到新的位置后原来未完成的数据通信以及用户在切换后的 AP上新发起的数据通信。下面分别介绍这三种数据通信的流程。
a.移动切换前的数据通信

图3-7 VDMM方案切换前的数据通信

这个部分介绍用户在切换前进行的通信，即用户在切换前的AP上发起的数 据通信。
仍然以MN3为例，MN3初始接入API, MN3向API及控制器完成接入注册，注 册过程见上文，由控制器为MN3分配了虚拟AP的MN3-VAP后，控制器和API中 都缓存了 MN3的映射表项。如图3-7所示，以MN5向MN3发送数据为例，用户切 换前的数据通信过程如下，红色箭头表示数据传输过程。
(a)MN5向MN3发送数据包，数据包首先到达MN5接入的AP3。
(b)AP3首先以MN3-IP查询本地缓存映射表，发现映射表中并没有MN3的相 关表项，说明MN3并没有接入AP3。
(c)AP3向控制器发送查询消息(携带MN3-IP)-
(d)控制器收到消息后，以MN3-IP査询缓存映射表，查到MN3的映射表项 为〈MN3-IP, VAP3-ID, AP1-IP〉，得知MN3当前接入API,控制器将MN3接入AP 的地址AP1-IP发送给AP3o
(e)AP3收到API的IP地址后，知道MN3当前接入API,因此AP3将发给MN3 的数据包转发到API。
(f)API收到数据包后，以MN3-IP查询映射表得到映射表项 <MN3-IP,VAP3-ID>,得知MN3接入了 API,并己为它分配了虚拟MN3-VAP,因此 将数据包交给虚拟MN3-VAP处理。
(g)MN3-VAP将数据包转发给MN3。
如图3-8所示，是切换前数据通信流程。

图3-8 VDMM方案切换前数据通信流程

b.移动切换过程中的数据通信

图3-9 VDMM方案切换过程中的通信



这个部分介绍用户切换过程中的数据通信，即用户切换到新的AP后，用户 在切换前的AP上发起的数据通信仍在继续，这些数据需要发送到用户。
仍然以MN3为例，如图3-8所示，MN3接入API时，MN5向MN3发送数据， 然后MN3从API移动到AP2,但通信并没有中断，MN5依然向MN3发送数据。用 户切换过程中的数据通信流程如下：
(a)如图3-9中虚线所示为MN3切换之前的数据流向，为 MN5->AP3->APl->MN3o
(b)MN3 从 API 切换到 AP2。
(c)MN3接入AP2后向AP2发送RS接入请求。
(d)具体的移动切换过程已在上文中描述，此时MN3的虚拟AP己经从API 切换到AP2,因此MN3能够直接接入AP2而无需再执行一次注册过程，不会产生 额外的2层和3层的处理消息。
(e)AP2向MN3返回RA消息。此时API、AP2和控制器的映射表已经更新完 成。控制器的映射表更新为<MN3-IP, VAP3-ID, AP2-IP>O同时控制器向域内的 AP发送广播消息通知它们MN3己经由API切换到了 AP2O
(f)之后来自MN5的数据包被转发到AP2,再由AP2发送到MN3。
如图3-10所示，是切换过程中的通信流程。



图3-10 VDMM方案切换过程中的通信流程
C.移动切换后的数据通信





这个部分介绍用户在切换后进行的通信，即用户在切换到新的AP后，新发 起的数据通信。
仍然以MN3为例，MN3从API移动到AP2, API, AP2和控制器上的映射表项 都己经更新完成。如图3-11所示，AP3上新接入一个用户MN6,以MN6向MN3 发送数据为例，用户切换后的数据通信过程如下，红色箭头表示数据传输过程。
(a)MN6向MN3发送数据包，数据包首先到达MN6接入的AP3。
(b)AP3首先以MN3-IP查询本地缓存映射表，发现映射表中并没有MN3的 相关表项，说明MN3并没有接入AP3o
(c)AP3向控制器发送查询消息(携带MN3-IP) o
(d)控制器收到消息后，以MN3-IP查询缓存映射表，查到MN3的映射表项 为〈MN3-IP, MN3-VAP, AP2-IP〉，得知MN3当前接入AP2,控制器将MN3接入AP 的地址AP2-IP发送给AP3o
(e)AP3收到AP2的IP地址后，知道MN3当前接入AP2,因此AP3将发给 MN3的数据包转发到AP2O
(f)AP2收到数据包后，以MN3-IP查询映射表得到映射表项
<MN3-IP, MN3-VAP>,得知MN3接入了 AP2,并已为它分配了虚拟MN3-VAP,因此 将数据包交给虚拟MN3-VAP处理。
(g)MN3-VAP将数据包转发给MN3。
如图3-12所示，是切换后的数据通信流程。


图3-12 VDMM方案切换后的数据通信流程
3.1.4移动性管理分析模型
本小节首先提出基于VDMM方案的切换延迟模型，然后对分别VDMM方 案与IETF-DMM方案从切换延时、丢包率、信令开销等方面进行数学建模。
（1）切换延迟模型
移动节点之间进行通信时，数据在无线线路和有线线路上的传输都需要 时间，因此都会产生时延。如果移动节点a与b之间的平均跳数为那 么从移动节点从a发送大小为&的数据包到移动节点b的延迟表达式为： 知=侦（务+1）	31）
其中，BW. I分别代表有线链路的带宽和传播延迟。
与有线链路相比，无线链路的传输可靠性较低，因此可能导致数据包传输失败，
并进行多次传输。本论文中用当表示无线链路传输失败的可能性。则在无线
网络发送大小为Z,的数据包的延迟表达式为：
歸=（金+。/（1-今）	（3-2）
其中，BWw. lw分别代表有线链路的带宽和传播延迟。
如下表3-3所示是本章中需要用到的相关符号以及含义。

表3-3符号及含义
符号	定义
TL2	'	2层的切换延退
^Auth	身份认证延迟
&	控制包的平均大小
Ld	数据包的平均大小
BWw	无线链路带宽
BW	有线链路带宽
k	无线链路传输延迟
I	有线链路传输延迟
Pf	无线链路失败的可能性
r	子网半径

本文中提出的分布式移动性管理方案VDMM方案在核心网釆用分布式移动 性管理架构，数据流量通过接入层锚点,（接入AP）进行转发，而不需要通过集 中锚点，因此能够有效降低通信延迟和流量负载。并且，切换完成后新会话流不 需要通过原接入AP而以最优路径转发，有效降低了数据的传输开销。此外， VDMM方案不需要建立隧道，减少了建立隧道的大量移动性管理协议信令，减 少了隧道开销和信令开销。
（2）切换延迟与丢包率
a. IETF DMM 方案
前面我们已经分析过IETF DMM方案的切换流程。在IETFDMM方案中，节点 切换前接入的锚点是sMAAR,节点切换后接入的锚点是nMAAR。在IETFDMM方案 中，用户从sMAAR切换到nMAAR后，nMAAR通过绑定更新/绑定确认消息向CMD 进行注册，CMD中存储着用户的移动上下文信息，CMD收到nMAAR的消息后通过 绑定更新/绑定确认消息通知sMAAR更新映射表项，并在sMAAR和nMAAR之间建立双向隧道用来传输数据詞。因此，切换延迟（HL）的定义是用户能够通过sMAAR 接收/发送数据包的最后的时刻tl到用户能够通过nMAAR接收/发送数据包的最 初的时刻t2之间的时间间隔肉。


Mymd(c)是在MAAR和CMD之间通过有线链路传输控制包的时间延迟，计
算公式如下:
^■MAAR-CMD (c) = (	+ WmAAR-CMD
BW
其中厶是控制包的平均大小，8所是有线链路带宽，/是有线链路传输延迟, 城2^是临迅和CMD之间经过路由器的跳数。
上面介绍了 IETF DMM方案的切换时延，丢包率也是一个衡量切换性能的重 要指标。丢包率(Packet Loss, PL)定义为用户在切换过程中丢失或减少的数 据包岡。在IETF方案中切换过程中没有数据包缓存机制。因此，PL和会话恢复 间隔和数据传输率入成正比。
会话恢复时间T^F定义为一个给定会话在切换之前发送的最后一个数据包 到切换之后收到的第一个数据包之间的时间间隔。丢包率的计算公式如下:
PL?f=&愛	(3-7)
会话恢复时间的计算公式如下：
= Q捋f —dMU_MAAR (c)) + dlMAR_MAAR (d) + dKfU_MAAR (d)
b. VDMM方案
前面已经给岀了 VDMM方案中用户的切换过程和信令流程。在VDMM方案中， 当用户接入到网络后，它将会被分配一个唯一的虚拟AP。而当控制器通过切换 预测得知用户将从一个物理AP切换到另一个物理AP后，控制器会通过信令在新 的AP上为用户克隆出一个虚拟APo由于VAP中保存着链路层和网络层的相关信 息，所以用户并不需要重新进行链路层和网络层的配置，因此切换延迟将会大大 降低。
对于用户来说，一直是同一个虚拟AP为其服务，因此用户感受不到网络侧 的变化，实现了用户在不同AP间的无缝切换。和IETF方案相似，VDMM方案的 切换延迟(HL)的定义是用户能够通过API (MN原来接入的AP)接收/发送数据 包的最后的时刻tl到用户能够通过AP2 (MN切换后的AP)接收/发送数据包的 最初的时刻t2之间的时间间隔。
VDMM方案相对于上面介绍的IETF DMM方案增加了切换预测和切换准备阶 段，因此需要对这一阶段的信令流程进行分析。VDMM方案的切换准备阶段的时 间轴如下图3T4所示。首先，API通过二层(L2)信令检测到切换即将发生并 触发切换准备过程。API向控制器发送VAP Move Request消息，消息携带MN3

即将迁移到的AP信息(AP2_IP)和MN3的虚拟AP (VAP3)的状态信息。控制器 收到VAP Move Request消息后，得知用户即将移动到AP2,控制器向AP2发送 消息VAP Duplication消息，消息携带MN3的虚拟AP (VAP3)的状态信息，状 态信息包括BSSID,操作信道等信息。AP2收到VAP Duplication消息后，通过 消息携带的VAP3的状态信息在AP2上克隆一个VAP3O AP2更新它的映射表 <MN3-IP, VAP3-ID>O控制器更新它的映射表，将MN3当前所在AP更新为AP2-IP, 映射表项为<MN3-IP, VAP3-ID, AP2-IP>0 AP2向控制器返回确认消息VAP Move
Confirm0控制器向API发送VAP Release消息，API释放VAP3。此时，切换准
备阶段工作完成。

图3-14 VDMM方案切换准备阶段

1 匸	q	土 M長一4	书			aq
T E		>

图3-15 VDMM方案切换延迟
如图3-15所示是VDMM方案的切换延迟。
与IETF的切换方案类似，VDMM方案的切换流程也包括下面三个部分:
rpVDMbd 	 rrt , rrt . rrtVDMM
lHL = 1L2 ^1Auth Binding
匕2代表链路层建立延迟，即用户接入AP时建立链路层连接的时间;
乙効代表验证用户身份的延迟，即用户接入AP时验证用户身份的延迟;
嘴議代表VDMM方案绑定注册过程的延迟。
下面计算VDMM方案的切换延迟，用户身份验证延迟一般变化不大，可以认 为是常量，因此主要计算绑定注册过程中的延迟以當，如图3T5所示，璞# 的计算公式如下：
環# =2电好）+瓏	（3-10）
MN3移动到AP2后，向AP2发送接入请求消息RS。AP2收到RS消息后， 由于此时MN3的虚拟AP己经迁移到AP2,所以MN3可以直接与AP2建立连接而 无需再执行一次连接过程，不会产生额外的2层和3层的处理消息。连接建立后， AP2返回给用户RA消息。
在公式3-10中，7#是AP的处理时间。
始“?是用户和AP之间通过无线链路传输控制包的时间延迟，计算公式 如下：
"mn-ap (c)=('
其中〔是控制包的平均大小，是无线链路带宽，九是无线链路传输延 迟，与是无线链路失败的可能性。
上面已经介绍了丢包率的定义，丢包率（Packet Loss, PL）定义为切换过程 中丢失或减少的数据包。目前在VDMM方案的切换过程中没有数据包缓存机制。 因此，和上面类似，丢包率PL和会话恢复间隔和数据传输率入成正比。
会话恢复时间洗定义为一个给定会话在切换之前发送的最后一个数据包到 切换之后收到的第一个数据包之间的时间间隔。丢包率的计算公式如下：
pT — 2 T ^rNFV-DlM
r知为枷一儿SR	3
会话恢复时间的计算公式如下：
=。曾 -+ d奸妃⑷ + dg仙（d）	（3-13）
上面的公式是在VDMM方案没有数据包缓存机制时计算的丢包率。但在上一 章的方案流程中，我们可以继续对VDMM方案进行拓展。可以拓展AP使其具有数 据包缓存的机制，这样当用户离开API后，API缓存由对端发送过来的数据包， 当控制器感知到用户的迁移后，下发指令控制用户的虚拟AP也进行迁移，此时 可以将用户的虚拟AP和缓存的数据一同迁到AP2上，这样可以最大程度的减少 丢包?
具体做法是：当MN3从API切换到AP2时，API检测到用户离开，则启动数据包缓存机制。当MN5继续向API发送数据包时，由于此时找不到MN3,则API 会将数据包进行缓存，当MN3切换并接入AP2后，控制器下发指令将MN3的虚拟 AP从API切换到AP2,同时将API中缓存的发给MN3的数据也切换到AP2,之后 MN5发送给MN3的数据包则可以直接发送到AP2,由AP2转发至MN3。这样做可 以避免用户在接入到新的AP后由于没有对数据包返回确认帧而引发TCP重传机 制重传数据包，而且可以尽可能的减少丢包。
若对VDMM方案进行上面的拓展使AP能够支持数据包缓存机制,则此时VDMM 方案的丢包率可以认为是0。
（3）信令开销
信令开销的定义是移动节点切换过程中，移动性管理信令的总开销。本方案 中信令开销的定义为切换相关的信令在发送过程中经过的路由器跳数与单个信 令消息开销的乘积之和。因此，单个信令开销越大，信令发送过程中经过的路由 器越多，则总的信令开销越大。因此，在IETFDMM方案中，如果MAAR和 CMD之间距离越小，则PBU/PBA信令开销越小，同样如果MAAR之间的距离 越小，则隧道建立过程中的信令开销也就越小；而在我们的VDMM方案中，如 果控制器Controller和AP之间的距离越来越小，则PBU/PBA信令开销越小，而 如果AP之间的距离越小，则用户在不同的AP之间切换时产生的信令开销就越 小。
根据方案描述，信令开销C可以分为2部分：1）移动节点位置更新过程的 信令开销G，“g； 2）隧道建立过程中信令开销Gsa。即
C 一 ^update + C丽肅
在IETF DMM方案中，移动节点切换后，节点之前连接的sMAAR与节点 当前连接的nMAAR通过PBU/PBA消息与CMD通信更新节点位置信息，同时 sMAAR与nMAAR之间建立隧道，因此，信令开销的计算公式如下：
(3-14) (3-15)
而在VDMM方案中，移动节点切换后，AP与Controller之间通过VAP Move Request/VAP Duplication/VAP Move Confirm消息在节点新接入的AP上为节点 克隆一个虚拟AP,而VDMM方案不需要建立隧道，因此减少了建立隧道的信 令开销 J。因此VDMM方案的信令开销为：
C = Cupdate = 4*仙,Conger * ^AP-Con	(3-17)
假设在相同网络环境下对比2个方案，则	皿与Cgc。”可近似相等，
因此从上面的分析结果可以看出VDMM方案的信令开销要小于IETFDMM的信 令开销。
3.2移动性管理切换过程中的流量优化(ALB)
3.2.1问题分析
从3.1的内容我们可以看出，VDMM方案能实现无缝切换，主要是因为方案引 入了虚拟化的思想，方案为每一个接入的用户分配一个唯一的虚拟AP,虚拟AP 能够实现物理AP的全部功能，对用户来说，虚拟AP和物理AP没有区别。
当用户主动从一个AP切换到另一个AP时，控制器能够将为用户分配的虚拟 AP从用户原来接入的AP切换到新的AP上，对于用户来说，为其服务的一直是 同一个虚拟AP,虚拟AP拥有链路层和网络层中连接建立所需的相关状态信息， 因此用户切换后重新建立连接的时间大大降低，而且此方案无需建立隧道，减少 了隧道开销。因此VDMM方案实现了用户在不同AP间的无缝切换。
在移动性管理中，除了切换时延长之外，还普遍存在一个问题，即当大量用 户接入网络中时，网络中的AP可能会产生负载不均衡的问题。最近几年，随着 互联网络的飞速发展，智能移动终端的数量也在迅速增长。在2014年无线网络 的渗透率已经就已经增长到了 91. 5%,而这个数字在8年前才是14%。为了满足 无线网络WLAN中用户的流量负载，我们周围部署了越来越多的AP。而且AP的 数量还在不断的增长[43>46]o
在一些场景中(如会议，教室等)，数以百计的无线设备试图在短时间内连 到一个AP上，这有可能会导致AP过载。而在无线网络WLAN中AP过载会造成吞 吐量低和负载不均衡的问题。因此在这些场景中，负载均衡变成了一个非常严重 的问题由她。
为了解决负载均衡的问题，现有的方案中提出了多种负载均衡算法。然而， 在当前的无线架构中仍然存在一些问题。首先，由于现有的管理机制缺乏灵活性, 很难添加新的控制协议到当前部署的AP上。其次，由于缺乏AP之间的协作，一 个AP的信号经常会被附近的AP所干扰。我们需要的是一个更加灵活的，可扩展 的可以集中控制的网络架构网。
现有的接入控制协议和负载均衡算法有以下几种。
SSF (Strongest Signal First)方法是定义在IEEE802.11标准上的传统的接入机制。它的接入机制是设备会选择具有最强的RSSI的AP接入。这个方法在 切换方案中被广泛采用。
LLF (Least Load First)是最简单的负载均衡方案。它的接入机制是用户 选择具有最少用户数的AP接入。其他文章中也做过相应的改进，如同时考虑用 户的带宽需求，也可以在接入控制中考虑所有用户之间的公平性。
还有一种常用的负载均衡方法称为小区呼吸(Cell Breathing)。在CDMA 蜂窝网络中Cell Breathing已近被广泛的研究过，在Cell Breathing方法中， 不需要考虑用户的位置信息，控制器只需要逐步调整负载最高的AP的beacon power,直到所有AP的负载均衡。
文章［46］基于SDN提出了一个负载均衡方案。提出的方案包括时间监测机制 和一个控制器上的自适应的负载均衡算法。通过SDN的概念，文章使用控制器来 收集AP的负载和用户连接状态。基于控制器的整体的视角，设计了一个算法来 做接入控制，具体如下。当控制器检测到AP的负载不均衡时，控制器会自适应 的设置相关AP的beacon powero在这种情况下，一些用户会从weak power的 AP改变接入到strong power的AP上。在文章的算法中，控制器能够基于网络 负载和接入的用户数得到一个更好的接入方案，以减轻网络负载不均衡的问题。 仿真实验基于平均的AP负载，用户带宽和用户吞吐量，与现有的方案进行对比 得出结论。
文章［44］分析了目前EWLAN网络中存在的负载均衡的问题。无线用户扫描所 有可能的AP,然后独立的选择信号强度最大的AP来接入，不需要考虑AP的负 载状态。这常常会引起AP上的负载不均衡，导致丢包率高，网络吞吐量低等问 题，严重降低了用户体验。传统的负载均衡算法是基于RSSI的，但存在一些缺 陷，比如不能在多个无线信道之间提供无缝的移动性，并且经常会引起AP上用 户接入的不平衡，这会严重影响用户体验。为了解决EWLAN中这些特有的负载均 衡问题，运营商提供了专有系统和设备来解决它们。但是这些方法并没有开源的 编程接口，不能够大范围推广。作者利用了 SDN为网络管理提供的灵活性和可编 程性，将SDN应用到目前的EWLAN网络中，提出了一个基于AP负载和RSSI值的 自适应负载均衡算法，减轻了 EWLAN中存在的网络负载不均衡的问题。但文章中 的方案存在着一定的问题，首先文中通过公式计算了信道负载，AP负载，而文 中对这两个参数的计算公式却没有给出相应的推导；其次，文章后面的仿真验证 部分，只选取了 4个AP和6个用户，实验数据较少，因此得出的结论不够有说 服力。
3.2.2算法思想
在3.1节中，我们提岀了一个基于虚拟化的VDMM方案。VDMM方案可以实现 用户在不同AP之间的无缝切换，并且无需像IETFDMM方案需要建立隧道，减少 了隧道开销，降低了切换延迟和丢包率。因此，VDMM方案对实现网络AP之间的 负载均衡也有一定的优势。将负载均衡算法部署在控制器上，当控制器通过一定 条件判断发生了负载均衡后，执行负载均衡算法，通过VDMM方案将虚拟AP从高 负载AP迁移到低负载AP上，实现AP间的负载均衡，使网络吞吐量最大化。
负载均衡是WLAN中非常重要的一项技术。在传统方案中，无线用户扫描所 有可能的AP,然后独立的选择信号强度最大的AP来接入，而不需要考虑AP的 负载状态。这常常会引起AP上的负载不均衡，导致丢包率高，网络吞吐量低等 问题，这会严重降低用户体验圆血。传统的负载均衡算法是基于RSSI的，但其 中存在一些缺陷，它们的共同点是都没有考虑到AP的负载状况。基于RSSI的负 载均衡保证用户总是连接到信号最强的AP上熨闵。然而，这并不能保证最好的 用户体验因为信号最强的AP可能负载最重。因此，当设计负载均衡算法时需要 同时考虑RSSI和AP负载。
算法的具体思想如图3-16和3-17所示,网络中有两个AP分别是API和AP2, 三个用户分别是MN1，MN2, MN3o由于API的RSSI值比AP2的RSSI值大，因此 这三个用户初始接入时都接入了 API, AP2上没有接入用户，所以API的负载会 迅速增长，而AP2的负载则为0。控制器通过两个AP的负载判断API和AP2发 生了负载不均衡，然后执行自适应的负载均衡算法，算法将负载最小的MN3从 API切换到AP2,控制器判断此时AP负载均衡，算法执行完毕。

图3-16 VDMM方案实现负载均衡

图3-17 VDMM方案实现负载均衡
从上面的描述可知，如何判断网络中发生了 AP负载不均衡以及如何找到负 载较低且信号强度合适的AP并将用户从高负载的AP迁移到此AP上是算法需要 解决的主要问题。基于以上的问题，我将基于VDMM方案提出一个适应性的负载 均衡的算法来解决AP的负载不均衡问题，算法使用AP的负载状况和RSSI值作 为负载度量。在控制器上部署自适应负载均衡算法，控制器保证了网络的集中视 角，能够定期的检查每个AP的负载状况。一旦检测到负载不均衡的情况发生， 控制器就会主动的重新分配无线用户到负载较低、RSSI值相应较好的AP上，直 到网络中AP负载均衡。算法的具体内容以及执行过程将在下一部分进行介绍。
3.2.3算法设计
那么控制器如何获得AP的负载呢？我们在前面已经介绍过VDMM方案中用户 的接入过程，主要过程为，首先是用户向AP发送申请接入消息，AP进行身份验 证之后通过绑定更新消息向控制器注册用户信息，控制器收到绑定更新消息后， 若判断用户是首次接入此网络，则控制器为用户分配唯一的虚拟AP,然后控制 器和AP更新映射表项，AP向用户返回确认消息。
从上面的接入过程可以看出，控制番会为每一个接入的用户分配一个唯一的 虚拟AP,并在控制器和AP中为用户和它的虚拟AP建立映射表缓存它们之间的 关系。因此我们可以知道每一个物理AP的负载就是所有接入它的用户的虚拟AP 的负载之和。为了得到每个虚拟AP的负载，我定义了一个叫做FORWARD-VAP-LOAD 的协议信令。格式如图3-18所示。信令头和虚拟AP负载值以长字符串的格式存 储。这个信令的功能是定期向控制器发送每一个虚拟AP的负载情况。然后由控 制器计算所有物理AP的负载。

Packet
Headroom	Message Header
ForWARD-NAP-LOAD	Message Dats- NAP
LOAD VALUE	Tail room
图 3-18 FORWARD-VAP-LOAD 信令格式

控制器每收到一个FORWARD-VAP-LOAD信令，就会将此虚拟AP的负载值、虚 拟AP标识和虚拟AP所在物理AP地址发送至中心管理模块。中心信息管理模块 保存有两个映射表，一个保存了虚拟AP标识、虚拟AP负载以及虚拟AP所造物 理AP地址之间的映射关系，另一个保存了物理AP地址和物理AP负载的映射关 系。中心管理模块收到FORWARD-VAP-LOAD协议信令后更新两个映射表的相应表 项。我们提出的自适应负载均衡算法（ALB算法）就是在控制器的中心管理模块 实现的。
由此可知，中心管理模块会得到所有虚拟AP的负载值，然后更新映射表， 并可以计算所有物理AP的负载值。一旦控制器判断得知AP负载的最大值和最小 值之间的差值大于之前我们设定的阈值，中心管理模块就会认为网络发生了 AP 负载不均衡的情况，然后开始执行负载均衡算法，控制器通过判断从负载最高的 AP上选择一个用户，将此用户的虚拟AP迁移到一个负载较低，RSSI值相对好的 AP上，重复执行上述迁移过程，直到网络中AP负载均衡。
控制器每隔固定周期（如20s）获取当前每个物理AP的关联用户和用户的虚 拟AP标识，为所有用户建立列表玖％ ,为所有用户的虚拟AP建立列表Lis% O 虚拟AP会定时向控制器发送虚拟AP的相关负载信息，包括虚拟AP标识，虚拟 A。负载以及虚拟AP所在的物理AP地址。控制器收到后，更新映射表，并计算 网络中所有物理AP的负载。然后控制器得到网络中所有AP的最大负载2。“7皿和 最小负载load讪，通过定义负载不均衡的条件（负载不均衡条件的设置是参考 文章［44］中自适应负载均衡算法），判断是否发生负载不均衡。若判断发生了负 载不均衡，则执行自适应负载均衡算法，重新分配乃如中的虚拟AP,对于每个 虚拟AP,寻找负载和RSSI都合适的AP,将其迁移过去，直到网络中的负载均衡， 具体执行步骤如下。
（1）	自适应负载均衡算法在控制器上作为应用部署，每隔20s询问获取当 前每个物理AP的关联用户和用户的VAP标识，为所有用户建立建立列表反sfg， 为所有用户的虚拟AP建立列表Lis%。
（2）	一旦获得了用户的列表，应用从中心信息管理模块获得AP的最大负载 值［。叽亦和最小负载值1。洞min。
（3）	判断是否发生负载不均衡。算法认为发生负载不均衡的条件是： Load血宓 > Loaded，并且（Loa、- Loadmm） >0. 6* Loadlhreshold …
第一个公式表示有最大负载的AP负载值超过负载阈值/。。《为瑚出；
第二个公式表示最大负载值和最小负载值得差大于负载阈值的60%,说明发 生了负载不均衡的情况。
若判断发生了负载不均衡，则跳到(4),否则返回(1) o
(4)若发生了负载不均衡，则执行自适应负载均衡算法。
算法执行过程如下：.
a.选择迁出AP,即APfmm ；
选择负载最大即Loadm宓的AP作为APfr6m ,即迁出AP；
b.选择迁出用户的虚拟AP,即泊乌；
在APfmm下选择虚拟AP负载Zoad”缨*/最大的用户MNj,用户的虚拟AP标识 是 NAPj。
c.选择迁入AP,即Zg。；
.首先选择负载最小的AP为他,即迁入AP。则它的RSSI值为RSSZ，。，将跡叫。 和RSSI阈值跆丑心湖进行比较，RSS7心湖提前设定为200。阈值的配置是参 考文章[44],考虑到RSSI对网络吞吐量的影响，文章中提出RSSI超过200时能 够提供相对较好的网络吞吐量。因此，可以保证用户被重新分配到负载低的AP 上后能够有一个好的QoE。实后RSSI,不大于RSSJd，则算法需要找到负载 第二小的AP做为，然后将它的RSSI值作为夫SS/,°。重复上述过程，比较商57,° 和RSSJm,直到码％° >RS必瑚汨，说明此AP的信号足够强能够提供好的 网络吞吐量，则确定此AP作为
(5)控制器发送切换指令切换用户；
控制器向&%“，发送切换指令，将用户MNj的虚拟NPNAPj歸Pf切换到这 个具体切换过程可以参考上面方案的切换过程。
算法持续重复上面(3) (4)的过程直到网络中的AP负载均衡，之后算法 将会休眠一个时间间隔冗屛r,再进行下一次的负载均衡判断，重复上述的过程。
如图3-19所示是ALB算法的执行代码。
7：	if i	此x > SsJ好 f 皿
身虬)x*矿
8： Get' ；A^ 如 jj缗
9:	for	e ￡境五如
W* 有袞彳琮寡密壬
此	邮戒I站
0	ttoiiW?画EL冬,，妈：,涵p
毋	t^e
14:	Ger t tie next	心吼
15：	野碎^>彻1族5
16：	5 而iA典妈 AP^ ,妃,NAP,)
17:	eadff
18:	.—關 if

图3-19 ALB算法

3.3本章小结
本章的主要内容是基于虚拟化的分布式移动性管理切换优化方法的设计。
首先分析了分布式移动性管理方案中存在的问题，包括终端需切换时延长， 转发路径非最优，以及建立双向隧道的开销大等问题。针对分布式移动性管理方 案中存在的问题，本章提出了基于虚拟化的VDMM方案。下面介绍了方案的主要 设计思想以及方案的主要场景，包括用户接入注册，用户切换过程，以及切换前、 切换中、切换后三中数据通信过程，然后给出了分布式移动性管理的分析模型， 根据现有移动性管理方案分析模型，给出了针对本文方案的移动性管理切换性能 分析的理论模型，即切换延迟模型。
然后分析了分布式移动性管理中存在的流量优化的问题，即目前在WLAN网 络中普遍存在的多个AP之间负载不均衡的问题。为了解决这个问题，本章提出 了一个自适应负载均衡ALB算法。算法是基于上文中提出的VDMM方案，首先， 文章提出了一个负载不均衡的检测机制。若通过判断条件判断网络中出现了 AP 负载不均衡的状态，则控制器执行负载均衡算法，将用户的虚拟AP从负载高的
AP快速地迁移到负载较低且RSSI值合适的AP上，直到网络中的AP负载均衡。 然后介绍了算法的执行过程并给出了算法的代码，
第四章性能分析和验证
在上一章我们首先分析了目前分布式移动性管理方案中存在的切换时延长、 隧道开销等问题，并针对这些问题提出了我们的VDMM方案，介绍了方案的的设 计思想以及方案涉及的主要场景，包括用户首次接入AP、用户从一个AP切换到 另一个AP以及用户在切换前、切换中、切换后的数据通信流程；然后分析了目 前分布式移动性管理切换过程中存在的流量分配不均匀的问题，即网络中不同的 AP之间可能会产生负载不均衡，并针对这个问题提出了一个自适应负载均衡ALB 算法，给出了算法的设计思想和具体的实现代码。这一章的主要内容就是针对上 一章提出了方案和算法给出性能分析和验证。
4.1 VDMM方法性能分析与讨论
4.1.1实验环境部署
本文的VDMM方案的验证使用的是Docker平台?Docker是一个开源的容器虚 拟化平台，Docker平台提供了在容器(松散和隔离性的环境中)中进行应用程 序的打包和运行的功能。Docker具有隔离性和安全性，因此允许在指定的主机 上运行多个容器。容器是轻量级的，因为它们不需要管理程序的额外负载，但是 需要在主机的内核中运行。你甚至可以在实际上是虚拟机的主机中运行Docker 容器。
Docker中有两个重要概念，一个是镜像(Image),另一.个是容器 (Container)。容器就是利用Docker构建出来的虚拟环境。镜像类似于虚拟机 中的镜像，利用Docker运行镜像即可还原出构建的容器。通过配置环境变量可 以形成自己的镜像。如图4-1所示是Docker的结构图，不同于传统虚拟机技术, 为每一个环境虚拟了一整套物理硬件并搭载完整的操作系统，Docker的各容器 直接共享了宿主机的Linux内核，不需要为每个容器重复加载资源，因此节约了 大量的内存空间，启动速度也大大加快。


图4-1 Docker结构图
下面介绍在Linux系统上安装Docker平台的步骤: a.首先输入“yum check-update"更新包数据库；

图4-2更新yum库
b.输入“yum install docker命令安装 Docker：
[rootslocaIhost yum install docker
图4-3 Docker安装
安装完成后，提示安装成功：
Installed：	...	§
docker.x86_64	.3-59.el?.centos
Dependency I nsta 11 ed ?:
audit-1ibs-pythDB?0：2.6.5-3.el? docker-coswin.x86_64 2:1.10.3-59.el7,centos 1ibsemanage-python.x86_64 8：Z.5-4.el?
policycoreutiIs-python.x86_64 0：Z.5-9?el? yaJI.x86_64 6：Z.0.4-4.el?
Complete?
[root@ loca Ihost ~箱
图4-4 Docker安装成功
4.1.2功能模块开发
如图4-5所示是使用Docker平台仿真部署的VDMM方案拓扑图。实验平台需 要三台PC,其中两台作为终端MN和CN,另一台安装Docker平台模拟VDMM网络 结构。如图，虚线内是我们使用Docker容器编写代码模拟网络中各个元件的功能结构，以此构建出整个网络。
如图中所示，API, AP2和AP3是网络中的AP。初始构建网络时，CN接入API, 在API中为CN构建VAP1； MN接入AP2,所以在AP2为MN构建VAP2； Controller 负责管理整个网络中的AP。当MN由AP2移动到AP3时，在AP3上为MN创建一 个新的虚拟AP (VAP3),对MN来说VAP3和VAP2完全相同。

图4-5 VDMM方案拓扌卜

如图4-6所示是在Docker平台上搭建虚拟AP的功能模块图。VDMM方案中 虚拟AP的实现模块主要包括接入处理模块，消息处理模块，位置管理模块和加 密/解密模块等，共同实现了虚拟AP的基本功能。模块之间的实现过程如下，用 户接入网络时向AP发送接入请求申请接入，由接入处理模块来处理用户请求， 通过函数register向控制器进行接入注册，并在控制器建立用户相关的映射表 项；通过位置管理模块缓存用户信息，包括用户相关的ID、IP地址等信息。用 户向AP发送数据，AP收到数据后交由消息处理模块进行处理，消息处理模块对 数据进行解析处理，若AP已知目的地址的位置则直接进行转发，否则AP需要先 向控制器进行查询用户当前所在位置后再转发；加密/解密模块可以对数据进行 安全处理。每个模块的具体实现如下：
理模塊	密模块		　二三倉
逢生二	…

Virtualization Platform
虑尖:泓	i
Network	Storage
图4-6虚拟AP功能模块

(a)接入处理模块
由于本文的AP是在Docker平台虚拟出来的，因此只实现AP的基本功能， 并不包括AP的其他管理功能，如DHCP服务器，防火墙等等。接入处理模块是当 用户接入此AP时，虚拟AP处理用户接入请求的模块。AP收到用户接入请求后, 通过函数register向控制器进行接入注册，在控制器建立用户相关的映射表项。 控制器存储网络中所有用户的移动上下文信息，便于网络中的AP进行查询。
register函数定义如下：
register(String serviceName, int port) throws Exception (
String strKey = MessageFormatfonna^"/{0}/{1 }/{2}: {3 } n, rootPath, serviceName, IpHelper.getHostIp(), String.valueOf(port));
ByteSequence key = ByteSequence.fromString(strKey);
ByteSequence val = ByteSequence.fromStrmg(getSystemLoadO)；
kv.put(key, val, PutOption.newBuilder().withLeaseId(leaseId).build()).getQ; Iogger.infb(MRegister a new service at:" + strKey);
)
(b)消息处理模块
消息处理模块的功能是处理用户的移动上下文信息。AP收到消息后，将消息 转发至消息处理模块，该模块对消息进行处理，解析出消息的目的地址，若AP 已知目的地址的位置则直接进行转发，否则需要向控制器进行查询后再转发。
消息处理函数messageProcess具体实现如下：
FullHttpResponse response = new DefaultFullHttpResponse(HTTP_l_l 5 OK, Unpooled. wrappedBufier(rpcFuture.getResponse0.getValue().getBytesO))；
response.headers().set(CONTENT_TYPE, Htext/plainH); response.headers0.setInt(CONTENT_LENGTH?
response.content().readableBytesO)；

if (!keepAlive){ ctx.writeAndFlush(response).addListener(ChannelFutxireListener.CLOSE);}else
( response.headers0.set(CONNECTION, KEEP_ALIVE); ctx.writeAndFlush(response);}
(c)位置管理模块
位置管理模块的主要功能是维护接入此AP的用户的相关信息。当用户接入
AP后，AP为其初始化缓存映射表信息，缓存节点相关的ID、IP地址等信息。 初始化函数init具体实现如下： init(SocketChannel ch) (
Channelpipeline p = ch.pipelineQ;
p.addLastC'encoder", new HttpResponseEncoder());
p.addLast(Mdecodern, new HttpRequestDecoder()); p.addLast(naggregator,\newHttpObjectAggregator(10 * 1024* 1024)); p.addLast(new ConsumerAgentHttpServerHandler(consumerClient5 executorService));}
4.1.3性能分析
(1)利用Docker平台验证VDMM方案
本节首先验证VDMM方案的可行性。验证步骤如下:
a.在Docker平台模拟网络元件，MN, CN接入网络，分别为它们创建VAP2, VAPL 如图4-7所示在Docker平台初始化网络元件VAPL VAP2和Controller。图4-8
生成网络元件的Docker镜像并部署到容器中运行。

图4-7网络元件初始化
图4-8生成Docker镜像
b.如图4-9测试MN和CN的互通性:

图4-9 MN和CN之间的互通性
c.测试VLC视频流，CN端作为VLC服务端，MN作为客户端来播放VLC视 频流，检查视频流是否能在MN端播放，MN切换到新的AP之后，观察MN端 播放的视频是否流畅。如图4-10所示，MN切换到新的AP之后，在新AP上为 MN克隆一个虚拟AP,对MN来说两个虚拟AP没有区别。测试结果为，MN 移动到AP3时，视频流业务不中断，仍保持连续。
曇涉樓 lootli(g)lootlM>43-￡S3G: -
lootii@Loctii-P43-ES3G:sudo docker	P5
CONTAINER ID	　IMAGE	　COMMAND	CREATED
STATUS	　　　PORTS	NAMES
a080a316ellc	　43e?b?ccbfe4	　"docker-entrypoint.s-w	2S	> second:	5 sg。
Up 27 seconds		ap3
i>489a7323d97	　43e6b9ccbfe4	　"docker-entrypoint.s^	4	ninutes	ago
Up 4 ninutes		ap2
F558dc925395	　43eGb0ccbfe4	　"docker-entrypolnt.s_"	4	ninutes	ago
Up 4 minutes		apl
285901fea887	　ff8ecSd52246	　"/usr/local/bin/eted"	8	ninutes	ago
Up 8 ninutes	　　　6.8,e.B:2379'>2379/tCp, 2389/tcp controller
loDtii^locttx-P4 3-	ES3G：~$ |

图4-10 MN和CN之间的互通性
（2） VDMM方案和IETF DMM方案性能对比
上面我们已经分析了 IETF DMM方案和我们提出的VDMM方案的切换过程和信 令交互流程,并通过数学建模分给出了切换延迟，丢包率和信令开销的计算公式。 并已经通过Docker平台进行了仿真验证。下面根据公式对切换延迟，丢包率和 信令开销进行定量的分析。给出参数的参考数值，经过计算得出结果并画出对比 分析图，通过对比分析图能够直观的对两个方案的性能进行对比。
方案默认的参数值参考自文章關，默认参数的参考数值为：TL2 （二层切换 延迟）=200ms,以〃，（身份认证延迟）=100ms, Lc （控制包大小）=80bytes, Ld （数据包大小）=400bytes, BW （有线链路带宽）-100Mbps, BWw （无线链路 带宽）=10Mbps, I （有线链路传输延迟）=0. 5ms, lw （无线链路传输延迟）=2ms, 暧D=20ms, 建#=10ms, pf （无线链路失败率）=0.5, B=500KB, r （子网半 径）=1000m°
a.切换延迟
为了对IETF方案和VDMM方案进行比较，在相同的参数条件下（相关参数已 近在上面给出），分别计算两个方案的切换延迟进，并画出了如图所示的对比分 析图。

° 2。1UUU ZUUU 5UUU 4UUU bUUU bUOO
Radus of Cells（m）
图4-11子网半径-切换延迟
如图4-11所示是在其他条件相同，子网半径r从1000m增长至6000m, IETF 方案和VDMM方案的切换延迟的对比图，子网半径每次增长500米。横坐标表示 子网半径，单位是米，纵坐标表示切换延迟，单位是秒。图中粉色曲线表示IETF 方案中的切换延迟，绿色曲线表示VDMM方案的切换延迟。
从图中可以看出，当子网半径从1000m增至4000m的过程中，随着子网半径的増加，IETF方案和VDMM方案的切换延迟都有轻微的减少，这是因为子网半径 增加，则网元之间的平均跳数减小，因此信令传输时间降低，所以切换延迟也会 减小；但当子网半径大于4000m后，IETF方案和VDMM方案的切换延迟变化不大, 这是因为当子网半径达到一定的大小后，即使继续增长，网元之间的平均跳数变 化也不大，因此切换时延变化不大。但从两个方案的整体性能来看，IETF DMM 方案的切换延迟主要分布在500ms左右，而我们的方案的切换延迟主要分布在 440ms左右，整体的切换延迟下降了约12%。



图4-12无线链路失败率-切换延迟
如图4-12所示是在其他条件相同，无线链路失败率p,从0增长至0. 8, IETF 方案和VDMM方案的切换延迟的对比图，其中无线链路失败率每次增长0.1。横 坐标表示无线链路失败率P,,纵坐标表示切换延迟，单位是秒。图中粉色曲线 表示IETF方案中的切换延迟，绿色曲线表示VDMM方案的切换延迟。
从图中可以看出，随着无线链路失败率的增加，IETF方案和VDMM方案的切 换延迟都有所增长。这是因为一旦无线链路发生故障，则用户和AP或锚点之间 的信令交换会受到影响（如RS和RA信令），因此切换延迟会有所增长。但从两 个方案的整体性能来看，IETF方案的切换延迟主要分布在500ms左右，而我们 的方案的切换延迟主要分布在440ms左右，整体来看切换延迟下降了约12%o
综上所述，在切换延迟的方面，本文方案的切换延迟整体要小于IETF DMM 方案，而且从图中可以看出，我们方案的切换延迟波动幅度更小，说明方案的稳 定性更好。因此从切换延迟来看，本文的方案要由于IETF DMM方案。
b.丢包率
为了对IETF方案和VDMM方案进行比较，在相同的参数条件下（相关参数巳经在上面给出），对两个方案的丢包率进行了比较，并画出了如图所示的分析图。

图4-13子网半径-丟包率
如图4-13所示是在其他条件相同，子网半径r从1000m增长至6000m, IETF 方案和VDMM方案的丢包率的对比图，子网半径每次增加500米。图中横坐标表 示子网半径，单位是米，纵坐标表示丢包率，单位是X10Kb/s。图中粉色曲线表 示IETF方案中的丢包率，绿色曲线表示VDMM方案的丢包率。
从图中可以看出，当子网半径从1000m增至4000m的过程中，随着子网半径 的增加，IETF方案和VDMM方案的丢包率都有所降低，这是因为子网半径增加， 则网元之间的平均跳数减小，切换延迟也会减小，因此丢包率也会下降；但当子 网半径大于4000m后，IETF方案和VDMM方案的切换延迟变化不大，这是因为当 子网半径达到一定的大小后，即使继续增长，网元之间的平均跳数变化也不大， 因此切换时延变化不大，因此丢包率变化不大。但从两个方案的整体性能来看， IETF DMM方案的丢包率主要分布在80Kb/s,而本文的方案的丢包率主要分布 65Kb/s左右，较IETF DMM方案整体下降了 20%左右。




CT! CT2 U3 (T5	03 U7B CE7 UT
Probability of Wireless Link Fail
图4-14无线链路失败率-丢包率
如图4-14所示是在其他条件相同，无线链路失败率Pf从0增长至0. 8, IETF 方案和VDMM方案的丢包率的对比图，无线链路失败率每次增长0. 1。图中横坐 标表示无线链路失败率，纵坐标表示丢包率，单位是X10Kb/so图中粉色曲线表 示IETF方案中的丢包率，绿色曲线表示VDMM方案的丢包率。
从图中可以看出，无线链路失败率从0增长至0.5的过程中，随着无线链路 失败率的增加，IETF方案和VDMM方案的丢包率没有明显变化；而无线链路失败 率从0. 5增长至0. 8的过程中随着无线链路失败率的增加，IETF方案和VDMM方 案的丢包率有所增长，但增长幅度并不大。这是因为一旦无线链路发生故障，则 用户和AP或锚点之间的信令交换会受到影响（如RS和RA信令），切换延退会 有所增长，因此丢包率也会随之增长。但从两个方案的整体性能来看，IETFDMM 方案的丢包率主要分布在80Kb/s,而我们的方案的丢包率主要分布65Kb/s,较 IETF DMM方案整体下降了 20%左右。
因此，从上述分析可知，在切换延迟的方面，我们方案的切换延迟整体要小 于IETF DMM方案，而且从图中可以看出，我们方案的丢包率波动幅度很小，说 明方案的稳定性很好，因此从丢包率来看，我们的方案要由于IETF DMM方案。
上面对丢包率的计算是在VDMM方案没有数据包缓存机制的情况下进行的， 但在上面已经分析过，VDMM方案可以在AP中引入数据包缓存机制，在用户离开 之前的AP之后，之前的AP缓存发往用户的数据，当控制器下发指令控制虚拟 AP进行迁移时将AP缓存的数据包一同迁往新的APo此时VDMM方案的丢包率可 以认为是0,则此时VDMM方案的丢包率则大大小于IETF DMM方案的丢包率。
此外，从上一章描述的VDMM方案的主要场景以及信令流程中可以看出，VDMM 方案中是不需要在锚点之间建立双向隧道的，因此不需要额外的隧道开销。而 IETF DMM方案则需要在sMAAR和nMAAR之间建立双向隧道，而且随着节点不断 移动，双向隧道的数量不断增加，隧道开销也就不断增大。就这一点来看，VDMM 方案的性能要比IETF DMM方案的性能高。
c.信令开销
下面对IETF DMM方案和VDMM方案的信令开销进行对比。上面4. 1. 1节已经 分析了 IETF DMM和VDMM方案的信令开销，并给出了计算公式。
C1ETF—D心=^update + Cme/ =	* ^CMD-MAAR	（4-1 ）
= ^update = ^AP.Controller * AP-Con	（4-2 ）
假设在相同的网络情况下，IETF DMM方案和VDMM方案中相似的功能实体的 处理时间近似相同，这样可以便于突出影响方案信令开销的主要因素。因此我们可以假设妬""和瞄,5“近似相同，Gm—妳和G P—Controller 近似相同，则可 以给出下面的公式：
ClETF-I^fM / GoAflf = ^CMDJMAR * ^CMD-MAAR ^^AP,Controller *^AP-Con 3 / 2 (4-3 ) 从上面的公式可以看出，在相同的网络环境下，IETF DMM方案和VDMM方案 的信令开销比近似为3:2,因此可以说我们的VDMM方案的信令开销要小于IETF DMM方案。
4.2本章小结
本章主要是对VDMM方案进行了性能分析和验证。首先4.1节中给出了 VDMM 方案的实验验证，在Docker平台上部署了我们的方案，介绍了功能模块的开发, 并对方案进行了测试设计，通过实验验了 VDMM方案的可行性。然后基于第三 章中提出的分析模型对我们提出的VDMM方案和IETFDMM方案在切换延迟、丢包 率和信令开销方面分别进行对比分析，并在相同的网络环境下，给定相关参数的 取值，然后对这两个方案在切换延迟、丢包率和信令开销两个方面进行了比较， 给出了数学分析的对比图。从方案对比图的结果可以看出，无论是切换延迟、丢 包率还是信令开销，VDMM方案都比IETF方案要小，因此，可以说VDMM方案比 IETF方案性能高。
第五章结束语
5.1论文总结
近几年随着互联网的飞速发展，移动终端的数量迅速增长，人们对网络性能 的要求也不断增加，而移动性正是制约互联网用户体验的重要因素之一。传统的 集中式移动性管理方案如MIP, PMIP中移动锚点是集中式部署的，网络中所有节 点的通信都必须通过这个唯一的锚点，这样做的好处是管理起来比较方便，但容 易引起单点失败和三角路由等问题。为了解决这个问题，IETF提出了分布式移 动性管理（DMM）的想法，即在网络中分别部署多个移动锚点，用户接入网络时 选择离它最近的一个锚点接入，这个锚点负责处理与此用户相关的移动性工作。
分布式部署的移动锚点解决了集中式移动性管理方案中的单点失败和三角 路由的问题。但分布式移动性管理方案中仍存在一些问题，如用户需要拓展支持 多个IP地址，以及方案仍存在转发路径非最优的问题，还有随着用户移动不断 增长的隧道开销等。
为了解决分布式移动性管理方案中存在的以上问题，本文提出了一个基于虚 拟化的分布式移动性管理方案即VDMM方案，此方案是面向网络的。方案为每一 个接入的用户分配一个唯一的虚拟AP,虚拟AP能够实现物理AP的全部功能， 对用户来说，虚拟AP的功能和物理AP是一样的。网络中部署一个控制器，控制 器的功能是管理整个网络的AP和用户，控制器上存储了用户IP,为用户分配的 唯一的虚拟AP的标识以及用户所在AP的IP地址的映射表项，AP上存储了用户 IP和用户的虚拟AP的映射表项。当用户主动从一个AP切换到另一个AP时，控 制器能够将为用户分配的虚拟AP从用户原来接入的AP切换到新的AP上，对于 用户来说，为其服务的一直是同一个虚拟AP,实现了用户在AP间的无缝切换。
本文第四章在Docker平台上部署了我们的方案，介绍了功能模块的开发， 并对方案进行了测试设计，通过实验验证了 VDMM方案的可行性。然后基于第三 章中提出的分析模型对我们提出的VDMM方案和IETFDMM方案在切换延迟、丢包 率和信令开销方面分别进行对比分析，并在相同的网络环境下，给定相关参数的 取值，然后对这两个方案在切换延迟、丢包率和信令开销两个方面进行了比较， 给出了数学分析的对比图。
除了无缝切换，VDMM在解决AP间负载不均衡的问题上也存在一定优势，文 章提出了一个自适应负载均衡算法，算法部署在控制器上，并给出了算法的具体 步骤和算法的代码。

5.2论文展望
本文关注了分布式移动性管理方案中存在的问题，对于部分分布式移动性管 理方案中存在的转发路径非最优，切换时延长以及隧道开销等问题，提出了基于 虚拟化的VDMM方案。并在此方案基础上，提出了一个自适应负载均衡算法来解 决目前网络中普遍存在的网络AP负载不均衡的问题。虽然本论文对目前分布式 移动性管理中存在的问题做出了一定的改进，但是仍存在一些不足的地方。例如 下面几个方面：
（1）	本文提出了基于虚拟化的分布式移动性管理VDMM方案，并介绍了移动 节点的注册过程，节点切换过程以及切换过程中的数据通信流程。方案为每一个 接入用户分配一个唯一的虚拟AP,当用户从一个AP切换到另一个AP时，控制 器发送指令控制用户的虚拟AP从用户之前接入的AP切换到新的AP上。通过数 学建模分析可知VDMM方案优化了切换延时，并且不需要额外的隧道开销。然而， 关于在分布式移动管理架构中虚拟化的应用仍具有研究价值，例如本方案只考虑 了 AP的虚拟化，可以进一步考虑整个架构的虚拟化，最大限度的减少切换时延。
（2）	然后文章基于VDMM方案提出了一个自适应负载均衡算法，通过条件判 断网络是否负载均衡，若出现网络AP负载不均衡的情况则执行自适应负载均衡 算法。将负载较高的AP上的用户的虚拟AP切换到负载较低且RSSI值合适的AP 上，直到网络负载均衡。未来可以考虑实现方案的硬件部署，在真实的网络环境 中对算法进行改进和优化。
另外，在下一代移动性管理方案中，安全性，鲁棒性等问题都是值得研究的 问题。在后续的关于移动性管理的研究工作中，这些问题都需要进一步的讨论研 究。

缩略语
缩写	英文全称	　中文释义
3gPP	　　　3rd Generation Partnership Project	　第三代移动通信合作计划
5G	the fifth generation mobile communication network 第 5 代移动通信网络
C
CMD	　　　Control mobility database	　　　控制移动数据库
CoA	　　　Care of address	　　　转交地址
CN	　　　Correspondent Node	　　　通信对端节点
D
DMM	　　　Distributed Mobility Management	　　　分布式移动性管理
H
HA	　　　　　Home agent	　　　家乡代理
HoA	　　　　　Home address	　　　家乡地址
L
LMA	　　　　　Local Mobility Anchor	　　　　本地移动锚点
M
MAAR	　　　　　Mobility anchor and access router	　　　　移动锚定接入路由
MAG	　　　　　Mobile Access Gateway	　　　　移动接入网关
MN	　　　　　Mobile node	　　　　移动节点
P
PBA	　　　　　Proxy Binding Acknowledgement	　　　　代理绑定确认消息
PBU	　　　　　Proxy Binding Update	　　　　代理绑定更新消息
Q
QoS	　　　　　Quality of Service	　　　　服务质量


参考文献
[1]吴义镇.面向下一代网络架构的移动管理关键技术研究[D].中国科学技术大学，2016.
[2]Wang Y, Bi J. A solution for IP mobility support in software defined networks[C]//
International Conference on Computer Communication and Networks. IEEE, 2014:1-8.
[3]Giust F, Cominardi L, Bernardos C J. Distributed mobility management for future
5G networks: overview and analysis of existing approaches[J]. IEEE Communications Magazine, 2015, 53(1):142-149.
[4]C? Perkins, D. Johnson. RFC 6275, Mobility Support in IPv6[S], IETF, 2011.
[5]S. Gundavelli. REC 5213,Proxy Mobile IPv6[S]. IETF, 2008.
[6]Song B, Shin J, La S H, et al. On minimizing signaling costs for PMIPv6~based
distributed dynamic mobility management [C]// Ubiquitous Computing, Electronics & Mobile Communication Conference. IEEE, 2016:1-7.
[7]Jeon S, Figueiredo S, Rui L A, et al. Distributed Mobility Management for the
Future Mobile Networks: A Comprehensive Analysis of Key Design Options [J]. IEEE Access, 2017, PP(99):1T?
[8]Giust F, Cominardi L, Bernardos C J. Distributed mobility management for future
5G networks: overview and analysis of existing approaches[J]. IEEE Communications Magazine, 2015, 53(1):142^149.
[9]Condeixa T, Sargento S. Distributed mobility management in future networks:
Tunneling or host routing?[C]// Computers and Communication. IEEE, 2016:639-645.	-
[10]JC. Zuniga. RFC 7429, Distributed Mobility Management: Current Practices and Gap Analysis[S].IETF, 2015.
[11]Wagan A A, Jung L T. An efficient distributed mobility management scheme for network mobility[C]// International Conference on Computer and Information Sciences. IEEE, 2016:270-275.
[12]Wang Y, Bi J. A solution for IP mobility support in software defined
networks [C]// International Conference on Computer Conimunication and Networks. IEEE, 2014:1-8.	'
[13]Nguyen T T, Bonnet C, Harri J. SDN-based distributed mobility management for 5G networks [C]// Wireless Communications and NETWORKING Conference. IEEE, 2016.
[14]Ko H, Jang I, Lee J, et al. SDN-based distributed mobility management for 5G[C]// IEEE International Conference on Consumer Electronics. IEEE, 2017:116-117.
[15]Yang H, Kim Y. SDN-based distributed mobility management[C]// International Conference on Information NETWORKING. IEEE, 2016:337-342.
[16]Karimzadeh M, Valtulina L, Berg H V D, et al. Software Defined Networking to support IP address mobility in future LTE network[C]// Wireless Days. IEEE, 2017.
[17]Khanfouci M. Distributed mobility management based on centrality for dense 5G networksEC]// European Conference on Networks and Communications. IEEE, 2017.
[18]Sun K, Kim Y. Gap analysis for adapting the distributed mobility management model in 4G/5G mobile networks[C]// Network Softwarization. IEEE, 2017.
[19]Han S, Park J, Kim H, et al. Mobility of Everything (MoE): An Integrated and Distributed Mobility Management[C]// International Conference on Computer Communication and Networks. IEEE, 2017:1-11.
[20]Balfaqih M, Ismail M, Nordin R, et al. Design and evaluation of network-based distributed mobility management solution based on PFMIPv6[C]// International Conference on Wireless and Telematics. IEEE, 2017:132-139.
[21]Wagan A A, Jung L T. An efficient distributed mobility management scheme for network mobility[C]// International Conference on Computer and Information Sciences. IEEE, 2016:270-275.
[22]Balfaqih 虬 Ismail M, Nordin R, et al. Handover performance analysis of distributed mobility management in vehicular networks[C]// IEEE, Malaysia International Conference on Communications. IEEE, 2016:145-150.
[23]Balfaqih M, Ismail M, Nordin R, et al. Design and evaluation of network-based distributed mobility management solution based on PFMIPv6[C]〃 International Conference on Wireless and Telematics. IEEE, 2017:132-139.
[24]Roth J D, Martin J, Mayberry T. A graph-the oret i c approach to virtual access point correlation[C]// Communications and Network Security. IEEE, 2017:1-9.
[25]Kassahun S, Demessie A, Hie D. A PMIPv6 approach to maintain network connectivity during VM live migration over the internet[C]// IEEE, International Conference on Cloud NETWORKING. IEEE, 2013:64-69.
[26]Lei T, Lu Z, Wen X, et al. SWAN: An SDN based campus WLAN framework[C]// International Conference on Wireless Communications, Vehicular Technology, Information Theory and Aerospace & Electronic Systems. IEEE, 2014:1-5.
[27]Wang L, Lu Z, Wen X, et al. An SDN-based seamless convergence approach of WLAN and LTE networks[C]// Information Technology, Networking, Electronic and Automation Control Conference, IEEE. IEEE, 2016:944-947.
[28]卢莹.5G基站虚拟化基站资源管理关键技术研究[D].华北电力大学(北京)，2016.
[29]Kondo T, Aibara R, Suga K, et al. A Mobility Management System for the Global Live Migration of Virtual Machine across Multiple Sites [C]// Computer Software and Applications Conference Workshops. IEEE, 2014:73-77.
[30]Lee C, Shin S, Chung J M. Enhanced LTE handover scheme using NFV for LTE handover
delay reduction[C]// IEEE International Conference	on	Consumer
Electronics-Asia. IEEE, 2017:1-2.
[31]Prados-Garzon J, Adamuz-Hinojosa 0, Ameigeiras P, et al.	Handover
implementation in a 5G SDN-based mobile network architecture[C]// IEEE, International Symposium on Personal, Indoor, and Mobile Radio Communications. IEEE, 2016:1-6.
[32]Mohandas M, Babu K R R. Live migration of virtual machines in the homogeneous cloud[C]// International Conference on Emerging Technological Trends. IEEE, 2017:1-5.
[33]Ordonez-Lucena J, Ameigeiras P, Lopez D, et al. Network Slicing for 5G with SDN/NFV: Concepts, Architectures, and Challenges[J]. IEEE Communications Magazine, 2017, 55(5):80-87.
[34]Yousaf F Z, Bredel M, Schaller S, et al. NFV and SDN - Key Technology Enablers for 5G Networks[J]. IEEE Journal on Selected Areas in Communications, 2017, PP(99):1-1.
[35]李晨，段晓东，陈炜，等.SDN和NFV的思考与实践[J].电信科学，2014⑻:23-27.
[36]赵明宇，严学强.SDN和NFV在5G移动通信网络架构中的应用研究[J].移动通信， 2015(14):64-68.
[37]Li Y, Chen M. Software-Defined Network Function Virtualization: A Survey [J]. IEEE Access, 2015, 3:2542-2553.
[38]Aissioui A, Ksentini A, Gueroui A M, et al. Toward Elastic Distributed SDN/NFV Controller for 5G Mobile Cloud Management Systems[J]. Access IEEE, 2016, 3:2055-2064.
[39]Wang H, Li Y, Zhang Y, et al. Virtual Machine Migration Planning in Software-Defined Networks[J]. IEEE Transactions on Cloud Computing, 2014, PP(99):1-1.
[40]Gironzaceron M A, Villotajacome W F, Ordonez A, et al. SDN management based on Hierarchical Task Network and Network Functions Virtualization[C]// IEEE Symposium on Computers & Communications. IEEE Computer Society, 2017:1360-1365.
[41]Mekky H, Hao F, Mukherjee S, et al. Network function virtualization enablement within SDN data plane[C]// IEEE INFOCOM 2017 - IEEE Conference on Computer Communications, IEEE, 2017:1-9.
[42]Afolabi I, Bagaa M, Taleb T, et al. End-to-end network slicing enabled through network function virtualization[C]// IEEE Conference on Standards for Communications and NETWORKING. IEEE, 2017:30-35.
[43]Crichigno J, Oliveira D, Pourvali M, et al. A routing and placement scheme for
network function	virtualization[C]//	International Conference on
Telecommunications and Signal Processing. 2017:26-31.
[44]Han Y, Yang K, Lu X, et al. An adaptive load balancing application for software-defined enterprise WLANs[C]// International Conference on Information and Communication Technology Convergence. IEEE, 2016:281-286.
[45]申超，孙丹丹，张洪欣.基于AP选择及自适应切换的负载均衡算法[J].吉林大学学 报(信息科学版)，2014, 32(5):498-503.
[46]Lin C Y, Tsai W P, Tsai M H, et al. Adaptive Load-Balancing Scheme through Wireless SDN-Based Association Control [C]// IEEE, International Conference on Advanced Information NETWORKING and Applications. IEEE, 2017.
[47]Yang L, Cui Y, Tang H, et al. Demand-Aware Load Balancing in Wireless LANs Using Association Control[C]// IEEE Global Communications Conference. IEEE, 2015:1-6.
[48]Alexandras K, Sapountzis N, Nikaein N, et al. Load-aware handover decision algorithm in next-generation HetNets[C]// Wireless Communications and NETWORKING Conference. IEEE, 2016.
[49]Umme Z, Hanene B Y. Dynamic load balancing in SDN-based data center networks. Information Technology, Electronics and Mobile Communication Conference (IEMCON). IEEE, 2017.
[50]Navaratnarajah S, Dianati M, Imran M A. A Novel Load-Balancing Scheme for Cellular-WLAN Heterogeneous Systems With a Cell-Breathing Technique[j]. IEEE Systems Journal, 2017, PP (99):1-12.
[51]Sang X, Wu Q, Li H. Client-network collaborative load balancing mechanism for WLAN based on SDN and 802. llu[C]// Wireless Communications and Mobile Computing Conference. IEEE, 2017:506-511.
[52]任壮祖，马宏宝.基于软件定义网络的WL AN负载均衡算法研究[J].无线互联科技， 2016(3):69-70.
[53]李云，周亚峰，曹償.基于软件定义网络的WLAN架构及负载均衡切换[J].重庆邮电 大学学报(自然科学版)，2016, 28(5):613-619.
[54]Lin Y E, Tsai T M. Creation, Management and Migration of Virtual Access Points in Software Defined WLAN[C]// International Conference on Cloud Computing and Big Data. IEEE, 2015:313-320.
[55]Ming-Chin C> Jeng-Farn L. FH-PMIPv6: A fast handoff scheme in Proxy Mobile IPv6 networks, International Conference on Consumer Electronics, Communications and Networks (CECNet). IEEE, 2017.
