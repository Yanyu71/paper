第一章绪论
1.1无线网络发展
陆地移动通信从美国贝尔实验室提出蜂窝小区的概念以来，在近30年经历 了技术突飞猛进的进步,用户数量大幅增长。
20世纪80年代，被人们称为“第一代”的移动通信系统大规模的商用。“第 一代”系统使用模拟技术，由许多分布在世界各地的独立系统组成，不同系统间 不能互通。“第二代”移动通信系统，应用了数字技术的全球移动通信系统（GSM） 使全球范围内的漫游成为可能。随后个人数据通信起步，带动了 GPRS/EDGE的 发展，扩展了通信系统的业务承载范围。移动互联网的兴起，又推动了移动通信 的宽带化，极大促进了第三代移动通信（3G）技术的发展，为人们带来了革新 换代的通信体验。但目前3G峰值传输速率已很难满足人们日益增长的移动通信 需求。为此，3GPP首先引进了高速下行链路分组接入（HSDPA）和增强型上行 链路（HSUPA）两种技术，而后又通过了称为“LongTermEvolution（LTE）“即 “3G长期演进”计划田，以宽带通信、正交频分等新技术特性进一步提升速率 与资源利用率，为人们提供更优质的通信服务。
随着LTE网络商用及移动互联网应用的深入，有研究表明，未来80%〜90% 的通信流量将发生于室内及热门景区，因此需要釆用新的技术来提升未来热，飆 区的用户体验。在目前正在标准化的第四代无线蜂窝通信网络LTE-Advanced（简 称LTE-A）的研究中，协作多点传输（CoMP）、中继（Relay）、终端直通 （Device-to-Device, D2D）、多天线传输（MIMO）等学术前沿都被作为解决以 上需求的关键技术⑵，列入标准化进程。
1.1.1 LTE/LTE-A 蜂窝网络
根据IMT-Advanced定义的功能与性能需求，LTE网络已经能够满足其核心 部分，但以指标而论，LTE与IMT-Advanced还有一定距离。LTE-A通过在LTE 现有技术的基础上对其进一步扩展与增强，以满足IMT-Advanced的需求。因此， 处于标准化进程的LTE-A在保留现有LTE核心技术的基础上尽可能平滑演进， 保证对LTE的向后兼容。下面针对几个关键技术进行介绍EK】。
1）快速调度
IMT-Advanced提出的系统时延需求为：用户平面环回时延低于10ms,控制 平面延时低于WOmsoLTE物理层帧格式和多址方式决定了其具有支持灵活资源 分配的能力，支持最小调度资源粒度为1ms、IRBo其共享信道的资源调度方式 支持动态和半静态调度。在动态调度中，使用PDCCH对共享信道资源进行分配, 上行共享信道支持4ms提前量的资源分配指示（UL Grant）；下行共享信道支持 随路资源分配指示（DL Grant）。在半静态调度中，系统的上、下行资源只需通 过PDCCH指定一次，并使用上层的RRC信令进行配置后，周期性地重复使用 相同的时频资源，只有自适应重传的数据才需要通过PDCCH重新分配资源。对 于周期性业务，极大节约了蜂窝网络控制信道资源。.
, ■ . - - , . -
2）	协作多点
协作多点技术（CoMP）允许多个小区间协同提供服务，利用空间分集带来 的增益，有效解决小区间的干扰问题，提升小区边缘用户通信体验，扩大网络高 速通信覆盖。按照通信方向的不同,CoMP可以分为下行CoMP发射和上行CoMP 接收。上行接收主要通过临近多基站节点对用户信号联合接收以提升小区边缘用 户上行通信质量。下行CoMP可分为联合处理获取分集增益、协作调度/波束赋 形减小小区间干扰。
3）	载波聚合
为了满足IMT-Advanced对于峰值速率的要求，LTE-A当前最大可以支持 100MHz带宽，但在目前现有可用的资源频谱中很难找到如此大的带宽。为此， 使用载波聚合技术将分散在多个频段的不同载波资源聚合起来，形成一整块带宽 共同承载业务，既能够提高网络峰值速率和系统吞吐量，同时也能够将运营商拥 有的不连续资源组合起来共同运营。考虑到通信中普遍存在的上下行不对称问 题，载波聚合支持非对称载波聚合，提高频谱优化自由度。
4）	OFDMA/SC-FDMA
LTE-A/LTE系统中釆用多载波方式的多址接入方式。下行釆用正交频分多 址（OFDMA）技术，上行釆用基于正交频分技术的单载波频分多址（SC-FDMA） 技术。相比较于OFDMA, SC-FDMA具有更好的峰均比特性，有效降低对用户 终端（UE）功放的要求，并且两者均能很好的支持频率选择性调度，为灵活的 资源分配提供可能性。
5）	LTE-A/LTE物理层帧结构
为T在统一框架下支持TDD和FDD模式LTE支持两种帧结构。
帧结构类型1适用于全/半双工的FDD模式，如图1-1所示。


图1-1帧格式类型1
帧结构类型2适用于TDD模式。其帧格式如图1-2所示。

图1-2帧结构类型2

1.1.2终端直通技术
终端直通技术(D2D)是指两个或多个需要交换信息的通信终端利用地缘性 和网络的自组织特性，在设备间直接建立无线连接来交换数据，而无需像传统基 础设施网络经过中央控制器转发。正是由于此特点，完成一次单向D2D通信仅 需消耗传统网络经由中央控制器转发一半的资源。
移动互联网本地服务(ProSe)的高速增长、蜂窝与公共安全网络(PubSe) 的融合催生了将终端直通技术引入移动通信网络演进的构想。将D2D引入蜂窝 网络，将会丰富通信形式，增强网络的灵活性，在基础架构网络故障时仍然可以 提供应急通信，为ProSe与PubSe提供一种新解决方式。同时，与其他近场通信 技术相比，例如WiFi、蓝牙，蜂窝网络的加入也使D2D技术在连通性与可操作 性上得到增强，由于基于蜂窝技术的D2D工作在许可频段，是蜂窝通信的一部 分，使其能够利用蜂窝网络技术优势获得更高的无线资源频谱效率，也避免了在 免许可频段中存在的干扰严重、通信效率低、通信质量没有保障等问题，同时免 去了用户接入蓝牙、WiFi网络过程中设备匹配与验证密码的繁琐。
所以，在下一代蜂窝网络通信系统的标准制定中，3GPP TSG-SA I作组提 出了 LTE-D2D设想⑹，并将可能的应用场景分成2大类：商业应用和公共安全， 讨论了其中的潜在需求与可能的技术方案，覆盖有、无蜂窝网络两种通信环境。 其中，商业应用包括对等通信和中继通信。对等通信又包括准确定位目标用户的 本地广播、大量信息交互分享类应用和基于内容的服务。中继通信主要提升小区 边缘用户的通信体验。公共安全服务指发生紧急情况(如台风等自然灾害)时，
蜂窝网络无法提供正常覆盖与通信承载，允许终端脱离蜂窝网络后提供正常通信 服务。
1.2课题研究意义
将终端直通技术引入蜂窝通信网络，虽能同时增强两种技术，但新通信方式 的加入，必然会对原有中心控制转发网络结构产生影响，网络干扰问题将变得更 加复杂。若两种通信技术直接硬性合并，D2D和蜂窝通信在授权频谱内的相互 干扰可能带来严重的问题，导致双方都无法正常通信。诚然，降低D2D发射功 率能有效抑制共存网络中的同频干扰，但这会限制了 D2D收发端间的通信距离。 与此同时，IMT-Advanced系统中高度动态的资源分配，更增加了共存网络中资 源重用和干扰控制的难度。因此需要更深入地研究共存网络，通过相应机制或算 法的设计和创新，推动二者的有效融合。
目前，共存网络的研究主要集中在由基站对D2D集中式控制的接入方案、 干扰控制、无线资源分配方案研究，同时也有少量分布式方案被提出。文献[7]-[8] 提出了基站集中控制下多小区场景中通信模式选择方案、D2D会话建立流程。 [9]-[10]研究了单小区、多小区环境下复用同一无线资源的蜂窝与D2D用户配对 策略。[11]-[12]提出基站辅助下干扰避免、干扰协同的机制，以减轻引入D2D 带来的对蜂窝用户的干扰。[13]提出干扰的分布式控制方案，以D2D监听蜂窝 资源分配广播控制蜂窝用户对D2D用户的干扰，并通过基站辅助控制方式控制 D2D对蜂窝用户的累积干扰。[14]-[16]在假设基站具有完全知识的前提下，基于 图论、博弈论等方式，研究了较优的资源分配策略。以上研究均证明，通过合适 的功控、干扰控制、资源分配策略，引入D2D能够使系统总吞吐大幅增加，但 明显的，在以上研究中，D2DRRM均以蜂窝网络覆盖为前提，并没有考虑PubSe 的需求，脱离蜂窝网络后，其RRM算法框架并不通用。同时，使用集中式的 D2D控制增大了资源分配、干扰协作方面的信令开销与基站计算复杂度；使用 分布式的算法也仅仅给出了部分机制的设计，并没有给出完整的D2D无线资源 管理方案。
如何设计既能满足ProSe需求又能满足PubSe需求的D2D无线资源管理方 案是D2D技术达到LTE-D2D场景需求、成功引入蜂窝网络的关键。
同时，作为正在标准化的新技术，目前的研究均停留在方案设计、数值仿真 阶段。由于没有支持与其他网络复用的可用D2D系统,LTE网络也并不支持D2D 通信，因此D2D技术引入蜂窝网络的可实现性仍没有最终确认。本课题也将自 制能够与蜂窝网络共存的D2D终端，并与LTE网络异构组网，搭建验证场景以 充分验证D2D技术引入蜂窝网络的可实现性与有效性。
1.3论文研究内容及结构安排
在针对D2D无线资源管理以往的研究设计中，特别注意到目前大部分的研 究均基于使用蜂窝集中控制方式对异构网络进行管理，但这种控制方式又存在如 信令资源浪费、无法及时获得D2D链路状态、不支持PubSe场景等诸多弊端。 所以，在本课题中，终端直通通信将利用尽可能少的基站辅助措施，提高本方案 的适用范围。在保证D2D网络在基站覆盖下的协同工作，增加网络容量，提高 小区边缘用户体验的同时，又能保证D2D网络的健壮性，使其能够在非基站覆 盖的情况下使用相同的无线资源管理框架提供通信服务。
本课题将设计异构网络D2D通信中所使用的干扰协同、资源分配、功率控 制、链路自适应机制。研究思路是将建模为基础设施网络及认知网络［1刀两个子 系统，希望D2D终端能够尽可能自主的学习蜂窝网络系统配置及资源调度方案, 并从中找到资源空洞加以有效利用。
在方案研究设计过程中，以监听PDCCH公共搜索域获得LTE网络资源分 配卩8〕为认知主要手段，针对异构网络中不同的干扰，提出并具体设计了相应的 分布式干扰协同方案。通过对D2D通信链路的分析，提出了开环和闭环相结合 的D2D AMC选择方案。在异构网络资源复用方式分析中，通常的研究卩4］卩5］卩够9］ 均按照overlay与underlay分开讨论的方式进行，本工作成果中提出了一种基于 分段预估SINR最大化D2D吞吐的资源选择方案，在保证蜂窝用户性能的前提 下，可以在资源段中存在同时复用多蜂窝用户资源、存在同时对蜂窝用户资源的 overlay与underlay复用,以最大化D2D吞吐，同时提高整体异构网络吞吐。
在D2D无线资源管理设计的基础上，又对其进行了实现，自制D2D终端， 与LTE终端在LTE网络覆盖下进行联合组网，验证异构网络中D2D RRM方案 的可行性与性能。同时又对本方案在无蜂窝网络环境中进行验证。
论文结构安排如下：
第一章：概要介绍蜂窝网络的发展及LTE网络的关键技术、D2D技术及其 引入蜂窝网络的原因、本课题的研究内容及意义；
第二章：首先介绍蜂窝与D2D共存网络的不同的组网方式，并对其优缺点 进行了分析。之后针对不同的异构网络复用策略，分析蜂窝与D2D正交、复用 蜂窝资源时的干扰情况，尤其对于复用方式进行了细致分析。最后结合课题背景， 给出本文研究所使用的异构网络架构方式；
5
第三章：主要研究D2D终端对异构网络干扰控制、链路自适应机制、资源 选择策略的设计，提出了一套在异构网络中适用的少量蜂窝网络辅助、基于完全 自主竞争、D2D自主感知的分布式D2D无线资源管理方案，达到D2D引入的干 扰受控及有效利用频谱空洞、提升频谱利用率的目的；
第四章：在以上研究的基础上，针对D2D硬件验证平台需求对D2D无线资 源管理方案进行了进一步的优化，对方案中所需要的D2D专用控制信道、RRM 各功能模块进行了详细的波计，并给出了基于通用处理器的软件无线电硬件平台 的实现方案，实现自制D2D终端。最后，使用自制D2D终端与TD-LTE商用上 网卡作为D2D用户与蜂窝用户，混合组网形成异构网络，对本文提出的D2D无 线资源管理方案在多真实场景下进行验证，同时也对本方案在无蜂窝网络覆盖时一 对应急通信的支持进行验证。
第五章：对全文进行总结，并对进一步的研究进行展望。
第二章 蜂窝与D2D异构网络
在第一章中已经介绍了 D2D技术引入蜂窝网络需求背景与技术优势，但两 种网络的融合势必会改变其中任何一方原有的技术架构。若仅仅采用硬性合并， 网络中不可协调的干扰将会是破坏性的，两种网络的通信质量均不能得到保证。 并且不同的网络融合方式会对网络性能和无线资源管理技术方案产生较大影响， 本章将主要分析蜂窝与D2D融合中不同的网络架构及其中存在的干扰情况，并 在充分比较的基础上，得到本课题中釆用的异构网络融合方式。
2.1异构网络资源复用方式
首先定义蜂窝通信与D2D通信共存网络中，用户终端（UE）存在的两种不 同的通信模式：蜂窝通信模式和D2D通信模式。网络通过一定的规则为终端选 择合适的通信模式。在蜂窝通信模式下，终端通过基站接入核心网络或在由基站 直接进行数据转发，实现与另一用户通信，处于此状态的终端称为蜂窝终端 （CUE）；在D2D通信模式下，终端通信不经过基站的转发，直接或借助中继 与目标终端实现通信，处于此状态的终端称为D2D终端（DUE） o
异构网络场景［2。】如下图所示：


图2-1异构网络场景
在异构网络中，D2D通信需要使用原本仅为蜂窝网络独享的无线资源。根 据二者划分无线资源方法的不同，其可能的复用方式为专用和共享。
1）	专用
专用（Dedicated）是在异构网络融合中最为简单的方案。通常，D2D釆用 类似Ad-hoc的网络结构实现，蜂窝釆用基站集中控制的网络结构实现。为了使 二者能够共用授权的无线资源，将无线资源划分为两类：D2D专用和蜂窝网络 专用，可供划分的资源有时隙、频带、码字等。这样，D2D和蜂窝网络作为独 立子网络，子网络间使用正交资源，相互干扰可以忽略不计，所以其干扰控制方 案相对简单，基本不需要增加任何功能便可以实现共存。对于原有网络功能的修 改也仅是需要由基站和用户设备实现对资源划分信令解析及通信模式选择的支 持即可。
正是由于其简单的特性，在3GPP 36series Release 12版本的标准化中， Dedicated方式作为D2D融入蜂窝网络的首次尝试被写入标准中。但其缺点也是 显而易见的，正交化的资源分配使灵活的资源调度变得困难，不利于资源利用率、 系统容量的提升。
2）	共享
共享（Shared）方式与专用相对，是指D2D和蜂窝子网络并不事先硬性分 割无线资源，全部资源被二者共享，并在一定的调度条件下灵活分配使用。这种 方式调度灵活，并且在一定程度上可以利用小区内终端的分散性实现对无线资源 的空分复用，提高系统资源利用率。在这种方式下，小区内部可能存在资源的非 正交复用，干扰管理策略必须进行完善的考虑，否则过强的干扰可能直接造成复 用资源用户通信质量的下降。
在共享方式的资源分配方案中，对于DUE与CUE的资源使用情况，又可以 分为正交（Overlay）和重用（Underlay）。当异构网络负载较小、有较多空闲资 源可以分配时，或者若DUE和CUE重用资源对其中任何一方将造成较大干扰时, D2D与蜂窝通信将倾向于以正交方式共享无线资源。否则，二者将尝试重用资 源，提高自身业务吞吐率，增加系统容量，提高资源利用率。在网络中，通常这 两种方式均会存在，部分DUE重用CUE资源，部分以正交方式进行通信。
2.2 D2D通信控制方式
上文论述了 D2D引入蜂窝网络后多种无线资源复用方式，本节将主要讨论 异构网络无线资源管理控制权的归属问题。
在异构网络中，蜂窝网络通信的控制权仍然由基站所有：基站负责为蜂窝用 户实现接入，统一调度无线资源，并进行链路自适应控制；对于D2D网络通信 的控制权的归属方式，在目前学术研究中，通常根据终端直通通信过程中基站的 参与程度分为两类：蜂窝网络集中控制和蜂窝网络辅助控制[21]t22]o
8
1.蜂窝网络集中控制
在蜂窝网络集中控制中，终端直通模式与蜂窝通信模式一样，完全由基础架 构网络控制。在这种资源控制方式下，基站在网络中仍然扮演中央控制器的角色, 在控制传统蜂窝网络的基础上，还需要对共存网络中UE通信模式选择、D2D通 信中的资源分配、功率进行控制。此时，蜂窝与D2D通信模式二者间的差别仅 为数据传输过程中的接收对象不同。
'这种集中控制的优点丰分明显。首先，资源控制机制完全集中于基站，UE 仅需要较小的升级便可以以近似透明的方式支持两种不同的通信方式。同时，基 站拥有授权频谱的完全分配权，可以通过用户调度、资源分配满足针对网络干扰 环境变化的调整和对用户QoS的保证。
在研究中，通常假设基站对管辖的网络区域拥有完全知识，即基站掌握各个 用户所处的位置、每对用户间及用户与基站间的链路质量与相互干扰情况。这样, 网络资源便可以在一种相对简单的模型下进行全局最优化分配，保证网络内部干 扰最小。但这种假设通常难以满足。在蜂窝通信模式中，基站作为收发的端点， 能够比较容易地由包括参考信号和传输错误率在内的指标对CUE与基站间的链 路质量进行估计；在D2D通信模式中，由于基站并不参与数据传输过程，需要 设计专用信令过程以满足DUE间链路质量的上报，以供基站进行资源调度时使 用，极大增加了蜂窝系统控制信道开销。若令网络内用户规模为N,则信令开销 将会达到O(N2),系统控制信道难以承载。如果不进行基站具有完全知识的假设， 基站在分配资源时，仅能使用完全正交的方式进行，这样会丧失引入D2D时带 来的空分复用增益。同时，使用集中控制的网络仍为基础架构网络，与传统蜂窝 网络一样都无法脱离基站使用，丧失了 D2D通信网络由自身自组织特性引入的 灵活性，无法满足应急通信的需求。
2.蜂窝网络辅助控制
蜂窝网络辅助控制，其关键在于“辅助”。在这种结构中，D2D通信中的 连接建立、对使用资源的决策都是由DUE自主控制，基站在其中主要充当观察 者、协调者的角色，并不像集中控制一样直接分配D2D通信的资源占用。在这 种结构中，基站提供与传统蜂窝网络一致的对蜂窝网络的完全控制能力，并借助 其拥有的蜂窝系统全局信息，为自主D2D通信提供少量、必要的辅助与控制信 息，解决蜂窝系统与D2D通信系统间信息互盲的状况，帮助DUE在引入干扰受 控的条件下实现对蜂窝网络的资源共享。
这种异构网络系统本质是一个基础设施蜂窝网络和一个与蜂窝网络存在少 量信息共享的Ad-hoc网络的结合体。驻留在Ad-hoc网络中的DUE能够利用类 似于认知无线电的概念，全面感知周边无线环境进行，获取监听范围内信道情况、 9
干扰信息及蜂窝系统相关信息，并可以在网络内部分享感知结果。同时，基站可 以通过控制信道对D2D通信进行必要的干扰协调。在保持D2D通信的分布特性 的同时，避免基站集中控制中因信息共享开销和控制时延带来的问题。
具有无线资源管理能力的DUE不仅可以支持在蜂窝网络覆盖下工作，同时 可以支持无蜂窝网络情况下的应急通信。在蜂窝网络覆盖下，UE通信模式选择 由基站控制，可以釆用D2D探针(D2D probe)测量信道判断能否建立D2D通 信的方式;当然,如果UE：引入认知的能力，在UE空闲时便可以得到临近的 DUE用户列表，基站请求时可以直接返回链路质量信息，缩短探测、通信模式 选择时延。在无蜂窝网络覆盖下，网络直接退化为Ad-hoc网络，DUE仍然可以 自组网并按照自主无线资源控制方案进行正常通信。对于D2D网络的组织方式； 又可以分为集中式与分布式。集中式采用将D2D进行建簇管理［231,并由簇头负 责与蜂窝网络进行干扰协同，维护D2D网络的资源分配。在分布式中，由每个 终端节点自主感知蜂窝网络并进行无线资源管理控制。对于集中式D2D组网， 簇头处理及电量消耗压力较大，同时可能会面临单点失效问题，需要较为复杂的 协议支撑。对于分布式D2D组网，每个DUE均作为一个功能节点健壮存在，并 且每个DUE在周期共享信息的基础上仅需管理自己的资源分配即可，分散无线 资源管理压力。
2.3异构网络干扰分析
异构网络融合前提为网络中有效的干扰管理。如上文所述，异构网络无线资 源复用方式可以分为专用和共享。不同资源复用方式所引发的干扰不同。
2.3.1以专用方式复用无线资源
对于专用无线资源的复用方式，蜂窝通信与D2D通信使用的信道相互独立, 网络间不存在干扰。网络内部干扰为传统蜂窝网络内部干扰和D2D网络内部干 扰。其中，蜂窝网络在设计时己使用基于正交的多址接入技术，如FDMA、TDMA、 CDMA、OFDMA等，在理想情况下无内部干扰。对于由信道、定时、频偏等非 理想因素引入的干扰均有较为成熟的解决方案，可以近似认为蜂窝网络内部不存 在干扰问题。在D2D通信使用专用无线资源时，可釆用蜂窝网络辅助控制，网 络结构为类似Ad-hoc的自组织网络。当距离相近的两对DUE同时接入信道，会 产生D2D网络内部干扰，影响通信质量。对于这种干扰，需要分布式协同机制 进行无线信道接入控制，以保证一个时间片内在一个冲突域中仅有一个DUE有 权接入信道。
2.3.2以共享方式复用无线资源
若以共享方式复用蜂窝资源，对于一段蜂窝通信占用的资源，网络中部分
10
D2D通信以重用方式复用，部分以正交方式复用。对于这两种共享分配方式， 网络内部干扰与专用方式复用无线资源时一致，不予赘述。异构网络间干扰主要 由资源重用引入，正交方式复用在不考虑非理想特性时不会产生网络间干扰。对 于资源重用，蜂窝通信会对D2D通信产生干扰，记为C2D干扰；D2D通信对蜂 窝通信产生干扰，记为D2C干扰。考虑到蜂窝通信在上、下行时基站与CUE轮 流作为发送接收端，干扰源与受众的不同导致其干扰模型不同。所以，需要分别 对D2D复用蜂窝上行资源和下行资源时异构网络间的干扰进行具体分析。
2.3.2.1重用蜂窝上行资源
D2D通信与蜂窝通信重用上行资源，D2D用户的发送将会对基站的接收造
成干扰，蜂窝用户的发送将会对D2D用户的接收造成干扰，如下图所示。

图2-2重用上行资源蜂窝用户发送对D2D接收的干扰	..
¥

在无线通信中，大尺度链路损耗与距离之间通常满足负指数关系〔24],
P"・dF	(3-1)
其中，心为接收功率，d为发送机与接收机的距离，上为衰落系数，a为链 路损耗因子，女为发送功率。
假设D2D通信中，距离为d咨2站的DUE1向DUE2发送数据如。蜂窝用户 CUE1到eNB距离dC2BS,发送信号％至eNB。CUE1与D2D接收端DUE2间 距离为必2徧=在DUE2处接收到的信号为
尸2D** "c2Dk J去20依 %C +"o	( 3-2 )
%和玲分别为DUE1和CUE1的发送功率，数据信号X。和X。采用单位功率。a 为路损因子，hC2Dgx和牡2%分别为CUE1到DUE2及DUE1到DUE2的衰落系 数。%为加性高斯白噪声，满足分布n(o，m)。
因此在DUE2处的SINR为
_ 仇&20J 财覆 2。&	(3 3)
\hmYPcd為 d/N。
11
为简化计算，暂不考虑衰落系数。则DUE2的吞吐为:



同理，蜂窝通信吞吐量应为

其中，“为CUE、DUE到基站的路损因子。7?bs的干扰部分为DUE发送造 成的累积干扰，涉及到DUE的发送功率、到基站的距离及链路损耗。R风干扰 部分由DUE累积干扰和CUE发送干扰组成，涉及CUE与其他DUE的发送功率、 到D2D接收端的距离及链路损耗因子。
上述对重用上行蜂窝资源的异构网络间干扰的分析表明，为了实现较高的异 构网络吞吐性能，DUE资源选择基本思路为：对于距离BS较近的DUE,降低 其发送功率，并选择离其接收DUE较远的CUE资源进行复用，或者使用正交复 用；对于距离BS较远的DUE,仅需要选择离其接收DUE较远的CUE资源进行 复用并保证对小区边缘用户的通信即可。
23.2.2重用蜂窝下行资源


与重用蜂窝上行资源分析类似，当仅有一对DUE复用CUE1的下行资源时,
记瑞为基站发送功率，则CUE1的吞吐为:



当k个D2D用户复用CUE1资源，此时CUE1的吞吐为: / 、
&=3屈 1+	一
£Pd,0M2c+N。
D2D的吞吐为:
1+一 /
Z %03心知 +Pbsd歸d+N°
v i=l>7X	丿
D2D重用蜂窝下行资源，对于距离BS较近的DUE, PBAD非常大，需要 D2D链路质量非常好并需要大幅度提升发送功率，所以在这种情况下通常使用 正交方式而不使用重用。对于距离BS较远的DUE,选择离发送端DUE较远的 CUE资源进行复用并需要保证小区边缘CUE的通信性能。
综上所述，对于异构网络的无线资源管理而言，D2D重用蜂窝上、下旬资 源在理论上均是可行的。通过选择合适的复用对象，能够起到增加无线资源利用 率的目的。
2.4异构网络组网方案选择
本课题中使用的异构网络组网方案选择主要考虑以下几方面：
(1)异构网络控制方式：为了保持异构网络中D2D的灵活性同时考虑控制 信令等开销，蜂窝通信仍然保持现有基站集中控制，D2D通信使用蜂窝网络辅 助控制。D2D内部选用分布式控制方案，若使用簇头集中控制，仍然需要较多 信令开销。整体网络为基础设施蜂窝网络和一个与蜂窝网络存在少量信息共享的 Ad-hoc网络的结合体。
(2)异构网络资源使用优先级：D2D通信引入蜂窝网络，需要以保证蜂窝 用户通信质量不受影响或影响程度受控为前提。所以在异构网络资源使用角色 中，以蜂窝网络用户为授权资源使用主用户，D2D用户为异构网络中的次用户。
(3)复用上下行资源的选择：考虑到蜂窝网络的集中控制特性，上行发送 必须由基站提前通知蜂窝终端所使用的信道位置，终端才能在对应空口时间点将
13
数据发出；下行蜂窝终端接收，则可以通过先解码控制信道再解码数据信道的方 式实现对数据的接收，不需要提前广播信道分配信息。在GSM、TD-SCDMA等 2G/3G通信系统中，数据信道以专用的方式配置，其上下行信道所在位置在通信 的建立阶段会提前下发；在新一代网络中，以LTE网络为例，下行资源分配指 示以PDCCH随路的方式下发，上行资源分配指示则会至少在调度前4ms由 PDCCH下发到CUE。在网络辅助控制的D2D通信中，DUE为了能够以共享的 方式复用网络资源，必须具有提前获得蜂窝网络资源分配情况的能力，复用下行 资源不能满足此需求。诚然，将下行资源分配指示按照上行方式提前下发也是一 种解决方案，但考虑到下行信道中承载大量系统控制消息，若被干扰则可能引发 严重的蜂窝网络故障。综合考虑，D2D通信复用上行蜂窝资源。
(4)D2D通信物理层设计思路：在D2D通信方案的设计中，为了保持异 构网络间的干扰为同质干扰，D2D网络使用与蜂窝网络相同的帧格式及多址方 案；为了简化UE的设计复杂度，尽可能多的复用蜂窝网络技术，增加UE中模 块的重用性。
综上所述，本文选用的异构网络方案为：蜂窝通信沿用传统基站控制方式， 并作为无线资源使用主用户；D2D作为次用户，以共享的方式复用蜂窝网络上 行资源，利用少量基站辅助措施、以分布式方式完成无线资源管理，并使用与蜂 窝网络相同帧格式与多址方式，信号处理保持与蜂窝网络的相似性。
2.5本章小结
本章比较了不同的网络资源复用方式、D2D通信控制方式的优劣性，并对 异构网络中以共享方式复用蜂窝网络上下行资源的干扰问题进行了重点分析。干 扰分析表明，D2D复用蜂窝上下行资源在理论上均是可行的，通过选择合适的 复用对象，控制相应子网络内部与子网络间干扰，能够起到增加无线资源利用率 的目的。在对系统稳定性及干扰控制难易性综合考量后，选定本文中终端直通通 信以共享的方式复用蜂窝网络上行资源，并利用尽可能少的基站辅助措施完成分 布式D2D无线资源管理，便于其对两种通信环境的兼容。
第三章D2D无线资源管理
在第二章中，已经讨论了本文中所使用的异构网络组网方案。在下文对D2D 无线资源管理（RRM）方案的研究设计中，将针对LTE与D2D异构网络进行。
选用LTE网络的考虑如下：首先，课题提出的背景是D2D技术在3GPP LTfc-A的标准化中被引入蜂窝通信网络。LTE与LTE-A主要技术相同，在这个 基础上进行研究得到的方案能够适用LTE-Ao并且由于LTE-A仍在标准化过程 中，选用LTE网络可以较为方便的进行D2D技术在真实蜂窝网络中的混合组 网验证。同时，目前基于正交频分技术设计的无线系统渐渐成熟，选用LTE使 下文对D2D无线资源管理的讨论具有较高的普适性。
本章主要目标为设计针对LTE与D2D异构网络的基于尽量少蜂窝辅助控 制、共享上行无线资源、干扰可控的分布式D2DRRM方案。
3.1 D2D无线资源管理框架
根据第二章分析，共享授权频谱的LTE/D2D异构网络使用相同的物理层多 址技术，共用蜂窝网络上行频谱资源，并以LTE蜂窝网络为授权频谱使用的主 用户，分布式D2D网络为授权频谱使用的次用户。
异构网络资源分配关系如图3-1所示，首先保证主用户一一蜂窝用户的资 源分配后，再进行D2D通信资源的选取。
D2D业务QoS参数
D2D HARQ反馈
网络测量
D2D干扰协同
DUE数据缓冲区状态
图3-1异构网络主次用户资源分配示意图

分布式D2DRRM目标为:在如上所述的异构网络架构中，当UE处于D2D 模式时，提供对其通信所使用的时域、频域资源位置、发送功率、调制编码方 案（MCS）决策的能力，保证通信的可靠高效，并保证网络间干扰可控。同时 需要保证在无蜂窝网络环境中仍正常提供RRM功能，支持D2D公共安全场景。
为实现此目标，D2DRRM的设计应满足以下需求：
15

(1)为支持PubSe场景，决策应全部在DUE侧进行，蜂窝网络仅提供辅 助信息。脱离蜂窝网络不影响无线资源管理的正常运行
(2)为了确定时域资源，需要具有相应的时域信道接入机制，既保证一定 范围内的D2D通信资源独占，还可以限制在同一小区内同时接入信道的D2D 用户数量，避免对基站接收产生较大干扰。在分布式D2D RRM中，使用自主 竞争方式完成D2D对数据信道的接入。
(3)对于D2D频域资源、功率、MCS的选择，需要基于授权频段干扰图 谱知识。为此，必须对异构网络动态调度的蜂窝用户进行干扰认知。干扰认知 通过收集蜂窝网络资源调度信息、干扰感知功率信息，综合形成干扰图谱知识 供后续决策使用。
(4)为了确定发送功率，除干扰图谱外，还需要考虑异构网络间的干扰控 制问题。过大的D2D复用功率可能对蜂窝通信带来严重的性能影响；若D2D 复用CUE较大干扰的资源段，则D2D吞吐也难以保证。由于发送功率选择、 干扰认知、干扰控制紧密相关，故将其作为整体一一异构网络干扰认知协同机 制进行设计。
(5)对于MCSo通过干扰认知与干扰协同，已经得到每段资源的干扰值 与最大复用功率。在此基础上，需要AMC机制完成SINR到码率的映射。同时, 考虑到D2D QoS保证，需要提供D2D的链路自适应机制，在传输的可靠性与 高效性间获得平衡。
(6)对于资源使用方案选择，需要设计D2D资源决策机制。根据干扰信 息、发送功率信息、码率信息，并综合待发数据缓冲区等信息，按照给定准则， 选出最优资源使用方案，确定包括资源段位置、发送功率、MCS等参数。
综上所述，分布式D2D RRM需要干扰认知协同机制、信道接入机制、链 路自适应机制及D2D资源选择决策机制，以共同完成无线资源管理目标。其框 架如图3-2所示。
I
I
干扰认知协同	球
干扰认知	干扰控制_开环AMC ―►资源决策
\	/	频域资源
/	f	—功率
功率选择	链路自适应	Mls
竞争信道接入	--时域资源
I
控制信!息传递
控制平面	I	数据平面
图3-2 D2D分布式RRM框架
16
对于有/无蜂窝网络环境的影响，在此框架中仅表现为干扰认知协同机制中 针对蜂窝网络认知协同的部分生效/不生效，对其余RRM模块均无影响。
下面对其中各个机制进行研究设计。
3.2 D2D网络自主竞争接入机制
D2D时域资源竞争接入主要解决分布式D2D网络中多D2D通信对之间的 相互干扰问题。定义D2D冲突域为以自身DUE为中心、半径为在独享信道情 况下，最远能够正确解码的圆形区域。假设若一个接收DUE的冲突域内有多于 一个的DUE进行数据发送，则此接收DUE将不能对此信道进行正确解码。在 两个不重合的D2D冲突域内，两组D2D通信可以空分复用相同的无线资源。
通过使用D2D时域资源竞争接入，保证一个D2D冲突域内，仅有一个DUE 获得无线资源接入权限，消除2.3.2.1节R%计算式3-5中的D2D累积干扰项， 使后续DUE在资源分配、干扰计算时仅需要考虑蜂窝资源分配。	费
在Ad-Hoc和计算机网络中，为了实现资源竞争，达到无线资源的统计时 分复用，常用于无线网络面向数据的MAC算法〔25］有：
1)ALOHA：终端发送分组时，不需要对信道进行监听，直接发送。由于 多用户随机发送，若发送重叠，则发生碰撞。接收端在正确接收分组后，反馈 确认。若在一段时间内没有收到确认，则认为分组发生了冲突，经过一个随机 延时后重发；
2)时隙ALOHA：将时间轴分成多个时隙，每个时隙发送一个分组，用户 仅在时隙开始的时候发送分组。由于碰撞窗口为一个完整的时隙长度，最高效 率比纯ALOHA提升一倍，在泊松数据流的条件下达到0.368o但需要在终端间 建立同步。
3)CSMA：每个终端在发送前需要监听信道，根据发送的方式，又分为非 坚持CSMA、1-坚持CSMA、p-坚持CSMA。1-坚持CSMA持续检测信道，一 旦信道空闲，立刻发送分组，这种方式与ALOHA相比，减少了碰撞概率，但 仍存在大量碰撞的可能性；非坚持CSMA在检测到信道忙后，随机退后一段时 间后再次检测，当信道空闲，才发送分组，消除了大量碰撞,性能比1-坚持CSMA 有所提高，但当负载较轻时，延时时间长。P-坚持CSMA界于上两者之间，持 续监听信道直到空闲，以概率p发送数据，以概率1-p延时到另一时隙，协议 的性能取决于p的优化程度。
4)CSMA/CA：终端通过忙音多址或控制信息握手的方式预约信道，能够 解决隐藏终端、阻止数据碰撞提高数据传输的可靠性。在802.11协议中以四次
17
握手RTS-CTS-DATA-ACK为分布协调机制（DCF）。四次握手在检测到信道空 闲、准备发送数据前先发送RTS进行信道请求。
但上述方案均不能简单地应用于异构网络的D2D通信中：
1）	Aloha与时隙Aloha直接使用数据信道进行碰撞，在共享信道的过程中 由于DUE用户数未知且均尝试使用信道，将对蜂窝网络造成大量干扰。
2）	由于基站对系统内资源的动态调度机制，蜂窝网络中不存在长时间稳定 的无线资源，导致无法按照CSMA类的方案通过监听频谱并感知瞬时网络资源 占用情况的方式进行竞争。
通过上述分析，结合蜂窝网络帧格式对蜂窝网络进行扩展，并综合时隙 Aloha和CSMA/CA技术，得到异构网络中D2D通信时域共享资源竞争接入的 解决方案：基于D2D公共控制信道的同步时隙冲突避免（SSCA）方案。
3.2.1同步时隙冲突避免
SSCA本质上为时隙Aloha （S-Aloha）,并结合CSMA/CA的握手机制。 在传统S-Aloha中，传输流程为DATA-ACK,可能的碰撞发生在DATA阶段。 在SSCA中，由于D2D数据传输信道无线资源管理、基带信号处理流程比较 复杂，直接使用共享信道发送数据处理成本较高，并且引入的干扰也难以控制， 故先使用短小简单的RTS、CTS进行信道预约接入竞争，利用两次握手实现冲 突避免。SSCA与典型的CSMA/CA系统，如802.1伸〕的区别在于SSCA不需 要进行载波侦听，使用与LTE同步的帧格式，使其不会对蜂窝系统引入符号间 干扰。
数据发送流程为RTS-CTS-DATA,最后配合ACK进行传输确认。具体为： D2D通信发送端（TxDUE）接收到调度器信道接入需求后，将在D2D控制信 道RTS子信道内发送指向D2D通信接收端（RxDUE）的RTS请求，用以申请 以RxDUE为中心的D2D冲突域内关于后续对应时刻的上行信道接入权。若 RxDUE能正确解码TxDUE的RTS内容，将会在应答信道中回复指向TxDUE 的CTS,用以确认RTS并申请以TxDUE为中心的D2D冲突域内关于后续对应 时刻的ACK控制子信道接入权。当TxDUE正确解析CTS后，表明竞争成功， D2D双方能够接入数据信道。
举例分析如图3-3所示的竞争场景。TxDUEK TxDUE2同时使用RTS申 请资源，由于RxDUE2处于TxDUEl和TxDUE2的发送可达域内，RTS信道 被严重干扰，导致其不能够正确解码，不会向TxDUE2发送CTS应答。TxDUE2 申请RxDUE2冲突域的接入权失败。与此同时，虽然RxDUEl、RxDUE3处于
18

同一竞争域内，但由于二者均为接收方，相互不影响通信质量，能够正常进行 RTS-CTS过程并复用信道。



RTS、CTS同时测试了链路正向、反向通信质量，避免由于信道的不对称 性引发信道探测的不准确性。如图3-4,可能存在DUE-TX1到DUE-RX3的衰 减较大，而DUE-RX3的CTS反馈反向链路衰减较小的情况，若此时DUE-TX1 发送数据，在接收ACK时，会同时收到DUE-RX1和DUE-RX3,造成冲突， 引发重传。联合RTS、CTS,能保证数据传送、反馈过程都不会收到其他DUE 干扰。
Blue Ring : D2D Collision Domain
-> :D2D Interference
齐：RTS
—> :CTS
卷:CTS Collision
图3-4 D2D在链路不对称时的竞争场景图
由于RTS的竞争性，不可避免的存在多D2D通信对(D2D pairs)处于同 一冲突域的情况。RTS/CTS碰撞便不会触发后续数据的发送。此时所有通信对 都没有成功接入信道，这意味着在此冲突域中无线资源的浪费。如何设计SSCA 的分布协同机制(Distributed Coordination Function, DCF)降低碰撞概率，直接 影响了 D2D通信使用蜂窝网络频谱空洞时的利用效率问题。
19
3.2.2 SSCA分布协同机制
对比SSCA与S-Aloha： SSCA的RTS相当于S-Aloha中的DATA,试探可 能的碰撞；CTS相当于S-Aloha的ACK,确认竞争接入结果，二者本质相同。
SSCA分布协同机制的设计，可以借鉴S-Aloha的分布式协同算法，研究中 常用的有基于伪贝叶斯估计的P-概率时隙Aloha (PBCA)和基于二进制指数退 避(BEB)算法。
首先讨论SSCA的最大信道利用率。若在一个时刻，.共有N部终端有RTS 发送需求(活跃终端)，令其发送概率为p,等待概率为w = l-p。RTS时隙共 有三种状态：空洞、成功、碰撞，概率记为Fh、Ps、Pc,分别如下：
- 鸟=互但=讨
7^=Sp(N) = "・p・w"T	(3-1)
口 =q(N) = l-Hp(N)-Sp(N)
当Fs取得极大值，即昭/0p = O时，发送概率p = l/N,信道利用率最大 为
S1W(N) = (1-1/-1«-	(3-2)
N e
若己知网络中活跃终端数N,即可以保持信道最大利用。PBCA算法假设 系统数据到达为泊松流，强度为人，通过对时隙空洞、成功、碰撞状态的监测， 动态更新估计得到的活跃终端数卩(真实活动终端数为N),按照p = l/v得到 的发送概率进行RTS发送，其步骤如下"I。
(1)需要发起RTS请求时，以p = \/v概率进行发送；
(2)当时隙为空洞或者竞争成功时，即RTS控制信道测量功率未过检测 门限、自身收到CTS反馈、正确解码他人RTS信息时，y-lo当RTS信道功 率超过检测门限却未正确解码或自身发送RTS未收到CTS反馈时，v + (e-2)-'。
(3)更新后，将卩设定为max(v + 2,l), 2为对系统新数据包到达率的估 计量，到达率定义为两个相邻RTS信道的时间间隔内数据包的到达概率。
标准二进制指数退避(BEB)算法，设定最小回退窗口 CKn和最大回退 窗口 C%ax，满足C^mm=2mCWmin。在第i次传输前，需经历的退避时间为
C =「U(・)・(2'TCKinT)］	(3-3)
其中，。(・)为(0,1)均匀分布的伪随机函数。每次经历一个RTS时隙，退避 定时器减1,直到为0时，进行RTS发送。
文献［28］基于二维离散马尔可夫模型，给出了一个终端在最小窗长W时， 在一个RTS时隙上的传输概率
20

厂	2(1-2功
(l_2P)(W+l) + P・*(l 一(2P)”)
其中，尸表示节点发生冲突的概率，P = l-(l-^)"~1o根据式(3-4),得到
。为使数据信道利用率最大化，需满足q = l/N,


CW^=TW>2n-\ o
当取定C%后，BEB算法受固定窗口值的影响，当活跃节点在一 定范围内时，才能获得时隙Aloha的理论信道利用率极限，其余情况下性能均 有一定下滑。
在标准BEB中，所有新数据(RTS)的发送都要先经过［l,CWmin］随机退避, 这使得此算法在低负载时信道利用率较低。考虑到D2D通信的本地通信特性， D2D冲突域较小，在同一 D2D冲突域中同时具有接入信道需求的用户数较少。 对此应用场景，将标准BEB进行改进为初传非退避BEB算法，初始RTS直接 发送，而不经过退避，其余RTS也仅区分是否在退避过程中。具体步骤如下：
(1)当请求RTS发送时，检査退避定时器，若为0,直接发送，不退避。
(2)若RTS发生碰撞，在第j次碰撞后，将退避定时器设定为C,每经过 一个RTS时隙，定时器减1。"(•)与式3-3中相同。
。=网.).(2丿七％一1)］	(3-5)
(3)当RTS竞争成功时，碰撞次数清零，退避定时器清零。
在满业务量的条件下，对PBCA、标准BEB退避算法、初传非退避BEB 算法性能进行仿真，系统整体信道利用率&比较如图3-5所示，RTS成功接入 时延如图3-6所示。
通过比较，得到在相同窗口配置下，初传非退避BEB利用率明显好于标准 BEB算法，RTS成功接入时延近似相同。PBCA算法利用率在N较小时性能比 初传非退避BEB略差，但其能够在大用户量同时接入时保持稳定，RTS成功申 请时延在三者中保持最低。BEB算法则需要对窗口大小进行调整。如前文所述, D2D场景中，通常业务以大容量突发为主，同时具有发送需求的用户数较少， 在特殊的应用场景，如集会场景，虽然人数众多，但需求普遍为人与人之间近
21
距离传输资料、分享信息，可以通过基站控制D2D开环工作点的方式人为控制
D2D冲突域，以减小同时接入用户数，降低冲突率，提高资源复用效率。



图3-5 BEB和PBCA信道利用率比较



图3-6 BEB和PBCA成功接入时延比较
分析比较后，SSCA分布协同选用初传非退避的BEB算法更为适合，机制 简单，仅需通过预设或在基站辅助下选取合适的冲突域大小及窗长即可。
3.2.3 D2D公共控制信道分配
SSCA基于D2D公共信道进行竞争，同时由于D2D使用分布式RRM,DUE 间需要进行必要的信令交互，以保证整个网络的协同。为此，需要由蜂窝网络 在授权频谱内提供与数据信道独立的专用控制信道一一D2D公共控制信道
(DCCCH)o

DCCCH的分配方式，可以在今后通过协议预设的方式确定，也可以由基 站通过广播信道（PBCH）或下行共享信道（PDSCH）系统信息块SIB为D2D 通信统一分配。如图3-7所示，为LTE网络中上行DCCCH的一种可行分配方 案。
D2D frenquency band
:PUCCH Shared resource for PUSCHs and D2D PSCHs D2D CCCHs PUCCH H	 LTE Allocation frenquency band	->
图3-7 LTE与D2D异构网络上行信道的资源划分
对于DCCCH控制信道是否需要在蜂窝网络上下行无线资源中均提供，做 如下考虑。由于异构网络中D2D数据通信复用蜂窝上行资源，作为次用户需要 时刻变化信道分配以适应蜂窝网络调度结果。同时，LTE引入共享信道动态调 度机制，为保证D2D数据接收端能正确配置，每一次数据发送均需要将信道所 占资源、使用的MCS等作为数据随路控制信息传送，占用蜂窝上行资源中的 DCCCH （上行DCCCH）o为了满足D2D其他控制信令的需求，如上文提到的 自主资源竞争、终端发现等功能，则需要提供下行DCCCHo
3.2.4基于SSCA的D2D数据传输流程
基于RTS/CTS,改进BEB退避算法的SSCA机制的数据通信如图3-8所示。


DCCCH Allocation Broadcast-
RTS——
<	CTS—
DATA
—DATACTRL
图3-8 基于SSCA数据通信流程
与普通Ad-hoc或者802.11等独立频谱网络不同，LTE网络的不同帧格式 配置允许的下行D2D控制信道数量各不相同，故SSCA不能直接使用传统RTS- CTS帧格式。下面针对TDD与FDD基于SSCA的D2D数据传输流程进行设计。
1.TDD
TDD-LTE的蜂窝网络上下行配置方式有7种如表3-1所示。
表3-1 TDD-LTE ±下行配置
Uplink-downlink configuration	Downlink-to-Uplink Switch-point periodicity	Subframe number
0	1	2	3	4	5	6	7	8	9
0	5 ms	D	S	u	U	U	D	S	U	U	U
1	5 ms	D	S	u	U	D	D	s	U	u	D
2	5 ms	D	s	u	D	D	D	s	U	D	D
3	10 ms	D	s	u	U	U	D	D	D	D	D
4	10 ms	D	s	u	U	D	D	D	D	D	D
5	10 ms	D	s	u	D	D	D	D	D	D	D
6	5 ms	D	s	u	U	U	D	S	U	U	D

在传统RTS过程中，1次RTS申请1 TTI的资源，但在TDD网络中，上 下行子帧数量并不对称，导致基于下行的DCCCH与上行数据传输信道无法一 一对应。同时，一次完整的数据通信需要使用RTS、CTS、ACK三个辅助信道。 为了使竞争粒度最小，将这三个辅助控制信道设计为基于时隙。这样，对于下 行子帧最少的TDD ConfigO,也有6个时隙可供安排D2D控制信道，通过在一 个无线帧内设计两组竞争接入过程，可以将竞争粒度控制为半帧。但此时主要 考虑到D2D控制信道可能还有的其他用处，需至少保留一个时隙，方便后续对 终端发现等基于DCCCH功能的扩展。最终将TDD的竞争粒度设计为1个无线 帧，即如果竞争成功将会获得后续对应一个无线帧的上行资源接入权。
以TDD Configl为例，对一次D2D数据传输过程的具体流程进行说明，如 图3-9示。其中DataCtrl为D2D数据随路控制信道,ACK为传输结果确认信道。
第n帧	第n+1帧	第n+2帧	第n+3帧	第n+4帧
人 .				 	A___	 	A. 		A			a
I d| s| u| u| d| d| s| u| uj d| d| s| u| u| d| d| sl u| u| d| d| s| u| u| d| dHI u| u| d] d| s| u| ul d| d| s| u| U! d| d| s| u| u| d| d| sl u| uPdI

图3-9 TDD Configl的D2D数据通信定时关系

1)DUE-TX在第n帧通过D2D-RTS向RxUE发送传输请求，同时也是向 周围的其它DUE发出D2D独占资源竞争，即发出了对第n+2帧的D2D传输资 源进行独占使用的请求；
2)DUE-RX在第n帧正确接收RTS (没有D2D-RTS碰撞发生)后，在第 n+1帧向DUE-TX发出D2D-CTS作为数据传输请求的响应，否则不发
24 D2D-CTS-如果DUE-TX正确接收（没有D2D-CTS碰撞发生），则这一对DUE 通信对就成功获得了对第n+2帧的D2D传输资源独占使用进行D2D数据传输 的权利；
3）	在第n+2帧的一个或多个上行子帧中DUE-TX向DUE-RX发送一个或 多个D2D数据传输块，在发送D2D数据的子帧中同时发送D2D-DataCtrl指示 该子帧中D2D数据传输的数据格式和资源配置信息；
4）	RxUE在第n+3帧中向TxUE发送对应上述D2D数据传输块的ACK/NAK 确认信息，完成本次D2D数据传输过程。
2. FDD
FDD相比较于TDD,每个无线帧均有10个下行子帧，设计的灵活性更大。 与TDD的设计思想一致，首先考虑最小的竞争粒度。基于时隙的RTS、CTS、 ACK控制子信道可以被压缩到2个子帧的控制信道中，所以1次RTS竞争2 个后续上行子帧的D2D通信资源，RTS控制信道使用偶数子帧slotO, CTS控 制信道使用偶数子帧sloth ACK控制信道使用奇数子帧slotlo控制信令交互 间隔选用与LTE网络提前下发上行物理信道配置一致的4ms,数据传输流程如 图 3-10o


具体为：
1）	TxDUE在偶数子帧n通过D2D-RTS向RxDUE发送传输请求，同时也 是向周围的其它DUE发出D2D独占资源竞争，即发岀对n+8、n+9子帧的D2D 传输资源进行独占使用的请求；
2）	RxDUE在n子帧正确接收RTS （没有D2D-RTS碰撞发生）后，在第 n+4子帧向TxDUE发出D2D-CTS作为数据传输请求的响应，否则不发
25

D2D-CTSo如果TxDUE正确接收（没有D2D-CTS碰撞发生），则这一对DUE 通信对就成功获得了对n+8、n+9子帧的D2D传输资源独占使用进行D2D数据 传输的权利；
3）	TxDUE在n+8、n+9子帧的上行信道中向RxDUE发送一个或多个D2D 数据传输块，在发送D2D数据的子帧中同时发送D2D-DataCtrl指示该子帧中 D2D数据传输的数据格式和资源配置信息；
4）	RxUE在n+13帧中向TxUE发送对应上述D2D数据传输块的ACK/NAK 确认信息，完成本次D2D数据传输过程。
3.2.5基于D2D链路速率预估的多进程RTS触发机制
普通CSMA/CA采用紧凑型RTS-CTS过程，如下图3-11示。



图3・11 802.11协议中RTS-CTS过程
此时,RTS申请不存在与CTS应答之间还有多个RTS信道的情况。在SSCA 中，RTS-CTS过程往返时延大，若将数据传输也计算入内，则从RTS开始到 D2D数据发送完毕将花费3个无线帧的时间。以图3-9的TDD Config 1下的通 信流程为例，TxDUE在第n帧申请RTS竞争接入第n+2帧后，在第n+2帧数 据传送完成前，第n+1、n+2帧又各有一次RTS竞争接入信道的机会。若TxDUE 在将申请到的数据信道使用完毕后再查询待发送缓冲区内是否还有数据待发， 最快也需等到第n+3帧的RTS信道中进行申请，并使用第n+5帧进行第二次数 据传输。两次数据传输之间间隔2个无线帧，这在无碰撞的单向D2D通信中， D2D的通信速率将会直接降低到最大传输能力的1/3-
考虑到上述情况，提出基于D2D链路速率预估的多进程RTS触发机制。 其思想与多进程HARQ相似，分配多个RTS进程，每个RTS进程独立管理一 次数据传输过程，并利用历史D2D发送链路平均链路速率预测已经申请的上行 传输资源能否足够承载待发送缓冲区内的所有数据，在不足时可以及时进行 RTS接入申请新传输资源。
TxDUE到RxDUE的平均链路速率S^〉为近N次成功传输中D2D上行共 享物理信道（D2D-PSCH）能够承载的平均通信速率，单位为bit/scheduled。
26

SD2D=i^BSizejN , NnminWsMax)
其中，翊为第i次成功传输时使用的传输块大小，Mans为已记录的传 输次数，蝠为记录队列的深度。
Sd2d与TxDUE到RxDUE的链路质量、蜂窝网络负载情况、DUE周围环 境相关。由于D2D通信用户常处于低速或静止状态，信道环境、蜂窝网络负载 在短时间段内维持稳定，所以结合历史岛2d和待发送缓冲区状态对发送所需要 的子帧数进行估计。
-	RTS触发流程如下：
1）	检查SD2D是否已初始化，若TxDUE到RxDUE的=0 ,表明此链 路平均速率暂未初始化，采用普通RTS触发流程，即一次申请直到确认发生碰 撞或数据子帧发送完成才允许下一次申请。当无CTS等待且在非退避期时，使 用RTS进行信道竞争接入，在已申请列表中记录本次申请上行子帧数。
2）	若品2。已初始化，在满足非退避期时，读取目的地址为RxDUE的待发 送缓冲区状态，为妇，对应目的地址己申请上行子帧数NUL_req ,此时待发送 缓冲区的发送通过预估得到需要的上行子帧数凡妇^
NuL -need =LtB/SD2D
当凡小，心〉M如冲时触发RTS发送，并记录申请上行子帧数，否则屏屛 次触发。
3）闭环控制：对于叫心_叫，当发生RTS碰撞（CTS接收超时）或数据发 送完成后，在已申请列表中删除对应申请的上行子帧数。对于则通过式3-6 进行更新。
3.3系统间干扰认知协调机制
异构网络复用蜂窝上行资源，网络间干扰为DUE发送对基站接收造成的 D2C干扰和蜂窝用户发送对DUE接收造成的C2D干扰。
3.3.1 D2C干扰控制机制
DUE对基站接收造成的干扰存在两种因素：1） DUE正交复用蜂窝资源， 在DUE距离基站较近时，若使用过大的发送功率会引起基站对边缘CUE弱信 号接收的处理精度损失；2） DUE非正交复用CUE资源，导致CUE通信链路 SINR降低，引起误码率的提升，影响蜂窝上行链路通信质量。
27
33.1.1正交干扰控制机制
在理想情况下，使用正交资源不会引入干扰。但在实际中，由于BS前端 具有非线性、截止等特性，当BS接收到来自DUE的干扰功率远高于其设定的 对CUE接收功率时，可引起信号处理时干扰泄露、精度损失等一系列导致BS 对CUE处理性能恶化的问题。正交干扰控制决定了基站可容忍的D2D发送功 率上限PBSD2D o为了不影响基站对蜂窝小区边缘用户弱信号的接收，D2D发送 功率的上限应满足:基站接收到DUE干扰功率不应大于CUE到达基站的功率 的均值。DUE需要了解当前蜂窝网络配置的系统信息（SI）和蜂窝网络功控方 式。
蜂窝上行PUSCH功控采用
^PUSCH =P&+ PpL* P心* ^tpc = Po_pusch * a • PL© + 厶订 *《[dBm/RB] （3-8） △所=101。％（（2噺*_1）.媪尸）	（3-9）
其中，出为蜂窝网络配置的PUSCH静态工作点，Ez为开环路损补偿项， 服为码率补偿项，耳％为闭环TPC命令字补偿项。
对于D2D系统，
Pbsd2d = P。d2dpsch * a ■ PLdb * AtEm [dBm/RB] （3-10）
其中参数的获取方式如下：
P°_d2Dpsch :在蜂窝辅助的D2D控制中，配置PogscH作为D2D正交复用 蜂窝上行资源时最高允许的基站接收干扰功率值，在系统配置中，可以与 ^NorninalPUSCH 一致，放入SIB2中。若蜂窝系统P0D2DPSCH未配置，默认 Po_D2DPSch =P0_pusch，即最高允许的干扰接收值与蜂窝上行PUSCH静态工作点 相同；
«：蜂窝上行路损补偿因子，基站可以由此控制终端开环补偿程度，能够 满足UE从完全不补偿路损到完全补偿路损的灵活配置。a通过解析SIB2 uplink PowerControlCommon 信息得到；
PLdb： DUE到基站的路损。有两种方式可以得到。1）物理层测量小区专 用参考信号接收功率RSRP,通过解析SIB2得到参考信号发送功率，差值即为 基站到D2D终端的路损尹妁。，近似认为双向链路对称，特别是在TDD环境中， 近似满足PLdb=PLbd关系。2） UE在选择通信模式时，以开环功控的功率向基 站发起PRACH接入。在基站反馈的随机接入响应及后续信令交互过程中，得 到基站对UE发送功率的修正量Gpc，PLdb = PLbd + Mc，可以消除由双向链
28

路不对称引入第一种方案的不准确性。
M :蜂窝上行平均码率补偿项。在蜂窝网络中，系统通过deltaMCS-Enabled 指示是否需要MCS补偿，并使用RRC专用信令的方式配置。在蜂窝辅助的异构 网络中，此参数由基站广播下发进行配置。通过预设蜂窝通信平均码率，计算得 到此项。
对于LTEPUSCH,毬共有27种配置，编号为。〜26, Acs为29种配置。 默认以4心13作为蜂窝用户平均MCS码率，或以蜂窝网络配置为准。按照式3-9 计算，得到Imcs\3对应的=5.81, ZMCS28对应的△丄=19.2。经计算，在 近基站匹域内当有25对D2D设备同时复用同一资源，产生的累积干扰与蜂窝最 大码率补偿项一致。通过保留13.4dB的接收功率裕量，能够有效解决D2D通信 对基站的累积正交干扰问题。
3.3.1.2分布式重用干扰控制机制
基站通过配置蜂窝用户链路质量损失门限7；oss，由DUE分布式对重用囲 源引入的干扰进行跟踪控制，达到D2D通信对蜂窝通信干扰协同目的。
干扰控制目标为：控制由D2D通信引入的干扰所导致的蜂窝上行链路质量 的降低比例不超过预设门限7；oss。
定义蜂窝上行链路质量0頒的衡量标准为：蜂窝用户CUE连续N次调度 中上行链路平均每RB上承载bit数目，即统计指标单位为bits/RB/schedule»蜂 窝用户上行传输的正误性，可以通过DUE监听PDCCH并对公共搜索域 (Common Search Field)中的UL DCI信息盲解码得到新数据指示(NDI)综合 HARQ指示(HI)信息后得到。
0	(HI / DCI\ = NACK
TBSize {HHDCI\=ACK (3-11)
非正交干扰控制决定了 DUE在CUE传输资源上允许的最大复用功率。对 于最大复用功率的调整，DUE采用闭环方式，跟踪重用干扰影响，并根据系统 设定最高蜂窝业务损失率调节存储的对应蜂窝用户资源的复用允许最大发送功 率因子factorpc，进而调节再次复用CUE1时被允许的最大发送功率。基于最高 蜂窝业务损失率设定的干扰跟踪机制如下图3-12所示。当DUE非正交复用了 CUE1的资源使其通信质量的降低在安全范围内，则缓慢增加对CUE1复用允 许最大发送功率因子；可接受范围内不调节；反之降低此因子。
29


对于每个蜂窝用户CUE/均执行以下非正交干扰控制步骤:
1）静默监听CUE,上行资源分配、传输反馈信息（UL DCI信息和HI信息）, 得到本机感知到的C血，•初始上行链路质量。并通过D2D广播信道周期性发送 本机感知到的所有CUE初始上行链路质量。通过接收其他D2D用户的感知信 息，选取最大值为CUEj的初始上行链路质量Qcue_"并更新本机感知值。
2 ）初始化C既，.复用功率因子factorPC ,为DUE功率可变范围的中值。
3）非正交复用。明资源的发送功率为:



4）每次非正交复用C血，的资源后，执行闭环功控。
监听CUE,传输反馈HI及NDI,按照式3-11计算0班，按照式3-13调整 factorPCi o
QcUE > (1 - Loss + △ monitor) ■ QcUE_i而 & factOrpcj = factorpCupper
QcUE > Q _TlOSs + 3mrniiiQ'QcUEMctorpci <■ factorPCupper (1 — Ttoss) • QcUE_init < QcUE <	— "^LOSS + ^monitor) - QcUE_init
Qcue < Q - Loss)' QcuEjnH & factorpa > factorPCIower
Qcue < (1 — Lqss) • Qcue& factorPCi = factorpciower
（3-13）
其中，factorPCupper.庇Scs为复用功率因子调整的上下限。琴州为 D2D对Qg的监控裕量因子，即为了满足龙c彻pc收敛设定的可接受区间门限。 △眄为复用功率调整精度。
5）若将成啊复用功率因子降低到复用功率下限还不能使0*满足准则。 则停止对c通;的复用并再次进入步骤（1）。
30
对于多D2D用户对。昭造成的累积干扰，通过一定时间的闭环功控，这 些D2D设备中维护的如c血沁都会降到一个合理值，保证控制目标得以满足， 进而保证蜂窝上行链路质量。
3.3.1.3集中式重用干扰控制机制
分布式重用干扰控制机制，其优点在于基站不需要控制，仅需要配置蜂窝 通信链路质量损失率即可，但其缺点也比较明显，需要DUE不断监控每 条蜂窝链路反馈的HI、NDL增大了 DUE终端的处理压力。考虑到蜂窝通信 上行链路质量本身就是基站监控的一项指标，可以直接利用基站辅助控制得到 对共用干扰控制方案一一基于干扰容限的集中式重用干扰控制机制。
这种方案主要在基站端进行，基站在进行蜂窝网络上行调度的基础上，同 时计算本次调度上行子帧中每个RB能够允许的干扰值(dBm/RB),并向DUE 广播，消息结构示意如表3-2所示。
表3-2可容忍干扰辅助信息结构表(TorlntfTable)
RBI	Torlnterferencel
RB2	T orlnterference2
RB3	Torlnterference3
RB4	Torlnterference4

RB Max-1	Torlnterference Max-1
RB Max	Torlnterference Max


基站侧对每个CUE维护上行链路质量表，如下。
表3-3基站维护的上行链路质量表
CUE
C-RNTI	TxPower
Margin	QoS Class	QcUE_allow	QcUE_minreq	QcUE_cur	Totalinference

其中，CUE C-RNTI为UE在蜂窝无线网络中的识别码；TxPower Margin 为CUE剩余的发送功率裕量，当发送功率裕量不为0时,基站可以通过PDCCH Format 3A对CUE进行上行闭环功控，在容忍干扰不变的情况下，提升其上行 链路质量。QoS等级决定了表格中的CUE允许链路质量和CUE最小 链路质量需求Qc电minreq。QcUE*ut为当前CUE平均链路质量，并通过一定机制 调整此CUE可容忍的总体干扰值。考虑到CUE的链路质量与D2D通信和底噪 形成的总干扰直接相关，所以调整的是总体干扰值，这样可以将底噪的变化也 包含在其中。下图3-13为一种可容忍干扰值的调整机制，使用三段增量方式调 整不同区域的干扰值闭环增量，增加系统调整自由度。
31


图3-13集中式可容忍干扰调整机制示意图
首先，由蜂窝网络设定初始允许的干扰相比噪声提高量，假定此时噪声为 Pnoise (单位dBm/RB),初始提高量为、“(单位dB),则初始可容忍总干扰 TotalInference(Q)及可容忍 D2D 通信干扰 TorInterference(G)(单位 dBm/RB)为 Totall晌enceW) = Pnoise + △她
TorlnterferenceiG) = ioiogIO(10ro,aMrence(0)/1(, -10%*)	(3-14)
对可容忍干扰进行闭环控制，得到此CUE第i次的可容忍干扰值为
Totallnterferenceiji) = Totallnterference(i-1) +A
Torlnterference(i) = 101og10(10r°z°Mre,,ce(,)/,0 -10%"。)	(3-15)
其中，
△s	QcUE_cur W (QcUE_aHow，+°°)
△	QcUE_cur 6 \QcUE jnmre^QcUE _allow\
'<!	QcUE_cur e[°，QcUE_ minreq )
可容忍干扰值经过量化后，放入表3-2的结构中CUE对应的资源段上进行 广播。
TorlntfTable(j) = TorInterferenceCUE , RB; is assigned to CUE,
DUE在接收到此辅助控制信息后，根据自身到基站的路损7Y伽，得到满足 D2C共用干扰约束的资源块j的最大允许发送功率乙we为
PTxDUE ①=TorlntfTable ① + PLDB	(3-16)
如上讨论了两组D2C的干扰控制策略。在基站辅助控制的异构网络中，使 用集中式D2C干扰控制策略能够简化DUE的设计，同时使基站对于多D2D通
32 信的累积干扰控制更加便捷。如果异构网络中的基站不能提供此辅助信息，使 用分布式D2C的干扰控制策略同样能够达到D2D通信对蜂窝网络通信干扰可 控的目的，多D2D通信累积干扰问题使用预留干扰裕量因子解决，能够在不支 持增加基站控制器功能模块的环境中使用。
3.3.2 C2D干扰避免机制
CUE传输作为D2D链路的干扰噪声，影响D2D链路的传输质量。DUE通 过测量上行子帧功率进行干扰感知，获得C2D干扰血払。在后续计算SINR 评估资源时，高干扰导致低SINR,通过资源选择算法，避开DUE对高干扰资 源的使用。
在对CUE进行发送功率测量时，需要考虑到此时可能有近邻DUE复用了 此段资源进行D2D通信。所以此时应同时监听此DUE冲突域内是否有其他 DUE在数据随路控制信道中发送D2D数据信道配置信息，如果有，在测量时 需要避开这部分资源，而在冲突域外的D2D发送不影响本DUE对CUE干扰的 测量。
获得血妬的具体步骤为：
1）	监听蜂窝网络上行资源分配信息，存储所有被调度CUE的RB资源数 榛、RB起始位置MCS信息。
2）	监听D2D-DATA随路控制信道，解析D2D冲突域内D2D-DATA数据 信道的资源占用信息。
3）	物理层测量上行子帧每RB的能量，使用D2D非复用资源测量结果，
按照蜂窝资源分配表计算对应CUE对自身的平均干扰IntfCiD,若D2D通信完 全复用某CUE的资源，则本次不更新血％,力。式3-17中，LRBi为CUE独占资 源长度，球。“为其功率测量结果。	’
101og10 4工七——>_1\	MCSenMe =旭庇
IntfCiD=\ ‘I 栩 、丿	[dBm/RB]
im	快 Start,+幻）
lOloge 				M MCSyfue
, I	L朋i	丿
（3-17）
由于C2D干扰影响RxDUE,而SINR的预估在发送端进行，需将感知到 的CUE平均干扰血电表通过D2D数据广播信道周期广播，并使用超时淘汰机 制进行维护。D2D冲突域内的所有用户保存干扰广播信息，在后续发送功率开 环计算时选择对应D2D用户感知到的IntfcD。
33

3.4 D2D链路自适应机制
上文两节讨论了 D2D分布式资源管理对于异构网络子网络内部及子网络 间干扰控制机制的设计思路及解决方案，确定了 TxDUE在数据传输时的时域 发送时机、每个资源块的最大允许发送功率和干扰功率。本节将主要关注DUE 如何自适应链路，以保证不同环境下的D2D通信的可靠性，并为TxDUE在数 据传输时的调制编码方式选择做铺垫。
无线信道衰落分为快衰落和慢衰落。为了保证在两种信道因素下的通信可 靠性及资源利用高效性，选用两种机制对链路进行自适应。自动调制编码 （AMC）用于跟踪信道的慢变，HARQ负责补偿信道的快变。由于AMC与 HARQ的设计均涉及物理层（PHY）,所以需要进行RRM-PHY跨层设计。
3.4.1 AMC
在通信系统设计早期，使用固定调制与编码技术，为了兼顾最恶劣信道， 只能选择较高的发送功率与较低的码率。这样即使信道条件较好，也不能加以 利用，极大浪费了信道容量与资源利用率。AMC技术的主要思想是通过动态调 整调制方式与编码速率，以适应信道条件，在保证一定可靠性的基础上，达到 较高的频谱利用率，使通信速率获得提升。
AMC技术原理框图如下图3-14示。数据接收端通过向发送端反馈传输质 量指标，如信道测量SNR、传输正误指示等，指导发送端使用AMC算法对当 前使用的调制编码方案（MCS）进行评价并确定下次传输所使用的MCSo



图3-14 AMC技术原理框图
在进行AMC算法设计前，首先需要对PHY支持的调整编码方式进行分级。 级数越多，AMC算法调节精度越精细。考虑到UE需要支持两种通信方式，为 了达到尽量多的模块重用，使D2D支持的调制编码表与LTE保持一致，以共 用Turbo编码器、速率匹配模块、调制模块，具体MCS表见文献[30]o
虽然选用的物理层MCS分级方案相同，但D2D通信的AMC与蜂窝网络 中的AMC仍不完全相同。在传统蜂窝网络中，传输信噪比主要与底噪、信道
34 响应和发送功率相关，假设一段时间内底噪与信道响应稳定，在CUE发送功率 不变的前提下，通信使用的MCS可以保持稳定，长时间的MCS变化趋势为渐 变。但在D2D通信中，为了满足干扰控制要求，其发送功率会根据每次占用资 源段中的CUE可容忍干扰值进行调节，同时，资源段包含CUE的不同也使得 对D2D通信引入的干扰值不同，这些都会导致发送所使用的资源段SINR不断 变化，其MCS方案选择也会频繁改变，而且经常会在不同码率间进行跳变。这 需要D2D的AMC具有适应信道变化及码率频繁跳变的能力。
在设计中，D2D使用的AMC算法由开环和闭环两部分构成，开环提供支 持码率及MCS频繁跳变的能力，闭环提供对信道变化的适应能力。在开/闭环 AMC设计前，由于在开环AMC中需要在TxDUE侧对RxDUE可能接收到的 SINR进行预估，首先对此环节进行研究。
3.4.1.1 SINR 预估
在蜂窝与D2D异构通信以往的研究中，一般都仅讨论复用一个CUE资源 的情况。但在实际中，复用多个CUE资源也是可行的，只要保证对其中任何一 个CUE的干扰不超过阈值即可。
假设DUE需要复用的资源段RBSEG如下图3-15示，资源段长度记为 Nprb_seg，内部共包括CUE1,……CUEn,各占用资源段长度NPRB_CUEl,…… 、邱朗。在RxDUE处感知到的对应CUE的干扰功率值为1时硕，…… IntfCUEn (单位为dBm/RB),底噪功率为(单位为dBm/RB)。其中，IntfCUE 中已经包含底噪功率。
IntfcUE\ N 0 IntfcuEllntfcUEB	^fcw.n
CUE1 CUE2 I CUE3 	 CUEn~~~
~——＞；	...... 长奇	 'I~
N&伫昭!	 	___
i	N prb-seg	I
图3.15资源段资源分配
RBSEG的SINR通过下式计算
SINR = P7、-PLg — (I + N) [dB]	(3-18)
TxDUE单位RB发送功率珏需满足自身功率等级最大发送功率限定、D2C 的正交和重用干扰控制限定，为限定允许发送功率的最小值。
当使用集中式重用干扰控制机制时，
35

其中，Torlntf为集中式重用干扰辅助控制广播中，指定资源段所有资源的 可容忍干扰值的最小值，即
Torlntf = min(TorIntfTable{NPRBStart +z)) , 0<z<NPRB_SEG (3-20)
i	■
当使用分布式重用干扰控制机制时，
^D2Dmax _ 1。^°810 ^PRB-SEG	-
=min-	PD2BS	> [dBm/RB] (3-21)
PD2BS + factorPcue
其中，复用功率因子为资源段RBSeg中被调度的蜂窝用户复用功率因子最 小值，若无蜂窝用户，则复用功率因子为0,允许使用最大正交功率。
factor =
SINR式中PLd2Drx为TxDUE本机到RxDUE的链路损耗。DUE周期性广播 自己的状态信息，并作为DUE间相互认知的依据。通过RxDUE对TxDUE广 播中参考信号的测量，测量值(RSRP)与参考功率之差即为TxDUE到RxDUE 的发送链路损耗。在竞争接入SSCA过程中，PL通过CTS响应告知TxDUE。
对于I、N , TxDUE通过C2D干扰避免机制获得RxDUE的IntfCUEn和N。 后，需要按照资源分配图进行计算得到I + N.
对于其合并方式，考虑到D2D数据传输使用与LTE蜂窝网络相同的 SC-FDMA技术，其基带信号SC-FDMA对调制符号先进行DFT,插零扩展后 再进行IFFT变换，其本质为频域补零时域扩展的时域调制方式，在资源段内每 个子载波上引入的干扰噪声在解调时将会平摊到每个数据符号，所以，RBSEG 的干扰1 + N按照式3-23以资源段加权平均的方式计算。
NcuE	1 河CUES	M)	Ncue
£10 2 •心叽阻+102・(心队殂 —£ NPRB-CUE)
[+ N = 10 log io 旦			E	 (3-23)
最后，按照式3-18计算得到此资源段的预估SINR。
36

3.4.1.2 AMC 控制
得到预估SINR后，通过SINR与MCS的对应曲线进行AMC开环控制。
在前文己经说明D2D与LTE使用同一套调制编码机制，本节将对SINR与MCS 对应准则进行讨论。
由于D2D通信釆用Turbo编码，误比特率BER和误传输块率BLER的闭 式解无法得到。这里釆用对物理层MCS方案在指定信道环境下进行蒙特卡罗法 仿真，得到对应BLER曲线。
仿真中，资源分配5RB、天线配置釆用1x1,信道模型使用ETU70和EVA70, 对MCS0-MCS28进行仿真，BLER曲线如图3-16、3-17。







图3-17 EVA70信道全MCS的BLER曲线
在BLER仿真的基础上，对D2D网络SINR的区域划分进行讨论。在D2D 系统中，可用4/cs数量为29,故将SINR区域划分为互不交叠的30个子区间， 子区间边界记为伊“}%，/为信噪比。当/£[/„,/„+1),选用MCSn的方案，当
37 聲(*%)时，不进行发送。｛港二的选取准则，根据优化目标的不同，一般 分为频谱效率最大准则和保证误包率准则。
频谱效率定义为单位带宽中每个符号传输的比特数。MCSn在单位带宽下 使用的TBSize记为虬,频谱效率最大化准则描述为
MZ0 =盹"麟]低(，)=比。-BLER" (/)))	(3-24)
频谱效率最大化准则仅关注频谱效率最大化，不关心平均误包率。
保证误包率准则相对保守，在设定最大误包率门限砒敬血后，保证当 r €[r„,/„+I)时选用MCSn的方案的最大误包率不超过BLE5 ,准则描述为
= arg max ｛4 (1 -BLER„ (/)) | BLER„ (/) < BLER^get｝ (3-25)
两种准则相比较，保证误包率准则更关注可靠性，频谱效率最大化准则则 关注资源利用率的最大化。在异构网络中，D2D通信属于次用户间通信，在效 率与可靠性间，选择牺牲少量效率达到可靠性要求。
在本文中，设定以£砍溥=0.05 ,由BLER仿真曲线，得到ETU70和EVA70 信道环境下的｛/“｝二分别为
｛厶｝etu7o=[37，-2.2,-1.4, -0.5, 0.3, 1.65, 2.75, 3.8, 4.5,
5.5, 6.3, 7.7, 8.8, 9.5, 10.2, 11.1, 11.9, 12.6,
13.2, 14.2, 15.1, 16, 17, 18, 18.5, 19.3, 20, 21.1, 22f
｛%｝eva70=[—28, -1.7, -0.8, 0.8, 1.3, 2.5, 3.4, 4.3, 5.1,
6.15, 7.15, 8.3, 9.9, 10.3, 11.3, 12.4, 13.2, 14.8,
15.7, 16.3, 17, 17.9, 18.7, 19.4, 20.1, 22.1, 23.4]T
这两种信道环境下的子区间边界集｛治｝：：。对应边界偏移量相对固定，故选 用ETU70的边界集为基准，并引入MCS调节因子对每一条D2D通信信 道类型进行闭环适应
在异构网络中D2D通信使用的MCS码率不连续，Zes不能直接修改【mcs， 而是通过修正当前MCS与SINR的对应关系，达到间接调整MCS的目的。引 入MCS调节因子Zes的MCS选择方案由下式给出。
mcsidx = ｛n | /„ < SINResl +AMCS </„+]) ,	(3-26)
△”cs的调整基于传输正误反馈的ACK7NACK,以统计的方式判断目前 反刀&旳是否满足要求。假设此时传输的数据包总量为凡部，■函.，反馈NACK的
38
数量为 Nerror,则 BLERmeas = f / Ng。
若传输最大误包率设置为BLER^ ,则Ay调整策略如下
A 宀 _ △ mcs + ♦ mcs _邮炒 BIER*的 > BLER^	( 3-27 )
MCS	△a/CS _ *MCS_ downstep BLERy < BLER^t
与D2C干扰控制机制调整思路一致，将调整步长独立设置，保证能够以灵 活的配置支持劣妗的尝试与退避。在能够满足误包率约束的条件下，通过降低 △mcs，尝试在相同的信道条件下使用更高的MCS,增加频谱效率，反之能够 降低MCS以保证约束。
考虑到RLC待发送缓冲区长度乌瓯小,当根据式3-26得到的mcsidx在指 定资源段长度时的对应msfee>z庖c-Tx时，有两种优化策略：1)固定mcsidx, 减小使用资源段长度；2)固定资源段长度，降低mcsidxo第一种策略，在蜂 窝网络中干扰平坦的环境中能够适用，但在D2D中，资源段长度的变化将影响 SINR的计算，进而影响可以选择的mcsidx,即若改变选择的资源段长度需要 重新预估SINR并重新进行开环AMCo第二种策略则适用D2D环境，仅需按 照TBSize表，固定RBLen,选取能容纳临小的最小TBSize即可。策略描述 为：
mcsidxl = arg min{TBSizeTable[7Vrae ] \ri\ > 丄咨_昨) , n g [0, mcsidx] ( 3-28 )
n
其中，mcsidx为式3-26返回结果。
3.4.2 HARQ
HARQ (Hybrid Automatic Repeat reQuest)混合自动重传请求，为 FEC 和 ARQ的联合。过多的FEC冗余会降低传输效率，较少的FEC冗余降低传输正 确率，HARQ能够在FEC不能进行成功纠错时使用ARQ重传，兼顾传输效率 与正确率。
D2D通信中，使用HARQ对无线承载进行QoS保证，并补偿快衰落引入 的传输错误。HARQ设计时，考虑最大限度利用LTE已有技术与模块，并针对 二者的差异给出解决方案。
首先将D2D通信环境与LTE通信环境中的HARQ条件进行比较。在LTE 蜂窝网络中，上行使用同步HARQ,其数据与反馈指示间时间间隔恒定，初传 与重传、重传与重传之间的时间间隔恒定[3%由于通信资源由基站集中调度， 可以保持与前次传输相同也可以不同，即使用自适应、非自适应资源分配皆可。 对于D2D HARQ的设计，考虑到D2D使用专用DCCCH,当确认指示
39
ACK/NACK与传输数据间定时恒定，通过SSCA竞争得到数据传输资源的同时 也确定了在冲突域内对ACK反馈信道的接入权，能够满足确认指示与数据传输 间恒定的时间间隔。但DUE作为异构网络的次用户，在重传时，其对应的上一 次调度时使用的通信资源在本次调度中不能得到保证，需要等到蜂窝网络资源 分配后才能在此基础上进行调度。这导致了 D2D HARQ与LTE HARQ的设计 不同。
通过上述分析，并借鉴LTE HARQ的设计思路,提出使用定时反馈的异步、 自适应的D2D HARQ过程，并使用与LTE相同的多进程停等（S/W）协议。“定 时反馈”、“异步”、“自适应”分别指：确认指示与传输数据之间的定时关系确 定；初传与重传、重传与重传时间间隔不定，需要根据竞争到的资源决定，在 数据传输时由随路控制信道进行初传、重传指定；数据重传与之前传输所使用 的资源选择相互独立，需要蜂窝网络资源分配情况后才能决定。多进程S/W协 议利用了标准停等协议的简单性，每个进程负责一个传输块的存储、传输、确 认，由N路HARQ进程并行运行以避免在等待ACK反馈期间单进程不能进行 新数据发送的弊端，增强吞吐能力。
在进行D2D HARQ其余MAC层方案设计前，需要先确定物理层对HARQ 提供的支持，以进行RRM-PHY的跨层HARQ设计。HARQ技术除了由MAC 层提供HARQ实体管理及状态转换、重传时参与MCS选择、确认反馈的传输 外，还需要物理层在基带信号处理层面提供对初传与重传进行增量冗余（IR） 发送、接收合并或对Chase合并（CC）的支持。
物理层HARQ对于IR和CC的支持，主要决定于基带信号处理中的速率 匹配模块。由于D2D与LTE通信使用相同的MCS方案，且文献［31］中规定的 速率匹配模块能够支持对可变长度的传输块通过打孔、重复操作对信道不同资 源量予以适配，故D2D完全复用LTE中的速率匹配模块便可以完成物理层对 HARQ的支持，具体物理层信号处理方案在此不予过多描述。考虑到IR能够提 供更多合并增益，在D2D中，仅使用IR作为HARQ的合并方案，并将最大重 传次数设置为4,、冗余版本（RV）设置为0〜3,以保持与LTE的一致性。
确定HARQ物理层方案后，针对D2D与LTE HARQ的差异给出以下解决 方案：
1.初传与重传控制参数
对于D2D通信中初传与重传可能取得不同的信道资源，考虑如下：RxDUE 物理层HARQ软合并处于速率匹配后、Turbo译码前的虚拟环状缓冲区，如图 3-18所示，必须保证初传与重传时此处数据一致，即原始数据、TBsize不能改
40
变，编码方式由于仅使用Turbo不需考虑，其余参数可以随着使用信道资源量 的不同而变化。


图318物理层数据传输速率匹配框图
调制方式与RB数量的变化体现在信道传输容量上，会得到不同的E （速 率匹配中环状缓冲区中数据的传输长度），冗余版本RV的变化体现在kO （速率 匹配中环状缓冲区中数据传输起始位置）不同，LTE与D2D速率匹配差别如囹 3-19所示。所以，对于同一 HARQ进程的初传与重传控制参数，TBSize不寵 改变，RV由HARQ进程控制，其他参数如资源段起始、资源段长度、发送功 率、调制方式等均由RRM在重传调度时计算得到。

图3-19 LTE与D2D速率匹配差别

2.ACK捆绑
在FDD-LTE中，一次上行PUSCH传输对应一个ACK；在TDD-LTE中， 若一帧中下行子帧数不少于上行子帧数,根据协议中固定模式每一个ACK对应 一个上行PUSCH传输，否则使用ACK捆绑（ACK Bundling）㈣技术。
根据基于SSCA的D2D数据传输流程，TDD网络中D2D资源竞争粒度为 一个无线帧，FDD网络中D2D资源竞争粒度为两个上行子帧。一次竞争传输 流程仅对应一个ACK控制子信道ACK-CCCH,需要在这个信道中反馈其对应 的资源竞争粒度中全部传输结果，所以也需要使用ACK Bundling技术。但与之
41 不同的是，D2D使用控制子信道，其信道资源比LTE中ACK指示传输资源多， 在设计时主要关注ACK指示的对应关系。
对ACK Bundling中需要预留的ACK指示数量做如下考虑。对于TDD模 式而言，一个无线帧中最多能够提供的上行子帧数为6 (TDD Config 0),需要 预留6个ACK/NACK位置。FDD中，竞争粒度为2,所以需要2个反馈位置。
D2D通信中，可能存在竞争到无线资源却不能全部利用的问题。例如，在 TDD Config 1中,一次竞争能够获得四个上行子帧的接入权，但其发送缓冲区 利用三个上行子帧便全部发送完毕，最后一个上行子帧不会进行数据发送。所 以，在接收端存在三种接收情况：
1)D2D数据随路控制信道(DATACTRL：CCCH)正确，D2D数据共享信 道(DPSCH) CRC校验正确，表明传输成功，反馈ACK；
2)DATACTRL-CCCH正确，DPSCH CRC错误，表明TxDUE有数据发送， 但RxDUE接收错误，反馈NACK；
3)DAIACTRL-CCCH错误，无法进行DPSCH解码，此时不能确定是接 收错误还是未发送，默认反馈NACK；
对于TDD模式非UL子帧的预留位置，默认置NACK,由TxDUE HARQ 负责对应进程匹配处理。
3.5 D2D资源决策方案
上小节中针对一个资源段中的干扰计算、发送功率选择及MCS选择问题进 行了方案设计。本小节将首先讨论在已知蜂窝调度资源图的条件下最大化D2D 吞吐的资源选择方案，而后在更具有可实现性的条件下简化无线资源分段策略, 并讨论分段D2D无线资源决策问题。
3.5.1最大化D2D呑吐的资源选择
为了最大化D2D吞吐，不对资源选择进行限制，即支持选择不连续资源、 每个资源块上允许使用非统一功率。
由系统间干扰认知协调机制及式3-23、3-19、3-21,得到每个RB上的干扰 (包括噪声功率)与允许发送的最大功率，分别记为in和
t n ) n=Npucch
(Pf ""，单位 dBm/RB,
最大化D2D吞吐，即选取在此子帧中能够使用的最大TBSizeo其步骤如 下：
42
(1)初始化已选集｛SINRselect诚｝为空，候选集｛SINR,｝鴛辭丁为每个RB 的SINR,结果集｛TBSize必｝、｛RB哧｝、｛MCS誕｝为空，循环序号idx = l。
(SINR“严了％™ = ｛p 仁了加阪 一 ｛i 严:叫回	(3-29)
(.	n ) n^NPUCCa	t )n-^pucca ' n n~^puccH
(2)选取候选集｛SINR”｝笞中最大SINR,加入已选集｛SINRselect也｝, 将对应序号n加入｛RB弦｝,并计算已选集总体TBSize,存入结果集｛TBSize毆｝, 删除(SINRJ中对应记录。此时结果集中共有idx条记录。
'i A / i 丄)
SINRselect =101og10 £10“/£10】° ,	i e ｛RB^ (3-30)
mcsidx = ｛n I /„ < SINRselect+AMCS </„+1) ,	/„ e	( 3-3 】)
MCS 泌=mcsidx	(3-32 )
TBSize/(fc =TBSize[z<ix：] \mcsidx]	(3-33 )
(3)当｛SINR* 为空，进入(4)。否则，idx idx+1,跳回(2)。
(4)在结果集｛TBSize*｝中选取最大TBSize，记序号为左，则最优资源分 配方案为：频域资源分配向量｛RB；｝，，对应发送功率向量｛P„,｝, me(RBj*=1 , 使用调制方式为MCS.对应方式，TBSize为TBSize*。
此方案虽然保证了 D2D吞吐最大化，保证了资源的充分利用，但其代价为 基带信号处理相对复杂，数据随路控制信息较多，同时，资源分配算法本身的 复杂度为O((Nul-2 -NpgHy )，对于实际应用过于复杂。
3.5.2基于遍历组合的资源分段
对于己知蜂窝调度资源图，系统资源已由蜂窝用户分割为不同区域：CUE1 资源、……CUEn资源及空闲资源。D2D资源分段时，为简化运算，进行如下 设定：1) D2D只能占用连续资源，且每个资源块的功率相同；2)若复用CUEi 的资源，则全部复用，不能仅复用部分CUEi的资源，空闲资源也同理；3)可 以复用多种资源，不限定每个资源段仅能针对一个CUE进行复用。
基于遍历组合的资源分段策略思路为：对不同区域在满足以上假定的情况 下进行遍历组合，得到所有可能的分段情况。举例如下"
43


图3-20遍历组合的资源分段
对于图3-20,在共享数据传输带宽内（不占用PUCCH）,有四段资源， ReScUEl、ReSiDLEl、ReSCUE2' Res【DLE2，共能产生10种分段方式。若将10种分段 方式分别调用AMC模块进行SINR、MCS的计算，共需调用AMC模块10次， AMC的调用次数满足0（”.（〃 + 1）/2）幻0（疽），”为资源图区域个数。
分段算法非常简单，但明显其中有一些资源组合在分段时就已经不可能为 最优解，如Resell独立组成的ReS|与ResCUEP Res^Ei组成的Res?相比，复用 相同蜂窝用户CUE1导致允许发送功率相同，干扰值与底噪对比，满足 IntfCVEX>N0,则 IntfcuEi 之 网费•貽小 •城,SINR}<SINR7,同时由于
LcUEl + L[DLE1
LCUE] < LCUE} + Ldlei，必然存在TBSize, < TBSize2。因此，对基于遍历组合的资 源分段进行改进，以减少不必要的计算。
3.5.3资源分段优化
由于Intfcul;>N0,资源分段优化思路为：1）对于独立空闲资源段，仅选取 最长段，记为L； 2）对于CUE资源段，若与空闲资源段相邻，选取带空闲资 源段的整体而不选仅包含CUE的资源段；3）对于所有资源段组合，若资源段 长度不超过L,不存入候选资源段。
其步骤为：
1）	将整个资源段放入候选资源段；
2）	选取空闲资源段，并选出最长段放入候选资源段，记录长度L；
3）	从左到右对整个资源段进行扫描，寻找独立CUE资源段和CUE相邻分 配的资源段组合体，进行遍历组合，并在与空闲资源段相邻时，与空闲资源段 组成整体，若比L大，则将此段资源放入候选资源段，否则进行下一次扫描。
44
示意如下图3-21。
LTE PUCCH	LTE PUSCH & D2D DPSCH	D2D
CCCH	LTE PUCCH
CUEl | | CUE2 | CUE3
1: L		1
Reference,,	2:
unselected	　　　3:
4: 1
图3-21优化后的资源分段

这种分配方式选出的候选资源段数量与蜂窝阿络资源调度图的资源分布方 式密切相关，记调度图中相邻资源的CUE数量为k,则AMC的调度次数满足 最大值不超过(?(k2),且与最大空闲资源长度L相关。
3.5.4无线资源选择决策
对于指定候选资源段，通过开环AMC得到发送功率、最大可用MCS和选 定MCS (最大可用MCS主要针对RLC待发送缓冲区内数据较少而降低最后选 定MCS的情形)，综合候选资源段位置及长度，得到适用于此资源段起始位置 RBStart、资源段长度RBLen、传输块大小TBSize、调制方式Qm、发送功率大 小纭。在得到所有候选资源段如上参数后，通过无线资源决策，根据策略选出 最优解即可交由数据发送模块使用。
为了简化计算，首先对最长空闲资源段进行AMC,若其反馈TBSize足以 承载RLC待发送数据时，不进行后续计算，直接使用最长空闲资源，以最大限 度保证对蜂窝通信干扰最小。
若不足以承载待发送数据，需对其他每个候选资源段进行AMC计算，并 按照以下优先级进行策略选择：
1)最大吞吐准则：选择所有资源段中选择最大TBSize的资源段作为决策 结果，描述为下式。
residxl = arg max{TBSize[«]}	(3-34)
2)最小干扰用户数准则：当最大TBSize相同时，选择最少复用CUE数量 的资源段作为决策结果。虽然AMC选择的方案满足干扰控制，但为尽量降低 对蜂窝网络干扰，选择尽量少可能受到D2D干扰的复用CUE数量。
residxl = ar§,min{Nmderlay_CVE[n]} , n e {residxl}	(3-35)
45
3)最佳信道质量准则：当最小干扰用户数也相同时，此时通常发生因为 RLC待发送缓冲区内数据较少而降低选定MCS的情形，选择最大可用MCS的 资源段，即资源段信道质量最佳。
residx3 = argmaxfMCS^-^Jn]) , n e \residx2\	(3-36)
若仍然重复，则随机选择一满足上述三准则的资源段使用。
■
3.6本章小结
本章主要研究设计了 LTE/D2D异构网络中分布式D2D RRM方案。首先分 析了 RRM方案的设计目标及框架。.其后，针对D2D网络内部干扰协调，提出 了基于D2D公共控制信道、多进程RTS及初传非退避BEB的SSCA机制。其 次，按照D2D监听PDCCH和HI综合获取蜂窝资源调度图的思路，研究设计 了系统间干扰认知协调方案。针对D2C干扰，设计了正交干扰控制与重用干扰 控制机制，并分别给出了二者在有基站辅助及无基站辅助时的策略。有基站辅 助时，正交控制选用D2D开环工作点配置方案，重用干扰机制使用基于蜂窝链 路通信质量跟踪的集中式干扰控制机制，若不考虑基站辅助，则可以使用基于 学习LTE PUSCH开环工作点的正交控制方案及基于最高蜂窝业务损失率设定 的分布式干扰跟踪D2C干扰控制机制。针对C2D干扰，设计了基于干扰测量 并主动避免的干扰控制机制。	•
基于认知协调，为达到D2D通信对无线资源的有效利用并保证一定的QoS, 又设计了基于干扰共享的SINR预估与开闭环结合的AMC实现自适应调制编码 控制方案，并在与LTE HARQ比较异同后，提出了适用于D2D的HARQ机制。 最后，基于D2D吞吐最大化为优先准则，设计了 D2D终端资源决策方案，并 对其中资源分段过程进行了优化。综合以上方案，实现了对异构网络D2D通信 无线资源管理的设计工作。
46
第四章D2D无线资源管理实现与验证
第三章主要针对LTE/D2D异构网络中的D2D无线资源管理方案进行了研究 设计。本章将结合具体实现环境，对D2D无线资源管理方案进行优化，对D2D 公共控制信道DCCCH进行设计。在此基础上设计并实现D2DRRM模块，在与 商用网络异构组网的环境中验证其性能。
4.1 D2D硬件验证演示平台介绍
目前，针对D2D这项新技术的研究大部分停留在理论阶段，仅能通过数值 仿真对其性能进行评估。为了验证真实蜂窝网络环境中D2D通信的可行性和基 本性能，研发实现了可扩展的D2D硬件验证演示平台Hl。基于此平台，可以实 现本文所提出的D2D RRM算法，并通过多台自制D2D终端与TD-LTE商用蜂 窝终端异构组网，形成LTE/D2D网络用以实测验证。	’
D2D硬件平台由x86通用处理器GPP服务器与通用无线电外设平台USRP 组成a】，如图4-1。x86服务器负责D2D网络基带信号发送接收处理、TD-LTE 基带信号接收处理、D2D-L2/L3协议栈，并使用虚拟网卡TUN技术实现Linux 系统应用层与D2D协议栈的互通。同时，通过在服务器上开发展示平台，实现 对整体网络通信状态展示，也能够实现指令下发，调整D2D设备的工作状态。 USRP负责基带I/Q信号与射频信号的相互转化，通过天线实现射频收发通信。 其与x86服务器使用lGbps以太网卡连接，二者间传送I/Q基带信号。通过x86 服务器与USRP的结合，实现射频前端、变频、基带信号处理、D2D协议栈、 应用业务发生及运行状态监控调整功能，形成完整LTED2D终端。

图4-1自制D2D硬件验证演示平台

47

系统架构如图4-2o其中，本文设计的D2D RRM模块作为L2/L3层协议栈 Scheduler的子模块，完成对D2D接入、测量、通信等资源管理功能。


图4-2系统架构图
在第三章中，D2D设备作为正常的蜂窝设备，在与基站进行传统通信的基 础上，能够接收基站辅助信息，完成分布式资源管理与D2D通信任务。在验证 场景异构网中，由于模拟的D2D终端不能与基站直接通信，基站并不知道其存 在，也无法将其接入核心网。因此本课题假设各台模拟D2D终端的已经预先分 配了本地局域网IP地址和终端ID。在通信模式选择问题上，假设通信目的地址 为本地局域网地址的通信全部使用D2D模式进行通信，并通过固定IP与DUE-ID 对应关系使D2D通信在资源映射（资源标识与蜂窝终端标识间的映射）阶段不 需要基站参与。通过以上设定，避开了异构网络D2D通信中必须由基站控制的 部分，同时并不影响D2D其余的通信方案设计，使D2D设备在无法接入基站的
48
条件下也能正常组网、通信，支持对异构网络中D2D同步、组网、物理层设计、 无线资源管理方案进行验证。今后在蜂窝网络支持设备模式选择、D2D寻址后, 上述方案能直接适用于异构网络，完成蜂窝与D2D的融合。
4.2 SSCA优化设计
在D2D通信验证场景中，D2D网络最大规模固定。为了使第三章中设计的 SSCA机制冲突几率更小、资源利用效率进一步提高，本节将结合网络最大规模 固定的特点及业务特性，对TDD模式下的SSCA进行进一步优化。
考虑到今后D2D网络的最大规模（一个D2D冲突域内的DUE最大数目） 能够由基站根据DUE信令反馈的D2D网络临近用户数进行设定并能在一段时间 内保持固定，同时网络中DUE-ID也能够由基站进行动态管理。当满足以上两个 条件，下文所描述的针对网络规模优化的方法即可适用。
4.2.1针对网络规模的优化
在第三章的设计中,SSCA采用基于初传非退避BEB的冲突避免的RTS-CTS 流程。在TDD模式中，每个无线帧中分配一个RTS竞争时隙用以竞争后续一个 无线帧中所有上行子帧资源的接入权，数据发送流程图如图3-9所示。
针对网络最大规模固定的特点，引入“优先接入”机制。通过分配优先接入, 达到对应DUE无碰撞接入的目的，降低网络整体碰撞率。记优先接入RTS为 RTSO,普通接入RTS为RTSlo同一无线帧中的RTSO、RTS1竞争目标均为后 续的同一无线帧中D2D数据信道的接入权。
网络最大规模记为N,编号为k的DUE允许使用优先接入信道的帧号为FN, 满足：
FNmodN = k	（4-1）
这样，能够保证每个DUE在N个无线帧中都有一次优先接入信道的机会。 优先接入信道最多仅可能有一个DUE进行发送，即只要DUE有接入信道的需 求，在被允许的RTS0时间点申请接入信道，其碰撞概率为0。同时在无RTS0 申请的情况下，仍然可以使用RTS1对信道竞争，既保证公平性，又能增加信道 利用效率。
RTS0与RTS1的关系满足：
1）	若监听到RTS0被占用，禁用本帧的RTSlo
2）	若RTS0无占用，则其他DUE可以通过RTS1在满足退避条件的前提下 竞争资源的接入权。
49
考虑到RTS1的发送调度需要在接收RTSO并进行解码后才能做出，RTSO 信道位置与RTS1至少间隔一个子帧。引入RTSO后，DCCCH分配如下表所示, 除TDD Format 0下行子帧较少，仅能支持每个无线帧中安排一个RTS竞争时隙 外，其余上下行配置方式均可以支持RTSO优先接入过程。
表4-1 加入RTSO后的TDD DCCCH分配
上下行配置	子帧号
0	　　1	2	3	4	5	6	7	8	　　9
0	RTS1	　　S	u	u	U	CTS|ACK	S	U	U	　　U
1	RTSO	s	u	u	RTS1	CTS	s	u	U	　ACK
2	RTSO	s	u	D	RTS1	CTS	s	u	D	　ACK
3	..	RTSO	s	u	U	U	CTS	D	RTS1	D	　ACK
4	RTSO	s	u	U	RTS1	CTS	D	D	D	　ACK
5	RTSO	s	u	D	RTS1	CTS	D	D	D	　ACK
6	RTS1	s	　　u	U	U	CTS	S	U	U	　ACK

4.2.2针对广播业务的设计优化
SSCA承载广播业务申请信道请求时，使用单播流程，随机选取在终端发现 列表中的DUE作为CTS反馈端，在RTS中指明申请广播业务，其后的数据传 输需要其他DUE也同样进行接收。症结在于由于RTS存在竞争，导致其必须使 用CTS才能确认是否已经成功申请到信道接入权。
在引入“优先接入”机制后，可以在4.2.1节的基础上进行功能扩展，以满 足对于广播业务良好的支持。
RTSO具有碰撞概率为0的特点，且由于广播出现的频次少、实时性要求小, 若使用RTSO申请信道接入，则不必考虑CTS确认的问题，RTSO已经保证了在 SSCA碰撞域内成功申请到信道的接入权。
广播业务的发送流程可以修改为图4-3所示流程。
第创贞


第n+1帧


第n+2帧
第n+3帧




图4-3广播业务的发送流程
广播业务数据量较小，且不再占用CTS、ACK CCCH资源，若为小数据量
50 的广播业务申请一个无线帧中全部的上行子帧资源，势必会造成较大的资源浪 费。为此，在广播业务申请后，允许单播业务对其未声明占用的资源进行二次竞 争。由于RTS1处于RTSO之后，RTSO指明其所需占用的子帧数即可。
记一个无线帧中的上行子帧数为N, RTSO、RTS1处理逻辑扩展为：
1)若RTSO中仅申请广播，申请子帧数为n,且满足n<N,则其他DUE可 以通过RTS1竞争剩余N-n个子帧的接入权；
2)若RTSO中仅申请广播，其申请子帧数为N,或RTSO中附带申请单播业 务，由于一个无线帧中仅配置一个CTS发送子帧，需禁用RTSlo
在验证场景中的D2D无线资源管理方案，除SSCA利用固定网络规模进行 优化，增加优先接入机制外，其余均直接使用第三章论述的方案。
在D2D无线资源管理方案确定后，将对RRM模块进行设计与实现，完成 D2D在异构网络中的无线资源管理功能。考虑到DCCCH的物理信道设计直接 关系着后续D2D无线资源管理对等层间消息最大设计长度，在下文对RRM模 块进行设计前，首先确定DCCCH物理信道方案。
4.3 DCCCH物理信道设计
在第三章，以基站辅助控制为前提，设计了由基站分配系统频带用于D CCCH 信道的方案，这需要基站支持D2D通信模式。目前由于演示场景中的TD-LTE 基站并不具备此功能，需要设计替代方案。
在LTE协议中规定在系统频带两侧需要保留保护边带(Guard Band, GB)。 这部分带宽本身不用于传输信号，仅为了提供相邻频带间的隔离性。考虑到DUE 间通信距离近发射功率低，可以使用保护边带的资源进行DCCCH信令传输，使 用频域连续的资源能够保证相位连续，更有利于接收端信道估计与补偿。在本系 统中，将TD-LTE保护边带中保留高频带5个资源块用于部署DCCCH，低频带 5个资源块可以用于测量底噪，如图4-4。
GB	LTE system band	! DCCCH
LTE Allocation frenquency band 	►
图4-4 DCCCH物理信道资源分配
DCCCH子信道类型可以分为：
1)DATACTRL-CCCH：上行D2D公共共享数据信道DPSCH的传输随路控 制信道，在上行DCCCH发送，指示接收端DPSCH所在位置及调制方式等信息。
2)RTS-CCCH、CTS-CCCH、ACK-CCCH：主要用于 SSCA 资源竞争及 HARQ
51
确认反馈，在下行DCCCH发送。
对于下行DCCCH,考虑到较小的子信道时域长度可以缩小资源竞争粒度， 如FDD数据传输可以使用2个子帧的资源竞争粒度。在LTE帧格式中，每个时 隙(0.5ms)配置一个参考信号RS,可以认为时隙是信道调度的功能完备(能够 估计瞬时信道冲击响应)的基本单位，为实现TDD、FDD设计统一，使用时隙 长度作为下行DCCCH时域信道长度。对于上行DCCCH,由于TxDUE已经在 冲突域内独享资源，DPSCH与PUSCH一致，最小调度粒度为1个子帧，所以 DATACTRL-CCCH使用子帧长度。
二者的时频资源图如下。
u' U D D S Uj U D" S 丨 uj uj D； d| S 1 u! U： D

1 OFDM symbol	1 OFDM symbol
图4-5 上行/下行DCCCH时频资源图

物理层下行DCCCH基带信道处理，考虑到控制信道本身载荷并不大，不需 要使用turbo编码，采用卷积编码即可。为保证传输正确性，使用低码率，为1/3 卷积编码与QPSK调制方式，并采用CRC24进行校验。为简化处理流程，不进 行速率匹配，如图4-6o从物理信道资源分配反向递推得到：下行DCCCH有效 载荷数为96bito
上行DCCCH复用与LTE PUSCH相同的基带信号处理技术，物理承载选用 TBSize=120, RBLen=5, MCS0的方案，其信号处理流程与PUSCH 一致，具体 见文献[29] o
52


4.4 RRM模块设计与实现
第三章指出，D2DRRM需要蜂窝网络调度信息感知获取机制、D2D网络内 部信道接入机制、完备的异构网络间干扰控制机制、链路自适应机制及D2D的 资源选择决策机制，以共同完成无线资源管理目标。
为完成以上功能，在实现中将RRM分为网络监控模块、SSCA模块、干扰 控制模块、AMC模块、HARQ模块、资源决策模块。子模块间关系如图4-7。
在TD-LTE D2D硬件验证系统中，调度器使用消息处理和时序双重驱动的形 式。物理层接收数据上报、状态上报使用消息处理，时序主要用来驱动发送调度。 调度器按照调度队列的子帧分配，以一个固定提前量调度对应功能模块。

上图中，红线内为RRM模块及其子模块。紫线为数据流，橙线为认知消息 流，绿虚线为参数流，蓝虚线为定时控制流。
以一次成功的数据传输为例，发送端简化的交互流程如图4-8。此交互流图 仅为了说明一次成功的数据传输各类间的交互信息与顺序，以建立整体的调度逻
53
辑，其余处理分支流程，例如等待超时、RTS0/RTS1共存等，将在各个子模块设 计时进行阐述。但需要指出，在发送端接收CTS后，SSCA需要：1）在调度时 序队列中记录已经应答的数据发送帧号、子帧号，以便在对应时刻触发DPSCH 发送调度；2）在调度时序队列中记录对应ACK反馈接收的帧号、子帧号，以
便在对应时刻使能ACK-CCCH物理层接收。



图4-8发送端简化模块交互流程图
在本次成功的数据传输中，对应的RxDUE简化交互流程如图4.9。其交互 过程与发送端配合，不再赘述。
54


图4-9 接收端简化模块交互流程图 下面对每个子模块进行设计及实现。
4.4.1网络监控模块 4.4.1.1模块功能
网络监控模块负责解析蜂窝系统消息、上行调度控制信息并管理功率测量信 息、蜂窝用户的链路质量信息、D2D用户的链路质量信息，为其他模块的控制 决策及运行提供数据支持。
4.4.1.2模块监控指标及计算
网络监控模块在整个D2D RRM模块中作为网络参数与本机指标的汇聚整 理者，输入输出参数较多，如表4-2、表4-3。之所以强调“本机指标”，是为了 区分针对如本机所测量得到C2D的干扰值IntfLC2D[CUEID],与干扰控制模块 在干扰信息广播中接收到的其他DUE感知到的干扰值IntfJZ2Drx [DUEID][CUEID]o网络监控模块定位为汇聚本机自主感知到的信息，与其他 DUE的信息交流由其他模块完成。在其变量命名中，约定D代表DUE本机， Dtx 代表 TxDUE, Drx 代表 RxDUE, B 代表 BS, C 代表 CUE。
55

表4-2网络监控模块指标及参数获取
名称	　　I/O	说明
SystemlnfbrmationBlockl	Input	PDSCH中系统广播的SIB1,其中包含TDD UL/DL 配置[33】。
SystemInfbnnationBlock2	Input	PDSCH中系统广播的SIB2,其中包含：小区专用 参考信号功率CRS-refbrencePower、PUSCH上行功 控的路损补偿因子a、开环工作点Po_Nominal PUSCH[331o
PDCCH_DCI0_HI _MSG	Input	PDCCHDCI Format。消息在公共搜索域中包含
NDI、MCS、RBStart、RBLen^I。
HI消息包含确认数据子帧号、ACK/NACKo
DATACTRL_MSG	Input	DUE监听D2D随路控制信道DATA CTRL-CCCH,
CRC正确时上报消息，其中包含D2D通信的资源 段占用信息，用于辅助功率测量统计。
SYNC_MSG	Input	D2D-SYNC-CCCH为DUE同步、状态广播信道， 用于D2D组网中的终端发现。消息包含DUE同步 信号参考功率D_ referencePower ,单位为 dBm/REo
PowerMeasure_UL[l 10]	Input	系统总带宽(包括保护边带)中RS符号的每RB 的能量测量值，如20M系统中，共上报110RB的 功率值，单位为dBm/RB。
C_RSRP, D_RSRP	Input	专用参考信号测量功率。异构网中专用参考信号为 LTE小区专用参考信号、D2D-SYNC专用参考信 号，测量功率值分别记为C_RSRP, D_RSRP,由 物理层计算上报，单位为dBm/RE。
HARQ_MSG	Input	其中包含D2D数据接收方Drx_ID,使用TBSize, ACK/NACK指示。以此计算D2D发送链路速率。
TDDConfig	Output	SIB1 中 tdd-Configuration 配置的 TDD UL/DL 帧格 式，此处为0〜6。用于调度时序的选择。
Cell_ResourceMap	Output	保存一个上行子帧中，被调度的蜂窝用户C-RNTI 和由对应资源段起始及长度组成的资源向量 (RBStart, RBLen)»用于蜂窝用户干扰测量、蜂窝通 信质量统计、资源决策。

56

表4-3网络监控模块指标及参数获取（续上表）
名称	I/O	说明
PL_D2B	Output	DUE到基站的路损，单位dB,用于干扰控制模块。 由于DUE无法进行蜂窝网络接入，且考虑到TDD 链路对称性相对较好，近似认为
PLd2b = PLB2D = CRS _ referencePower -C _ RSRP
PL_Dtx2D [DtxID] \	Output	Dtx设备到DUE本机的路损，单位dB。
PL^x 小=D _ referencePower-D_ RSRP 用于SSCA模块CTS时向RTS请求端返回路损。
-IntCC2D[CUEID]	Output	CUEID对DUE本机的干扰值，单位dBm/RB。有 关干扰具体获得方式由下文进行详细描述。输岀用 于干扰控制模块构建干扰广播数据包。
alpha	Output	SIB2 中 UplinkPowerControlCommon 中的上行功控 的路损补偿因子序号alpha,根据映射［0,0.4,感5, 0.6, 0.7, 0.8,0.9,1］转换为0〜1。用于干扰控制模块。
P0_PUSCH	Output	SIB2 中 UplinkPowerControlCommon 中的开环工作 点p0 NominalPUSCHo用于干扰控制模块。
N0_D	Output	本机测量系统频带外低保护边带得到的噪声功率， 单位dBm/RB。用于干扰控制模块。
Q_CUE[CUEID]	Output	CUE链路质量，通过UL DCI中TBSize、RBLen 和NDI/HI计算得到链路质量，单位bit/RB/Sched。 用于干扰控制模块。
Throughput_D2Drx [DrxID]	Output	DUE本机和Drx发送链路速率。通过HARQ信息 得到平均每次调度的速率，单位为bit/sched。用于 SSCA模块。
下面对上表中两个输出参数的计算进行补充说明。
1. Cell_ResourceMap：

蜂窝网络调度资源图由PDCCH DCI FormatO中携带的UL Grant信息及
PHICH信道中的HI指示综合得到。如第一章所述，在LTE网络调度中，使用两
种调度策略一一动态调度和半静态调度。动态调度使用PDCCH至少提前4ms
下发，半静态调度则是在建立数据连接后，使用RRC专用信令的方式进行配置,
由动态转变为半静态。目前DUE可以通过对PDCCH公共搜索域盲检的形式得
到蜂窝网络动态调度的UL Grant但却不具备解析指定UE专用RRC信令的能力。
57 在第三章基于蜂窝网络辅助的无线资源管理策略中，可以让基站在触发半静态调 度时进行一次状态广播，使DUE获取此信息。在目前的条件下，并不支持对蜂 窝网络半静态调度资源图的获取。在D2D硬件平台的组网验证中，不使用半静 态的蜂窝业务(例如VoIP)以避开没有蜂窝网络辅助、不能获取半静态调度这 一问题。待蜂窝网络支持DUE获取半静态配置时，D2D网络监控模块在获取动 态调度资源图的基础上仅需增加配置解析便可支持半静态调度。
通过以上分析,蜂窝网络新数据的调度能够完全通过UL Grant信息获得。 考虑蜂窝网络的HARQ机制，上行HARQ支持自适应与非自适应资源分配。当 上行重传使用自适应资源分配，重传使用的资源由基站DCIFormatO下发，新数 据指示NDI与对应上次传输NDI相同，不翻转；若使用非自适应资源分配，将 直接通过PHICH信道下发HI (NACK)指示，指示CUE以相同的频域资源在 固定时间间隔后重传，不会再次下发UL Grant信息。为了得到完整的蜂窝调度 图，需要DUE通过监听PHICH,将重传调度的资源分配按照与之对应前一次的 分配方案相同的方式，放入对应子帧的蜂窝网络资源调度图中。
UL Grant和HI的提前调度时间为k,在子帧n上发送的UL Grant与HL其 对应的上行发送子帧为n+kP。］。
表4-4 TDD配置0~6的提前调度偏移量k
上下行配置	子帧号
0	　1	2	3	4	　5	　6	7	8	9
0	　4	　6				　4	　6
1		6			4		　6			4
2				4					4
3	　4								4	4
4									4	4
5									4
6	　7	　7				　7	　7			5

若在子帧n时收到NDI或HL对应前一次传输子帧为n-k〔3。］。
表4-5 TDD HI/NDI对应上行传输子帧偏移量k
上下行配置	子帧号
0	　1	2	3	4	　5	　6	7	8	9
0	　7	　4				　7	　4
1		　4			6		　4			6
2				6					6
3	　6								6	6
4									6	6
5									6
6	　6	　4				　7	　4			6
58

2. IntLC2D[CUEID]
对于蜂窝用于对DUE自身干扰的测量，需要综合PowerMeasure_UL[110]、 DATACTRL MSG和Cell ResourceMap得到。以下图4-10为例，通过对应子帧 的Cell_ResourceMap,得到蜂窝资源分配，CUE1的资源向量为(RBStart_CUEl, RBLen_CUEl), CUE2 的资源向量为(RBStart_CUE2, RBLen_CUE2)。通过成功 接收DATACTRL_MSG,表明在DUE冲突域内有其他DUE用户进行D2D通信, 资源向量为(RBStart_D2D, RBLen_D2D)。其关系为
RBStartCUEX < RBStartD2D < RBStartCUEX + RBLenCUEX < RBStartCUE2 (42)
< RBStartCUE2 + RBLenCUE2 < RBStartD2D + RBLenD2D


图4-10上行干扰测量值






在此情况下，DUE无法从混合测量（上图包络）中区分各个用户的独立干 扰，仅能挑选未复用部分进行测量。故在计算蜂窝用户C2D干扰时需要避开D2D 占用资源，在本子帧中不能更新CUE2的C2D干扰，仅能计算CUE1的干扰：



4.4.1.3模块接口
网络监控模块对外接口如下：
// input process function handler
void sibproc_handler(const int& type, const void* sib);
void pdcch_handler(const ulgrant_t* grant, const int& totalcount);
void dccch_handler(const dccchtype_t& type, const void* dccchmsg );
void rsrp_handler(const int& type, const int& rsrp);
void powermeasure_handler(const int* power);
59
// output function
int get_tddconfig();
std::map<cueid, std::pair<rbstart, rblen»& get_resourcemap();
int get_thrputd2d(const int& dueid);
其中，UL Grant结构体和dccch类型枚举定义如下：
表 4-6 ulgrant/dccchtype t 定义
struct ulgrant definition	enum dccchtype t definition
struct ulgrant ( bool NDI; char mcs; char rbstart; char rblength;
)ulgrant t;	enum dccchtype_t (
RTS_MSG = 1,
CTS_MSG,
DATACTRLMSG,
ACK_MSG,
SYNC MSG};

对于其余模块输出参数，包括intJC2D、Q_CUE、PL_Dtx2D、PL_D2B、 NO D, P0_PUSCH均使用update方式在参数监控模块更新时立即更新至干扰控 制模块，update方法由干扰控制模块提供。
4.4.2无线接入管理模块 4.4.2.1模块功能
无线接入管理模块主要负责信道接入需求的判断、RTS0/RTS1/CTS流程的 实现、RTS必要时的退避功能及流程完成后对数据发送/接收定时器的触发配置。
前文已经进行了 SSCA算法流程的设计及优化，实现采用的方案为使用优先 发送RTS0机制、基于D2D链路速率预估的多进程RTS、二进制指数退避的 SSCAo
在模块设计中，需要设计的有SSCA状态机、与其他模块的交互流程、主要 对外接口及对等层间RTS/CTS消息格式。
4A.2.2 SSCA 状态机
首先，设计SSCA状态机的进入与退出。RTS发送触发为时序触发，触发后 进入SSCA发送状态机。RTS接收触发为正确解码的RTS-CCCH消息触发，触
60
发后进入SSCA接收状态机。当RTS/CTS流程成功时，状态转移图以向时序队 列添加关于数据及ACK的发送/接收触发回归Idle状态。
在RTS发送被时序触发后，首先判断是RTSO还是RTS1,并进入相应的RTS- Query状态。若处于RTS1,则需要判断是否退避定时器是否打开、RTS1是否使 能（接收到带有单播的RTSO后会禁用本帧的RTSDo若处于RTS0或RTS1非 退避且使能，则进行后续对发送缓冲区状态及HARQ重传进程状态、链路发送 吞吐的查询，若满足链路速率预估触发条件，才会发送RTS并进入CTS-Wait状 态。状态转移如图4-11、图4-12»
SSCA接收状态机与发送状态机相互配合，状态转移如图4-13o



对应申请子帧数
图4-12 RTS1-CTS发送处理状态机

图4-13 RTS-CTS接收处理状态机
442.3模块接口
其主要对外接口如下:
// timing queue trigger handler
void rts send trigger(const int& type);
void cts_send_trigger();
// message process handler
void rts_msgproc_handler(const void* msg, const int& size, const int& type); void cts_msgproc_handler(const void* msg, const int& size);
第一部分为时序触发调用，触发RTS、CTS发送调度。第二部分为消息触发 调用，用于对RTS、CTS信道上报消息处理。
4.4.2.4 RTS/CTS 消息格式
最后，为了实现收发端的信令交互，针对无线接入模块发送接收端对等层间 消息格式进行设计。
RTS消息需要兼容RTS0与RTS1,同时支持单播与广播子帧的申请。考虑 到RLC使用无确认模式(Unacknowledged Mode, UM),在链路的首次传输或 者链路中断后的再次传输前，都需要对接收侧RLC的序列号(SN)初始化，使 收发两端RLC协同。基于跨层设计，由于传输开始前均需要RTS流程，UM SN 初始化请求由RTS消息承载传输。同时需满足最大消息长度不超过96bitso综上 考虑，RTS消息格式设计如下：
表4-7 RTS消息格式
字段	　　比特位置	含义
TxDUE ID	　Bit[0:3]	RTS发送端DUE-ID,范围0-15 =
RxDUEID	　Bit[4:7]	RTS接收端DUE-ID,范围0~15o
Broadcast Flag	　Bit[8]	广播子帧申请指示，0：未申请，1：申请
Unicast Flag	　Bit[9]	D2D单播子帧申请指示，同上。
Broadcast
Subframe Number	　Bit[10:12]	广播申请子帧数。范围满足
0 < Nbcasl < N霓为使用的TDD上下 行配置中，无线帧的上行子帧总数。
Unicast
Subframe Number	　Bit[13:15]	单播申请子帧数。范围满足
= 0 或 Nunieast = Nl'rame - Nhcas.
SN Initial Request
Flag	　Bit[16]	UM RLC SN初始化请求指示， 0：无需初始化，1：需要初始化。
Reserved	　Bit[17:95]	保留比特用于未来扩充。

当一个无线帧中既有广播子帧预约接入又有单播子帧预约接入，规定广播子 帧占用前子帧，单播子帧占用后Nunicast子帧。
CTS消息仅回应RTS单播申请。在其中需要确认发送端可以使用的子帧数， 值可能与发送端申请的子帧数不同，场景如图4-14。同时，若RTS申请RLC SN 初始化，也需要CTS进行确认才认为初始化成功，否则RTS需继续请求初始化。



图4-14 TxDUE2收不到RTSO需由CTS修正
CTS的消息格式设计如下表4-8：
63
表4-8 CTS消息格式
字段	　　比特位置	含义
TxDUE ID	　Bit[0:3]	RTS发送端DUE-ID,范围0〜15。
RxDUE ID	　Bit[4:7]	RTS接收端DUE-ID,范围0~15o
Pathloss	　Bit[8:14]	反馈测量得到的发送链路路损值，范围 0〜128dB。
SN Initial ACK Flag	　Bit[15]	UM RLC SN初始化确认指示， 0：未初始化，1：已初始化。
Unicast Subframe
Number	　Bit[16:18]	单播申请子帧数。范围满足
Nunicast = ° 或 Ng] = MLe - Nbeast
Reserved	　Bit[19:95]	保留比特用于未来扩充。

4.4.3干扰控制模块
4.4.3.1模块功能
干扰控制模块在D2D无线资源管理中负责蜂窝与D2D异构网络间的干扰控 制，为AMC与资源决策提供发送功率、干扰水平等指标。
在无蜂窝辅助的条件下，第三章所讨论的D2C和C2D干扰控制机制除了集 中重用干扰控制机制不可用之外，其他均可用。在模块设计中，D2C重用干扰 控制使用基于蜂窝通信质量损失门限的分布式闭环控制机制，D2C正交干扰控 制釆用基于学习蜂窝网络PUSCH开环功控配置的开环控制机制，C2D干扰避免 使用测量CUE干扰并主动资源避让的方案。
4.4.3.2模块流程
如前文所述，在C2D干扰避免中，TxDUE在计算SINR时使用RxDUE感 知到的干扰值，所以干扰控制模块还需负责干扰感知数据的交换，即广播本机的 干扰感知数据，接收其他DUE发送的干扰感知数据并存储更新。
为提供以上功能，需设计干扰控制模块与其他模块间的交互流程，并拆分为: D2C闭环干扰控制、本地测量更新、干扰广播发送、干扰广播接收并更新记录、 AMC相关参数更新及返回五个子流程，见图4-15、图4-16o
64

<—求基准发送功率一
_返回正交干扰决定 一的最大发送功率―
<—请求 rxdueid, cueid 参数一 —返回cue对rxdue的干扰一* 一返回本机对cue复用因子— 一返回rxdue处的噪声水平f
图4・16 干扰更新（续）、AMC参数返回
65
4.4.3.2模块接口
通过对交互流程的设计，模块需提供对外接口如下:
// timing queue trigger handler
void intf^send_trigger();
// message process handler
void intf_msgproc_handler(const void* msg, const int& size);
// interface to NetMonitor module
void update_intf^c2d(const int& cueid, const int& intf);
void update_pO(const int& pO);
void updatejpl_d2b(const int& pl_meas);	.
void update_noise(const int& noise_meas);
void update_alpha(const double& alpha);
// interface to SSCA module
void update_pl_d2drx(const int& pl_cts)
// D2C interference tracing
void update_qualitycue(const int& cueid, const int& quality);
void set_underlaylist(int fh, int sfh, std::vector<int>& underlay cuelist);
// interface to AMC
int get_intf^c2d(int dueid, int cueid);
int get_noise_drx(int dueid);
int get_maxpower_d2b();
int get_powerfactor_d2c(int cueid);
在上表中，函数名大致能够反映函数的作用，仅对其中两个函数补充说明。
1)干扰跟踪时，在DUE本机未发送数据的情况下，CUE的通信质量也可 能发生改变，此时DUE本机不应该对此CUE进行闭环干扰控制，所以需要在本 机数据发送时，使用set_underlaylist()记录复用的CUE ID,以此进行干扰跟踪。
2)get_maxpower_d2b()为正交干扰控制函数，返回最大允许发送功率值。 get_power factor_d2c()返回重用干扰闭环控制后的重用功率因子。
4.4.3.3干扰广播消息格式
最后，针对干扰控制模块间的干扰广播消息格式设计。与其他消息不同的是, 干扰广播使用DPSCH,消息打包后放入RLC广播发送缓冲区。由于不使用D2D 公共控制信道，所以没有最大消息长度约束。其格式设计如下：
66

图4-17干扰广播消息格式

其中的测量值采用有符号数传输，范围如下表。定界时充分利用IByte的动 态范围并考虑相对极端的情况，干扰、噪声量化间隔IdB, CUE通信质量量化 间隔为 4bits/RB/schedo
表4-9干扰广播消息数据范围
变量	　　　范围	传输偏移量/压缩率	调整后的范围
Intf CUE	　[-150,50]	　vdf/ + 50	[-100, 100]
Q_CUE	　[0, 754]	　「四八 0.25 -100]	[-100, 89]
Noise	　[-200,50]	　pal+ 7 5	[-125,120]

4.4.4 AMC 模块
4.4.4.1模块功能
AMC模块负责为给定资源段选取合适的MCS。为此，将AMC模块分为开 环和闭环两部分。开环AMC负责根据蜂窝网络调度资源图，调用干扰控制模块 输出接口，得到每个资源子段上干扰控制模块反馈的RxDUE周围的干扰水平、 允许的发送功率，开环AMC由此预估资源段在接收端可能的SINR,并根据此 SINR,按照第三章中给定的SINR与MCS对照表，经过闭环AMC修正后，选 取SINR对应的MCS方案，最后返回给资源决策模块。闭环AMC与HARQ接 口，接收其反馈的D2D链路经HARQ补偿后的传输正误，并根据设定的最小残 留误包率，调整对应D2D链路的MCS因子mcsfactor,利用此因子对SINR与 MCS对照表进行基准微调，以得到满足最小残留误包率的最大吞吐性能。
4.4.4.2 AMC 流程
将支持调度决策的开环与支持修正的闭环结合，便可以完成AMC模块功能。 其开环、闭环AMC流程如图4-18、图4-19。
67

.返回对应指标'
计算发送功率、干扰水平
计算预估SINR
《 	I
根据SINR、待发
数据量选择MCS
1

图4-18 开环AMC流程
AMC	HARQ
JACK-CCCH 接收一
D2D-HI
ACK/NACK
计算对应链路误包率
调整相应DUEID的MCS因子
4				1
图4-19闭环AMC流程

4.4.4.3模块接口及关键数据结构
AMC模块提供的接口如下:
// HI report from HARQ
void amc_closeloop (int dueid, int fh, int sfh, int HI);
// AMC openloop trigger bool amc_openloop(std::map<cueid, std::pair<rbstart, rblen> >& resourcemap,
int rbstart, int rblen, int& mcs, int& txpower);
在 amc_openloop 中，resourcemap、rbstart、rblen 为输入参数，给定需要计 算的资源段；mcs. txpower为输出参数，向资源决策模块反馈此段资源可以使
68
用的发送功率与调制编码方式，完成AMC功能。
其维护的关键数据结构为amcinfo_t,每个DUE的链路质量均由一个amcinfo 结构体记录，定义见表4-10o其中，transresult记录每一次上报的传输情况并以 滑动窗平滑的方式给出残留误包率在一段时间内的平均值，共闭环算法使用。
表4・10 amcinfo定义
struct amcicfb t definition
struct amcinfo_t (
int totaltrans;
int residualerrortrans;
std::queue<std::pair<int sfn, int residualHI> > transresult;
int mcsfactor;
} amcinfo [MAX_DUENUM];
开环AMC中使用有关干扰、路损的数据不在本地存储，需要时向干扰控制 模块请求。
4.4.5资源决策模块
4.4.5.1模块功能
资源决策模块主要负责无线资源的分段，向AMC模块提供指定的候选资源 段，并在AMC模块返回计算结果后，综合比较各候选资源段，给出最后使用的 资源段、功率决策。
在模块实现中，资源分段使用第三章中描述的经优化后的策略，决策准则按 照D2D吞吐量最大，即选用在本次调度候选资源段中支持最大TBSize的资源段 作为决策输出结果。
4.4.52模块流程
资源决策模块的运行流程如下图4-20所示。
69


选择最大TBSize
返回选定资源段位置.
及控制参数rm_inft>
图4-20 资源决策模块的运行流程
4.4.53模块接口
此模块主要的外部、内部接口设计如下。
H data controller trigger
struct rminfb_t generate_rminfo (int dueid, int fh, int sfii);
// inner function std::vectorvrbpair_t> available_rbpair();
int select_bestpair(std::vector<rminfo_t > rminfo_group);
其中涉及的两个结构体定义为
表 4-11 rminfo t/rbpair t 定义
struct rminfb t definition	struct rbpairt definition
struct rminfb_t {
int rbstart;	struct rbpair_t (
int rblen;	　　　int rbstart,
int tbsize;	　　　int rblen;
int qm;	};
int powertx;
int mcsidx;
};

数据传输控制器在调用generate_rminfd()时需指定对端ID,不同的接收端使
70
用的PL和干扰值均不相同。在AMC模块将available_rbpair()给出的所有rbpair 进行运算后，会得到一组rminfo, select_bestpair()方法就是在这一组分配方案中 按照指定决策准则给出最终选用的rminfo序号，并由generate_rminfo()返回对应 序号的资源分配信息。将这两个方法做成子模块后，能够支持今后灵活对资源分 割与资源决策准则进行替换。
4.4.6 HARQ 模块
4.4.6.1模块功能
D2D无线资源管理中的HARQ模块不仅需要支持多进程HARQ技术本身的 错误重传功能，同时需要负责D2D控制信道ACK-CCCH的对等层通信，以完 成对数据传输的确认，并为AMC模块、网络监控模块提供HI指示(ACK/NACK), 使之在此基础上完成对AMC的闭环控制及D2D速率监控。在实现中，将HARQ 模块分为HARQ进程子模块Process Entity和ACK处理子模块ACK Processer» 模块内部及模块间关系如图4-2 lo

数据发送子模块	数据接收子模块
数据传输控制模块



图4-21 HARQ模块组成及交互图
4.4.6.2模块流程
数据发送接收流程图4-8.图4-9中已经包含了 DPSCH新数据发送时在 HARQ空闲process中保存、接收端接收到DPSCH后将CRC结果上报HARQ 的ACK-CCCH控制部分、在ACKSEND时序触发到来时将对应帧中的CRC结 果进行ACK/NACK转换后形成ACK-MSG后发送、发送端HARQ模块对 ACK-MSG的解包。在闭环AMC的流程图4-20中包含HARQ模块将ACK-MSG 解包后，将D2D-HI信息上报给AMC模块的流程。将D2D-HI信息上报给网络
监控模块的流程与上报给AMC模块一致。
4.4.6.3模块接口
针对以上流程，HARQ模块需要提供对外接口如下:
// timing trigger
void ackmsg_send_trigger(int fh, int sfii);
void ackmsg_waitexpired_trigger(int fh, int sfh);
// ack-msg/crc process
void ackmsg_recv_handler(const char* msg, const int* msgsize);
void setcrc(int fh, int sfh, char crcflag);
// HARQ process
int check_retransnum(int dueid);
int check_availableprocess();
bool save_process(int procid, rminfb t rminfb, int rvidx, char* dpsch, int size);
int get_retransprocidx(int dueid)
bool retrans_process(int procid, rminfb_t* rminfb, int* rvidx,
char* dpsch, int*size)
模块接口说明如下：
1)时序触发：时序队列在ACKSEND和ACKWAITEXPIRED时，会分别 调用ACK信息打包发送函数ackmsg_send_trigger()和ACK过期处理函数 ackmsg_ waitexpired_trigger()。
2)ACK消息、CRC处理：在数据接收端，数据传输控制器每收到一次传 输便将其CRC结果通过setcrc()函数写入HARQ模块，等待打包反馈；在接收 端收到ACK-MSG后，调用ackmsg_recv_handler()进行有效性检查及处理。
3)HARQ进程相关：在RTS申请前与数据发送前，都可以通过调用check_ retransnum(dueid)获取对应 dueid 是否有进程等待重传；check_availableprocess() 检査是否有空闲进程用以存储新数据，如果有，返回进程号；在数据发送后，将 数据内容及配置调用save_process()存入指定进程号中；若有重传需求，通过 get_retransprocidx(int dueid)以指定规则(此处是等待重传时间最久的进程优先重 传)获得dueid的重传进程号；retrans_process()将指定进程号的进程中的配置和 数据取出，待重传后再次调用save_process()存入进程。
对于AMC及网络监控模块的D2D-HI传输，由对应接收模块提供方法支持。
上述为一个完整的HARQ模块结构，完成对模块间的交互的设计。下一小 节主要关注对等层ACK-MSG的消息格式设计。
72
4A.6.4 ACK消息格式
在LTE中使用重复编码对HARQ指示（HI）进行编码。但在D2D系统中， ACK-CCCH的概念与LTE HI的概念不同，ACK-CCCH以一独立信道存在，使 用CRC-24校验。当校验通过时，可以认为上报ACK-MSG都是有效数据包。所 以无需考虑对HI进行重复编码。同时，如3.6.2节中的设计，需要考虑类似ACK Bundling技术以实现一个ACK信道对多上行子帧的反馈，这里，采用3.6.2小节 的方案，以6 bits对应TDD FormatO中的上行子帧，默认NACK, CRC正确时 将对应子帧置为ACK。
综上考虑后，ACK消息格式如下：
表4-12 ACK消息格式
字段	　　比特位置	含义
TxUE ID	Bit[0:3]	数据发送端TxUE IDo
RxUE ID	Bit[4:7]	数据接收端RxUE ID,为自己的ID。
RadioFrameNum	Bit[8:17]	此次ACK对应的数据传输帧号，范围为 0〜1023。
ACK/NACK Indicator	Bit[18:23]	以6比特表示ACK/NACK指示，对应 Format 0,最低位代表子帧2的确认指示， 最高位代表子帧9的确认指示，其他 Format,非上行子帧按照NACK填充， 未接收到数据及译码错误均按照NACK 填充。ACK=0, NACK=1 o
保留	Bit[24:104]	保留比特用于未来扩充。

4.5 RRM模块功能验证
在LTE蜂窝网络覆盖下，使用商用LTE终端与自制LTE D2D终端异构组网, 对RRM模块功能及方案有效性进行验证。
LTE蜂窝网络为楼内分布式BBU+RRU系统，配置如表4-13所示：
表 4-13	LTE蜂窝网络配置
Duplex Mode	　　　　TDD
Bandwidth	　　　　20MHz
UL/DLConfig index	　　　　2
POnominalPUSCH	　　　　-75 dBm/RB
C-RS power	　　　　12dBm/RE
Alpha index	　　　　5
NRBPUCCH	　　　　12
MCS enable	　　　　true

设备最大发送功率为：CUE设备最大24dBm, DUE射频前端最大发送功率
73
4dBm。
验证中使用的蜂窝通信业务，根据业务模式的不同可划分为持续低容量型业 务和突发高容量型业务。持续型业务如VoIP、实时视频流，每次传输数据量较 小，资源分配与传输数据量相关；突发高容量业务如文件上传，待发送数据量充 裕，调度时通常分配较多传输资源。
4.5.1接入方案验证
在接入方案验证中，异构网络中无蜂窝用户，D2D业务采用Dummy数据满 发送，即D2D数据发送端数据缓冲区永不为空，保证业务负载饱和。
在实现中，接入方案采用基于优先接入、多进程RTS、初传非退避BEB的 SSCA,并对传统BEB的SSCA过程进行实现以对比验证。验证环境如图4-22。

图4-22 SSCA自主竞争接入方案两对传输验证场景

通过启动不同数量D2D终端的数据传输，得到在不同D2D链路数量时初传 非退避SSCA、传统SSCA与理想满发送状态下的RTS接入效率的对比图4-23。
图中釆用D2D链路数为横坐标。对比图能够反映，优化后的SSCA在实际 测试中与理论计算近似吻合。而使用普通RTS过程，由于其每次申请之间需要 间隔2个无线帧，当仅有一个业务链路时，最大利用率仅为31%,相当于引入了 一'定的初传退避，其性能曲线与标准BEB类似。
74

0.3	—		1				—(-	-丁 — 一 -一	　　1
1
0.2			　　　1				　　1
j
2	　　　3	4
D2D链路数	　5	6	7
图4-23接入性能对比曲线


综上，经过优化设计后的SSCA虽然与理想接入曲线仅存在微弱的性能差 距，相比较于普通RTS过程，在1〜8个D2D链路的情况下整体性能提升2倍以 上。
4.5.2干扰协调验证



图4-24 D2C强干扰验证场景（左）与C2D强干扰验证场景（右）
1. D2C强干扰场景
构造如下D2C干扰协同验证场景：蜂窝商用终端处于网络边缘，DUE通信 对离基站较近。若TxDUE不加控制的复用TxCUE的资源，将严重BS接收TxCUE 性能。由于距离较远，TxCUE对RxDUE的干扰可以忽略不计。网络间主要干扰
75
为D2D通信对蜂窝网络的干扰。
在此场景下，D2D1对异构网络拓扑和干扰认知如图4-25、图4-26所示。 图4-25中，D2D1检测到CellID332蜂窝小区覆盖，并与D2D3建立D2D通信 连接，此刻并无数据传输。CUEID8002. 3520、4102、4517为抽样显示时刻10 UL TTI内被调度的蜂窝用户，此UL子帧中8002正进行上行发送，其资源占用情 况与干扰情况如图4-26所示。由于二者距离较远，干扰情况并不能直观反映认 知的正确性。在C2D强干扰场景图4-31中，认知得到的干扰与CUE8002发送 使用资源一致。综合以上三图，验证了 D2DRRM干扰认知功能准确性。



图4-27 TxDUE复用时RxDUE感知的频谱功率
图4-26、图4-27综合展示了 D2D通信复用蜂窝8002资源前后在频谱 RB11〜RB84的功率，此时C2D的干扰近似与底噪相同，主要干扰为D2C干扰。
在此场景下，分别测试了在最低蜂窝业务保有率a°ss）参数设定为50%与 70%时，D2D非正交复用发送功率与被复用蜂窝链路质量指标的对应变化情况， 结果如图4-28、图4-29 o
600

UL subframe number
图4-28 D2C干扰控制性能（蜂窝保有率50%,损失率50%）



图4.29 D2C干扰控制性能（蜂窝保有率70%,损失率30%）
结果显示D2D复用发送功率波动范围为±2.5必、+3dB,且由于监控裕量 △“,物印=0・05的设定，使CUE通信质量能稳定在最低蜂窝业务保有率之上。图 4-29中D2D发送功率均值不同的两段（0〜400、400〜700）是由蜂窝网络对于D2D 引入的干扰的主动功控补偿引起，D2D的发送功率则跟随这一变化，在保证蜂 窝链路质量的条件下提高了对此CUE资源的复用。验证表明，基于最低蜂窝业 务保有率设定的D2C干扰跟踪机制在复用小区边缘蜂窝用户这种极端情况中， 依然能够保证D2D引入干扰受设定门限控制，其有效性得到验证。
为了验证D2D干扰协同模块对动态配置蜂窝最大允许损失率参数的支持， 在D2D复用小区边缘用户资源通信的过程中，使用监控平台更改允许7〃锵为0.8, 0.4, 0.1,蜂窝链路质量改变如下图。图中，蜂窝链路质量随着允许损失率Tjg的 降低而提高，表明C2D干扰协同模块能良好支持损失率参数的动态配置。

图4-30动态改变Tloss时D2C干扰控制性能
2. C2D强干扰场景
C2D强干扰验证场景中，CUE与RxDUE距离较近，C2D干扰避免体现在 TxDUE有能力避开对CUE资源的复用。其复用结果如下图4-31。

图4-31 C2D干扰避免资源使用图

图中d2d占用（绿色柱状）与蜂窝占用（红色柱状），显示此时D2D并未复 用CUE资源，而是选择与其正交复用，成功避开了 CUE对D2D通信的干扰。
4.5.3 AMC 验证
AMC的模块验证中，主要对AMC闭环调整MCS因子功能进行有效性验证。 通过将一对正在通信的D2D设备从直视场景转移到拐角场景中，改变其信道环 境，观察MCS调整因子的变化。结果见图4-32,其中横坐标为MCS因子调整 的序号。	,
图中，横轴表示MCS因子切换的次数，绿线代表AMC模块对指定接收DUE 调度资源时使用的MCS因子。柱状图表示使用当前MCS因子情况下，传输的 子帧个数。其中，黄色代表传输正确，红色代表传输错误。直视环境信道条件较 好，相比与基准曲线，可以在相同信噪比下使用更高码率的MCS方案；当在拐 角处，MCS因子升高，表明在相同信噪比下只能使用较低码率的MCS方案才能 保证残余BLER小于给定值1%。经200000子帧发送情况统计，在两种信道环 境下的整体残余BLER为0. 853%,满足给定1%的要求。
79
发送子帧、残余错误子帧数与MCS因子调整关系



图4.32 MCS因子与正确、残余错误传输次数间的关系曲线
4.6性能分析及扩展
在上节针对RRM模块功能验证后，本节将对D2D所能提供的业务场景予 以展示叙述，并将分析异构网络整体性能。
如第一章所述，D2D需要提供临近服务与公共安全服务，本文设计的RRM 方案可以很好支持两种场景。
4.6.1蜂窝覆盖下的D2D通信性能
LTE蜂窝网络配置如表4-13,每个无线帧配置2个上行子帧。DUE在检测 到蜂窝下行信号后，全部与蜂窝基站同步。
为了测试验证平台中RRM所能支持的D2D通信最高速率，将DUE分别建 构为FTP服务器与FTP用户端，当蜂窝网络中无上行蜂窝用户，且D2D冲突域 内仅有一对D2D,链路质量较好时，FTP速率稳定在910kBps左右，如下图。
13%	[==	->	]33,306,552	921K/S	EM英国中部时
14%	[==		1 33r487,552	918K./S	et对英国中部时
14%	[==	=>	]33,678,688	920K/S	eta （英国中部时
14%	[==	=>	1 33,861.136	919K/S	etm （英国中部时
14%	【==		1 34,058f064	922K/S	Ea（英国中部时
14%	[==	=>	]34,246,304	92GK/S	etm（英国中部时
14%	[==	=>	]34,438,888	921K/S	　　　英国中部时
14%	〔==		1 34,627,128	918K/S	etM英国中部时
14%	[==	=>	]34.822t608	919K/S	　　　英国中部时
14^
间）	[==
4m		]35,029r672	926K/S	etm （英国中部时

图4-33 TDD Format2蜂窝配置下的D2D通信速率
考虑到蜂窝系统配置单边PUCCH资源为12RB,可用PUSCH资源为76RB,
则上行PUSCH最大可用资源长度为75RB[3。],在验证平台中，物理层仅支持到 Imcs26 ,最大 TBSize 为 45352。上行理论最高速率为45352/8x2x 100/1000= ll33kBps ,按照MTU 1500Bytes需对应64BytesTCP确认包，经RLC模块汇聚 后，反馈与数据传输占比大致为1/7,再考虑SSCA的竞争效率0.94, 1133x7/8 x0.94 = 931翊s。与实际FTP测得的均值900kBps近似一致。表明在无蜂窝用 户的异构网络中，D2D无线资源管理模块能够识别网络中的资源空洞并加以高 效利用，最高速率近似满足理论极限。
之后，将分析异构网络中D2D通信与CUE通信共存情形下所能达到的网络 整体性能。为测试总吞吐性能，两种通信模式均选用高容量业务，D2D选用FTP 业务，蜂窝用户选择网盘上传业务。
对于DUE复用蜂窝用户的类型，存在非蜂窝边缘用户与边缘用户的区别， 非蜂窝边缘用户具有较大的功率裕量，能够通过提高自身发送功率维持稳定的吞 吐；边缘用户由于其自身裕量较少，DUE复用时格外看重干扰控制性能。
首先讨论远场D2D与非蜂窝边缘用户共同组网情形以验证蜂窝引入D2D模 式后频谱利用率的提高，并分析本文设计的RRM方案(Advanced RRM)与盲 复用RRM的性能提升。测试时为保证C2D强干扰时D2D仍有通信速率，通过 限速软件对蜂窝上传业务进行限制，使蜂窝网络负载为50%,改变CUE与RxDUE 间的距离以改变C2D的干扰，设定通信保有率为80%。结果见图4-34。
12000
2000
-110	-105	-100	-95	-90	-85	-80	-75	-70	-65
Interference from CUE to DUE-Rx (dBm/RB)
图4-34 基于干扰控制的RRM方案与盲复用方案吞吐对比
上图中，由于CUE吞吐恒定，在C2D干扰较小时，盲复用与Advanced RRM 方案总体吞吐均超过单一网络最大吞吐量；当C2D增大时，Advanced RRM能


2000



图4-36 不同业务保有率干扰控制性能图（D2C干扰基于图4-35降低15dB）
结果表明，在不同的蜂窝业务保有率配置下，实际蜂窝吞吐率均未低于设定
最低门限（蜂窝最小吞吐需求），实际吞吐率与裕设定最低门限的平均量为5%, 与选取D2D监控裕量一致，保证了异构网络中“D2D通信引入的干扰必须可控” 的关键需求。图4-36相比较于图4-35,在保证C2D干扰与CUE位置（处于蜂 窝网络边缘）不变的情况下，D2C的干扰值降低15dB/RB得到的结果，可以看 到由于D2C干扰最大仅能将蜂窝吞吐率降低到50%,使其前半段总吞吐远高于 单一 D2D/蜂窝网络最大吞吐，通过重用在干扰允许范围内的无线资源，其频谱 效率获得提升。
以上结果综合表明，Advanced RRM达到了对异构网络中D2D通信资源管 理的目的，在保证引入干扰符合设定的前提下，能够自主找寻频谱空洞并加以有 效利用；通过重用相应资源，达到提升网络整体频谱利用率的目的，其有效性与 高效性得到了验证。
4.6.2无蜂窝网络环境自组网D2D通信性能
分布式RRM方案在设计之初便考虑了无蜂窝网络覆盖的情形。在整体方案 中，除了 D2C设计了蜂窝辅助的集中式重用干扰控制机制外,其余机制均在DUE 侧完成。考虑到无蜂窝网络环境中本身也不存在D2C干扰，保证了分布式RRM 在无蜂窝网络环境中也是功能完备的。
无蜂窝时，DUE使用D2D同步子信道建立帧格式，默认使用20MHz系统, 帧格式选用TDD Format 1, 一个无线帧中配置4个上行子帧。D2D通信可以使 用100RB数据传输资源。在如图4-37所示的通信场景中，实测得到FTP最大吞 吐量维持在2MBps左右，同样近似满足理论极限。

图4-37 无蜂窝网络覆盖下的D2D场景（D2D1视角）

83


图4-38无蜂窝网络覆盖下的D2D通信速率
4.6.3 D2D通信服务及扩展
以上测试结果表明D2D物理层与Advanced RRM能够提供较高的吞吐率， 在异构网络中，可以使用D2D技术承载较多高速率的通信服务，例如高码率视 频分享、本地广告推荐、文件传输等等，上文已有展示。
同时，D2D Advanced RRM使用模块化的设计也非常便于扩展，例如:
1）通过物理层支持同步状态机，RRM模块能够无缝地在蜂窝网络覆盖与无 蜂窝网络覆盖环境中切换，同时保证业务中断时间仅为同步时间，对公共安全场 景中的应急通信及灵活的通信方式转变提供有力支持，如下图所示。



图4-39 RRM在蜂窝网络覆盖与非覆盖场景中切换
2）通过引入路由协议，并将其模块化嵌入RRM框架，D2DRRM便可以支 持D2D内部多跳中继功能。
84


64 bytes from 192.168.40.9: icmp_seq=503 ttl=64 time=127 ms
RR:	192.168.40.13
(same route)
192.168.46.9
192.168.40.8
192.168.40.8
192.168.40.9
192.168.40.13
from 192.168.40.9:
from 192.168.40.9:
from 192.168.40.9:
from 192.168.40.9:
fr潮 192.168.40.9:
icmp seq=504 ttl=64 time=195 ms
tirae=180 ms time=218 ms time=193 ms time=146 ms
(same route) (same route) (same route) (same route) (same route)
04 bytes
04 bytes
,4 bytes
04 bytes
64 bytes
]477,308,928
]477,463,864
】477,621,696
]477,799,800
]477,963,424
]478,170,488
1 478,355,832
]478,483,256
1 478,690,326
]478,929,24©
]479,144,992
]479,350,608
756K/S eta（英国中部时 762K/S eta（英国中部时 740K/S eta（英国中部时 724K/S eta（英国中部时 710K/S eta（英国中部时 722K/S eta（英国中部时 729K/S eta（英国中部时 726K/S eta（英国中部时 734K/S eta（英国中部时 770K/S eta（英国中部时 784K/S eta（英国中部时 789K/S Ea（英国中部时
图4-40 RRM对D2D网络内部两跳的扩展
64 bytes fr伽 192.168.40.10: icmp seq=l ttl=62 RR： 192.168.40.11
192.168.4©.8
192.168.40.9
192.168.40.10
192.168.40.10
192.168.40.9
192.168.40.8
192.168.40.11
time=417
ms

图4-41 RRM对D2D网络内部三跳通信的扩展
以上实测结果表明，本文所述RRM方案达到了对异构网络中D2D通信资
源管理的目的，在保证引入干扰符合设定的前提下，能够自主找寻频谱空洞并加
以有效利用，通过重用相应资源，达到提升网络整体频谱利用率的目的，其有效
性与高效性得到验证。同时，通过D2D在基站辅助下与非基站辅助时的业务性
能与RRM扩展的验证，证明了基于本文所述的RRM方案具有高扩展性，在承
载高速本地业务外，也能够支持应急通信、D2D中继应用场景，达到了 D2D引
入蜂窝网络的预期效果。
4.7 本章小结
本章主要针对LTE D2D硬件验证平台中RRM模块进行设计与实现验证。
85








































结合验证场景，在已知最大网络规模时，对SSCA进行优化设计，提出了优先接 入RTSO与竞争接入RTS1共存的SSCA,并在此基础上对D2D数据广播流程进 行了优化。由于验证场景中并不支持基站辅助，设计了处于系统保护频带中的 DCCCH信道帧格式及基带信号处理流程。其后，对RRM模块进行了交互设计 与接口、功能实现。最后，通过与商用LTE异构组网，对D2DRRM接入方案、 干扰控制、AMC方案及异构网络整体性能进行了测试验证，达到预期效果，并 证明其具有较高扩展性。
86
第五章总结与展望
在通信发展进程中，学术界一直致力于寻找增加系统容量与吞吐速率的解决 方案。随着认知无线电技术的提出，其授权频谱的机会动态接入能力为在通信网 络中进行端到端的通信提供可能。同时，蜂窝与公共安全网络融合的需求也提升 了学术界对D2D引入蜂窝网络研究的热情。将D2D引入蜂窝网络，能够分流本 地通信流量，提升网络资源利用率并增强网络灵活性。为了达到D2D与蜂窝网 络的有效融合，本文分析了二者的共存方式，并针对其中D2DRRM方案进行研 究设计，提出了一套完整的D2DRRM方案，在统一框架下支持蜂窝网络覆盖下 及无蜂窝网络覆盖时两种通信环境下的D2D通信。
本文首先详细比较了不同网络资源复用方式、D2D通信控制方式的优劣性, 并重点分析了异构网络中的干扰问题。在对系统稳定性及干扰控制难易性综合考 量后，选定以共享蜂窝网络上行资源并利用较少基站辅助的异构网络组网方案。
其后针对异构网络中D2D无线资源管理方案进行设计，引入了认知无线电 的思路，将异构网络建模为以蜂窝网络通信为授权频谱使用的主用户、D2D通 信为次用户的两个子系统的融合。提出了异构网络中基于少量蜂窝网络辅助、 D2D完全自主竞争、自主感知的分布式D2D无线资源管理方案，并对其中干扰 认知与协调、混合资源利用的具体方案进行探究设计。
接着，结合LTE D2D硬件验证场景，在已知最大网络规模时，对SSCA进 行优化，提出了优先接入RTSO与竞争接入RTS1共存的SSCA,并在此基础上 对D2D数据广播流程进行了优化设计。由于验证场景中不支持基站辅助，设计 了处于系统保护频带中的DCCCH信道帧格式及基带信号处理流程。后续章节则 主要从工程角度对平台中的RRM模块进行分解，描述了各子模块实体的功能及 交互方式，定义了对等层消息格式，并对接口、功能进行具体实现。
最后，通过与商用LTE终端异构组网，测试验证了分布式D2D RRM中各 个子方案及系统整体性能，给出了 D2D在有/无基站覆盖环境中的业务性能与 RRM扩展演示，证明了本文所述的RRM方案能够在LTE网络中发现频谱空洞， 在引入干扰可控的前提下有效承载本地高速业务，同时具有高扩展性，能够支持 应急通信、D2D中继等应用场景，达到了 D2D引入蜂窝网络的预期效果。
总体而言，本课题创新性地设计了一套完整的分布式D2DRRM方案，并结 合自制D2D硬件平台，将D2D技术从理论研究向工程实践的转化进行了实质性 的尝试与推进，对其在实际场景中引入的性能增益与应用扩展给出了有力的验
87
证。
诚然，本文D2D无线资源管理方案还有很多不完善、待继续深入研究补充 之处。如在本文RRM方案设计中，仅考虑了 D2D通信终端均在同一小区内的 场景，对多小区场景欠缺设计。且由于时间所限，RRM方案中并未涉及对D2D 中继路由选择算法的优化设计，仅使用开源路由软件babeld完成了中继功能验 证，在路由决策中并未充分利用D2D链路性能指标，还有较大研究、改进空间。 同时，如何控制D2D冲突域大小以适应不同通信业务量，如何优化蜂窝辅助控 制都是值得今后进一步研究的问题。
88
参考文献
[1]3GPP TSG/WG. 3GPP TS 36.300, Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved、Universal Terrestrial Radio Access Network (E-UTRAN); Overall description; Stage 2, vl2.1.0 [S]. Mar 2014.
[2]Ghosh A, Ratasuk R, Mondal B, et al. LTE-advanced: next-generation wireless broadband technology [J]. Wireless Communications, IEEE, June 2010, voL17, no.3: 10〜22.
[3]Stefenia Sesia, Issam Toufik, Matthew Baker LTE - The UMTS Long Term Evolution: From Theory to Practice [M]. A John Wiley and Sons Ltd Publication, 2009.
[4]Erik Dahlman, Stefan Parkvall, Johan Skold. LTE/LTE-Advanced fbr Mobile Broadband [M]. Elsevier Ltd, 2011.
[5]3GPP TSG-RAN. 3GPP TR 25.924, Opportunity Driven Multiple Access, vl.0.0 [R], Dec 1999.
[6]3GPP TSG/WG 3GPP TR 22.803, Feasibility study for Proximity Services (ProSe), V12.1.0 [R], Mar 2013.
[7]Klaus Doppler, Chia-Hao Yu, Cassio B. Ribeiro, et al. Mode selection fbr Device-to-Device Communication xinderlaying an LTE-Advanced Network [A]. WCNC 2010: Sydney Australia, April 2010.
[8]Klaus Doppler, Mika Rinne, Carl Eijting, et al. Device-to-Device Communication as an Underlay to LTE-Advanced Networks [J]. IEEE Communication Magazine, Dec. 2009.
[9]Janis R? Koivunen V., Ribeiro C.? et al. Interference-Aware Resource Allocation fbr Device-to-Device Radio Underlaying Cellular Networks[A]. VTC Spring 2009: Barcelona Spain, April 2009.
[10]Zulhasnine M, Changcheng Huang, Srinivasan A. Efficient resource allocation fbr device-to-device communication underlaying LTE network [A]. Wireless and Mobile Computing, Networking and Communications (WiMob) 2010, Oct 2010.
[11]Shaoyi Xu3 Haiming Wang, Peng Tao, et al. Effective Interference Cancellation Scheme for Device-to-Device Communication Underlaying Cellular Networks [A]. VTC 2010-Fall: Ottawa, Ontario, Canada, Sep. 2010.
89
[12]Di Zhang, Xuewen Liao, Deng Jianguo, et al. Interference Coordination Mechanism for Device-to-Device Communication in Uplink Period Underlaying Cellular Networks[A]. WCSP 2012: Huangshan, Oct, 2012.
[13]Tao Peng, Qianxi Lu, et al. Interference Avoidance Mechanisms in the Hybrid Cellular and Device-to-Device Systems[A]. PIMRC 2009: Tokyo Japan, Sep. 2009:617-621.
[14]Chia-Hao Yu, Doppler K., Ribeiro C,B・, et at Resource Sharing Optimization for Device-to-Device Commimieation Underlaying Cellular ' Networks [A]. Wireless Communications, IEEE Transactions, vol. 10, no.8. August 2011: 2752-2763.
[15]Wang Zhibo; Tian Hui; Chen Nannan; Huang Yao. Device-to-device resource allocation for QoS support using a graphic theory [A]. Consumer Communications and Networking Conference (CCNC), 2014 IEEE llth5 10-13 Jan. 2014: 525-530,
[16]Jun Huang, Yanxiao Zhao, Sohraby K. Resource allocation for intercell device-to-device communication underlaying cellular network: A game- theoretic approach [A]. Computer Communication and Networks (ICCCN) 2014 23rd International Conference, Aug 2014.
[17]J. Mitola, G Maguire. Cognitive radio: Making software radios more personal [J], IEEE Personal Commun., Aug. 1999, vol. 6: 13-18.
[18]杨晨晨，彭涛等.混合蜂窝与端到端系统PDCCH盲解码研究[J]・电子技术 应用，2014： 107-110.
[19]E H. Fitzek, M. Katz, Q. Zhang. Cellular controlled short-range communication for cooperative P2P networking [A]. Proc Wireless World Research Forum 17, Nov 2006.
[20]刘子扬.基于认知的蜂窝与D2D混合网络研究[D].北京：北京邮电大学， 2013.
[21]P. Janis, YU Chia-Hao, K. Doppler, et al. Device-to-Device Communication Underlaying Cellular Communications Systems [J]. Int. J. Communications, Network and System Sciences, June 2009, vol. 2, no. 3: 169-178.
[22]T. Koskela, S. Hakola, T. Chen, and J. Lehtomaki. Clustering concept using device-to-device communication in cellular system [A]. IEEE Wireless Communications and Networking Conference, 2010.
[23]Yang Shu-Hao, Wang Li-Chun? Huang Jane-Hwa, et al. Network-assisted
90
device-decided channel selection and power control for multi-pair device-to- device (D2D) communications in heterogeneous networks [A]. Wireless Communications and Networking Conference (WCNC) 2014, April 2014: 1356-1361.
[24]P. Kyosti, et al. WINNER II channel models, DI.1.2, vl.2 [R]. 2007.
[25]谢希仁.计算机网络[M].第五版.电子工业出版社,2008.
[26]IEEE 802.11 WG IEEE 802.il. Part 11: Wireless LAN Medium Access Control (MAC) and Physical Layer (PHY) specifications [S]. 1999.
[27]Rivest Ronald L・ Network control by Bayesian broadcast. Information Theory [J]. IEEE Transactions, May 1987? vol.33, no.3: 323-328
[28]方飞，毛玉明.时隙ALOHA二进制指数回退算法[J]・计算机应用， 2013,33(5): 1203-1207.
[29]3GPP TSG/WG 3GPP TS 36.211, Evolved Universal Terrestrial Radio Access (E-UTRA); Physical channels and modulation, V12.1.0 [S]. Mar 2014.
[30]3GPP TSGAVG. 3GPP TS 36.213. Evolved Universal Terrestrial Radio Access (E-UTRA); Physical layer procedures, V12.1.0 [S]. Mar 2014.
[31]3GPP TSG/WG 3GPP TS 36.212. Evolved Universal Terrestrial Radio Access (E-UTRA); Multiplexing and channel coding, v 12.1.0 [S]. Mar 2014.
[32]王顺程，王宏宇，彭涛.蜂窝与D2D异构网络下的D2D通信方案及原型系 统设计[EB/OL].北京：中国科技论文在线，2014-10-23. 孟
[33]3GPP TSG/WG 3GPP TS 36.331. Evolved Universal Terrestrial Radio Access (E-UTRA); Radio Resource Control (RRC); Protocol specification, V12.1.0 [S]. Mar 2014.
91




























































92


时光飞逝，转眼间在北邮的求学生涯已近7年，硕士学位论文的完成，代表 着人生一段旅程的结束与新征程的开始，心中感慨万千。求学期间我得到了许多 老师和同学的关心和帮助，在此，我衷心地向所有关心和支持过我的人表示深深 的敬意与诚挚的感谢!
我首先要感谢我的导师郭文彬老师与实验室负责人王文博老师。两位老师治 学严谨、学识渊博、平易近人，在实验室营造了一个开放和宽松的学术氛围，给 予我的学术指导使我受益匪浅，非常幸运研究生阶段能在WSPN实验室进行学 习和科研工作。
特别要感谢彭涛老师。读研期间，彭涛老师对我的学习和生活给予了悉心的 指导和无私的帮助，并为我的研究提供了良好的软硬件环境和项目支持。彭涛老 师对通信领域深刻的认识和理解，严谨的治学态度，方案制定时的高瞻远瞩、分 析问题时的专注都让我钦佩不已，是我今后工作学习中努力看齐的榜样。感谢彭 涛老师为项目组的付出，在此，衷心地祝愿研究组在他的带领下取得更加优异的 成绩。
同时还要感谢在研究生学习工作中给予我无私指导的钱荣荣老师、林德平老 师，使我能够迅速适应研究生的工作，融入项目研究中去，我所取得的成绩与他 们密不可分。感谢陈昊师兄、王顺程、马崇、朱宏宇、王哲及其他实验室一起开 展项目的同学，很荣幸能和他们在一起共同工作、学习与成长，在互相帮助中构 建了一个温暖的大家庭，祝各位前程似锦。
最后，要特别感谢我的父母和家人对我无私的关怀和坚定的支持。在北邮度 过的七年时光是你们在我身后默默的支持和付出才使我能够坚强的闯过生活和 工作中的一个个困难，你们也是我前进的动力和希望。在未来的人生道路上，希 望我能给你们带来更大的惊喜，为你们构筑更加美好的生活。
93




























































94


攻读硕士学位期间发表的学术论文
[1]Yuan Qi, Rongrong Qian, Hongyu Wang, et al. On the Capacity of Ergodic Channels: A Large Deviation Analysis [A]. Chinacom2014 （El 会议）.
[2]Hai Yu, Yuetan Chen, Hongyu Wang, et al. Coexistence Studies on the Interference Performance between Subway CBTC System and Portable V^-Fi Devices [A]. IEEE IC-NIDC 2014 （El 检索）
[3]王宏宇，王顺程，彭涛.D2D终端基于自主认知的蜂窝与D2D异构网络间干 扰控制[EB/OL].北京：中国科技论文在线 [2014-10-20]. http://www.paper.edu. cn/releasepaper/content/201410-225.
95
