第一章结论
1.1	研究背景与研究意义
网络通信的发展加速了万物互联(Internet of Everything, IoE)时代的到来， 越来越多的智能手机、智能电视等数字化智能设备走进了大众的生活。与此同时, 智能硬件也在交通、医疗等各个行业方面不断地进行融合，为传统行业注入新的 活力和动力。智能硬件主要由两部分组成：硬件终端和云端。硬件终端主要通过 网络的方式与云端进行连接并进行数据的交互通信，构成“云+端”的形式，从而 拥有云计算、大数据等附加功能价值，方便人们的生活。智能硬件在带来便利的 同时也带来了信息安全的问题，由于智能硬件隶属于网络通信的终端，网络通信 中各种各样的安全入侵也逐渐渗透到了智能硬件的领域，以旁路分析为例，通过 分析智能硬件在工作时无意泄漏的电磁发射、功耗、声音等旁路信息便能获取到 智能硬件中重要的秘密信息，从而造成信息安全问题，带来安全隐患，如图1-1 所示。
图1-1万物互联的信息安全
信息安全问题不仅仅关乎个人利益，更决定着医疗、交通、军事和基础设施 建设等国家命脉产业的命运。2020年IBM安全部门曾发布报告称，数据信息泄 露已经为企业带来的损失高达几百万美元之巨，加之受全球新冠病毒的影响，远 程工作加重了数据泄露，所带来的平均损失已超过400万美元囚。在超过5000万 条的大规模数据信息泄露中，平均损失更是高达3.92亿美元。数据信息泄露的 罪魁祸首主要是恶意攻击,系统故障和人为失误，其中恶意攻击的占比高达52%, 依然是过去五年中最主要的威胁。目前，全球各国正在抓紧部署网络安全机制以 抵御恶意攻击所带来的危害，对数据信息的掌控、利用和保护能力已经成为全球
1
各个国家之间的核心竞争力之一。近年来，我们国家也加大了对信息安全的重视 力度，不断推出各种保护措施以防信息泄露。我国相继出台了各种网络安全法律 以及相应的政策，从法律层面上为信息安全提供保护。比如2019年网络等级保 护2.0标准的实施、2017年《网络安全法》、2020年《密码法》、2021年《数据 安全法》等法律的相继出台，以及《个人信息保护法》的起草规划都展现了我们 国家对信息安全的重视。除此之外，各地政府也正在加速网络空间安全的布局， 积极引导网络空间安全与新兴技术的结合。
智能硬件作为网络空间的重要组成部分，对于信息安全防护发挥着不可或缺 的作用。而集成电路又是智能硬件最为关键的部分，集成电路的安全性与否不仅 决定了智能硬件的安全可靠程度，同时也决定了网络通信的信息安全与否。集成 电路设计的高集成度和全球化分布式协作供应链使得硬件安全问题日益突出。然 而当前国内的微电子工艺技术水平还落后于国外，集成电路对国外的依存程度比 较高。从我国工业和信息化部对全国多家企业关键基础材料的调查结果中可以看 出，绝大部分高端芯片和处理器都要从国外进口。虽然在集成电路的设计环节上， 国内的华为海思、龙芯和中芯国际等企业已经能够做到世界先进水平，但是在14 纳米及以下的工艺上，我国的水平还远落后于国外的先进技术，所以当前依然采 用的模式是“外循环为主，内循环为辅”。这势必会给集成电路行业带来信息安 全的问题，比如硬件木马的植入。硬件木马是对现有集成电路进行篡改或添加恶 意模块，能够在集成电路设计开发的任何阶段植入，常常潜伏在硬件电路当中， 仅在特定的小概率事件下被触发从而造成威胁。最近几年来硬件安全攻击呈上升 趋势，表明集成电路已然成为多方攻击的一个有效切入点，是迫切需要研究和解 决的硬件安全问题。
硬件安全防护的一种重要方式是对数据进行加密，因而就需要密码技术参与 其中。密码技术作为网络空间安全的核心，是信息安全与通信保密的基础。在智 能硬件终端与云端进行数据交流和通信的过程中，通过对数据进行加密以保障数 据的安全性。密码技术最初由战争催生而来，由于保密通信的要求从而得以飞速 发展。1949年，Shannon将信息论引入密码学中凡从数学角度对信源、密钥、 加解密算法以及密码分析进行了详细阐述，将密码建立在数学理论之上，为密码 学的开创和发展奠定了坚实的理论基础。1976年，Diffie和Hellman提出了公钥 密码算法的新思想⑶，成为密码历史上的里程碑。该思想首先证明了在信源和信 宿之间通过无密钥传输进行保密通信的可能性，开创了公钥密码学的历史新篇章。 2000 年，美国的国家标准技术局(National Institute of Standards and Technology, NIST)历时三年经过三轮的筛选和讨论，最终确立新的高级加密标准(Advanced Encryption Standard, AES)算法叫次年，美国政府正式公布将AES作为美国联
2
邦信息处理标准，用于行政部门包含敏感信息文档的保护以进行保密通信。
图1-2保密通信系统模型
保密通信的系统模型是在一般通信系统模型的基础之上加入了加密器和解 密器，从而保证信息能够在传输过程中不能被攻击者读取，有效地解决了信息在 传输过程中的安全问题，其系统模型如图1-2所示。在一般通信系统模型当中， 信源发出信号经过编码调制之后，在普通信道中进行传送，经过信宿的译码、解 码之后获得信息。信息的存储、传送和处理在普通信道中都是按照明文的形式进 行，很容易受到攻击者的窃听和截获。因此，为保护信息的安全，在信息传送之 前先用加密器进行加密将输出的密文进行传送，信宿端收到之后经过解密器解密 之后便可以得到明文信息，从而保证明文信息免遭攻击。
随着密码算法和硬件安全技术的融合，对于硬件系统的信息安全问题也逐渐 关注到密码算法的安全性分析上来。密码算法的安全性分析一般都遵循柯克霍夫 准则以
柯克霍夫准则认为一个系统的安全性不是建立在加密体制和加密算法的保 密上,而是应该依赖于密钥，攻击者可以了解除密钥之外的关于系统的所有细节。
依据柯克霍夫准则，对于密码算法的安全性分析的目标就是从密文恢复出明 文或者根据已知条件恢复出密钥。密码分析是建立在已知密码算法的基础上而进 行的。传统的密码分析大致可以分为两种类型：暴力分析和数学分析，二者均把 密码算法视为一个待求解的数学模型。暴力分析主要通过暴力搜索的方式来得到 密钥，而数学分析主要是通过数学方法来获取密钥。暴力分析的方法主要有三个: 密钥穷举分析、查找表分析和空时均衡分析，虽然通用性比较好，但是比较笨拙。 数学分析主要利用数学方法来发现密码算法的漏洞，并减少暴力分析的复杂度, 主要的方法包括差分密码分析回、代数分析［久相关密码分析网以及线性密码分 析也
传统密码分析主要针对密码算法的数学理论方面，偏重于密码算法的设计安 全性。但是密码算法在数学理论上的设计安全性并不能够代表其在物理实现过程
3
中的安全性。任何密码算法的落地终究是要依附于某个物理平台，而密码算法在 运行时会导致密码集成电路的物理特性发生改变，从而产生信息泄露，称之为旁 路泄露。旁路泄露的信息往往同密码算法的内部运算或内部数据之间存在着某种 关联，能够为密码分析提供额外的帮助。通过旁路泄露来进行密码分析的方法叫 做旁路分析【刈。
旁路分析绕过了密码算法本身复杂的分析过程，通过密码算法在软硬件实现 过程中的旁路泄露并结合统计方法快速恢复出密钥。旁路泄露不仅包括通过被动 方式获取到密码算法的执行时间、功耗、声音和电磁发射等信息，也包含通过主 动方式获取到的中间状态或故障输出。旁路分析的基本框架如图1-3所示。
密码算法实现的基本信息
是否含有防护措施
寻找旁您信道的薄弱点
确定旁络分析模型
优化旁路分析方法
旁第灌案采集及顼处理
图1-3旁路分析基本框架
依据旁路分析基本框架，旁路分析的过程可以分成三个步骤。第一步是旁路 分析评估，在旁路分析之前确认目标密码设备有被攻击的可能性，了解密码设备 所使用的密码算法及其实现架构、是否带有防护措施等基本信息。第二步是旁路 泄露采集，根据已掌握的信息找到旁路泄露的薄弱点进行数据采集并对数据进行 预处理操作(如滤波、降噪和对齐等)。第三步是旁路分析，通过对预处理后的 数据依据所确立的泄露模型进行优化分析从而恢复出密钥。
常用旁路分析类型主要有：
(1)计时分析(Timing Analysis )
主要是利用密码算法在不同的明文和密钥条件下加密时间的差异，通过统计 分析的方法来恢复密钥，常用于非对称密码算法［I1
(2)功耗分析(PowerAnalysis)
主要是利用密码算法在不同的明文和密钥条件下所获得的功耗轨迹的不同， 通过相关性分析的方法来进行密钥的恢复，常用于对称密码算法口久
4
(3)声学分析(Acoustic Analysis)
主要是通过捕获密码算法在集成电路设备运行过程中的声音发射信号来获 得敏感信息从而恢复密钥[问。
(4)电磁分析(Electromagnetic Analysis)
主要是利用密码算法在不同的明文和密钥条件下所捕获的电磁发射轨迹的 不同，通过相关性分析的方法来恢复密钥口引。
(5)故障分析(FaultAnalysis)
主要是利用不同的方式主动使加密设备产生错误的输出结果，通过对比正确 结果和错误结果的分析从而恢复密钥口叫
在上述旁路分析方法中，电磁分析相较于其他旁路分析的方法，不仅不需要 对目标密码设备做任何改动，更加具有隐蔽性，而且还能够在较远的距离探测到 电磁信号，更加具有实用性。
制造装配阶段
测试阶段
图1-4集成电路供应链
电磁分析不仅在密码设备秘密信息的获取上发挥了重要的作用，而且在硬件 木马的检测方面也展现了极大的潜力。硬件木马是密码集成电路物理安全的另一 个巨大威胁，它具有形式多样、隐蔽性好、触发概率低和危害后果严重的特点“6-18]o当前全球化的发展趋势使得集成电路产业遭受硬件木马威胁的情况日益显著, 现代芯片的设计极其复杂，仅单个芯片就达到包含数十亿个逻辑门的规模，如此 复杂的片上系统通常包含相当数量的功能模块，任何一个公司想要单独完成整个 制造过程几乎是不现实的。出于经济因素和产品需求的考虑，就必然需要依赖于 多个可靠性无法保证的第三方。随着半导体工艺的发展，越来越多的分布在世界 各地的可信性无法保证的制造商参与到集成电路的设计和制造的供应链过程中。
5
全球化的分布式协作增加了攻击者在供应链的任何一个环节植入恶意电路的风 险，这已经成为当前集成电路领域新的挑战。集成电路供应链的设计、制造、测 试和部署等各阶段如图1-4所示。开发流程首先根据规范设计寄存器传输级中的 组件。除了内部设计之外，第三方供应商还提供不同抽象级别的IP (Intellectual Property)核。不同的设计组件被集成在一起并使用EDA工具经过多个阶段的综 合和验证，最终生成物理布局。第三方代加工工厂进行集成电路的制造，然后在 下一阶段进行测试、封装和部署，并运往市场。
硬件木马是近些年在集成电路领域新兴的一种硬件威胁方式，主要指集成电 路在设计和生产过程中发生的恶意添加或篡改，抑或是设计者无意留下的缺陷设 计。这种恶意添加或篡改可能发生在集成电路开发周期的任何一个环节，其结果 可能会导致集成电路的功能发生异常、拒绝服务、提供隐蔽信道、泄露敏感信息 以及制造硬件后门对集成电路芯片进程远程控制和破坏，也可能会导致芯片性能 下降，加速老化，降低可靠性等一系列问题。集成电路硬件木马的一般结构如图 1-5所示,主要包含触发木马和有效载荷两部分。触发木马部分类似于传感电路， 用于激活硬件木马，当T1、T2、T3…Tn等特定事件出现时便会触发硬件木马； 有效载荷部分则是负责在硬件木马被激活后执行特殊的功能。除此之外，如果硬 件木马一直处于激活状态，则只需具备有效载荷部分即可，但是这种类型的硬件 木马比较容易被检测到，因而其应用相对较少一些。
图1-5集成电路硬件木马一般结构示意图
硬件木马到目前为止，还没有一个统一的分类标准，但是可以按照不同的规 则从不同的角度对其进行分类口93],并且可能随着新的攻击模式的发展而不断更 新。常见的硬件木马大多可以基于6个特征来进行分类，分别是：插入阶段、抽 象级别、触发方式、负载机制、插入位置和物理特性，各个类别和其子类如图1-6所示。依据硬件木马的不同分类，可以从不同的层面上在集成电路中植入硬件 木马。
硬件木马一般是依据系统的工作原理而实现对底层硬件的精心设计，并且半
6
导体技术的发展使得纳米级关键尺寸和高集成度电路的木马检测变得越来越困 难。相较于传统的软件木马，硬件木马的工作机制多样，设计方法灵活；往往都 存有一个恶意的目的，一旦触发，破坏性强，威胁性高。而且硬件木马电路具有 良好的隐蔽性，能够不被标准的集成电路芯片测试和验证过程所发现。
图1-6常见硬件木马分类
通常情况下，大多数硬件木马的尺寸一般比较小，触发概率极低，以此来规 避检测，从而不易被察觉。硬件木马一旦被触发，便可能对整个系统造成严重的 后果。如果硬件木马被应用于医疗、军事或基础设施建设等重要领域的集成电路 内部，一旦其被激活，就可能会对国家和公民的人身安全造成无法想象的后果。
硬件木马是在原有集成电路基础之上进行的改动，任何改动势必会反映在集 成电路的物理特性上，产生一定程度的改变，而其所产生的电磁发射也会有所差 异，因此，通过电磁旁路分析可以作为检测硬件木马的一种有效方式，能够以非 侵入式的方法检测到其存在，正在逐渐成为硬件木马领域中一种强有力的新兴解 决方案。
万物互联使得越来越多的智能电子设备硬件终端彼此相连，任何智能硬件设 备在工作时都会产生电磁发射，其电磁信息安全问题与我们的生活息息相关，所 以对电磁信息安全的研究更具有应用价值。中国科协也在2020年将防范电磁威 胁和集成电路缺陷检测列为十大工程技术难题之中，足以看出电磁安全和集成电 路的重要性。因此，本文依托该两大技术难题，主要针对密码集成电路的电磁信 息安全问题进行探究，重点研究密码集成电路的密钥恢复以及硬件木马的检测两
7
方面内容，旨在为密码集成电路的检测和分析提供技术支持，提高密码集成电路 的安全防护水平。而且随着信息化的提升，国家安全和人民生活也越来越依赖于 电磁信息安全，电磁信息安全已经成为网络空间安全体系中不可或缺的重要部分, 在国家安全战略的各个关键环节当中都发挥着重要的作用。
1.2	国内外研究现状
电磁信息安全可以追溯到1914年至1918年的第一次世界大战期间，当时的 通信设备会通过传导电磁发射泄露机密信息。随后各国纷纷开展了信息技术设备 (Infbmiation Technology Equipment, ITE)的电磁传播发射与安全传输测试的研 究，即TEMPEST研究。TEMPEST往往有多种含义解释，其中被广泛接受的一 种是 Test for ElectroMagnetic Propagation Emission and Secure Transmission。』。 TEMPEST的主要目的是为解决ITE的电磁泄漏所带来的安全隐患，其研究对象 主要是ITE在工作时所泄漏的电磁波。ITE泄漏的电磁波能够在空气中或者耦合 到邻近的导体上进行传播，利用接收设备对泄漏的电磁波进行接收、分析和解码 便能够还原出ITE所处理的敏感信息，通过ITE的电磁泄漏来获得机密信息要 比其他方法更及时、更隐蔽。
1985年，荷兰学者VanEck在《Computer & Security》上介绍了在远处接收 配有阴极射线管(Cathode Ray Tube, CRT)显示器的计算机的电磁辐射原理，仅 用廉价的元器件和一台黑白电视机便复现了计算机显示器的内容口］,从而引发了 人们对于电磁泄漏的关注，我国也在此时开始关注到TEMPEST的研究。
2004年，剑桥大学的博士 Markus G. Kuhn在其博士论文中详细阐述了计算 机CRT显示器和液晶显示器(Liquid Crystal Display, LCD)的电磁泄漏原理和 截获接收方法，成功复现出显示器上所呈现的内容，并介绍了 SOFT-TEMPEST 技术，将窃取到的信息隐藏在显示器的正常显示当中，利用显示器电磁发射比较 强的优势将信息传递出去⑶〕。
2013年，日本学者Sekiguchi等人针对笔记本电脑在理论上评估了电磁辐射 泄漏的最远可接收距离［26］。Sekiguchi等人指出接收机的接收能力以及接收天线 的增益直接决定了最远的可接收距离，并依据接收机所捕获的电场强度评估出最 远的可接收距离。同年，Snowden披露美国的棱镜计划，其中有一项就是美国利 用电磁泄漏发射主动窃取密码传真机上的机密信息，代号为“DROPMIRE”。 DROPMIRE并没有在密码传真机上安装窃听器或者偷拍设备，而是利用传真机 本身的基础电路，在电路设计上刻意增强机密信息的电磁辐射，从而使得传真机 所处理的机密信息能够在远处被截获并恢复出来。
8
2017年，北京邮电大学EMB&EMC实验室已经实现了计算机CRT和LCD 显示器、PS/2键盘近场和远场的还原，并对计算机视频图像建立了电磁泄漏的一 般模型，与此同时也给出了计算机视频电磁泄漏信息安全理论范围的估算方法和 防护措施［27-2叫
展望未来十年的发展，电磁信息安全必将与万物互联进行更密切地交互融合。 电磁信息安全不仅仅存在于ITE间直接通信过程的非密码学范畴，同样也存在于 与密码学相结合的保密通信过程中。1996年，美国科学家PaulKocher发现密码 算法在执行过程中所泄露的计算时间存在着差异，这些计算时间往往与密码算法 的内部数据存在着某种关联，利用彼此的关联可以推断出密钥，并成功地应用到 RSA等公钥密码算法的破解上口L自此之后，密码学旁路分析的大门被打开，针 对密码集成电路的电磁旁路分析也迅速发展成为极具广阔前景的研究方向。
1.2.1	基于密码集成电路的电磁旁路分析研究现状
1943年，美国贝尔实验室将电传终端加密处理的信息利用TEMPEST技术 破解后转换成明文，并通过深入研究发现所有的ITE在信息处理时都存在电磁泄 漏，这些电磁泄漏能够用于信息的恢复还原“°】。
2000年，Quisquater和Samyde首先提出电磁分析的方法〔用，并在此之后由 Peeters等人和Gandolfi等人在智能卡上给出了相关的实验分析结果因3】。电磁 分析主要是通过观察在密码集成电路附近放置的近场电磁探头所捕获的电磁泄 漏信号来研究电磁发射与密码算法运算之间的相关性，分为简单电磁分析 (Simple ElectroMagnetic Analysis , SEMA )和差分电磁分析(Differential ElectroMagnetic Analysis， DEMA )。
2002年，IBM公司的Agrawal等人发现电磁发射中包含多种信号，每种电 磁发射信号都跟底层计算所处理的不同数据相关HR,并定义了一个模型，该模型 能够完全定量地给出从密码集成电路设备中多个(或所有可用)电磁发射旁路信 道泄露信息的边界范围，使用该模型为智能卡等设备提供了电磁泄漏的评估方法。
2008年，Eisenbarth等人利用近场电磁探头对遥控门锁系统的KeeLoq算法 实施了相关电磁旁路分析，仅用少量的电磁发射迹线便恢复出密钥，并成功克隆 了收发器mi。次年，Kasper等人利用“同源抵消”的方法采集非接触智能卡在工 作时所泄漏的电磁波，采用相关电磁分析(CorrelationElectroMagneticAnalysis, CEMA)方法用了大约十五万条波形成功地将非接触智能卡所用的数据加密标准 (Data Encryption Standard, DES)算法的密钥恢复成功网。
2011年，Oswald等人对实际生活中应用广泛的Mifare非接触智能卡进行了
9
非侵入式的旁路分析，将最初的载波信号分别进行正反相放大，然后进行整流叠 加并滤波，获得信噪比较高的电磁信号；然后再对3DES模块进行相关电磁分析, 对密钥的传输模块进行模板分析；最终成功恢复出MifareDESFireMF3ICD40智 能卡中3DES密码算法的所有密钥〔35〕。后来，Korak等人的研究发现该分析的最 远有效距离可达1米〔3%
2015年，Genkin等人在针对笔记本电脑GHz级别的中央处理器上运行的 RSA密码算法进行电磁攻击，经过适当的信号处理和密码分析，通过廉价的设备 在50厘米外实现了对RSA密码算法密钥的破解RI。为了增强隐蔽性，他们将自 制的圆环探头换成收音机天线，用智能手机来存储收音机天线接收到的电磁波， 同样成功破解了 RSA密码算法的密钥。次年，Genkin等人利用调谐环形天线在 厚度为15厘米的钢筋混凝土墙壁相隔的两个房间来对笔记本进行电磁分析，成 功恢复出隔壁房间笔记本电脑中运行的椭圆曲线加密算法(Elliptic Curve Cryptography, ECO的密钥网。同年，他们针对安卓系统和IOS系统的智能手 机成功复现了类似的电磁旁路分析，在间隔数厘米厚的玻璃桌面捕获电磁发射信 号并成功恢复出ECC算法的密钥mi。
2017年，Fox-IT公司利用500MHz的印制电路板天线在30厘米处采集现场 可编程阵列(Field Programmable Gate Array, FPGA)开发板上运行AES加密算 法时的电磁旁路泄漏，通过数字滤波、曲线对齐等信号预处理措施后，将电磁辐 射与加密过程相关联，依据相关电磁分析便可成功恢复出AES-256密码算法的 密钥［4。］。
2018年，Giovanni等人利用敏感信息的电磁泄漏发射能够被调制到载波信 号上经由天线对外发射⑷］,从而可以在比较远的距离接收到电磁信号。相较于常 规的电磁泄漏旁路信道，能够在更远的地方进行分析和攻击。Giovanni等人测试 了多个不同品牌的密码集成电路，在所有的密码集成电路上都运行AES-128密 码算法，其中nRF52832芯片的电磁发射最强，能够在10米处成功恢复出密钥， 在1米处采用相关电磁分析的方法将mbedTLS上的密钥恢复出来。同年，Ryad 等人将深度学习用于电磁旁路分析，解决了多层感知器网络和卷积神经网络类的 超参数选择问题，并开源了一个公共数据集以供全球各地的学者来评估旁路分析 的性能附。
2020年，Wang Ruize等人首次使用远场电磁发射作为旁路信道对AES-128 密码算法进行基于深度学习的电磁旁路分析，在距目标15米处用平均少于400 条电磁发射迹线成功恢复出AES-128算法的密钥【43】。同年，Josef等人首次将不 同设备的近场电磁发射作为旁路信息进行基于深度学习电磁旁路分析，仅用平均 少于20条电磁发射迹线就成功恢复出密钥
10
2021年，法国的两位安全研究人员发现了谷歌硬件安全密钥的安全漏洞，然 后利用电磁旁路分析成功恢复出谷歌硬件安全密钥中ECDSA密码算法的密钥并 揭示了 NXP、飞天等公司的相关系列产品也存在同样的安全漏洞岑】。
我国的密码集成电路电磁旁路分析相较于国外起步较晚，在资金、技术和设 备等方面还有很多不足，同时还要面对国外的技术封锁，但是经过近些年无数科 研工作者的努力也取得了比较丰富的成果。
2009年，军械工程学院针对AES微控制器密码芯片远场电磁发射噪声比较 大，信噪比低的特点，采用改进最小样本量估计的方法在0.5米远的地方成功实 施相关电磁分析，用8000条左右的电磁发射迹线成功恢复出密钥Pa。除此之外， 他们还针对FPGA密码系统实施近场差分电磁分析，利用42000条电磁发射迹 线成功恢复AES密码算法的密钥阳〕。
2012年，上海交通大学针对智能卡芯片安全性做了简单的理论分析和方法 研究，用电磁旁路分析方法成功恢复出DES算法的密钥网。除此之外，他们还 对多种密码算法以及带有防护措施的密码算法进行了不同的旁路分析，并取得了 一定的研究成果［425。］。
2014年，北京邮电大学将机器学习融入到电磁旁路分析当中，运用支持向量 机、回声状态网络等方法来对密码算法的密钥进行建模分类卬-53］。并且将智能算 法引入到电磁旁路分析中，对密钥的搜索进行优化以恢复正确密钥〔54,55］。除此之 外，北京邮电大学还率先提出将深度学习应用到密码算法的电磁旁路分析当中， 针对密钥字节的不同取值进行建模，利用深度学习强大的特征提取能力对其进行 分析，并利用迁移学习实现了进一步的改进【5%
2017年，天津大学探究了电磁脉冲故障注入机理及其实现方式，通过自制的 电磁脉冲故障注入平台，实现了纳秒级的电磁故障注入，利用在密码算法中注入 的故障来实现电磁旁路分析卬〕。
2018年，清华大学结合可重构密码集成电路的局部可重构特性对电磁旁路 分析的防护进行了研究，提出了利用动态可重构的特性为电磁采样制造错误的采 样数据，从而使传统的电磁旁路分析失效Ml。
2019年，电子科技大学利用八分之一波长的拉杆天线在两米处接收微控制 器的电磁发射并进行预处理，然后运用电磁分析进行密钥的恢复，仅用了不到 10000条的电磁发射迹线便将密钥恢复［5式同年，中国科学技术大学对真实的小 型密码设备进行电磁旁路分析，并对以无触发信号、非侵入方式获得的电磁发射 迹线进行深入研究，成功恢复出其完整密钥⑹］。与此同时，中国科学技术大学还 对电磁发射迹线的预处理方法进行了研究，利用卷积神经网络对噪声进行滤除以 提高信噪比⑹
11
2020年，中国科学院对图形处理单元(Graphics Processing Unit, GPU)位 片实现的AES密码算法进行了研究，并用组合和非组合的方式来进行电磁分析 方法的对比［62］。同时，对多信道融合以及旁路分析泄露和检测的研究也取得了卓 著的成果1631。
现有文献的电磁旁路分析方法基本上可以分为非建模分析和建模分析两大 类。非建模分析方法往往是依据密码算法的中间值与电磁发射迹线的对应关系， 利用统计分析的方法恢复密钥；建模分析方法往往是在已有的与目标对象类似的 设备上利用已知信息进行特征提取和训练建模，然后再对目标对象进行特征匹配 来恢复密钥。但是两类分析方法均需要人为引入不同程度的模型假设，而模型假 设的参数估计往往比较困难，从而致使模型并不能很好的符合实际情况，因此对 于零假设或者通用假设的电磁旁路分析方法还亟待研究。而且对于密码集成电路 的电磁旁路分析研究往往是采用“分而治之”的策略，但是在FPGA等硬件并行 实现过程中会存在信息利用不足问题，从而造成密钥恢复效率低的问题，因此对 于电磁旁路分析的研究还有待于进一步加强。
1.2.2	基于密码集成电路的硬件木马检测研究现状
基于旁路分析的硬件木马检测主要通过采集硬件木马电路在运行过程中的 旁路泄露，并提取其中的差异进行比对和检测，从而发现硬件木马的存在，旁路 分析技术具有非侵入式、成本低、检测精度高、简单易操作且无需对原始电路进 行修改等优点，已经逐渐成为一种主流的硬件木马检测方法。
硬件木马的概念最初是由Agrawal等人于2007年提出，在其研究中首次使 用电磁发射、功耗以及时延等旁路泄露信息来进行硬件木马的检测［附。自此以后， 针对不同类型、不同载体的硬件木马的研究便如雨后春笋般涌出，各国研究者纷 纷对硬件木马设计和检测展开研究。
2013年，美国的研究学者在Trust-Hub网站上开源了 140余种涉及AES、 RS232等模块的硬件木马，建立起了基本的硬件木马库，目前已经被全世界各国 的研究者广泛应用和参考【6习。
在硬件木马的电磁旁路分析方面，Josep等人通过近场扫描对密码集成电路 提取电磁指纹，并根据空间电磁场的发射特性对硬件木马的位置进行了定位166】。 Liu Yu等人首次利用超宽带技术对台积电制造的40款0.35微米的密码集成电路 芯片设计了窃取敏感信息的硬件木马16刀。Oliver等人设计了六种不同的基于 FPGA的硬件木马，硬件木马布局在整个FPGA的不同位置。通过近场扫描获取 硬件木马的电磁发射，并分析硬件木马电路与标准黄金电路之间的差异网】。Sinan
12
等人提出了一种近场测量装置和一种新的传感器拓扑结构，用于在FPGA上激发 和测量来自约1mm小光斑的后向散射信号，用于一种基于后向散射旁路信道的 新型硬件木马检测技术169〕。
在硬件木马的检测分类方面，机器学习的融入带来了新的契机。Kento等人 利用多层神经网络来对门级网表的硬件木马进行检测分类【7°】；Takato等人在频域 利用机器学习来进行硬件木马的分类口1】；Amey等人利用支持向量机(Support Vector Machine, SVM)来对在线运行的硬件木马进行检测口〕； Richa等人利用深 度卷积神经网络来进行硬件木马的检测［73】； Sina等人利用分层时间记忆的方法 来进行木马的检测，并且通过自参考的方式从而无需标准黄金电路El。Burcin等 人利用信息论，通过聚类的方法来实现无参考的硬件木马检测的问题0I。
在硬件木马信号的特征选择和数据降维方面，Abdullah等人利用二维主成分 分析来进行特征提取〔76〕，Nima等人利用遗传算法来进行特征选择mi, Liu Yu等 人利用一维主成分分析来进行数据降维［7叫Kento等人依据随机森林来对特征的 重要性排序来进行选择UK
国内硬件木马研究工作的理论和技术大多是追随国外的研究成果并对其进 行复现和优化，鲜有对关键技术的创新研究。天津大学偏重于对逻辑检测和旁路 分析检测优化的研究以及工艺偏差所造成的影响［2。，80⑻］,并在硅后硬件木马检测 技术的基础上，对电磁旁路信道发射进行了理论分析，利用频谱因子构建了硬件 木马的电磁发射指纹，通过自适应神经网络来对硬件木马进行检测［82］；军械工程 学院则多重于设计方面183-85］，在硬件木马的检测上也有一定的基础研究［86］；国防 科技大学对硬件木马温度旁路分析的检测有所研究［8刀；华中科技大学主要是研究 硬件木马的防护［881：电子科技大学偏重于检测硬件木马的存在PIM,90］；工业和信 息化部电子第五研究所主要研究基于频谱分析和智能算法的硬件木马检测技术 ［91.92］；空军工程大学则研究片上环形振荡器与内部温度之间的关系可用作硬件木 马检测193】;信息保障技术重点实验室偏重于密码集成电路旁路信号的特征提取与 识别皿。
综观国内外硬件木马的检测现状，虽然硬件木马的旁路分析检测在近些年蓬 勃发展，但是目前还尚未有一种比较全面的解决方案，检测方法依然尚不完备， 其主要原因在于硬件木马没有固定的形态，可以被设计成各种各样的形式，而且 硬件木马往往被故意设计成难以激活的状态，具有非常好的隐蔽性。加之集成电 路工艺偏差对硬件木马电路和标准黄金电路的物理参数差异以及采集测试过程 中随机噪声的影响，使得硬件木马的检测面临非常大的挑战。因此，硬件木马的 检测往往需要集成电路在流片前和流片后多种检测方式的结合，并随着硬件木马 攻击方式的发展而不断地创新突破。
13
1.3	主要研究内容和创新点
1.3.1	本文课题来源
密码集成电路的电磁旁路分析经过近些年的发展已经有了长足的进步，但是 仍有一些问题尚未完全解决。基于零假设的通用电磁旁路分析模型将是当前甚至 未来很长一段时间电磁旁路分析理论和方法研究的主要问题和基本问题。而当前 已有的密码集成电路电磁旁路分析方法还存在以下问题：
（1）密码集成电路的电磁发射泄漏和密码算法之间的关系还没有一个通用 的模型来解释清楚，大都是依据某种前提假设而进行的旁路分析。
（2）传统电磁旁路分析一般采用“分而治之”的方式，针对密钥单个字节来 进行电磁分析，在硬件并行实现的情况下往往会造成信息利用不足，旁路分析信 噪比低的问题。
（3）在实际的硬件木马检测分析场景当中，一般无法从目标设备获取到大 量的电磁发射迹线。加之密码集成电路硬件木马存在着形式多样、隐蔽性强、触 发概率低的特点以及工艺偏差的影响，使得硬件木马的检测往往比较困难。
本论文选题主要为了解决密码集成电路以上三个问题，本人并在研究过程中 参与了两个国家自然科学基金，分别为“基于多源信息融合的集成电路芯片旁路 分析新方法研究”（基金编号：61571063）、“基于噪声干扰建模和信息挖掘的密 码集成电路深度旁路分析研究”（基金编号：62071057）以及北京市自然科学基 金“基于多物理场效应的密码芯片信息安全研究”（基金编号：3182028）和北京 邮电大学博士生创新基金：“基于智能优化的集成电路电磁旁路分析与信息安全 研究”（基金编号：CX20190226）o
1.3.2	主要研究内容
本文主要是针对上述密码集成电路电磁旁路分析现存问题而展开的研究，主 要分为三个方面：密码集成电路信息泄露的电磁分析建模、基于智能算法优化的 多字节电磁分析、基于迁移学习的电磁旁路硬件木马检测。首先，从信息泄露的 电磁分析模型入手，探究密码算法在集成电路中的工作机制，通过建立密码集成 电路信息泄露的电磁分析模型来解释密码集成电路的电磁旁路泄漏与密码算法 之间的关系，为后续多字节电磁分析和硬件木马的检测提供理论上的支持。接着 引出基于智能算法优化的多字节电磁旁路分析，探究通过多字节的方式来提高信 息利用率，并引入智能算法来对电磁旁路分析进行优化。然而电磁旁路分析不仅 仅可以用来恢复密码算法的密钥，同样还可以用于其他用途，比如检测硬件木马
14
的存在。然后对硬件木马检测的问题进行研究，探索一种新的基于迁移学习的电 磁旁路分析的方式来检测硬件木马存在。
每一方面的具体研究内容如下：
(1)密码集成电路信息泄露的电磁分析建模
针对密码集成电路的电磁旁路泄漏与密码算法之间缺乏一个通用的模型来 解释刻画的问题，尝试探究密码算法在集成电路中的工作机制和密码算法在运行 时有关密钥的电磁发射源机理，研究建立密码集成电路信息泄露的电磁分析模型o
(2)基于智能算法优化的多字节电磁分析
针对传统的电磁旁路分析在硬件并行实现时信息利用不足的问题，探究信息 利用不足的原因，在理论上为电磁分析提高信息利用率提供解决方法。利用新的 方式来解决电磁旁路分析的问题，引入智能算法，比如粒子群优化算法和遗传算 法，将电磁分析的密钥恢复问题转化为密钥寻优问题。
(3)基于迁移学习的电磁旁路硬件木马检测
针对密码集成电路的硬件木马存在着隐蔽性强，触发概率低而无法获得大量 电磁发射迹线的问题，讨论一种新的基于迁移学习的硬件木马检测框架。迁移学 习在放宽训练数据限制的同时又能获得比较好的性能，对迁移学习应用于硬件木 马的检测进行深入研究。
1.3.3	本论文创新点
本论文的主要创新点如下：
(1)探究了密码集成电路的电磁发射原理，并针对发射源的电磁发射和近 场探头的电磁波接收分别进行了建模刻画，构建了一种密码集成电路信息泄露的 电磁分析模型，可用于电磁旁路分析。
该部分研究成果已产出论文 Analysis Of Electromagnetic Information Leakage Based On Cryptographic Integrated Circuits,其对应章节为第三章，对应学术成果 为［J4］。
(2)传统电磁旁路分析采用“分而治之”的思想仅对密码算法密钥的单个字 节进行分析，这对硬件并行实现的密码算法会造成有效信息的浪费，因为密码算 法密钥的每一个字节均包含有用信息，仅利用密钥的一个字节进行分析等同于将 密钥的其他字节视为噪声处理。因此，本文提出一种基于密钥多个字节的电磁旁 路分析方法，充分利用密钥的有效信息，提高信息利用率。
该部分研究成果已产出论文 Multi-Bytes Electromagnetic Analysis: A Novel Method To Get The Key,其对应章节为第四章4.1,对应学术成果为［C6］。
15
（3）通过电磁旁路分析与智能算法结合，利用智能算法迭代寻优的优势， 将电磁旁路分析的密钥恢复问题转换成密钥相关系数的寻优问题，并对智能算法 加以改进使之更适合密钥的寻优求解。
该部分研究成果已产出论文 1： Multibyte Electromagnetic Analysis Based On Particle Swarm Optimization Algorithm,其对应章节为第四章4.2,对应的学术成 果为［J2］；论文 2： A Novel Multi-Objective Electromagnetic Analysis Based On Genetic Algorithm,其对应章节为第四章4.3,对应的学术成果为［J3］。
（4）提出了一种基于迁移学习的硬件木马检测框架，通过迁移学习对硬件 木马电磁泄漏的时频信息进行检测分类。除此之外，对基本的迁移学习进行改进, 融入支持向量机以获得更好的硬件木马检测分类效果。
该部分研究成果已产出论文 1 ： Electromagnetic Side-Channel Hardware Trojan Detection Based On Transfer Learning,其对应章节为第五章，对应的学术成果为 ［J1］； 论文 2 ： The Electromagnetic Leakage Analysis Based On Arithmetic Operation OfFPGA,其对应章节为第五章5.4,对应的学术成果为［C5］；论文3： Hardware Trojan Detection Based On Transfer Learning By Electromagnetic Fingerprint, 其对 应章节为第五章，对应的学术成果为［C刀。
1.4	本文组织结构
本论文一共分为六章，主要的研究内容框架如图L7所示，每一章节的研究 内容如下：
第一章：绪论。本章的主要内容是对密码集成电路电磁旁路分析的研究背景 进行阐述以及电磁旁路分析在密码算法的密钥恢复和硬件木马的检测分析两个 方面的研究现状进行详细介绍，并对本文的研究内容及思路、创新点和研究意义 进行了阐述。
第二章：密码集成电路电磁旁路分析基础。本章主要是为后面的第三、四、 五章节提供相关的理论知识储备，主要介绍了 AES加密算法的原理、电磁旁路 分析的物理基础以及后续涉及到的电磁旁路分析方法等，为后续深入开展电磁旁 路分析的研究奠定了基础。
第三章：密码集成电路信息泄露的电磁分析建模。本章主要对密码集成电路 电磁发射的发射源进行了分析，建立了密码集成电路的电磁发射模型和电磁接收 模型，电磁发射模型和电磁接收模型共同构成了密码集成电路信息泄露的电磁分 析模型。并提出基于多元线性回归的电磁分析模型，利用多元线性回归理论来验 证所提出的密码集成电路信息泄露的电磁分析模型的正确性。
16
基于旁路分析的密码集成电路电磁信息安全研究
密码集成电路电磁旁路分析基础
电磁旁路分析万法
密码集成电路 业磁发射模型分析
分组密码算法基础	电磁旁路分析物理基础
密码集成电路信息泄露的电磁分析建模
基于多元线性回归 的电磁分析模型
密码集成电路 电磁接收模型分析
基于智能算法优化的 多字节电磁分析
多字节电 磁分析理 论基础
基于粒子基于邃传 群优化其算法优化 法多字节的多字节 也域分析电磁分析
电磁旁路 硬件木马 检测分析
基于迁将 学习的电 碳旁路硬 件木马检 测框架
基于迁移学习的电磁 旁路硬件木马检测
基于密码 集成电路 硬件木马 检测基础


图1-7本文的主要研究内容框架图
第四章：基于智能算法优化的多字节电磁分析。本章主要围绕提高密码算法 的信息利用率而展开，首先对通过密钥多字节提高可用信息利用率的理论基础进 行了研究和分析，然后通过实验对其进行了验证，最后通过粒子群优化算法和遗 传算法两种智能算法分别对多字节电磁分析做了进一步的优化。
第五章：基于迁移学习的电磁旁路硬件木马检测。本章提出了一种基于迁移 学习的硬件木马检测框架，主要介绍了利用不同领域的相似性使用迁移学习的方 法来对硬件木马进行检测，并且提出了一种将迁移学习与支持向量机相结合的方 式，进一步改善了硬件木马的检测分类效果。
第六章：总结与展望。本章主要是对本文的主要研究内容和研究成果进行了 较为全面的总结，并对密码集成电路旁路分析未来的研究工作进行了展望。
17
本章参考文献
[1]	Security L 2020年数据泄露成本报告[Z]. 2020
[2]	Shannon C E. Communication Theory of Secrecy Systems [J], Bell System Technical Journal, 1949,28(4): 656-715.
[3]	Diffie W, Hellman M. New directions in cryptography [J]. IEEE Transactions on Infonnation Theory, 1976, 22(6): 644-654.
[4]	NIST. Advanced Encryption Standard (AES):	[S].
http://csrc.nist.gov/publications/fips/fips-197/fipsl97.pdf, 2001:
[5]	Petitcolas F. La cryptographic militaire [Z]. 1883
[6]	Biham E, Shamir A. Differential cryptanalysis of the data encryption standard [M]. Springer Science & Business Media, 2012.
[7]	Courtois N T? Pieprzyk J. Cryptanalysis of block ciphers with overdefined systems of equations [A]. // International conference on the theory and application of cryptology and information security [C]: Springer 2002: 267-287.
[8]	Biham E. New types of cryptanalytic attacks using related keys [J]. Journal of Cryptology, 1994, 7(4): 229-246.
[9]	Matsui M. Linear cryptanalysis method for DES cipher [A]. // Workshop on the Theory and Application of of Cryptographic Techniques [C]: Springer 1993: 386397.
[10]郭世泽、王韬、赵新杰.密码旁路分析原理与方法[M].北京：科学出版社, 2014.
[11]	Kocher P C. Timing attacks on implementations of Diffie-Hellman, RSA, DSS, and other systems [A]. // Annual International Cryptology Conference [C]: Springer 1996: 104-113.
[12]	Kocher P, Jafie J, Jun B. Differential power analysis [A]. // Annual international cryptology conference [C]: Springer 1999: 388-397.
[13]	Genkin D, Shamir A, Tromer E. RSA key extraction via low-bandwidth acoustic cryptanalysis [A]. //Annual Cryptology Conference [C]: Springer 2014: 444-461.
[14]	Quisquater J*J. A new tool for non-intrusive analysis of smart cards based on electro-magnetic emissions. The SEMA and DEMA methods [J]. Eurocrypt 2000 rump session, 2000.
[15]	Biham E? Shamir A. Differential fault analysis of secret key cryptosystems [A]. // Annual international cryptology conference [C]: Springer 1997: 513-525.
18
[16]翟腾，高宏玲，郭青帅.芯片硬件安全风险分析与防控建议[J].工业技术创 新,2020, v.07;No.38(03): 22-27.
[17]	Huang Z, Wang Q, Chen Y et al. A Survey on Machine Learning Against Hardware Trojan Attacks: Recent Advances and Challenges [J], IEEE Access, 2020, 8(99): 10796-10826.
[18]	Xue M, Gu C5 Liu W, et al. Ten years of hardware Trojans: a survey from the attacker's perspective [J]. IET Computers & Digital Techniques, 2020, in press.
[19]	Tehranipoor M, Wang C. Introduction to Hardware Security and Trust [M]. Springer New York, 2012.
[20]苏静.基于分类决策的侧信道硬件木马检测方法研究[D],天津大学,2017.
[21]李靖伟.信息泄露型硬件木马及硬件木马检测方法研究[D].电子科技大学， 2019.
[22]袁诗琪.基于侧信道信号分析的硬件木马检测方法研究[D].合肥工业大学, 2019.
[23]杨文翰.实用化的计算机辐射信息截获技术研究[D].北京邮电大学,2011.
[24]	Van Eck W. Electromagnetic radiation from video display units: An eavesdropping risk? [J]. Computers & Security, 1985,4(4): 269-286.
[25]	Kuhn M G. Electromagnetic eavesdropping risks of flat-panel displays [A]. // International Workshop on Privacy Enhancing Technologies [C]: Springer 2004: 88-107.
[26]	Sekiguchi H, Seto S. Study on Maximum Receivable Distance for Radiated Emission of Information Technology Equipment Causing Information Leakage [J]. IEEE Transactions on Electromagnetic Compatibility, 2013, 55(3): 547-554.
[27]莫凡.计算机伴随电磁发射的视频信息认知及还原技术研究[D],北京邮电 大学，2013.
[28]杜玉雷.数字设备的伴随电磁发射及信息电磁纹研究[J].北京邮电大学， 2014.
[29]张南.计算机电磁信息泄漏与视频信息认知研究[D].北京邮电大学,2019.
[30]	Peeters E, Standaert F-X, Quisquater J J Power and electromagnetic analysis: Improved model, consequences and comparisons [J]. Integration, 2007,40(1): 5260.
[31]	Gandolfi K, Mourtel C, Olivier F. Electromagnetic analysis: Concrete results [A], // International workshop on cryptographic hardware and embedded systems [C]: Springer 2001: 251 -26L
19
[32]	Agrawal D, Archambeault B, Rao J R, et al. The EM side—channel (s) [A]. // International workshop on cryptographic hardware and embedded systems [C]: Springer 2002: 29-45.
[33]	Eisenbarth T, Kasper T? Moradi A, et al. On the power of power analysis in the real world: A complete break of the KeeLoq code hopping scheme [A]. // Annual International Cryptology Conference [C]: Springer 2008: 203-220.
[34]	Kasper T? Oswald D, Paar C. EM side-channel attacks on commercial contactless smartcards using low-cost equipment [A]. // International Workshop on Information Security Applications [C]: Springer 2009: 79-93.
[35]	Oswald D, Paar C. Breaking Mifare DESFire MF3ICD40: Power analysis and templates in the real world [A]. // International Workshop on Cryptographic Hardware and Embedded Systems [C]: Springer 2011: 207-222.
[36]	Korak T, Pios T. Applying remote side-channel analysis attacks on a security-enabled NFC tag [A]. // Cryptographers9 Track at the RSA Conference [C]: Springer 2013: 207-222.
[37]	Genkin D, Pachmanov L, Pipman I, et al. Stealing keys from PCs using a radio: Cheap electromagnetic attacks on windowed exponentiation [A]. // International workshop on cryptographic hardware and embedded systems [C]: Springer 2015: 207-228.
[3 8] Genkin D, Pachmanov L, Pipman I, et al. ECDH key-extraction via low-bandwidth electromagnetic attacks on PCs [A]. // Cryptographers5 Track at the RSA Conference [C]: Springer 2016: 219-235.
[39]	Genkin D, Pachmanov L, Pipman I, et al. ECDSA key extraction from mobile devices via nonintrusive physical side channels [A]. // Proceedings of the 2016 ACM SIGSAC Conference on Computer and Communications Security [C]: 2016:1626-1638.
[40]	Ramsay C, Lohuis J. TEMPEST attacks against AES [J]. Fox-IT, Fremont, CA, USA, Tech Rep, 2017.
[41]	Camurati G, Poeplau S, Muench M, et al. Screaming channels: When electromagnetic side channels meet radio transceivers [A]. // Proceedings of the 2018 ACM SIGSAC Conference on Computer and Communications Security [C]: 2018:163-177.
[42]	Benadjila R, ProuffE, Strullu R, et al. Deep learning for side-channel analysis and introduction to ASCAD database [J]. Journal of Cryptographic Engineering, 2020, 20
10(2): 163-188.
[43]	Wang R, Wang H, Dubrova E. Far field em side-channel attack on AES using deep learning [A], // Proceedings of the 4th ACM Workshop on Attacks and Solutions in Hardware Security [C]: 2020: 35-44.
[44]	Danial J, Das D, Golder A, et al. EM-X-DL: Efficient Cross-Device Deep Learning Side-Channel Attack with Noisy EM Signatures [J], arXiv preprint arXiv:201106139,2020.
[45]	Roche T, Lomne V, Mutschler C, et al. A Side Journey To Titan [A]. // 30th USENIX Security Symposium [C]: 2021: 231-248.
[46]张鹏，邓高明，陈开颜，等.针对AES密码芯片的远场相关性电磁分析攻击 [J].华中科技大学学报:自然科学版,2009, (8).
[4刀陈开颜，余浩，邹程，等.针对FPGA密码芯片的近场差分电磁分析攻击[J]. 计算机工程与应用,2013.
[48]李菁.IC卡芯片旁路攻击分析方法研究[D],上海交通大学,2012.
[49]王伟嘉.新型功耗分析方法研究及密码攻防实践[D],上海交通大学,2018.
[50]许森.典型公钥密码实现的功耗分析与防护技术研究[D].上海交通大学, 2018.
[51]刘聪.基于机器学习的密码芯片电磁攻击技术研究[D],北京邮电大学, 2014.
[52]李静.基于功耗泄露的侧信道分析和评估技术研究[D].北京邮电大学, 2016.
[53]甘罕.基于密码芯片的旁路攻击方法研究[D].北京邮电大学,2020.
[54]	Sun S, Zhang H, Cui X, et al. Multibyte Electromagnetic Analysis Based on Particle Swarm Optimization Algorithm [J]. Applied Sciences, 2021, 11(2): 839.
[55]	Sun S, Zhang H, Dong L, et al. A Novel Multi-Objective Electromagnetic Analysis Based on Genetic Algorithm [J]. Sensors, 2019,19(24): 5542.
[56]	Cui X, Zhang H, Wang L. Research on AES Cryptographic Chip Electromagnetic Attack Based on Deep Transfer Learning [A]. // 2019 IEEE 6th International Symposium on Electromagnetic Compatibility (ISEMC) [C]: IEEE 2019: 1-4.
[57]袁果.电磁脉冲故障注入实现及其机理的研究[D],天津大学,2018.
[58]黎奥.利用动态局部重构特性抵抗电磁攻击关键技术研究[D],清华大学, 2018.
[59]孔凡同.基于空间电磁辐射的旁路攻击[D],电子科技大学,2019.
[60]戴立，董高峰，胡红钢，等.针对真实RFID标签的侧信道攻击[J].密码学
21
报,2019,6(03): 383-394.
[61]陈平.基于卷积神经网络的能量迹预处理方法研究[D].中国科学技术大学, 2020.
[62]	Gao Y, Zhou Y Cheng W. Efficient electro-magnetic analysis of a GPU bitsliced AES implementation [J]. Cybersecurity, 2020, 3(1): 1-17.
[63]杨威.密码芯片侧信道分析与检测技术研究[D].中国科学院大学,2017.
[64]	Agrawal D, Baktir S, Karakoyunlu D, et al. Trojan detection using IC fingerprinting [A]. // 2007 IEEE Symposium on Security and Privacy (SPf07) [C]: IEEE 2007: 296-310.
[65]	Trust-Hub [Z]. https://www.trust-hub.org/
[66]	Balasch J, Gierlichs B, Verbauwhede L Electromagnetic circuit fingerprints for hardware ttojan detection [A], // 2015 IEEE International Symposium on Electromagnetic Compatibility (EMC) [C]: IEEE 2015: 246-251.
[67]	Liu Y, Jin Y、Makris Y. Hardware Trojans in wireless cryptographic ICs: Silicon demonstration & detection method evaluation [A]. // 2013 IEEE/ACM International Conference on Computer-Aided Design (ICCAD) [C]: IEEE 2013: 399-404.
[68]	S6110, Korak T, Muehlberghuber M, et al. EM-based detection ofhardware trojans on FPGAs [A]. // 2014 IEEE International Symposium on Hardware-Oriented Security and Trust (HOST) [C]: IEEE 2014: 84-87.
[69]	Adibelli S, Juyal P, Nguyen L N, et al. Near-Field Backscattering-Based Sensing for Hardware Trojan Detection [J]. IEEE Transactions on Antennas and Propagation, 2020, 68(12): 8082-8090.
[70]	Hasegawa K, Yanagisawa M, Togawa N. Hardware Trojans classification for gatelevel netlists using multi-layer neural networks [A]. // 2017 IEEE 23rd International Symposium on On-Line Testing and Robust System Design (IOLTS) [C]: EEE 2017: 227-232.
[71]	Iwase T, Nozaki Y Yoshikawa M, et al. Detection technique for hardware Trojans using machine learning in frequency domain [A]. // 2015 IEEE 4th Global Conference on Consumer Electronics (GCCE) [C]: IEEE 2015: 185-186.
[72]	Kulkarni A, Pino Y Mohsenin T. SVM-based real-time hardware Trojan detection for many-core platform [A]. // 2016 17th International Symposium on Quality Electronic Design (ISQED) [C]: IEEE 2016: 362-367.
[73]	Sharma R, Rathor V S, Sharma G, et al. A new hardware Trojan detection 22
technique using deep convolutional neural network [J]. Integration, 2021, 79: 111.
[74]	Faezi S, Yasaei R, Barua A, et al. Brain-inspired golden chip free hardware trojan detection [J]. IEEE Transactions on Information Forensics and Security, 2021, 16: 2697-2708.
[75]	Cakir B, Malik S. Hardware Trojan detection for gate-level ICs using signal correlation based clustering [A]. 〃 2015 Design, Automation & Test in Europe Conference & Exhibition (DATE) [C]: IEEE 2015: 471-476.
[76]	Nowroz A N, Hu K? Koushanfar F, et aL Novel techniques for high-sensitivity hardware Trojan detection using thermal and power maps [J]. IEEE Transactions on Computer-Aided Design of Integrated Circuits and Systems, 2014, 33(12): 1792-1805.
[77]	Karimian N, Tehranipoor F, Rahman M T, et al. Genetic algorithm fbr hardware Trojan detection with ring oscillator network (RON) [A], // 2015 IEEE International Symposium on Technologies for Homeland Security (HST) [C]: IEEE 2015: 1-6.
[78]	Liu Y Hardware Trojans in ^^reless Cryptographic ICs [D]. The University of Texas at Dallas., 2017.
[79]	Hasegawa K, Yanagisawa M, Togawa N. Trojan-feature extraction at gate-level netlists and its application to hardware-Trojan detection using random forest classifier [A], // 2017 IEEE International Symposium on Circuits and Systems (ISCAS) [C]: IEEE 2017: 1-4.
[80]赵毅强，冯紫竹，史亚峰，等.一种基于缩短激活时间的硬件木马检测方法 [J].华中科技大学学报(自然科学版),2014, (6): 85-89.
[81]赵毅强，刘阿强，何家骥，等.基于RO硬件木马检测的工艺偏差校正方法 [J].天津大学学报(自然科学与工程技术版),2018, v.51； No.327(06): 95-100.
[82]何家骥.基于高层次安全模型的硬件木马检测关键技术研究[D],天津大学, 2019.
[83]李雄伟，徐徐，张阳，等.基于简单电磁分析的硬件木马设计[J].计算机测 量与控制,2013, (12): 3396-3398.
[84]王晓啥，李雄伟，张阳，等.一种基于故障注入的硬件木马设计[J].军械工 程学院学报,2015, 000(005): 57-61.
[85]孙海涛，刘洁.载波泄漏型硬件木马芯片设计[J].兵工自动化，2012, (04): 69-72.
23
[86]李雄伟，王晓哈，张阳，等.一种基于核最大间距准则的硬件木马检测新方 法[J].电子学报,2017,45(003): 656-661.
[87]赵志勋.硬件木马的非线性功耗检测方法及实现[D].国防科学技术大学, 2015.
[88]石朝阳，邹雪城，明瑞华，等.一种基于密钥的硬件木马预防方法研究[J]. 现代电子技术,2016, 39(020): 1-3.
[89]覃皓.FPGA硬件木马检测的关键技术研究[D],电子科技大学,2019.
[90]冀晋渊.硬件木马检测方法研究[J],电子科技大学,2018.
[91] He C, Hou B, Wang L, et al. A failure physics model for hardware Trojan detection based on frequency spectrum analysis [J]. IEEE, 2015.
[92]刘燕江，何春华，王力纬，等.基于遗传算法的硬件木马检测方法[J].微电 子学与计算机,2016, 33(011): 74-77.
[93]钟晶鑫，王建业，阚保强，等.基于温度特征分析的硬件木马检测方法[J]. 电子与信息学报,2018, 03(v.40): 239-245.
[94]张鹏，王新成，周庆.基于投影寻踪分析的芯片硬件木马检测[J].通信学报, 2013,000(004): 122-126,137.
第二章密码集成电路电磁旁路分析基础
密码集成电路电磁旁路分析主要是一种利用密码设备在加密工作时所泄漏 的电磁信号而进行内部状态分析的方法⑴。密码系统在工作时往往需要进行加解 密操作，从而产生电磁发射信号，这些电磁发射信号一般跟密码设备加解密的操 作或内部状态之间存在有一定的相关性，通过结合密码算法的相关知识可以推断 出密码设备内部状态信息甚至恢复出密码算法的密钥。
密码集成电路设备中常用的加密算法是分组密码算法和公钥密码算法。公钥 密码算法虽然在数学分析上安全性比较高，但是其算法复杂度也相对比较高，加 解密过程比较慢，耗时长。而且在物理实现的过程中，高复杂度的密码算法往往 会占用密码集成电路上更多的资源，更加容易造成旁路信息的泄露，仅通过简单 的操作就可以获知密码集成电路内部的秘密信息。分组密码算法在保证密钥不被 泄露的前提下，其安全性也是可靠的。而且分组密码算法复杂度相对较低，加解 密效率高，运算速度快，不容易通过简单分析就能推知密码集成电路的内部状态。 因此，本文主要集中于分组密码算法的研究。
2.1	分组密码算法基础
分组密码算法是一种对输入的明文/密文分装成特定长度的明文/密文块以 进行加密和解密的算法，其安全性主要依赖于密码算法的密钥，故密钥对外是保 密的，而加解密的算法可以是公开的。分组密码算法具有速度快、方便标准化、 易于实现等优点，因此在通信系统和信息系统的安全领域中应用广泛。
高级加密标准(Advanced Encryption Standard, AES)是目前使用最为广泛 的一种分组密码算法，对AES密码算法的研究具有重要意义。AES密码算法是 一种迭代进行的对称密钥分组算法。在AES密码算法的标准规范中，分组大小 固定为128位(16个字节)，而密钥的大小可以为128位、192位和256位。根 据密钥长度的不同，其所对应的轮数分别为10轮、12轮和14轮。本节以AES-128 为例详细介绍AES算法的加密原理。
AES密码算法主要是基于由16个字节组成的4x4状态矩阵上而展开的迭代 加密运算，每一轮的状态矩阵内容都在不断更新，最终的运算结果被视为密文。 AES算法的加密表达式可以表示为C = E(P,K),将明文P和密钥K输入到加密 函数E中，便能够得到输出密文C。在加密函数E中包含一个轮函数，由字节代 替、行移位、列混淆和轮密钥加四个操作组成。该轮函数会执行10轮，前9轮 的操作是相同的，第10轮中省略了列混淆的操作。
25
AES密码算法的加密流程如图2-1所示。
Round 1-9 -<
RoundKey 1-9
RoundKev 0
MixCohiinns
SubByt^
Roimd 10
ShiftRows
AddRoundKey -RoundKey 10
Ciphertext
图2・1 AES密码算法流程
轮函数由四个操作组成，分别为
（1）字节代替（SubBytes）
字节代替是轮函数中唯一的非线性操作，同时也叫做S盒操作。字节代替主 要通过两个可逆变换复合而来，先对每个字节在有限域GFQ8）求其乘法逆元素, 其中，00被映射为00;然后，再对求得的结果进行如式（2-1）的仿射变换。
1 1 o o o 1 1 1 o o o 1 1 1
=
yol月y2l为力y5ly6l
01234567 rxlylxlx% %%/ ooolllll oolllllo o 4X 1 1 1 1 o o 1 1 1X 1 1 o o o lllloool llloooll
rO-i
1 1
0 0
0
1
(2-1)
+
该代换也可以用一个称之为S盒的查找表分别对状态矩阵的每一个字节进 行一对一的映射替换来实现。
26
（2）行移位（ShiftRows）
行移位是对状态矩阵中的每一行以字节为单位循环左移不同的位移量，其中 第1行不进行移位操作，第2行循环左移1个单位，第3行循环左移2个单位, 第4行循环左移3个单位。
（3）列混淆（MixColumns）
列混淆的主要目的是对状态矩阵每一列中的所有字节实现充分混合，每一列 都与一个固定的变换矩阵进行有限域GFQ8）上的乘法运算，从而得到混淆后的状 态矩阵，如式（2-2）所示。
即
So,j =（2 - Soj） ©（3 - Sij） © s2,j © S3ij
s% = soj ㊉（2 - Sij）㊉（3 - s2j） ® s3 j	_ 3
% = Soj ㊉ S1J ©（2 - s2J）㊉（3 - s3J）
s=j =（3 - Soj） © sltj © s2j ®（2 • s3J）
其中，0W/W3, s和s，分别为状态矩阵翻转前后的值。
（4）轮密钥加（AddRoundKey）
轮密钥加是对128位的轮密钥与128位的中间状态逐位进行异或操作。
AES密码算法在加解密过程中的密钥扩展是由一个初始密钥扩展生成各轮 的轮密钥来代替单个密钥的使用。
每一轮的轮函数执行的操作如图2-2所示，对于AES密码算法更为详细的 介绍请参见文献［2］。
27
也由向巾宓由应言囱山管自应中囱肉
I I I	T i i । I	I
明文
字节代替
行位移
列混淆
轮密钥加
图2-2轮函数加密操作流程
2.2	密码集成电路电磁旁路分析的物理基础
2.2.1	电磁旁路分析的半导体物理基础
集成电路设备大多采用金属-氧化物-半导体场效应管(Metal-Oxide-Semiconductor Field-Effect Transistor,简称 MOS 管)实现。将 P 沟道增强型 MOS 管(PMOS)和N沟道增强型MOS管(NMOS)按照一定的方式组合便构成了 互补金属一氧化物-半导体(Complementary Metal Oxide Semiconductorfield Effect Circuit,简称CMOS电路)。CMOS电路是数字集成电路的基础单元和设计核心， 所以对CMOS电路电磁发射的研究很有必要。
CMOS工艺几乎被应用于所有的数字电路当中，CMOS电路的基本思想是 通过互补结构来安排PMOS管和NMOS管，使PMOS管位于元件输出和Vdd之 间形成上拉网络，而NMOS管则位于元件输出和GAZ)之间形成下拉网络。在静 态时，心与GND间基本上是没有电流通过的，仅有少许的漏电流通过，而漏 电流一般在10』2A的数量级，故此时COMS电路的电磁发射可以忽略⑶。
28
CMOS电路是构成大多数数字电路的基本模块,这些电路彼此互连形成具有 更多功能的模块，如状态机、加法器等。这个过程随着抽象层的提升而持续进行， 直到最后构建出完整的系统，如加密模块。常见的密码集成电路芯片基本上都是 采用CMOS工艺制作而成⑷，密码集成电路的全部运算都是通过逻辑门电路来 实现的，逻辑门的变化表现在物理上就是电流的改变，因为电流的改变从而产生 电磁发射。电流的变化与逻辑门电路状态之间的相关性确立了电磁旁路分析的物 理基础。
CMOS电路，又称为COMS反相器，其基本结构示意图如图2-3所示：
图2-3 CMOS反相器基本结构示意图
CMOS电路的能量消耗分为两部分，一部分是静态消耗，另一部分是动态消 耗⑸。静态消耗是电路在稳定状态下的能量消耗，主要是由漏电流所决定的，因 为在静态下无论匕”处于低电平还是处于高电平，NMOS管和PMOS管不会同时 导通，二者中必有一个处于截止状态，而且截止内阻又非常高，所以流过PMOS 管和NMOS管的静态电流非常小，所引起的静态消耗也非常小，约占整体总消 耗的1%,可忽略不计，因此本文不予考虑；动态消耗主要是开关消耗和短路消 耗，约占整体总消耗的99%。
ftotal = Pdynamic + fstatic Pdynacic = fswitching + ^short
(2 — 4) (2-5)
CMOS电路的动态消耗主要包括两部分：一部分是动态充放电电流，即开关 消耗，大约占85%左右；另一部分是动态短路电流，大约占15%左右⑹。通常情 况下，密码集成电路在处理逻辑1和逻辑0的运算时会引起集成电路内部门电路
29
的不同变化，产生不同的电流，从而引起的电磁发射也不同。电磁旁路分析通过 观察这种差异来判别是逻辑1还是逻辑0。
除了逻辑门上的动态变化，集成电路互连线上的静态电流也与线路上的逻辑 值相关。密码集成电路的电磁发射EM与数据逻辑值的数学模型可描述为E
EM = f (data) + noise	(2 — 6)
其中，/'(data)表示为数据的模型函数，noise表示为与数据不相关的电磁发射值。
密码集成电路一般是由成百上千万个逻辑门组成的，对于其在运行过程中某 一时刻翻转的逻辑门数量通常无法精确统计出其结果，所以/(data)往往是一个 比较复杂的函数。电磁旁路分析的焦点是利用统计方法使得在某一时刻集成电路 的某个局部位置上与data相关的电磁发射值得以积累，而噪声部分则因为统计 被平均，因此EM与data的关联性加强，从而可由EM推算出data值。
2.2.2	电磁分侬论
密码集成电路的电磁发射与集成电路内部流动的电流有关⑻，是一种可以利 用的旁路信息。然而在集成电路的电磁兼容标准IEC61967中，发射电磁辐射和 传导电磁辐射却被认为是噪声并被要求限定于安全的范围之内，以免对集成电路 的其他部分产生干扰咒因此，密码集成电路的电磁发射信号往往是比较微弱的。 一般需要对电磁发射信号进行预处理后再进行电磁分析。本文中所涉及到的预处 理措施主要包括滑动压缩、主成分分析和小波变换等。
电磁发射迹线的采集往往是以高于密码集成电路工作频率几倍甚至几十倍 的采样率来进行捕捉，每个时钟周期内包含着多个电磁发射测量点，使得电磁发 射迹线中存在大量冗余和测量噪声，增加了攻击复杂度。通过预处理，不仅可以 滤除噪声，还能减少冗余，降低计算复杂度。
滑动压缩 通过对电磁发射迹线的滑动压缩操作来减少噪声，对滑动窗口内 的电磁发射测量点进行平均处理，将滑动窗口内的多个测量点压缩成一个点，可 以在有效信息损失较小的情况下减少冗余，同时又能在一定程度上滤除随机噪声 带来的影响，提高电磁发射迹线的信噪比。
主成分分析主成分分析是一种常见的特征降维方法，通过正交变换将高维 的电磁发射测量点映射到低维空间中，在保证低维空间电磁发射测量点信息量最 大(方差最大)的情况下，用较少的数据点保留更多原始电磁发射迹线的特性。 主成分分析首先是对电磁发射测量点进行规范化，然后再进行正交变换，转换成 若干线性无关的新数据点来表示原始电磁发射测量点，转换后的新数据点称之为 主成分。
30
小波变换小波变换是对傅里叶变换的继承和延伸，通过有限长度的基本小 波函数对电磁发射信号进行变换，经过尺度伸缩或平移等运算对电磁发射信号进 行多尺度细化分析，聚焦到电磁发射信号的有用部分从而能够有效的从整个电子 系统的电磁发射信号中提取出密码集成电路的电磁发射信息。
密码集成电路的电磁发射往往与集成电路内部处理的数据有关，所以这些电 磁发射信号一般与密码算法的密钥相关，通过分析这些电磁发射信号便能够推断 出密钥。麦克斯韦方程组是电磁理论的核心，描述了电磁场的变化规律和场源关 系，对于研究密码集成电路的电磁发射具有重要的指导意义叫。麦克斯韦方程组 的微分形式如下：
dD	(2-7)
dB V x £ =--	(2-8)
at
= 0 (2-9)
V •。= p (2-10)
式中H为磁场强度，/为电流密度，。为电通量密度，E为电场强度，b为磁通量密 度。其中式(2-7)称为麦克斯韦第一方程；式(2-8)称为麦克斯韦第二方程; 式(2-9)称为麦克斯韦第三方程；式(2-10)称为麦克斯韦第四方程。
根据麦克斯韦方程组可知，电流和时变电场都能够产生磁场，电荷和时变磁 场又会产生电场，故可总结出集成电路的电磁发射是由控制器、输入/输出、数 据处理或芯片部分的电流流动所引起的⑻。密码集成电路的电磁发射大致分为两 类：直接发射和调制发射。直接发射主要是由于电流的上升沿或下降沿的变化而 直接产生的电磁发射信号。如果电流的变化是由于数据改变而导致的，那么可以 通过检测空间中电磁场的变化而分析出数据。直接电磁发射分析能够对局部电磁 发射进行测量，提高效率并定位出信息泄漏点。调制发射主要是指通过调相、调 频等调制技术将数据电磁信号加载到高频载波信号上，并传送到空间中去。高频 载波信号的来源一般有几种：第一种是来自于密码集成电路内部，如时钟信号以 及时钟信号的高次谐波等；第二种是来自于电路中的布线电感、分布电容等在特 定条件下，对固有频率信号因谐振而产生的振荡信号；第三种是来自于外部的高 频信号作为载波信号。通过调制，信号可以在相对较远的范围内接收。
31
2.3密码集成电路电磁旁路分析方法
2.3.1	简单电磁分析
原始波形
图2-4密码算法运行片段截取
简单电磁分析是一种仅通过一些简单操作便能从少量（甚至一条）电磁发射 迹线中对密码算法的执行过程进行分析并推断出密钥的方法”⑵。通常情况下， 简单电磁分析往往需要攻击者掌握目标设备中加密算法的实现细节以便进行分 析。如果仅有一条电磁发射迹线能够使用，往往还需要结合复杂的统计分析方法 来对信号进行提取分析。在密码算法运行时，集成电路在不同时期拥有不同的状 态，在不同状态下所产生的电磁发射信号也不尽相同，从而可以实现对密码算法 的技术细节进行识别，如图2-4所示。不同时期所执行的操作不同，从而产生电 磁发射迹线的波形也是不一样的，通过电磁发射迹线的变化便能推断出密钥的变 化，粉色方框中的波形代表二进制密钥“0”，绿色方框中的波形代表二进制密钥
a ［，，
L Q
简单电磁分析的操作流程如下：
（1）运行一次加密算法并记录集成电路运行过程中的电磁发射迹线；
（2）依据所采集的电磁发射迹线直接推测加密过程中所使用的部分或全部 比特的密钥信息。
简单电磁分析具有较强的假设，往往要求密码集成电路中的密钥信息必须直 接或间接地对电磁发射迹线有显著的影响。虽然其假设比较强，但是在某些情况 下依然是有效的，而且简单电磁分析所需要的电磁发射迹线条数比较少，对加密
32
设备威胁比较大，此类设备常见于运行公钥密码算法的设备中。例如，在RSA加 密算法的M"modN的平方乘运算就能够通过直接观察电磁发射迹线的差别而进 行区分，当二进制密钥位为1时，会额外进行一次乘法的操作。如此一来，密码 集成电路在处理这些操作时所产生的电磁发射往往具有比较大的差别，每一条指 令的运行都能够在电磁发射迹线上观察到，从而可以重构出密钥。
2.3.2	相关电磁分析
相关电磁分析是最流行的电磁分析方法之一，主要利用密码集成电路电磁发 射对数据的依赖性"叫通过对大量不同数据分组进行加密操作时的电磁发射迹 线来分析固定时刻的电磁发射信号，并将其视为与被处理数据有关的函数，基于 电磁发射迹线恢复密码集成电路中的密钥。相关电磁分析相比于简单电磁分析的 优势在于无需掌握目标设备中加密算法的实现细节便可以获取其密钥信息。除此 之外，即使电磁发射迹线中存在有噪声影响，相关电磁分析也能获取密钥信息。
相关电磁分析通常采用“分而治之”的策略，其一般性步骤如下：
（1）选择所分析密码算法的攻击点，也就是密码运算过程中的某个中间值。 该中间值一般可以通过函数㈤表示，其中。为已经知道的明文或密文，上为 所要恢复密钥的部分位，即子密钥，满足这个条件的中间值方可进行子密钥上的 恢复。
（2）获取密码集成电路的电磁发射迹线。获取密码集成电路运行。次时每 次加密操作的数据d和相对应的电磁发射迹线t,分别记为d=（d1,d2,…,do）和ti =（加，加，…,幻），其中7为电磁发射迹线的长度。所以，采集到的电磁迹线构成 一个2）x7的矩阵T.
T =	^11	112	…	W 121	L22	-	12T tDl	±D2	-	tDT-
（3）计算密码算法的假设中间值。针对每一个假设密钥上值4 =（比左2,…,麻）， 其中K为假设密钥上遍历后的数量，根据给定的d=® d2,...,彰）和密钥假设k =（而…木k）,依据选择函数/（4哥计算出相对应的假设中间值小并构成一个 DxK的矩阵K
vtj = f （4, kj） i = 1,2, j = 1,2, ...,K	（2 - 11）
P的第j列包含了依据密钥假设年计算出的中间值结果。加密过程中使用的 是某个密钥假设上,相关电磁分析就是要找到该值位于中间值矩阵V的那一列，
33
从而确定出正确密钥。
（4）将中间值矩阵0依据旁路信息泄露模型映射为假设电磁发射矩阵 即对每一个假设中间值加依据旁路信息泄露模型映射为一个假设电磁发射值为。
h 12	— h1K'
u _ 九21 入22	— h2K
（5）将假设电磁发射迹线与实际的电磁发射迹线进行统计分析。将每个密 钥假设所对应的假设电磁发射值与每个位置的实际电磁发射迹线进行皮尔逊相 关系数比较，会得到一个K x T的矩阵矩阵K中元素f最大值所对应的假 设密钥便认为是正确密钥。
皮尔逊相关系数的数学表达式为
r..=	2%（%L ♦） .圈,广动 —	盘-12）
（九- 鬲）2 •	（tdj 一 弓）2
其中，后和弓分别表示为列鬲与号的均值。
2.3.3	差分电磁分析
差分电磁分析主要是通过计算密码集成电路处理的大量0和1对应的电磁 发射迹线之间的差值来判断""⑹。差分电磁分析的步骤与相关电磁分析基本一致, 主要的区别在于步骤（5）中比较的方法采用均值差而非皮尔逊相关系数。其基 本思想是通过构建一个二元矩阵H,并假设对于特定位n的中间值所导致的电磁 发射迹线与所有其他值所导致的电磁发射迹线不同，一中的每个元素都是选择函 数/（d”n,k）依据中间值所给出的0或1两种数值。根据中间值选择函数给出的 结果是0还是1,将矩阵T分成两个电磁发射迹线集合。其中一个集合包含T中 所有中间值输出等于1电磁发射迹线集合；另一个集合包含7中所有剩余电磁 发射迹线，然后计算每个集合中的电磁发射迹线的平均值，对两个集合的均值做 差值。如果差值近乎为0,那么说明以此分类的两个集合不相关，密钥猜测是错 误密钥；如果在某个时间点上存在一个明显的差异，则说明以此分类的两个集合 具有相关性，该密钥猜测就是正确密钥。当给定足够数量的电磁发射迹线时，不 论电磁发射迹线中是否包含噪声，即使很小的统计特性也可以被找到，因为差分 电磁分析在平均的处理过程中噪声被有效的抵消了。差分电磁分析的数学表达式 如式（2-13）所示。
34
△叩=
ZD
招"曲Z/-WD
W _4山,n, k) W「1 0 一 n, k))
(2 - 13)
差分电磁分析采用均值差的方法仅考虑了数值的差，而并没有考虑相应的方 差。皮尔逊相关系数同时考虑了数值的方差和差，所以差分电磁分析相较于相关 电磁分析往往需要更多的电磁发射迹线。
2.3.4	电磁旁路信息泄露模型
电磁信息泄露模型主要有汉明重量模型、比特模型、汉明距离模型和零值模 型，在这些模型中，目前应用最为广泛的两种电磁信息泄露模型是汉明重量模型 和汉明距离模型。
(1)汉明距离模型
汉明距离模型是基于逻辑元件的网表，将网表中全部或部分元件的前序和后 继处理数据的输出变换映射为电磁发射值。汉明距离模型的基本思想是在数字电 路中，假设“1-0”跳变和“0-1”跳变所导致的电流变化是相同的，“0-0” 跳变和“1-1”跳变对电流的变化几乎没有影响。通过统计某段时间内数字电路 中“0-1”跳变和“1-0”跳变的个数来映射为该段时间内的电磁发射值，电磁 发射值正比于这段时间内“0”与“1”之间相互跳变的总数。即2.3.2小节一般 性步骤(4)中前后两个中间值叱j和aj的汉明距离映射为电磁发射值。
htj =	㊉ v/y) + b	(2 — 14)
其中，HW(ytj㊉Mj)为七j跳变到说j的汉明距离，㊉为异或操作，a为旁路信号 的比例系数，b为不相关的旁路泄露和噪声。
一般而言，总线和寄存器中基本不会出现大量的毛刺，在已知网表部分连续 数据的情况下，可以使用汉明距离来进行刻画。
(2)汉明重量模型
汉明重量模型与汉明距离模型较为相似，在不知道逻辑元件网表文件的情况 下或者是知道部分网表，但是不知道其前序和后继处理数据的情况下，可以使用 汉明重量模型07〕。在汉明重量模型中，电磁发射值被假设为与中间值中被置位的 比特个数成正比。即232小节中一般性步骤(4)中间值列j的汉明重量被映射 为电磁发射值。
htj =	+ b	(2- 15)
其中，为巧j的汉明重量，a为旁路信号的比例系数，b为不相关的旁路
35
泄露和噪声。
(3)比特模型
比特模型又分为单比特模型和多比特模型口叫单比特模型使用中间值的某个 比特位来进行模型的刻画，常常用中间值的最低位或最高位来刻画电磁发射，其 它比特视为转换噪声。多比特模型是对中间值的每一个比特来进行模型的刻画， 相较于单比特模型具有更好的噪声防御能力。
(4)零值模型
零值模型(Zero-Value Model, ZVM)主要是依据处理数据值0时所引起的 电磁发射要小于处理所有其他数据值时的电磁发射的假设来进行模型的刻画印。 零值模型的数学定义如式(2-16)所示：
% = ZVM(%) = {: f	(2- 16)
2.4本章小结
本章主要是为后续几个章节做铺垫，对将会用到的基础知识做了相关的介绍, 首先对分组密码算法AES进行了详细介绍，AES密码算法贯穿全文，是本论文 的基础。然后，对电磁旁路分析的物理基础进行了阐述，为后续第三章密码集成 电路信息泄露的电磁分析建模和第五章基于迁移学习的电磁旁路硬件木马检测 做铺垫。最后介绍了电磁旁路分析的基本方法，这些方法在第四章基于智能算法 优化的多字节电磁分析中用于分析比较，并发挥了重要作用。
36
本章参考文献
[1]	Quisquater J-J. A new tool fbr non-intrusive analysis of smart cards based on electro-magnetic emissions. The SEMA and DEMA methods [J]. Eurocrypt 2000 rump session, 2000.
[2]	NIST. Announcing the Advanced Encryption Standard (AES) [J]. Fips Pub, 2001, 29(8): 2200-2203.
[3]冯登国，周永彬，刘继业.能量分析攻击[M].北京：科学出版社，2010.
[4]王昌林，张勇，李东生.CMOS集成电路功耗分析及其优化方法[J].舰船电 子工程,2006,26(003): 123-125.
[5] Sung-MoKang, YiisufLeblebici, ChulwooKim, et al. CMOS 数字集成电路:分析 与设计[M].北京：电子工业出版社，2015.
[6]李慧云.密码安全芯片与侧信道技术[M].北京：科学出版社，2014.
[7]陈廷定.密码芯片的侧信道安全性分析和量化评估[D],山东大学,2010.
[8]	Agrawal D, Archambeault B, Rao J R, et al. The EM side—channel (s) [A]. // International workshop on cryptographic hardware and embedded systems [C]: Springer 2002: 29-45.
[9]	Cei I. IEC 61967-2 (2005-09): [S]. https://webstore.iec.ch/publication/6185.
[10]张洪欣，沈远茂，韩宇南.电磁场与电磁波(第2版)[M].北京：清华大学出 版社，2016.
[11]	Martinasek Z5 Zeman Y Trasy K. Simple electromagnetic analysis in cryptography [J]. International Journal of Advances in Teleeommunications, Electrotechnics, Signals and Systems, 2012,1(1): 13-19.
[12]	Bettaieb L, Kokabi H, Poloujadoff M. A simple electromagnetic analysis of magnetic NDE using a double rectangular coil an a Hall effect sensor [J]. Advanced Electromagnetics, 2012, 1(3): 79-84.
[13]	Zhang P, Deng G, Chen K, et al. Electromagnetic correlation analysis attacks on microcontroller implementations of AES in far field [J]. Journal of Huazhong University of ence & Technology, 2009: 31-34.
[14]	Brier E? Clavier Cs Olivier E Correlation power analysis with a leakage model [A]. // International workshop on cryptographic hardware and embedded systems [C]: Springer 2004: 16-29.
[15]	Gandolfi K, Mourtel C, Olivier F. Electromagnetic analysis: Concrete results [A].
37
// International workshop on cryptographic hardware and embedded systems [C]: Springer 2001: 251 -261.
[16]	Ding G L, Guo H, Chen L J, et al. Research on differential electromagnetic analysis for cryptographic systems [J]. Computer Engineering and Design, 2009.
[17]	Messerges T S, Dabbish E A, Sloan R H. Investigations of power analysis attacks on smartcards [Z]. USENIX Workshop on Smartcard Technology. Chicago, Illinois, USA. 1999: 151-161
[18]	Mangard S, Oswald E, Popp T. Power analysis attacks: Revealing the secrets of smart cards [M]. Springer Science & Business Media, 2008.
38
第三章密码集成电路信息泄露的电磁分析建模
随着半导体工艺的发展和进步，以计算机为代表的各类集成电路也得到了越 来越广泛的应用，集成电路信息安全问题也伴随而来。信息安全问题并不是只存 在于互联网领域，在没有物理安全防护隔离的情况下，电磁发射也同样可能会造 成严重的信息泄露。
集成电路的电磁发射是由控制器、输入/输出、数据处理或芯片部分的电流 流动所引起的在理想情况下，集成电路的电流变化是由于电路中逻辑状态发 生改变而引起的。大部分集成电路一般是在时钟信号控制下而进行工作，在每一 个时钟周期都将完成相应的短暂逻辑状态转换，与此同时，数据处理模块中因为 数据变化也会有相应的电流变化。状态转换过程往往是瞬时完成的，在完成之后 到下一个时钟周期到来之前会保持在稳定的状态。在每个时钟周期中，状态转换 和相应的电流变化都是由数据中少数比特位引起，所以只需考虑单个时钟周期中 电流变化即可。这些数据中变化的少数比特位往往被称之为相关比特⑵。相关比 特数据的变化导致相应的电流变化，由麦克斯韦第一方程可知，时变的电流能够 产生相应的磁场，因此集成电路的电磁发射所携带的信息量非常容易引起信息安 全问题0 4]o
发射阶段
芯片
图3・1密码集成电路信息泄露过程
密码集成电路的信息泄露过程如图3-1所示，可以分为电磁发射和电磁接收 两个阶段。在电磁发射阶段，集成电路芯片作为发射体，向空间中发出电磁波。 在接收阶段，近场探头用来探测来自芯片发出的电磁信号，并将其转换成电压, 经过低噪放后送入示波器。需要说明的是，上述信息泄露的过程仅针对于近场测 试，对于远场的信息泄露过程不属于本文的研究内容，因此本文不对远场的信息 泄露进行阐述。
39
密码设备作为集成电路的一种重要应用，其电磁发射与流过芯片的电流有关。 对于执行加密算法的集成电路而言，集成电路的电磁发射信号与集成电路中处理 的数据相关。因此，运行加密算法的集成电路的电磁发射信号中包含着跟密钥相 关的有用信息。但是，目前电磁旁路分析大都是依据某种假设模型而进行分析， 主要目的是将密码算法的密钥恢复，鲜有对密码集成电路工作时电磁泄漏过程的 研究。为此，本章探究了密码集成电路的电磁旁路泄漏过程，分电磁发射和电磁 接收两个阶段进行建模分析。在电磁发射阶段，利用电偶极子对电磁发射源进行 等效，探索其发射出的电磁场，建立了电磁发射模型；然后，依据标准近场探头 的等效电路，建立了探头的电磁接收模型；最后，将电磁发射模型和电磁接收模 型进行结合，共同构成密码集成电路信息泄露的电磁分析模型，并构建了基于多 元线性回归的电磁分析模型，用多元线性回归理论对信息泄露的电磁分析模型进 行验证。
3.1	密码集成电路电磁发射源分析
在上一章节中，我们提到CMOS电路的能量消耗分为两部分，一部分是静 态消耗，另一部分是动态消耗卬71。静态消耗是电路在稳定状态下的能量消耗，主 要是由漏电流所决定的，所引起的静态消耗非常小，约占整体总消耗的1%,可 忽略不计。动态消耗主要是开关消耗和短路消耗，约占整体总消耗的99%。动态 消耗主要包括两部分：一部分是动态充放电电流，大约占85%左右；另一部分是 动态短路电流，大约占15%左右。通常情况下，当输入是高电平逻辑1和低电平 逻辑0的时候会引起CMOS电路的不同变化，产生不同的电流。
当匕〃输入是低电平时，PMOS管导通，NMOS管截止，此时电流流过PMOS 管，负载电容G充电，消耗外部能量，如图3-2所示。
图3-3输入高电平时CMOS等效示意图
图3-2输入低电平时CMOS等效示意图
40
当匕〃输入是高电平时,PMOS管截止,NMOS管导通，电流流过NMOS管， 负载电容Q放电，向外释放能量，如图3-3所示。
设R和R'分别代表CMOS反相器更新前后的输入状态，那么输入数据的变 化与电磁发射信号EM之间的关系如下表所示。
表3-1 CMOS反相器电磁旁路信号与输入之间关系
RtR'	电流i	电磁发射EM
0^0	无	无
0-1	有	有
JO	有	有
1-1	无	无
在集成电路中，从CMOS门级层面来讲，旁路信息泄露的大小是由门电路 的翻转状态决定的。从寄存器层面来讲，寄存器是由多个反相器组成的，旁路信 息泄露的大小取决于反相器翻转的频率。
虽然集成电路芯片工作时的电磁发射是有众多逻辑门的参与，但是我们最关 心的是跟密钥有关的相关比特的逻辑门状态情况。对于一个确定的加密芯片而言, 相关比特为与密钥相关的中间值状态，而中间值状态往往存储在寄存器中。如果 将寄存器简化成类似于CMOS反相器的结构，当寄存器中数据改变时便会有变 化的电流产生，从而产生电磁发射。假设第m个寄存器翻转前后的两个状态分 别为Rm和用小 那么由此而产生的跳变VR便可以通过式(3-1)表示
VR = % ㊉ R'm	(3 - 1)
当我们利用CMOS反相器的开关特性时，寄存器状态的翻转往往在很短的 时间内就能完成，那么定义在单位周期内寄存器翻转所产生的电流i可由式(3-2) 得出
i = am0m(Rm ® 敷)	(3 - 2)
式中/n为电流转换系数，系等效简化处理，0m为扇出系数。
3.2	密码集成电路电磁发射模型分析
3.2.1	电磁发射模型建模
密码集成电路的加密模块是由许多逻辑门组成，所以其工作时所发射出来的 电磁波具有一定的群体特性。由于加密过程中明文不断变化所导致的逻辑门的不
41
断跳变和逻辑工作状态的不断变化，致使集成电路工作时的电流在位置和时间上 都呈现不断地变化，对于电磁场的实时探测来说具有一定的随机性，但是因为集 成电路芯片上配有周期载频，密码算法的加密过程又是在重复进行且密钥是固定 的，所以展现出来的随机性也是有一定规律可循的。如果探测时间足够长或者样 本数量足够多，就能够发现其周期性，从而可用于密钥的恢复。
随着微电子工艺的发展，芯片的制造工艺也进入到了纳米的级别，由此可知 集成电路芯片中的电路尺寸也是极小的。由天线理论可知，电流元作为电磁发射 系统最基础的发射单元，一种简洁有效的方法就是采用电流元来分析密码集成电 路工作时的伴随电磁发射，该方法也同样适用于分析集成电路中的封装结构。电 流元通常可以看成赫兹偶极子，将其视作与实际相关的大电流的一段，所以，任 何一个实际的芯片电路都可以先分解成若干连续的电流丝，再将其细分成偶极子 ⑻。芯片工作时的伴随发射电磁场可以通过这些偶极子贡献的总和来求得，如图 3-4所示。虽然伴随发射的电磁场是由偶极子贡献的总和而得，但是仅有相关比 特的等效偶极子才是我们所关心的，可以用来恢复密钥，其他的等效偶极子均被 视为噪声，即图3-4方框中相关比特的等效偶极子才是我们所要求解的，其他的 偶极子可以视为噪声，不做处理。
IIIIIIIIIII
IIIIIIIIIII
图3-4偶极子等效示意图
电偶极子和磁偶极子作为两种最基本的发射单元，实际工程中的众多发射体 都可以通过基本偶极子进行组合来等效以图3-5给出了赫兹电偶极子的示意 图⑪，它是一段物理长度/远远小于波长入的短导线，上面均匀分布有电流/,偶 极子直径忽略不计。在计算赫兹偶极子产生的电磁发射时，一般要先求出磁矢量
滞后位Z,如式（3-3）所示。
A{x,y, z）
e-ikr
--dl
(3-3)
其中，观测点的坐标为（x,6z）,源点的坐标为（£, y', z，），r表示源点与观 测点之间的距离长度，积分线C沿长度/进行积分。上为自由空间波数k=4= A.
3俑彳，4是自由空间的介电常数，出）是磁导率。
42
图3-5电偶极子示意图
因为偶极子的长度］（】<< 入）很短，所以式（3-3）近似为
A « ez里e-加 4nr
“0〃 (e 47r \
2
-jkr\
(3 — 4)
由上式可知，在笛卡尔坐标系中Ax，A），均为零。
在计算电磁场时使用球面坐标系往往比较方便，因此给出笛卡尔坐标系到球 面坐标系的转换网，如式（3-5）：
Ar A® Ae
sin 0 cos 0
=cos 3 cos。 .-sin 0
sin 6 sin (p cos 6 sin 0 cos 0
cos 6 -一 sin。
0 .
Ax Ay
4
(3-5)
依据式（3-5）可求得在球坐标系中磁矢量滞后位的三个坐标分量为
磁场强度目和磁矢量滞后位4之间存在如下关系
1
H = —VxA	（3-7）
Ho
由式（3-6）可知，磁矢量滞后位在0方向上没有分量，故
43
H = e◎
dAri
(孙)一凉
(3-8)
将磁矢量滞后位4代入计算可得
即
Hr = He = 0
0 1
k2 sin0 ———F Ljkr
1 -(Jkry	e-ikr	(3-9)
1 (jkr)2.	e-jkr	(3 - 10)

电场强度为
1
7-Vx H J3£o
k3Ilcos0 2na)£Q
k3 Hsin 9 j 1 j ] 47r3£0 .kr + (fcr)2 (fcr)3]
e-"T
(3 - 11)
因此
(F _fc37/cos0r 1__________L_]e-a
r 2na)£0 L(fcr)2 (fcr)3J
k3 Hsin 9 r i 1 j i ..
9 4n(i)EQ Ikr (kr)2 (kr)3J
& = 0
(3 - 12)
由电偶极子的电场和磁场公式可以计算出近区场的平均功率(流)密度
1 Sav=-Re[FxH*] = O	(3 - 13)
乙
该结果表明电偶极子的近区场没有电磁功率向外输出，所以近区场也称之为 感应场。
电偶极子与磁偶极子之间具有对偶性，依据电与磁对偶原理，可得磁偶极子 的电磁辐射特性。
= 0
Hr =等 cos。匕 + e-ju < 2nr Ikr (fcr)2J	(3 —14)
ISk2 ,	j 1 1
= ——sin 0 -1 + t- + rr A2 e J r
I 47rr	kr (fcr)2J
44
rEr = Eg = 0
[“警'喀+帚…	GE
其中，S为磁偶极子圆环的面积，极为自由空间的固有阻抗。
通过对比电偶极子和磁偶极子的磁场强度公式可知，电偶极子的磁场强度仅 拥有“0分量而磁偶极子有七、周两个分量。用电偶极子来进行磁场的分析相对 容易一些，所以本章主要以电偶极子为例来进行分析，磁偶极子亦可进行同样的 分析。
根据源点至观测点的距离相对于波长X的大小，可将场区分为远区场(kr » 1)、近区场(行<<1)和介于两者之间的过渡区场。
在信号采集过程中，我们通常采用近场探头贴近加密芯片工作的区域，在此 区域中，「《；1即匕(1,该区域属于近区场。因此，仅对近区场内的性质做探 讨。
在近区场中，
111
kr <<： (kr)2 <<： (fcr)3
且
e-jkr 忆 i
因此，在近区场中主要是尚的高次项起主导作用，其余各项可以忽略，故
ilsinG 4nr2
(3 -16)
在密码算法加密的过程中，集成电路的加密模块是由许多“并发”逻辑门开 关组成的，所以总的开关电流须在时域对所有单一逻辑门的开关电流进行叠加而 来。如果已知集成电路芯片表面上的电流分布，便可以对该电流分布进行积分运 算从而得到芯片电路工作时的电磁发射。换句话讲就是集成电路的电磁发射所产 生的电磁场是由所有这些单一逻辑门的电磁场叠加而来，因而探测到的电磁场具 有群体发射的特点。虽然探测到的电磁场是由群体发射而来，但是我们感兴趣的 是相关比特所在寄存器所产生的电磁发射，对于由其他非相关的逻辑门所产生的 电磁发射我们视之为噪声处理。因为所有的加密过程都服务于同一个固定的密钥, 所以密钥也是具有识别性的，通过电磁发射周期重叠的特性便可以获取到密码算 法的密钥。
对于有电流通过的寄存器可以等效成理想电偶极子，电流近似均匀分布，因 此可以将寄存器等效成极小电偶极子。故密码集成电路相关比特所在的寄存器所 产生的磁场W为
45
n	n
”工5 2喏 …) m=l	m=l
现代微电子工艺的发展使芯片的制作工艺进入到了纳米级的水平，芯片的大 小也朝着越来越小的规模发展。相关比特所在的寄存器大小往往在纳米或者微米 的级别，而观测点的距离往往在毫米以上的数量级，加和垢的变化非常微小，可 忽略不计，即5l = r, % = 故可以建立密码集成电路的电磁发射模型为
n	n	n
▽ V1 ilsinO ▽ IsinO ,	,、	，	、
H=	2五=2中小%伊"^%)	(3-18)
m=l	m=l	m=i
3.2.2偶极子等效理论基础
偶极子等效的基础可以用多极展开理论来进行解释，电磁波是由交变运动的 电荷系统而辐射出来的3⑹。当给定交变电流的分布时，计算电磁辐射的基础是 磁矢量滞后位。
假设一个位于坐标原点的辐射体，其磁矢量滞后位的一般公式为
(3- 19)
其中，，为源点坐标，r为场点坐标，J为体电流密度。
因为场源是以一定的频率随时间呈时谐变化，
附一叫
-jr^r7]―
(3 - 20)
我们假设场点与源点间不是紧密的距离,但这并非远场假设，其与波长无关。 在该假设下，
的e-所f心').(5') A(r) « --- -----dV	(3 — 21)
47T Jv r
将式(3-21)中的指数项按级数展开可得
A(r) = J(r')CL +jker • r，+ ・••)■'	(3 - 22)
47rr
因为电流源假设为电小尺寸，所以痣r・r，的值很小，几乎为零，所以上式中 仅保留前两项，化简整理可得
46
4(r) « ,------ + jker - r')dV'
47r r Jv a g-jkr r	i
=含= ( JT) + RHT x/)x er+(er • rf)J + (er - Dr']]dV'
4tt r Jv	L
(iQ e~jkr(	1	\	,
« (P -Jker xM + -;kQ- erj	(3-23)
其中，P是电偶极子偶极矩，M是磁偶极子偶极矩，Q是电四极子的极矩。
一般情况下，电磁辐射基本上是由低阶项所产生。因此，电四极子项Q可 以忽略。磁矢量滞后位可进一步简化为
un e-J,fcr
A(r) « 詈-(P - jker x M)	(3- 24)
47r r
至此，电场和磁场便可经由磁矢量滞后位4(r)求解而得。
H(r)=
E(r)=
V x A(r)
Mo
V x V x A(r)
Jtd£0/Z0
(3 - 25)
综上所述，电场和磁场可用自由空间中的电偶极子和磁偶极子辐射的形式来 表不。
3.3密码集成电路电朝接收模型分析
实验中所用的近场电磁探头为Langer LF-B 3,它主要是由一个电感线圈构 成的传感元件。依据麦克斯韦第二方程可知，当信号中出现时变电流，便会伴随 产生磁场。所产生的磁场H穿过磁场探头的线圈时，线圈中通过的磁通量①就 会发生变化，磁场探头就会产生感应电动势，感应电动势E和磁通量①的关系 如式(3-26)所示。
d①
E…正
(3 - 26)
其中，N为磁场探头中线圈的匝数。
磁通量①与磁感应强度5的关系如式(3-27)所示。
①=
B ds
(3 - 27)
其中，S代表磁场探头接收面的面积。
若磁感应强度B垂直于积分曲面S,且磁感应强度B的值在积分曲面上不
47
随位置的变化而改变，则磁通量①可以改写成乘积的形式，如式（3-28）所示。
①=|b|・S = 4o |H|・S	（3 - 28）
电磁分析的优势在于其探索局部信息的能力，因此可以将磁场探头的触点置 于密码集成电路最感兴趣的局部位置。当用磁场探头进行电磁泄漏的探测时，往 往需要不断调整磁场探头的方向和角度以达到最佳的接收效果。此过程可以近似 为，通过调整磁场探头的方向和角度，使通过磁场探头接收面的磁感应强度上与 磁场探头的接收面达到近似垂直的关系。与此同时，因为磁场探头的接收面的面 积较小，可以近似认为接收面内磁感应强度3的值不随位置的变化而改变。因此 可以将式（3-28）代入式（3-26）来计算感应电动势E。
E = -N----= -N〃（）S 瓦	（3 - 29）
文献［17, 18］中详细分析了标准的电磁探头，依据其内容，本文中所使用的 磁场探头的等效电路如图3-6所示。
图3-6磁场探头等效电路图
其中，Lo是回路电感，Co是回路电容，&是回路电阻，&是负载电阻，〃。是电 磁探头的输出电压。
根据磁场探头的等效电路，建立电磁接收模型，如式（3-30）所示。
=_________E2Rl________
U°	+ J6）C07?0/?l - a）2 LqCqRl + Rl + Rq
=________一NRoSRl________ _
jaL。+ j（nCQRQRL —（i）2LQCQRL + RL + Rb dt
将密码集成电路电磁发射模型和电磁接收模型进行结合即可得到相关比特 寄存器的跳变鸳就式夫优㊉名）与近场探头的输出电压u。的关系，从而建立信息 泄露的电磁分析模型，如式（3.31）所示。
48
或阳|)__________良___________
°	dt JcoLq + j(i)CQR0RL —(i)2LqC0Rl +	+ Ro
-N〃°S& *=］罂- ampm(Rm © 弧)
=_________4兀r__________ 13 — 31)
j(oL0 + ja)C0R0RL — o)2L0C0Rl + Rl + Ro
因为实际测量中有无法消除的噪声影响和低噪声放大器的幅度放大的作用， 因此式(3-31)中还应加入噪声项£和幅度放大项〃从而构成完整的信息泄露的电 磁分析模型，即如式(3-32)所示。
-N叫SR『翳'。品虎=式3㊉/)
u =______iZIL_____________l 6	(3 — 32)
° jsL。+ ja)C0R0RL — o)2LqCoRl + Rl + Ro
由式(3-32)可知，磁场探头输出电压与寄存器的翻转个数成正相关关系。
由于集成电路芯片内部非常精密复杂，我们无法具体获知式(3-32)中I, 仇/•等参数的具体值，但是在具体的实验环境下，I,仇r可近似认为是固定的 值。对于一个给定的磁场探头，探头的参数£o, Co, Rl，N, S等参数也都是定 值：低噪声放大器的放大倍数〃也是固定的。所以，式(3-32)可以简化为
n
乳。=km • 2 (Rm ㊉砾)+ e m=i
cn IsinG 介
其中 k ： -NWoSRLFKamBm
出十' m - jaiL0+ja)C0R0RL-a>2L0C0RL+RL+R0 °
(3 - 33)
3.4	基于多元线性回归的电磁分析建模
回归分析在科学实验和实际生活中应用广泛，其中利用多元线性回归分析来 对研究的问题进行建模分析是一种常用的有效方式。多元线性回归主要研究一个 因变量同多个自变量间的关系，仔细观察公式(3-33)可知，磁场探头的输出电 压”主要受多个寄存器的翻转个数骞屋i(&n㊉En)的影响，从而可知密码集成 电路的电磁信息泄露也主要由多个寄存器的翻转而来。因此，可以构建基于多元 线性回归的电磁分析模型。
3.4.1	多疑性回归理论
多元线性回归模型通常用于研究一个响应变量y依赖于多个回归变量x之间 的随机线性关系［必21］，如果响应变量和回归变量间的关系可以用线性的形式来刻 画，那么则可以建立多元线性模型来进行分析，即
49
y = &)+仇之+…+优修c + £
(3 - 34)
式中，价，四，…，四是输入的回归系数，£是误差项，片为回归变量的个数。
如果对y和x进行了 〃次观测，得到“组观测值. xn，x＜；(z=l, 2, ”)，满足如下关系：
'% = 60 + 61%11 3-卜 Pk^kl + £1
丫2 = St) + 61Kl2 --H Pkxk2 + £2
、%=£() + 又％ T-----卜 Pkxkn + £n
(3 - 35)
用矩阵表示为
此时多元线性回归模型为
Y = Xfi + £	(3 - 36)
参数6一般通过最小二乘法来进行求解，即通过参数口的选择使得下式的残 差平方和(Residual Sum of Square, RSS)最小。
RSS(B) =(Y- Y)T(Y - P)
=(Y-Xpy(Y-Xp)	(3 - 37)
对6求导并令其为零
dRSS T,人 、	，	、
= 2XT(Xj? -y) = 0	(3- 38)
在正态性假设下，若X是列满秩的，那么线性回归模型参数。的最小二乘估 计便可由式(3-39)求得：
E =(xTx)-1xTy	(3 - 39)
于是y的估计值为：
Y = Xfi	(3 - 40)
多元线性回归方程(3-40)在一定程度上解释了响应变量y与回归变量X之间 的关系，因此可以依据X来预估y的值，但是预估的精度如何主要取决于多元线 性回归方程对于观测数据的拟合程度。
线性估计的决定系数距是对多元线性回归方程拟合程度的度量，这种度量
50
与响应变量y的离差相关。离差主要是由两个因素导致，一个是由于回归变量x 的不同取值所引起的；另一个是由于误差等因素的影响。离差可以通过实际的观 测值y及其均值歹的差来表示，对于n次观测的总离差是由n次的离差平方和来 进行表示，线性回归的总离差平方和(Total Sum of Squares, TSS)为
n
TSS = 2(yL 刃2	(3-41)
i=i
对于由回归变量x所引起的离差可以通过预估值夕和均值歹的差来进行解释， 其平方和称之为解释平方和( Explained Sum of Squares, ESS)
n
ESS = 2(灾一歹)2	(3-42)
i=l
三个平方和之间的关系满足：
TSS = RSS + ESS	(3 - 43)
决定系数叱主要取决于解释平方和在总离差平方和中的占比，其数学表达 式为：
ESS_S】像一刃2	RSS	一免产
~rss~^=1(yi-yl)2~	tss-1 珀 2	( 44j
因此，可以看出线性估计的决定系数改是一个在［0, 1］区间内的值，反映了 模型拟合的相似程度，值越大，回归变量X用来解释响应变量/离差的部分就越 多，拟合相似程度就越好。
多元线性回归的整体显著性检验主要是为了检验响应变量与回归变量间的 关系是否显著。具体的检验步骤如下：
(1)提出零假设M和备择假设"1：
Ho： 6PBi=…=A=o
Hl：为,fil,…，佻中至少有一个不是零
(2)依据下式计算出检验的统计量产：
ESS
n — k — 1
(3)做出统计决策：
根据给定的显著性水平明通过分子自由度k和分母自由度n-k- 1搜索尸分 布表来获得见,如果户＞%,则零假设成立；否则，备择假设成立。除此之外,
51
还可以根据P值来进行统计决策,如果P < a,则拒绝零假设，否则，接受零假设。 实际情况中，通过P值来进行统计决策，简单明了，可以避免查找尸分布表的繁琐 操作，因此，在进行统计决策时往往优先考虑P值。
对比式(3-33)和式(3-34)可知，如果将士皿视为优，寄存器的翻转(我市㊉ R3视为“，那么只需稍加改动便可以构建基于多元线性回归的电磁分析模型。 因此，对式(3-33)做如下修改
n
"o = km '〉'' (Rm ㊉ Rm) + 上0 — ^0 + €
m=l
n
=々in • W 依俏㊉ *)+ ^0 + £	(3 — 46)
m=l
其中，我们将跖融入到误差项中，£ = €-fc0o
至此，我们便可以用多元线性回归的理论来解释信息泄露的电磁分析模型, 利用决定系数来判断密钥的拟合程度，正确密钥的决定系数要高于其他猜测密钥 的决定系数。同时，可以通过多元线性回归的整体显著性检验查看响应变量七与 回归变量(Kn㊉R3间的关系是否显著。
3.4.2	电磁旁路分析实验平台
本小节将详细介绍本文所利用的自主研发和搭建的电磁旁路分析实验采集 平台，先对各个组成部件进行介绍，然后再进一步分析其工作的大致流程，最后 通过模块拆分来进行详细阐述。密码集成电路电磁旁路分析实验平台，如图3-7 所示，主要由密码设备，一组H-field近场探头，一个低噪声放大器，一台数字 示波器、一台苹果笔记本电脑和一台直流稳压电源构成。
图3-7电磁旁路分析实验采集平台
52
①密码设备。密码设备作为分析目标，可以是智能卡、单片机、嵌入式设备 等数字集成电路设备，本平台利用的是一块FPGA实验板一Sakura-G实验板。 Sakura-G实验板是一块专门为研究旁路分析的硬件安全而设计和开发的，实验板 上配有两块XILINX Spartan-6系列芯片，分别为主芯片和控制芯片，两块芯片均 采用45纳米的工艺制程。其中，主芯片主要负责密码算法的实现；控制芯片主 要负责为主芯片提供激励和控制时序。主芯片和控制芯片均配备了 48MHz的时 钟信号。
②H-field近场探头组。近场探头主要用来检测密码设备工作时的电磁泄漏 源并采集加密算法运行时的电磁发射信号。本平台所用的一组近场探头是Langer LF1 set,共包含四个不同直径大小的探头尺寸，其探测的频率范围为100KHz-50MHz o
③低噪声放大器。低噪声放大器紧邻近场探头，主要是对近场探头采集到的 电磁信号进行放大，同时减少杂波的影响，提高检测的灵敏度。本平台所用的低 噪声放大器是一款提供30dB增益的线性放大器，仅对电磁发射信号的幅度进行 放大，而不改变信号的频率成分。即低噪声放大器输出电压“。和输入电压%之间 满足下式的关系。
30dB = 20 x log10—或4 = 102 x %	(3- 47)
④数字示波器。数字示波器主要是用来捕捉经由近场探头获取到的电磁发射 信号，并将实时采集到的电磁信号通过网线传送给笔记本电脑进行存储。本平台 所使用的数字示波器为是德科技MSOS054A,是一个4模拟通道，带宽500M, 最大存储深度800Mpts,最高采样率可达20GSa/s的高性能数字示波器，完全可 以满足大部分实验的需求。示波器的采样率应满足奈奎斯特采样定理，采样率需 设定为目标信号最高频率的2倍及以上。
⑤笔记本电脑。笔记本电脑主要是用来存储示波器发送过来的电磁信号数据, 并对数据进行深层次的处理。同时笔记本电脑还负责与Sakura-G实验板的通信 和收发明密文等功能。
⑥直流电源。一台外接的直流稳压电源负责为Sakura-G实验板供电以减少 噪声的影响。当用笔记本电脑供电时，会存在供电不稳而引入其他干扰噪声的情 况出现。
电磁旁路信号采集流程如下：
(1)笔记本电脑通过一根标准的USB B-A线缆向Sakura-G实验板发送128 比特的明文和128比特的密钥。
(2)实验板接收到明文和密钥后开始进行加密算法的操作，并将加密完成
53
后的密文返回给电脑。加密算法在开始时会产生一个触发信号以同步示波器进行 存储操作。H-field近场探头通常置于主芯片的表面来检测电磁发射信号，通过调 整探头的角度和方向以达到最优的接收效果并保持在此最优位置直至信号采集 结束。
(3)近场探头接收电磁发射信号后，经过一个30dB的低噪声放大器提供 增益，并将信号传送给示波器。
(4)示波器捕捉到信号后将信号传送给电脑并储存下来以进行深入分析。 除此之外，一台直流电源为Sakura-G实验板供电以避免不相关的噪声给波形带 来的影响。
(5)笔记本电脑完成存储之后，再向Sakura-G实验板发送下一次的明文， 确保明密文和波形的一一对应。
(6)此过程不断重复，直到所要采集的电磁发射迹线数目满足需要为止。
该自主搭建的电磁旁路分析实验采集平台克服了传统人工操作明密文发送 费时费力的缺点，实现了对多种加密算法的数据收发存储和自动循环采集一体化 的功能，具有面向对象多样、信息采集量大、运行速度快、传输效率高、简单易 操作等优点。同时又能够避免长时间人为操作对实验环境和实验数据质量所造成 的影响，极大地提高了实验数据的采集效率。
数据发送 模.块
数据存储 模块
数据加密 模块
直流电源
薮据采集 传输模块
示波器 低噪放 近场探头
图3・8电磁旁路分析实验采集平台模块组成
电磁旁路分析实验采集平台按照模块划分主要由数据发送模块、数据加密模 块、数据采集传输模块和数据存储模块组成，如图3用所示。其中，数据加密模
54
块主要由密码设备和直流电源组成，其主要功能是进行密码算法的加解密运行, 对数据发送模块所发送来的数据进行加解密运算并输出明文或密文，本文所涉及 的加密算法为AES-128密码算法。数据发送模块与数据加密模块之间遵循USB 协议通过差分信号技术进行数据间的通信，经由USB的A型连接头进行上行连 接，B型连接头进行下行连接。
数据采集传输模块主要由示波器、低噪放和近场探头组构成，其主要功能是 对电磁旁路信号进行捕捉和传输。近场探头能够将密码设备泄漏到空间中的电磁 发射信号转化为电信号，一般而言，泄漏到空间中的电磁发射信号比较微弱，近 场探头局部定位的优势能够将探测点聚焦到密码集成电路部分的电磁发射，然后 通过低噪声放大器将电信号的幅度进行放大或者搭配滤波器进行滤波去噪，之后 再由示波器以二维形式将电信号随时间的动态变化在屏幕上可视化展现出来，并 将捕获到的电信号传送给数据存储模块从而实现对密码集成电路微弱电磁发射 信号的提取。示波器通常需要依据采集目标对采样率和存储深度进行设置以满足 要求。一般情况下，示波器在批量采集时常常设置为单次触发模式以确保明密文 的匹配。
数据发送模块和数据存储模块共同构成数据加密模块和数据采集传输模块 的上位机。上位机隶属于电脑上的应用软件，自主编写而成，其主要功能是对实 验所涉及的设备进行配置，并向数据加密模块发送明文或密钥，以及接收来自数 据采集分析模块的电磁旁路信号数据并进行存储。上位机界面如图3-9所示，可 以分成六个区域来展示。
清空	生成	匚自呢或		京椎连够③ 采集通道	哀陵O	采样疑
CO n22 3344 55 66 7?33 99AABeCCDDEEFF
口 位：					---	j	I 2511

密钥：	00 0- C2 Q3D4 05C6C7CS09DA0B0C0D0E 0F	35士	生K	口 56b;也c
□豌拉匚二				单依的百6〉 叉 3H-6	偏移电压(吟	单位电压(V) 区	!	,3	\
亚				贼发邈时⑸	触发时钟;S	科友电田切

接收：		告空.匚联消指误停止

对比：				IQt-l	FOStiirt」	11
接收方式：1	T	发送：			送耀	荣集	结索

Received: 0
图3-9电磁旁路分析系统上位机界面功能区划分
①端口控制区：该区域主要是与数据加密模块建立连接，选择合适的端口和 波特率以匹配加密设备与之进行数据通信和传送；
②采集控制区：该区域主要是对电磁旁路分析实验的采集方式进行设置，分
55
为握手方式的有无和加密次数的设置。握手方式主要是确保上一次的明文加密完 成并存储结束后再进行下一次的加密。加密次数主要是针对采集电磁泄漏信号的 发射迹数目而设置的。
③端口状态区：该区域主要是展示端口的连接状态和端口的开启关闭功能， 以可视化的形式确保端口正常连接。
④加密状态区：该区域主要是对加密过程中的明文密钥进行展示，并对密码 设备返回的密文进行校对，如果出现错误便停止，可以通过勾选右边的取消错误 停止来禁用错误停止功能。当进行多次加密时，需勾选明文自动生成功能，通过 产生不同的随机数种子来产生不同的明文和密钥，除此之外还能够对明文和密钥 的位数进行选择和固定。与此同时，可以选择单次循环和批量循环两种不同的方 式来进行电磁发射迹线的接收。
⑤示波器连接状态区：该区域主要是与数据采集传输模块进行连接并对示波 器的相关参数进行设置。示波器的参数主要包括采集通道、触发通道和采样频率 等参数。
⑥完成状态区：该区域主要是对已完成的加密次数进行统计，体现在明文的 已发送次数和密文已接收的次数，并通过对比二者之间的关系判断是否存在漏掉 加密的情况。
0. 008
0. ()06
0. 004
c 0. 002 >
0. 000 烟 整-0. 002
-0. 004
-0.006
-0. 008
0	1000	2000	3000	4000	5000
采样时间点
图3-10电磁发射迹线波形图
通过电磁旁路分析实验平台采集到的AES-128密码算法的电磁发射迹线中 的一条波形如图3-10所示。从图中可以看出，该条电磁发射迹线中一共有12个 朝下的尖峰存在。其中，第一个尖峰是由于触发信号的干扰而导致的，第二个尖 峰是由于密码设备加载明文或密钥所引起的，后面的10个尖峰依次对应着AES-
56
林 ppiwww***

128算法的十轮加密。
3.4.3	基于多元线性回归的电磁分析实验方案
由AES-128加密部分Verilog代码可知，相关比特所在的寄存器组存储的跟 密钥相关的中间值为每轮加密的输出结果。AES加密算法的硬件执行路径如图 3-11所示。在轮密钥加操作之后，将中间值存储到寄存器中，然后再进行下一轮 的加密直至最后一轮输出密文。由于第十轮的加密中没有列混淆的操作，加密过 程相对简单一些。因此，我们可以针对第10轮的输出密文和第9轮的输出密文 来验证模型的有效性。
密文
图3-11 AES加密算法硬件执行路径
本文在FPGA开发板上运行AES-128的密码算法，在加密过程中采用电磁 旁路分析实验采集平台进行电磁发射迹线的采集。在普通无防护的室内场景下， 采集了 10000条电磁发射迹线进行分析，示波器的采样率设置为500MSa/s。
3.4.4	基于多元线性回归的电磁分析实验结果
将多元线性回归应用于信息泄露的电磁分析模型，用决定系数改可以判断 密钥的正确与否。当正确密钥出现时，拟合程度要优于错误密钥的拟合程度，其 决定系数较高。因为AES-128是分组密码算法，算法运行的基本单元是字节，所 以我们以基本单元为例验证模型的正确性。我们选择密钥的第一个字节作为验证
57
单元，第一个字节的正确密钥为19。图3-12展示了所有猜测密钥的决定系数。 从图中可以看出横坐标位置19处的决定系数要远大于其他猜测密钥的决定系数, 所以可以认为猜测密钥19就是正确密钥，与实际相符。
0.020
0.015
0.010
0.005
0.000
猜测密钥
图3-12猜测密钥的决定系数
图3-13猜测密钥的产值
按照上一小节中多元线性回归的整体显著性检验的步骤对其进行显著性检 验，得到各猜测密钥值的尸值和P值分别如图3-13和图3-14所示。从图中可以 看出，猜测密钥19处的尸值要远大于其他猜测密钥，此时的尸值大于相应的Faa 在此处的尸值约为4.5x10-22,远小于0.05,因此可以认为备择假设H成立，磁 场探头的输出电压〃。与寄存器R的翻转之间存在整体显著性关系。
58

10
l(r-"
w-"
0	50	100	150	200	250
猜测密钥值
图3-14猜测密钥的产值
0.10
8 O
6 4 2 .00 0 SO.O. 对，“兴
0.00
1000	2000	3000	4000	5000	6000
电磁发射迹线数目
图3-15猜测密钥决定系数与样本曲线关系

猜测密钥的决定系数随着电磁发射迹线的变化如图3-15所示。其中，蓝色 线条代表正确密钥的决定系数变化，其他线条代表除正确密钥之外的猜测密钥的 变化。随着电磁发射迹线的增多，正确密钥的决定系数与错误密钥的决定系数之 间的差距越来越大，正确密钥的区分也更容易。当电磁发射迹线数量在600条左 右的时候，正确密钥便能从错误密钥之中区分出来。当电磁发射迹线数量低于600 条左右的时候，很难判断出正确密钥。在这一区间中，由于迹线数量较少，受噪 声的影响比较大。随着迹线的增多，噪声的影响逐渐减少，统计特性逐渐显现。
综上所述，经实验验证可得，输出电压与和寄存器翻转个数2取=1(/?小㊉7?幻 之间存在线性相关关系，通过多元线性回归从侧面证明了信息泄露的电磁分析模 型的正确性。
59
3.5	本章小结
本章主要对密码集成电路信息泄露的电磁模型进行了分析，通过建立电磁发 射模型和近场探头电磁接收模型，模拟了密码集成电路在密码算法运行时的电磁 旁路泄漏的物理过程，推导出了密码算法运行过程中电磁发射泄漏与密码算法中 间值之间的函数关系，并通过统计学的多元线性回归理论对模型的有效性进行了 验证。对于密码集成电路跟密钥相关的寄存器的电磁发射泄漏提出利用电偶极子 （或磁偶极子）模型来模拟其电磁发射泄漏。该方法也同样适用于任何结构的发 射体，任何一个实际发射体可以先分解成许多连续的电流丝，再将其细分成电偶 极子（或磁偶极子），发射体的场可以通过这些电偶极子（或磁偶极子）贡献的 总和来求得，同时对偶极子等效进行了理论分析。通过本章研究的内容为后续进 行电磁旁路分析和硬件木马的检测提供理论支持。
60
本章参考文献
[1]	Agrawal D, Archambeault B? Rao J R, et al. The EM side—channel (s) [A]. // International workshop on cryptographic hardware and embedded systems [C]: Springer 2002: 29-45.
[2]	Chari S, Jutla C S, Rao J R, et al. Towards sound approaches to counteract poweranalysis attacks [A]. //Annual International Cryptology Conference [C]: Springer 1999: 398-412.
[3]	Peeters E, Standaert F-X, Quisquater J-J. Power and electromagnetic analysis: Improved model, consequences and comparisons [J]. Integration. 2007,40(1): 5260.
[4]	Brier E, Clavier C, Olivier F. Correlation power analysis with a leakage model [A]. // International workshop on cryptographic hardware and embedded systems [C]: Springer 2004: 16-29.
[5]	Rabaey J, AnanthaChandrakasan, BorivojeNikolic, et al.数字集成电路:电路系 统与设计[M].北京：电子工业出版社，2010.
[6]	Sung-MoKang, YusufLeblebici, ChuIwooKim, et al. CMOS 数字集成电路:分析 与设计[M].北京：电子工业出版社，2015.
[7]阎石.数字电子技术基础(第5版)[M].北京：高等教育出版社，2006.
[8]	Stutzman W, Thiele G, Stutzman, et at天线理论与设计[M].北京：人民邮电 出版社，2006.
[9]李军.三维封装电磁干扰的分析与防护设计[D].浙江大学,2017.
[10]	Regue J, Ribo M, Garrell J, et al. A genetic algorithm based method for predicting far-field emissions from near-field measurements [A]. // Proceedings 2000 IEEE EMC Symposium [C]: 2000: 147-151.
[11]	Paul C.电磁兼容导论[M].北京：机械工业出版社，2006.
[12]张洪欣，沈远茂，韩宇南.电磁场与电磁波(第2版)[M].北京：清华大学出 版社，2016.
[13]舒余飞.基于近场扫描的电磁干扰源重构算法研究[J].浙江大学,2019.
[14]	Lindell, Ismo V Methods for Electromagnetic Field Analysis [J]. Oxford University Press, 1992.
[15]	Liu E-X, Zhao W-J? Wang B, et al. Near-field scanning and its EMC applications [A]. // 2017 IEEE International Symposium on Electromagnetic Compatibility &
61
Signal/Power Integrity (EMCSI) [C]: IEEE 2017: 327-332.
[16]	Wilson P. On correlating TEM cell and OATS emission measurements [J]. IEEE Transactions on Electromagnetic Compatibility, 1995,37(1): 1-16.
[17]	Kanda, M. Standard probes fbr electromagnetic field measurements [J]. IEEE Trans Antennas Propagat, 2002, 41(10): 1349-1364.
[18]张南.计算机电磁信息泄漏与视频信息认知研究[D].北京邮电大学,2019.
[19]	Hastie T J. The Elements of Statistical Learning [M/OL]. 2015[
[20]	Shan F, Wang Z? Xu G, et al. Multi-Byte Power Analysis: A Generic Approach Based on Linear Regression [J]. IEEE Access, 2018, PP(99): 67511-67518.
[21]刘飕.基于机器学习的密码芯片电磁攻击技术研究[D].北京邮电大学, 2014.
62
第四章 基于智能算法优化的多字节电磁分析
在上一章中，我们对密码集成电路的电磁发射进行了等效建模计算，为论文 的后续奠定了基础。本章将从提升信息利用率的角度对电磁旁路分析来进行研究, 在以往的电磁旁路分析中，往往会通过“分而治之”的方式12］，针对密钥的单 个字节进行建模分析，其他字节被视为噪声，这种方式虽然不失为一种行之有效 的方法，但是在密码算法的硬件并行实现时却对密钥包含的有效信息利用率较低。 因为密钥的每一个字节都包含有效信息，仅仅利用一个字节无疑是对密钥其他字 节的浪费。因此，本章提出一种多字节电磁分析的方法充分利用密钥的多个字节 信息来提高电磁分析恢复密钥的有效性。智能算法是人们受到自然界生物规律的 启发，根据其思想并利用仿生原理而提出的解决问题的算法，为解决工程中的许 多问题提供了新思路和新想法33智能算法具有通用、简单、方便并行处理等 优点，在诸多领域中得到了广泛的应用。通过将电磁分析与智能算法相结合的方 式，把旁路分析的密钥恢复问题转化为密钥寻优问题叵*虽然目前已有文献将 智能算法与旁路分析相结合，文献⑺提出SGA-CPA的方法将遗传算法与相关功 耗分析相结合，文献网在SGA-CPA的基础上进行了改进，提出MS-CPA的方 法，将多种群遗传算法与相关电磁分析相结合，二者虽然都在一定程度上减少了 所需的迹线数目，但是其存在算法复杂度较高的问题。为此，我们提出基于智能 算法优化的多字节电磁分析以解决硬件并行情况下信息利用不足的问题，同时平 衡效率和复杂度之间的关系。
4.1	多字节电磁分析
4.1.1	多字节电磁分析理论基础
在硬件并行的情况下，密码算法的加密操作时往往是同步完成的，密钥的所 有字节都同时参与其中。此时所采集到的电磁发射迹线包含密钥所有字节的信息, 如果此时依然针对密钥的单个字节进行密钥恢复，会对密钥的有效信息利用不足, 从而造成密钥恢复效率低下的问题。因此，本文提出利用密钥多个字节的信息来 进行分析以提高信息利用率。下面先从理论上探究利用密钥多个字节的信息进行 电磁分析的可行性。
针对多字节电磁分析，我们将从微观和宏观两个角度来进行分析。在微观上， 考虑一个使用m位密钥的密码算法，将其处理的二进制数据编码为X = £陶1%2乙其中% = 0或1。所以，针对X的汉明重量为HW(X) =£隔1%。
63
如果X中比特位是独立均匀分布的，那么其平均汉明重量为Hhw = 3,方差为 = p密码算法从当前状态x变化到下一状态y的汉明距离可以通过下式 (4-1)来计算。
HD(X,Y) = HW(X © Y)	(4 - 1)
汉明距离即是从当前状态x跳转到下一状态y时二进制位翻转的比特数目。 如果假设状态六o,那么汉明距离就跟汉明重量相似。因此，hw(x㊉匕)也有相 同的均值f和方差
2	4
按照第二章第2.3.4小节中的汉明距离模型来进行建模，如果汉明距离模型 刻画准确，那么实际电磁发射迹线T满足
T= a-HW(X ㊉ 丫)+ b	(4-2)
当运用相关电磁分析来进行密钥恢复时，皮尔逊相关系数为
Pt,hw =

(4 - 3)
其中，CO"。代表协方差。
因为汉明距离模型是线性模型[9],所以不同变量之间的相关关系可以通过它 们之间的方差来预测。
片=a2a^w + 诏	(4- 4)
在噪声无关的假设下，皮尔逊相关系数便转化为
Pt,hw =
CL '	CLyjTfl
aT y/ma2 +
(4 — 5)
如果汉明距离模型中仅应用密钥的1个独立的比特位，那么其部分相关性也 依然存在
一	(4 — 6)
m
,	_ ayfl _
Pt,hw = I _	==7 = Pt,hw
y/ma2 + 4g
通过上式(4-6)可知，相关系数p：,hw与所使用的比特数M成正比关系，所 用的比特数越多，相关系数越大，所包含的信息量也就越大。
在宏观上，实际采集到的电磁发射迹线7通常包含两部分：一部分是与密码 集成电路中密钥数据紧密相关部分的电磁发射迹线Q,另一部分是与密钥数据不 相关部分的电磁发射迹线N。
T = Q + N	(4-7)
64
当运用相关电磁分析来进行密钥恢复时，皮尔逊相关系数被用来衡量假设电 磁发射迹线〃与实际电磁发射迹线7之间的相关性，二者之间满足如下关系。
|P(T,M)|	= |P(H,Q+N)|
covQH, Q + N)
Jvar(H)var(Q + N)
(4 ,— 8)
_ cov(H, Q) + cov(Hf N)
在噪声无关的前提下，假设电磁发射迹线H与噪声N之间没有任何相关关 系，所以二者之间的协方差为0。
(4 — 9)
理想情况下，对于正确密钥通过电磁旁路泄漏模型而获得的假设电磁发射迹 线H与实际密码集成电路中密钥数据所泄漏的电磁发射迹线Q之间吻合一致， 所以二者之间的相关系数为1。当使用密钥中/个独立比特位时，其相关系数为
Um _ I
|P(H,T)I =
(4 - 10)
在实验单次测量的短暂过程中，信噪比可以看做是稳定不变的。因此，从公 式(4-10)可以看出，所应用的独立比特数越多，对应的密钥字节数也就越多， 其相关系数也就越大，因此利用多字节电磁分析能够提高相关性。
4.1.2多字节电磁分析面£实疆
为了验证上述多字节电磁分析的正确与否，对所采集的电磁发射迹线进行多 字节电磁分析实验。针对AES算法中最后一轮的非线性操作一字节代替来进行 电磁旁路分析，对于传统电磁分析而言，当正确猜测密钥出现时，正确猜测密钥 所对应的相关系数要比其他猜测密钥所对应的相关系数要高，如图4-1所示。即 如果相对应于横轴猜测密钥19处有一个明显的最大的峰值，也就意味着19即是 正确密钥。
65
三-|法理后粼般*奚
0. ()0
090807
0605
o o o o o O
4 3 2 1 o o o O
50	100	150	200	250
猜测密钥值
图4-1传统电磁分析猜测密钥的相关系数
当对猜测密钥的字节进行叠加时，往往会出现两种情况，如图4-2和图4-3 所示。相较于图4-1,当叠加到正确密钥时，所有猜测密钥的相关系数要比仅用 单个字节的密钥来进行电磁分析的相关系数整体要高一些，并且会呈现出一个明 显的尖峰，从而容易区分出正确密钥，如图4-2所示。当叠加到错误密钥上时, 相关系数往往会比较混乱，没有相对明显的尖峰出现，难以区分正确密钥与错误 密钥，如图4-3所示。
综上所述，多字节电磁分析能够有效提高信息的利用率并且有助于正确密钥 的区分。
出玄盘这粼帐W灵
O O.
8 6 4 2 o o o O O.O.O.O.
0. 00
50	100	150	200	250
猜测密钥值
图4・2正确密钥叠加时的相关系数
66
反茁S?言黑怅衣辛
0. 02
0.01
0.00
0 9 8 7 6 5 4 3 1OOOOOOO O.O.O.O.O.O.SO.
50	100	150	200	250
猜测密钥
图4-3错误密钥叠加时的相关系数
4.2基于粒子群优化算法的多字节电磁分析
4.2.1	粒子群优化算法
粒子群优化算法(Particle Swarm Optimization, PSO)是为解决优化问题所 提出的全局随机搜索算法【电1】通过对鸟类群体觅食过程的飞行路线和群体聚集 行为的模拟而发展出的一种群体智能算法，拥有简单、高效、参数少和易于实现 等优点，在实际生活中应用广泛。
PSO优化问题的每个候选解都被看作是D维搜索空间中的“粒子”点 (Particle),所有粒子都有一个共同的适应度函数(Fitness)。每个粒子都在D维 空间中以一定的速度进行移动，粒子的速度决定着它们的飞行方向和飞行距离， 每个粒子不仅受其自身历史最优位置的影响，还受到群体中最优位置的指引，不 断调整自身的速度，追随当前解空间中的最优粒子逐渐向更优的解空间中移动。 每次移动之后，利用适应度值对每个粒子进行评判，确保个体最优粒子和群体最 优粒子能够及时更新，经过多次迭代之后搜索到最优解。
一般来讲，将适应度函数的最大化或最小化作为主要的目标。对于目标函数 最大化的多维问题，函数/可以描述为
X* = argmax f (X) = {X* G R:f(X*) > f(X), VX ER}	(4- 11)
其中，X是一个D维的候选解，X*是优化后的最优解，第i个粒子的位置表示为 Xj = (无〃,2⑵…，如))。粒子的速度U同样也是一个D维的向量，第i个粒子的速 度表示为匕=(%1，巧2,…，%D)。
67
粒子群优化算法最主要的特点是具有记忆性，主要表现在速度和位置的更新 “2】，其速度更新通过下式(4-12)进行
%d(t + 1) = /d(t) +	~ 飞⑴)
+c2r2(gbestgd(t) 一 弁〃⑴)	(4-12)
其中，"必代表第i个粒子在第d维的速度；/代表当前迭代次数；q和C2是加速 因子，也称为认知系数和社会系数，它们用于平衡粒子向局部或全局最优位置的 位移；〃和厂2是在［0, 1］区间的随机数；%表示目前获得的每个粒子个体最 优位置,gbestgd是整个粒子群的全局最优位置。通常，nd的值被限制在范围［外加， 之内，以免粒子出离到搜索空间之外。
第i个粒子的位置更新主要通过下式(4-13)进行。
Xid(,t + 1) = Xid(t) + vid(t + 1)	(4 - 13)
其中，XW代表第i个粒子在第。维度上的位置。在求解优化问题时，一般会将解 限制在［而加，之内，以免粒子超出给定范围。
当迭代次数达到最大值或迭代次数足够多之后，粒子在群体中的全局最优位 置无法进一步改善时，PSO算法将停止。标准PSO算法的基本过程如图44所 不O
(一开始一)
图4-4标准粒子群算法基本流程
68
4.2.2	基于粒子群优化算法的相关电磁分析
基于粒子群优化算法的相关电磁分析(PSO-Correlation ElectroMagnetic Analysis, PSO-CEMA)通过粒子群优化算法和相关电磁分析的结合，将电磁旁 路分析的密钥恢复问题转化为密钥相关系数的寻优问题口刃。每个字节代表解空间 中的一个维度，因此空间坐标系中的每个点都是一个密钥候选解。正确密钥的恢 复就是通过找到多维空间坐标系中最优的点来实现。
相关电磁分析中用汉明距离模型来进行假设电磁发射迹线W的建模刻画口支 从当前状态h变化到下一状态S时的假设电磁发射迹线为
W = a- HD(h,s) + b = a- HW(h ®s) + b	(4 - 14)
通常情况下，s关于力和子密钥x之间存在着一种函数关系
s = g(/i,x)	(4 - 15)
所以，
W =	s) + b = a・HW(h ㊉ g(/i,K)) + b	(4 - 16)
如果我们假设hl, b=0,那么汉明距离模型便简化为
W = HW(h © g(h, x))	(4 - 17)
皮尔逊相关系数用来衡量假设电磁发射迹线和实际电磁发射迹线之间的相 关性口明 在实际运用中，一个拥有N条电磁发射迹线T的集合与N条相关的假 设电磁发射迹线/集合之间常采用如下式(4-18)形式的相关系数来衡量。
Pr.w = I --- I	———	(4 -18)
JnIXiK - (5XiK)2Jn£L % 一 (£匕%)2
为了充分利用密钥中每个字节所包含的有用信息，密钥的所有m个字节被用 于密钥恢复。从当前状态”=(以,后，•一，/)变化到下一状态S =…,Sm)的 汉明距离/次为 m	惟
AW = HD(”, S) = 2 HW(hj ㊉弓)=2 HW (%㊉ g回 芍))	(4 — 19)
7=1	)=1
粒子群优化算法是一种启发式的算法，它几乎能有效地优化各种目标函数或 适应度函数。在电磁分析中，其目标是从密钥搜索空间中寻找到最优的密钥解。 基于粒子群优化的相关电磁分析算法可概括如下：
69
给定适应度函数b（X）为皮尔逊相关系数:
产(%) = Pt,aw =
N^TjAWi-^T^AWj
JneLk — (ELktJniXi"” — (犬】4必)2
(4 - 20)
D维搜索空间QD是密钥的搜索空间，同时也暗示出密钥中包含有D个字 节，K =伙1#2,…，kD］。如果把密钥表示成多维的形式，每个字节的密钥将被看 （x1 = k1
作是搜索空间的一个维度•无2 ：均。因此，每一个密钥候选解都被定义成一个粒
=岫
子，第［•个密钥候选粒子可以表示为Xi =（々1/⑵…，刈D），其速度可以表示为 匕=（%1，%2,…，%））。
为加快收敛速度，我们对标准PSO算法的速度和位置更新方式进行了改进。 密钥候选粒子的速度更新方式按照下式（4-21）进行
Vid = Ojvid + c^Cpbestid - xid） + C2r2（gbestgd - xid） （4 - 21） 其中，（0是惯性权重，其值为非负的。惯性权重3对平衡全局和局部优化性能起 着重要的作用。当3较大时，全局寻优性能较好，而局部搜索寻优性能较差。考 虑到更强的搜索能力，对惯性权重8进行了修正，使其具有更好的收敛速度。修 正后的惯性权重的表达式如下：
iter
3 = 3max - C^max - 3Tnbi） ~~~	（4 - 22）
maxiter
其中/max和必nm是最大惯性权重和最小惯性权重，iter是当前迭代次数，maxiter 是最大迭代次数。为了搜索到最优的密钥候选解，粒子在搜索空间中逐步向最优 密钥位置点移动。
另外，为了获得全局最优值，我们在PSO算法中加入了变异算子。变异算 子用于保持种群从一次迭代到下一次迭代的多样性。它类似于生物突变，变异算 子从初始状态改变多维坐标中的一个或多个位置值。因此，利用变异算子可以得 到更好的解。变异操作会以概率尸m改变某些粒子的空间位置，以避免局部最优 的情况出现。
在改进后的方法中，对于具有较低适应度值的选定粒子，它们将随机地从其 当前位置改变到其他位置以具有更好的适应度值。
X = XxPm
(4 - 23)
为了保证安全性，密码算法的密钥长度通常会比较长。换句话说，在多维坐
70
标系中有大量的空间点存在。例如，AES是一种对称加密算法【161,能够使用16 个字节的密钥来处理数据。一个字节的数值范围是从0到255,因此多维坐标中 将有25616个点。它可能需要大量的初始粒子才能在多维坐标系中找到正确的密 钥点，也可能需要经过非常多的迭代次数之后才能得到正确的密钥点。
图4-5基于粒子群优化的相关电磁分析示意图
因此，我们对粒子群优化算法做进一步的简化处理，通过一种随机的定向路 径方式来得到优化解。以三维空间为例，如图4-5所示，红色的圆点表示初始粒 子以及它们所处的位置，黄色三角形点表示正确密钥K,其坐标位置为Cxbest, ybest, zbest)。
粒子群优化的方向是按照提前设定好的路径进行交替优化，例如粒子先在y 轴上行进，然后在x轴上移动，最后在z轴寻找。换言之，粒子将首先在K(0, y, 0)中找到最佳点K (0, ybest, 0),然后在K (x, ybest, 0)中找到最佳点K (xbest, ybest, 0),最后在 K (xbest, ybest, z)中找到正确的点 K Cxbest, ybest, zbest)。其中x, y, z均是从0到255变化的随机变量。因此，式(4-19)中的汉 明距离被修改为
AW = ^HW (hj ㊉	+ 幺 HWdefault	(4 - 24)
7=1	六t+工
其中，t指代的是定向路径中的当前维度数，m是密钥的字节数，"Wtfefau比被设 置为默认值0,抑或是其他值。
算法4-1给出了基于粒子群优化电磁分析的大致流程。
71
算法4・1基于粒子群优化相关电磁分析
Input:最大迭代次数初始粒子数变异概率%
Output:最优密钥解 best_point
1：	key_points = Initialization(A^)	〃初始化所有粒子
2：	Fitness侬yjjoints)	〃计算所有粒子的适应度
3： (pbest. gbesf) = PickFitness(或夕〃选出局部和全局最优的粒子
4： iter = 0
5： key_right = 0
6： while iter <max_iter and key_right = 0 do 〃循环迭代优化
7：	Update(婕y_points)
8：	Mutation(阿yjpointsJPr^) 〃变异
9：	Fitness(左@joints)
10：	(pbest, gbest) = PickFitness(和y_points)
11：	if Vertification(gZ>e^) = true then
12：	key_right = 1
13：	best_point = gbest
14：	End
15： End
16: return best point
4.2.3基于粒子群优化相关电磁分析实验结果
实验过程中，我们聚焦于硬件并行实现下AES加密算法最后一轮的非线性 操作一字节代替，在3.4.2节描述的电磁旁路分析实验平台上，示波器采样率为 500MSa/s,采集了大量的电磁发射迹线来进行基于粒子群优化的电磁分析实验。 其中，实验分析部分是在一台处理器为IntelXeonE5-2620v4,运行内存为64GB 的服务器上进行。
成功率是衡量一种方法性能的有效措施口刀，因此，我们使用成功率来测试不 同参数情况下的性能。成功率被定义为：
SR = Pr{F(勺)=Kc}二
2、｛尸网/田）=Kc[i]] m
(4 - 25)
其中，Pr是成功的概率，依是密钥恢复函数，勺国是猜测密钥的第i个字节, 儿国是第i个字节的正确密钥。
72
粒子群优化算法迭代次数对成功率的影响展现在图4-6中。经过多次实验, 粒子群优化算法的迭代次数少于10的时候，成功率增长的比较快，然后逐渐变 得平稳。当迭代次数达到25左右的时候，正确密钥几乎已经成功恢复，并且处 于稳定状态。实验结果展示出随着粒子群迭代次数的增加，密钥恢复的成功率也 将逐步提高并最终稳定在一个较高的成功率。但是，当迭代次数过于大的时候, 并不能够对密钥恢复提供进一步的帮助。
1.0
0.8
* 0.6 左 盛
0.4
0.2
0.0
0	5	10	15	20	25	30
迭代次数
图4-6成功率随迭代次数的变化
1.0
0.8
*0-6
0.2
0.0
0	10	20	30	40	50	60
初始粒子数目
图4-7成功率随初始粒子数目的影响
初始粒子数目对成功率的影响展现在图4-7中。从图中可以看出，当初始粒
子数目少于50的时候，成功率随着粒子数目的增多而不断提高，直到恢复正确
73
密钥。当初始粒子数目多于50的时候，虽然也能恢复正确密钥，但是在一定程 度上增加了计算量，耗费更多的时间。
针对变异操作所发挥的作用，我们对比了 PSO-CEMA中变异操作的有无对 成功率的影响，实验结果如图4-8所示。从图中可以看出，变异操作对PSO-CEMA 有一定程度上的改进，当带有变异操作的PSO-CEMA成功恢复密钥时，没有变 异操作的PSO-CEMA仍然需要大约1000条左右的电磁发射迹线才能将密钥正 确恢复。
0	2000	4000	6000	8000	10000
电磁辐射迹数
图4-8变异操作对成功率的影响
0	2000	4000	6000	8000	10000
电磁辐射迹数目
图4-9 PSO-CEMA优化单字节密钥和多字节密钥的性能对比
我们同样也对比了粒子群优化算法在优化单字节密钥和多字节密钥时的性
74
能，以验证PSO-CEMA方法的有效性，如图4-9所示。图中红线代表的是多字 节密钥优化的情况，蓝线代表的是单字节密钥优化的情况。从图中可以看出，粒 子群优化算法在优化多字节密钥时的性能要优于单字节密钥的性能，当对多字节 密钥进行优化时，大概需要7000条左右的电磁发射迹线，成功率就能够达到 100%。相同情况下，粒子群优化算法对单字节密钥的优化仅达到90%左右，依 然需要额外的2000条左右的电磁发射迹线才能够达到100%的成功率。
相关系数随密钥字节数的变化如图4-10所示。如果仅有一个字节的密钥被 利用，相关系数的大小约为0.075左右；当所有16个字节都被利用时，相关系 数的大小约为0.25左右。图4-10揭示了相关系数与密钥字节数之间存在正相关 的关系，所利用的密钥字节数越多，相关系数越大。同时也证实多字节的密钥包 含更多的有用信息。由式(4-9)我们可以得到
p2
SNR = —(4 - 26) 1 — 0/
信噪比SNR和|p|之间存在正相关关系，|p|越大，信噪比越高。所以，电磁 分析中所利用的密钥字节数越多，相关系数就越大，信噪比也就越高，从而可以 说明多字节密钥包含更多的有用信息。因此，这对使用多字节密钥来进行电磁分 析具有指导意义。
0.30
0.25
0.20
旦玄会喉踞*某
0.15
0.10
0.05
0.00
0	2	4	6	8	10	12	14	16
密钥字节数
图4/0相关系数随密钥字节数变化
不同方法的性能比较如图4.11所示。从图中可以看出，PSO-CEMA方法最 好，CEMA方法次之，DEMA方法相比于前两个比较差。当密钥被全部正确恢 复的时候，PSO-CEMA方法大约需要4500条电磁发射迹线。在相同电磁发射迹
75
线数目下，CEMA方法的成功率只有70%左右，仍然需要更多的电磁发射迹线 才能完整恢复密钥。当PSO-CEMA方法和CEMA方法均正确恢复密钥的时候, DEMA方法的成功率依旧非常低，依然需要大量的电磁发射迹线才能将密钥恢 复成功。这是因为在DEMA方法中，只有一个比特的信息被利用，其他127比 特的信息都被视作噪声处理，只有极少量的有效信息被利用，所以效率才会比较 低。鉴于DEMA方法的低效率，在本文的后续章节不再考虑DEMA方法的使用。
1.0
0.8
好“6 会

0.2
0.0
0	2,000	4,000	6,000	8,000	10,000
电磁辐射迹数目
图4-11不同方法性能比较
图4-12不同方法成功恢复密钥时所需的最少电磁发射迹线数
从一个攻击者的角度来讲，恢复密码算法正确密钥所需要的电磁发射迹线数 量越少越好。因此，通过采集大量的电磁发射迹线来验证PSO-CEMA方法的有 效性。为了表现PSO-CEMA方法的优越性，我们用正确密钥恢复时所需的最少
76
电磁发射迹线数目来做对比。所有的电磁发射迹线被随机的分成不同的集合，在 每个集合上重复相同的实验方法来对比性能。实验结果如图4-12所示，通过 CEMA方法平均需要7286±1075条电磁发射迹线而PSO-CEMA方法平均需要 6286±859条电磁发射迹线。在相同情况下，PSO-CEMA方法实现了大约13.72% 的改进。无论是从所需的电磁发射迹线数目上还是波动程度上，PSO-CEMA方 法都要优于CEMA方法。
4.3基于遗传算法优化的多字节电磁分析
在上一节中，我们对基于粒子群优化算法的多字节电磁分析进行了研究，虽 然有了一定程度的改进，但是并没有充分利用密钥所有字节的信息。因此，在本 小节将详细研究基于遗传算法优化的多字节电磁分析，同时利用密码算法密钥的 所有字节的信息来进行密钥的恢复。
4.3.1	遗传算法
遗传算法(GeneticAlgorithm, GA)借鉴了达尔文进化论“适者生存”的原则 和孟德尔的遗传学说，通过自然选择、遗传和变异等操作，实现个体适应性的提 高口8，1式标准遗传算法是一种群体型的操作，主要由选择算子、交叉算子和变异 算子三个主要操作算子构成，其操作过程简单，易于理解，具有其他传统方法所 没有的特点。
对于标准遗传算法，有以下一些基本的概念需要了解。
・	个体：优化问题的密钥候选解被视为是一个个单独的个体，一个128比特 AES密码算法的密钥就是一个单独的个体。
•	适应度函数：评价个体优劣性的目标函数称之为适应度函数，在电磁旁路 分析中，相关系数即为适应度函数。
•	种群：种群是一组随机初始化的个体，由多个随机初始化的128比特的密 钥候选解组成。
・	编码：通过编码将密码算法的密钥候选解转化成遗传空间的个体，常见的 编码方式有二进制编码和实数编码。
选择算子:通过从当前种群中筛选出适应度值高的个体作为父代进行繁殖， 选择算子的方法有多种，最常用的是轮盘赌的方法，由各个个体适应度的概率决 定其被选中的可能性。个体越适合，被选中的次数就越多，它的基因就会在后代 种群中逐渐增多。如果种群数量为〃，个体i的适应度值为力小那么个体i被选 中的概率是
77
p.= 加 i
1 %"由
(4-27)
•	交叉算子：通过种群中的个体随机配对，以交叉概率尸C随机交换两个选 择密钥个体之间的部分比特位，产生子代新个体。
•	变异算子：随机挑选出种群中某个个体，以相对较低的变异概率尸m随机 改变个体上的单个或部分基因，从而产生新个体。
标准遗传算法的主要流程如图4-13所示：
图4-13标准遗传算法流程
4.3.2	遗传算法的理论基础
遗传算法的理论基础主要是Holland的模式定理和积木块假设如211 o统计学 研究表明如果想通过随机搜索找到最优可行解，就要满足较优解呈指数级增长的 条件。模式定理确保遗传算法中较优解满足寻找全局寻优的条件；积木块假设则 表明遗传算法能够找到全局最优。
积木块假设：阶数低、长度短和适应度高的模式被称为积木块，积木块在遗 传算子的影响下，能够生成阶数高、长度长和适应度高的模式，最终生成全局的
78
最优解。
模式定理：在遗传算子的影响下，积木块将在子代种群中呈指数级增长。
模式H经过遗传算法的选择算子、交叉算子和变异算子的共同作用之后， 其子代中的样本数满足式(4-28)。
m(H, t + l)> m(H, t)竿[1 -	[1 一。(“)4J	(4 - 28)
其中，表示在第1代种群中所匹配模式H的样本数为相；/(H)是表示模 式"的位串在第/代的平均适应度;f是表示种群中所有个体的平均适应度,。(H) 表示模式H的阶数，6(H)是模式的定义距。
从上式可以看出，如果模式的平均适应度/(H)高于群体的平均适应度f,那 么在子代中将会获得越来越多的样本，然而如果模式的平均适应度/(均低于 群体的平均适应度r的模式，那么其样本将会在子代中变得越来越少。
4.3.3	基于遗传算法优化的多字节电磁分析
基于遗传算法优化的多字节电磁分析(Multi-Byte ElectroMagnetic Analysis based on Genetic Algorithm, MBEMAGA)主要是将多目标优化与遗传算法相结 合，并成功应用到相关电磁分析中。多目标优化广泛应用于我们的日常生活和大 多数工程优化问题中，是一个向量函数的优化问题向量函数值的比较比标 量函数值的比较要复杂的多。在理想情况下，多目标优化要求每一部分的目标函 数值都是最优的。
解决多目标优化问题的方法有很多种，最重要的方法是将多目标优化问题的 解转化为合适的解来进行求解。通常可分为两种方式：一种是重构新的目标函数， 将问题转化为新目标的求解；二是将多目标优化问题转化为多个单目标优化问题。
本文采用第二种方式将多字节电磁分析与多目标优化问题进行结合，其数学 模型可描述为
FWmax = [A(Xi)/(X2),…/(XJ7	(4 一 29)
s.t. ftCXt) E [-1,1]
X = [X1,X2r-,Xi\
Xt = [x1(x2,-,xn]
Xn e (0,1}
其中，向量适应度函数尸(X)max= [A(X1)/(X2),“/(M)F的目标是实现所有子 目标函数的极大化，尸(X)为128比特完整密钥的相关系数；%(X。是第i个字节
79
子密钥的目标函数或适应度函数，即密钥第i个字节的相关系数。
遗传算法以种群为基础的方式适于求解多目标优化问题。结合二者的优点, 我们将多目标遗传算法应用到CEMA中Ml,按照如下方式进行结合：
（1）随机产生一组包含n个128比特的初始密钥作为初始种群中的个体，
即 key_candidate 1, key_candidate 2, …，key_candidate n；
（2）依据子密钥的目标函数将种群中的全部个体平均分成一些子种群，即 subkey 1, subkey 2, …，subkey 16;
（3）在每一个子种群中分别计算相应的子密钥的适应度函数subFitness；
（4）在每个子种群中按照轮盘赌的方法选择子密钥适应度值高的个体来组 成新的子种群；
（5）在每个新的子种群中执行交叉算子和变异算子的操作；
（6）对新的子种群进行重组，计算向量适应度函数尸（X）,并寻找出多目标 优化后向量适应度值高的个体进入下一代的进化；
（7）该过程经过多次循环迭代，直至选出满足条件的密钥后停止。
基于遗传算法优化的多字节电磁分析单次迭代循环的过程如图4-14所示。
图4-14遗传算法优化多字节电磁分析的基本流程
基于遗传算法优化的多目标电磁分析被用作CEMA的替代方案，使用多字 节作为目标，而不是使用一个字节来恢复密钥。在标准遗传算法的基础上，我们 增加了排序算子和筛选算子应用于多字节电磁分析中来助力最优解的搜索。排序 算子将子种群中的个体按适应度降序排列，使不同子种群中较好的候选子密钥排 在前面，能够以较大的概率组合在一起生成最优候选密钥。筛选算子主要执行如 下操作过程：选择一个临时最优密钥keyjemp,将密钥候选解与临时最优密钥
80
keyjemp进行对比，如果二者之间存在某个字节不同，则对临时最优密钥 超匕彭如进行替换，如果替换之后的适应度值比之前的要高，则对其进行更新, 否则依然保留的Je”不变，直至最后一个密钥候选解比对完成。
算法4・2给出了基于遗传算法优化的多字节相关电磁分析的基本流程。
算法4-2基于遗传算法优化的多字节相关电磁分析______________________________
Input； 最大遗传代数种群大小NCVD,交叉概率尸°,变异概
率Pm
Output：密钥最优解 key_optimal
1： key_cand = Initialization(7\®VD);	〃初始化所有个体
2： subkey_cand = T)ivide(key_cand);	〃密钥个体切分
3 ：	Sub¥itnGss(subkey_cand);	〃计算所有子密钥的适应度函数
4：	gen = 0;
5：	keyjright = 0;
6：	while gen < genjnax	and keyjright =	0 do	〃循环迭代优化
7 ：	Seleciion(subkey_cand);
8 ：	Crossover^ 汕物尸°);
9：	Mutatioii(s"麻纱
10：	SubFitness(subkeycand);
11：	Sort(subkey〃子密钥适应度排序
12：	key_cand = Recombme(subkey_cand); 〃子密钥重组
13：	Fitness(tey_cand); 〃计算完整密钥的适应度
14 ：	Selection(氏y_caM；
15 ：	key optimal_cand = MaxF itii^s(key_cand); //选出最优密钥
16：	gen = gen + 1;
17：	If VertiGc^tion(key_optimaljcand) = true	then
18：	key_optimal = key_optimalyand}
19：	key_right=l;
20：	Endif
21：	end while
22：	if (key_right=Q) then
23：	key_optimal = Sieve(key_optimal_cand);	〃密钥个体筛选
24：	end if
25 ：	return key optimal
81
4.3.4基于遗传算法优化的多字节电磁分析实验结果
0	1000	2000	3000	4000	5000	6000
电磁辐射迹数目
图4-15不同操作算子的性能比较
基于遗传算法优化的多字节电磁分析实验采用同基于粒子群优化算法的多 字节电磁分析实验相同的配置来采集电磁发射迹线以进行实验分析。操作算子是 影响性能的重要因素，所以我们针对不同的操作算子进行了测试。实验结果如图 4-15所示，图中显示了五种不同的方法，分别是CEMA、MBEMAGA、没有排 序算子的MBEMAGA,没有筛选算子的MBEMAGA以及两种算子都没有的 MBEMAGAo从图中可以看出，拥有筛选算子和排序算子的MBEMAGA方法的 性能最好，没有筛选算子的MBEMAGA方法的性能虽然比CEMA的方法要好， 但是其波动性比较大。CEMA方法大约需要6000条电磁发射迹线才能达到100% 的成功率，而MBEMAGA方法和没有筛选算子的MBEMAGA方法大约需要 5000条的电磁发射迹线即可达到100%的成功率。至于其他两种方法，其性能要 比CEMA方法要差一些，在所给出的电磁发射迹线数目下没有正确恢复出密钥。 从图中可以看出，排序算子在性能提升上发挥了重要作用。没有排序算子，子种 群中的密钥候选解将随机进行重组，重组密钥字节之间几乎没有关联，所以其波 动会比较大。
为了突出展现MBEMAGA方法的优越性，我们同样在不同的随机分组的电 磁发射迹线集合上重复进行实验，实验结果如图4-16所示。实验结果显示出相
82
比于CEMA方法，MBEMAGA方法具有比较大的改进。根据配对T检验，它的 产值是5.5X10已在相同的电磁发射迹线数目下，MBEMAGA方法能够实现较高 的成功率。平均来讲，当正确恢复密钥时，CEMA方法所需的电磁发射迹线数目 约为7357±1282条，而MBEMAGA方法大约需要4214±488条电磁发射迹线即 可将密钥正确恢复。在相同情况下，相较于CEMA方法，MBEMAGA方法实现 了 42.72%的改进。无论是从电磁发射迹线数目还是波动情况上，都相比于CEMA 方法有了比较大的改善。
10000
8000
6000
4000
2000
0
1	2	3	4	5	6	7
实验次数
图4・16不同方法成功恢复密钥时所需的最少电磁发射迹线数
表44(A)不同方法的性能对比

密码算法	方法	迹线类别	复杂度量级
AES	CPA[14]	功耗能量迹线	103	—
SGA-CPAD		106	32%
ms-cpa[8]		106	44%
表4-1 (B)不同方法的性能对比
密码算法	分法	迹线类别	复杂度量级
AES	CEMAM	电磁发射迹线	103	—
PSO-CEMA （本文）		104	13.72%
MBEMAGA （本文）		105	42.72%
83
到目前为止，已有文献采用遗传算法来对AES密码算法的密钥恢复进行了 优化,我们在表4-1对比了几种已知的具有代表性方法的复杂度和迹线改进程度, 复杂度的计算方法如式(4-30)所示。
T(N) = O(/(N))	(4 - 30)
其中，/'(N)为相关系数的计算函数之和，N为计算次数。
通过表4-1中对比可知，基于智能算法优化后均较传统相关分析的方法有所 改进，但是也带来了复杂度增加的问题。PSO-CEMA能够用相对较小的复杂度 换来13.72%的迹线数目的减少。相比之下，遗传算法能够在较大程度上减少所 需的迹线数目，改进程度均在30%以上，但是复杂度相较于PSO-CEMA也增加 了至少一个量级，其中MBEMAGA能够比较好的平衡复杂度和成功率，能够在 105的复杂度数量级下获得42.72%的改进。
综上所述，当计算资源受限的时候，可以优先选择基于粒子群优化的电磁分 析；当迹线数量受限而计算资源可以满足的时候，可以优先选择基于遗传算法优 化的电磁分析。
4.4本章小结
本章主要介绍了通过多字节电磁分析来提高信息的利用率，从微观和宏观两 个角度进行了理论分析，并对其进行了实验验证。利用智能算法对电磁旁路分析 进行优化，将密钥的恢复问题转化为密钥的寻优问题，主要分为两个部分：
(1)基于粒子群优化算法的多字节电磁分析。通过粒子群在密钥搜索空间 中的定向移动实现多字节密钥的优化，并对粒子群的速度更新公式和位置更新公 式加以改进，使之更适合密钥的搜索。
(2)基于遗传算法的多字节电磁分析。将遗传算法与多目标分析的结合实 现密钥所有字节的利用，通过将密钥等效为遗传算法染色体上基因，然后经过选 择、交叉和变异的操作进化出最优密钥。除此之外，增加了排序算子和筛选算子 以更高效的方式搜索到最优密钥。
经过实验验证，基于智能算法优化的电磁旁路分析相较于传统的电磁分析方 法均有的不同程度的改善。其中，基于粒子群算法优化的电磁分析采用递进式的 多字节电磁分析，实现了约13.72%的改进；而基于遗传算法优化的电磁分析采 用全覆盖式的多字节电磁分析，实现了约42.72%的改善。虽然基于遗传算法优 化多字节电磁分析相较于基于粒子群优化算法的多字节电磁分析的改善程度较 大，但是与此同时也造成了电磁分析算法复杂度增加的问题。因此，在不同场景 下应考虑使用不同的方式来进行电磁旁路分析。
84
本章参考文献
[1]	Ding G L, Guo Chen L J, et al. Research on difierential electromagnetic analysis for cryptographic systems [J]. Computer Engineering and Design, 2009.
[2]	Zhang P, Deng G, Chen K, et al. Electromagnetic correlation analysis attacks on microcontroller implementations of AES in far field [J]. Journal of Huazhong University of ence & Technology, 2009: 31-34.
[3]	Tiachacht S, Bouazzouni A, Khatir S, et al. Damage assessment in structures using combination of a modified Cornwell indicator and genetic algorithm [J]. Engineering Structures, 2018, 177: 421-430.
[4]	Zhang H, Liang Y Zhang W, et al. Improved PSO-based method for leak detection and localization in liquid pipelines [J]. IEEE Transactions on Industrial Informatics, 2018, 14(7): 3143-3154.
[5]	Zhang Z, Wu L, Wang A, et al. A novel bit scalable leakage model based on genetic algorithm [J]. Secxirity and Communication Networks, 2015, 8(18): 3896-3905.
[6]	Yda B, Ying S C, An W A, et al. Block-oriented correlation power analysis with bitwise linear leakage: An artificial intelligence approach based on genetic algorithms [J]. Future Generation Computer Systems, 2020, 106: 34-42.
[7]张振宾.国密SM4和SM2算法功耗攻击关键技术研究与实现[D].清华大 学,2015.
[8]	Ding Y, Zhu L, Wang A, et al. A Multiple Sieve Approach Based on Artificial Intelligent Techniques and Correlation Power Analysis [J]. ACM Transactions on Multimedia Computing, Communications, and Applications (TOMM), 2021, 17(2s): 1-21.
[9]	Brier E, Clavier C, Olivier F. Optimal Statistical power analysis [J]. http://eprintiacrorg/2003/152? 2003.
[10]	Poli & Kennedy J, Blackwell T. Particle swarm optimization [J]. Swarm Intelligence, 2007: 33-57.
[11]	Kennedy J, Eberhart R. Particle swarm optimization [A]. // Proceedings of ICNN,95-international conference on neural networks [C]: IEEE 1995: 1942-1948.
[12]	Shi 丫 Eberhart R. A modified particle swarm optimizer [A]. // 1998 IEEE international conference on evolutioiiary computation proceedings IEEE world congress on computational intelligence (Cat No 98TH8360) [C]: IEEE 1998: 69-
85
73.
[13]	Sun S, Zhang H? Cui X, et al. Multibyte Electromagnetic Analysis Based on Particle Swarm Optimization Algorithm [J]. Applied Sciences, 2021, 11(2): 839.
[14]	Brier E, Clavier C, Olivier F. Correlation power analysis with a leakage model [A]. // International workshop on cryptographic hardware and embedded systems [C]: Springer 2004: 16-29-
[15]	Ding G L, Chu J, Yuan L, et al. Correlation electromagnetic analysis for cryptographic device [A]. // 2009 Pacific-Asia Conference on Circuits, Communications and Systems [C]: IEEE 2009: 388-391.
[16]	NIST. Announcing the Advanced Encryption Standard (AES) [J]. Fips Pub, 2001, 29(8): 2200-2203.
[17]	Hou S? Zhou Y Liu H, et al. Wavelet support vector machine algorithm in power analysis attacks [J]. Radioengineering, 2017, 26(3): 890-902.
[18]	Srinivas M, Patnaik L M. Genetic Algorithms: A Survey [J]. Computer, 1994, 27(6): 17-26.
[19]	Goldberg D E. Genetic Algorithm in Search, Optimization, and Machine Learning [M]. New Jersey: Addison Wesley, 1989.
[20]王小川.MATLAB神经网络43个案例分析[M].北京：北京航空航天大学 出版社，2013.
[21]雷英杰，张善文.MATLAB遗传算法工具箱及应用[M].西安：西安电子科 技大学出版社，2014.
[22]	Konak A, Coit D W, Smith A E. Multi-objective optimization using genetic algorithms: A tutorial [J]. Reliability Engineering & System Safety, 2006, 91(9): 992-1007.
[23]	Pettersson F, Chakraborti N, Saxen H A. A genetic algorithms based multiobjective neural net applied to noisy blast furnace data [J]. Applied Soft Computing, 2007, 7(1): 387-397.
[24]	Sun S, Zhang H, Dong L, et al. A Novel Multi-Objective Electromagnetic Analysis Based on Genetic Algorithm [J]. Sensors, 2019, 19(24): 5542.
86
第五章 基于迁移学习的电磁旁路硬件木马检测
随着集成电路技术的飞速发展，越来越多的智能硬件出现在人们的生活当中。 与此同时，硬件木马的安全问题也日渐突出，已经成为近些年来研究的热点。现 代集成电路的设计和制造越来越需要全球化、多方合作的制造商产业链的参与， 但这增加了恶意的攻击者在产业链的任何一个部分植入硬件木马的风险。大多数 的硬件木马往往被设计为很小的电路并且保持在休眠状态，对电路的影响可以忽 略不计，直到它们被特定的小概率事件触发才会执行恶意的操作。硬件木马的有 效防御并不是一件容易的事情，传统基于随机测试向量的集成电路结构测试或者 流片后功能测试往往很难有效的检测出硬件木马的存在。旁路分析的出现为硬件 木马的检测开辟了一条新的思路，利用硬件木马电路对原电路造成的旁路信道物 理参数的影响来检测硬件木马的存在。但是基于旁路分析的硬件木马检测所面临 的挑战主要是选择合适的标准黄金电路来进行建模和消除工艺偏差、测量噪声的 影响等。为此，提出了一种结合人工智能的电磁旁路硬件木马检测方法，利用在 海量数据集上表现优秀的神经网络强大的特征提取能力，迁移到硬件木马数据的 检测上提取出最为关键的特征，减少噪声和工艺偏差对有用信息的影响。
5.1	基于密码集成电路的硬件木马研究
传统的出厂检测在大部分情况下基本上是无效的，主要原因是：
（1）硬件木马的形式多种多样，其触发和有效负载能够被设计成不同的样 式，所以对硬件木马的逻辑功能进行建模往往比较困难。
（2）硬件木马是被故意设计为难以触发的状态并且难以观察到其有效载荷, 想要触发并观察到一个未知硬件木马的有效载荷面临着非常大的挑战。
（3）集成电路的工艺偏差使得同批次的集成电路也会出现物理参数的差异, 这些差异能够对硬件木马引起的物理参数差异起到掩盖作用，无法判别偏差的出 现是由于硬件木马还是工艺偏差引起。
旁路分析的方法不同于传统的出厂检测，它利用硬件木马电路对原电路造成 的旁路信道物理参数的改变来检测硬件木马，对于硬件木马的检测具有比较好的 效果。基于旁路分析的硬件木马检测的一般场景如图5-1所示，旁路分析首先是 要拥有一个没有硬件木马的标准黄金电路，然后将采集到的标准黄金电路和待测 电路的电磁发射或功耗等旁路信息进行比对，从而判断是否有硬件木马的存在。
87
图5-1硬件木马一般检测场景
本文中利用电磁旁路信号来进行硬件木马的检测，因为电磁旁路信号不仅包 含丰富的频谱成分，同时还携带有大量的有用信息，能够从不同角度展现硬件木 马所带来的影响。而且电磁旁路分析能够以其非接触的方式捕获到电磁信号，无 需对原始电路做任何修改，更加适合于硬件木马的旁路分析。本章采用电磁旁路 分析平台来进行硬件木马的检测实验，用AES-128密码算法作为基准电路，首 先采集标准黄金电路的电磁发射迹线，然后采集植入硬件木马电路的电磁发射迹 线。实验的主要流程是计算机控制集成电路芯片进行密码算法的加密操作，然后 输入不同的测试向量进行测试。示波器采集芯片在加密过程中的电磁信息，并将 采集到的电磁信号送到计算机中进行后续分析，最后结合人工智能的方法来进行 处理分析，从而检测出硬件木马的存在。
基于旁路分析的硬件木马检测虽然已有较多研究，但都存在一定的不足之处。 文献口］采用逆向工程的方法，利用深度卷积神经网络来检测硬件木马的存在，虽 然检测精度较高，但是逆向工程属于破坏性的方式，并不实用。文献⑵采用支持 向量机的方法对采集到的旁路信息进行硬件木马的检测，虽然不具有破坏性，但 是准确率相对较低。文献［3］虽然利用卷积神经网络的方法对硬件木马的电磁旁 路信息进行检测，但是同样存在准确率相对较低的问题。因此，我们提出一种基 于迁移学习的电磁旁路硬件木马检测方法，通过提取硬件木马电磁发射迹线的时 频信息，从时域和频域两个角度同时入手，利用迁移学习强大的特征提取能力， 对硬件木马的关键特征进行捕获并作为电磁发射指纹用以检测和分类。基于迁移 学习的电磁旁路硬件木马检测方法不仅能够在非破坏的情况下利用电磁旁路信 息检测出硬件木马的存在，同时对于处在非激活状态的潜在硬件木马也能够以较 高的精度检测出硬件木马的存在。该方法对于硬件木马的检测具有指导意义，能 够在硬件木马非激活的状态下检测出其存在，从而减少硬件木马激活后所带来的
88
危害。
5.2	基于密码集成电路的硬件木马检测基础
5.2.1	基于密码集成电路的硬件木马检测
硬件木马检测是应对硬件木马最直接也是最常用的防护手段，其目的是为了 验证集成电路设计加工过程中是否有恶意电路的篡改和加入。硬件木马检测可以 在流片前验证集成电路设计的可信性，也可以在流片后对集成电路进行检验测试, 其主要方式如图5-2所示。
流片前的硬件木马检测多是在设计的行为级代码或者门级网表中进行，其目 的是为了辅助验证第三方IP核及集成电路设计的可信性。常用的流片前检测有 功能验证、形式化验证和HDL设计分析左刀。
图5-2硬件木马检测分类
流片前的功能验证主要是检测硬件设计中几乎用不到的电路，将这些几乎用 不到的电路结构作为特征属性来对硬件木马进行建模和检测。功能验证可以分成 两类：动态检测和静态分析。动态检测主要是对电路进行仿真并找到那些几乎使 用不到的电路结构标记为疑似木马。静态分析主要是对硬件设计进行静态布尔函 数分析，找到没有被使用的电路结构。功能验证的缺点是仍然需要人工分析才能 够进一步确定疑似木马是否为硬件木马。形式化验证是对硬件IP核进行的基于 算法的逻辑验证，把硬件设计转化成可定义的信号属性并对其进行格式校对。形 式化验证的有效性在于所定义的安全属性能否覆盖到硬件木马。对于安全属性之 外的硬件木马，形式化验证难以检测到。比如从第三方购买的硬件IP核，在功 能检测之外，IP供应商不仅需要提供IP设计，还要提供相应的安全属性以供验 证。HDL设计分析一般在行为级代码或门级网表中进行，主要是为了识别硬件 设计语言中是否有多余的声明或者电路结构是否是潜在的疑似木马，同时还能够
89
量化标记硬件设计中翻转概率极低的逻辑门。HDL设计分析的缺点是不能保证 硬件木马被检测到而且常常需要手动处理以确定是否真的为硬件木马。
流片后的检测大致分为破坏性和非破坏性两种电叫破坏性方法主要是利用 化学试剂将密码集成电路芯片表面的封装去掉，然后对其每一层的电路进行拍照, 依据照片进行分析和重建以确定门电路和布线情况。逆向工程法［⑼属于该类破坏 性方法，这些方法能够具有很高的精确度，但是这些方法具有破坏性、成本高、 耗时长，因此并不是特别实用，一般只应用于简单的小型集成电路。非破坏性的 方法不改变设计流程，在流片后的测试阶段对硬件木马进行识别，主要是逻辑测 试和旁路分析。逻辑测试通过生成测试向量来触发硬件木马电路，并观察其对于 输出有效载荷的恶意影响。但是逻辑测试的困难在于需要遍历所有内部节点以激 励所有可能，并观察其对输出的影响。一方面，随着逻辑门数量的增加，难以测 试的节点数也在增加；另一方面，硬件木马一般是以极低的概率被触发，很可能 在逻辑测试中无法观测到恶意的影响。最终，由于众多的硬件木马使得逻辑测试 并不实用。旁路分析主要是基于在集成电路中任意植入的恶意电路都会在某些旁 路信道的物理特性参数上有所改变的事实，例如动态功耗、路径延迟特性、电磁 发射以及多种参数的组合。通常情况下，硬件木马的尺寸比原始设计尺寸要小， 这是因为硬件木马是在生产设计过程中通过修改原始设计的布局而加入的，一般 隐藏在原始设计当中。旁路分析的优势在于不用触发硬件木马就能够检测到硬件 木马的存在，可以避免硬件木马触发后导致的恶意后果，能够通过微弱的旁路信 道所泄漏的物理旁路信息检测到硬件木马。如果工艺偏差能够被校准且测量噪声 也能够被消除，那么硬件木马电路的存在肯定能够被反映到所测量的旁路信道参 数上。利用一个或多个旁路信道的信息来检测硬件木马的存在正逐渐成为一种新 兴的有效方式。
5.2.2	基于密码集成电路的硬件木马电磁旁路泄漏机理
现代集成电路构造复杂和高度分布协作的特点使植入的硬件木马种类越来 越繁多，物理特性也迥异不同，而且其植入环节、触发方式、攻击目标和实现的 恶意功能等都不相同，很难用一种普适的方法将不同种类的硬件木马检测出来吐 ⑶。数字集成电路的硬件木马一般可以通过组合逻辑触发和时序逻辑触发两种方 式来实现口5」6〕。图5-3展示了组合逻辑木马的一般模型，组合逻辑木马选取电路 内部的n个节点，当这些节点都满足某个小概率事件的时候将触发木马，然后有 效载荷将造成电路的错误。图5-4展示了时序逻辑木马的一般模型。时序逻辑木 马在每一个状态转换之后，如果没有相应的下一个激活向量引导有限状态机向下
一个激活状态转换，那么有限状态机将回到初始状态，使得激活向量重新输入。 在实际应用中，触发节点可以是随机的电路内部节点，也可以是可访问的寄存器 等逻辑单元。
图5-4时序逻辑触发木马
硬件木马电路在功能上可以分为触发逻辑和有效载荷两部分。触发逻辑主要 负责控制硬件木马电路是否处于闲置状态，在触发逻辑被激活之前，木马电路对 原始电路功能没有任何影响。在木马被激活之后，有效载荷将执行木马对原始电 路功能的恶意操作，比如泄露敏感信息或者降低性能等口7，间。硬件木马一般隐藏 在电路中小概率节点状态的集合中或者小概率事件的序列中从而逃避流片后的 集成电路测试。硬件木马不可避免的会造成电路引入面积、功耗和性能等方面的 额外开销，这为旁路分析等检测方法提供了依据。所有的旁路分析方法都需要观 察植入的硬件木马对物理参数的影响，即使木马电路在测试期间没有在电路中引 起能够观察到的现象，但是存在的额外电路也会影响到一些旁路信道参数。
我们在第三章中提到CMOS反相器是数字集成电路的基本单元，CMOS反 相器的电流变化包括静态电流和动态电流。因植入的硬件木马而在电路中存在的
91
额外逻辑会改变电流的特性，消耗额外的静态电流。静态电流具有可加性，可以 用于区分硬件木马电路和标准黄金电路。当测量数百万门级的集成电路的总漏电 流的时候，对于由额外几个逻辑门产生的漏电流效应是比较微弱的，仅从漏电流 的角度来进行检测效果会非常差。当硬件木马被激活时，集成电路的动态电流会 发生比较明显的改变从而增加硬件木马的的检测灵敏度。相较于静态电流，通过 动态电流的变化来检测硬件木马的效果要好一些。
由麦克斯韦第一方程可知，任何电流的变化都会产生相应的时变磁场。因此， 可以通过观察集成电路的电磁发射在非侵入的方式下检测到电路中额外的逻辑 门13〕。参考第三章电磁旁路建模的内容，我们同样也可以采用类似的方法对硬件 木马的电磁发射进行建模，此处详细过程不再赘述。针对不含硬件木马的标准黄 金电路，在时刻/所捕获到的电磁发射信号为EMG(t),其成分主要包括标准黄金 电路运行密码算法时的电磁发射EMg(t),工艺偏差而导致的电磁发射EMp(t)以及 测量噪声EMn(t)[i9,23,因此可以建模为
EMg (t) = EMg (t) + EMp ⑴ + EMM	(5 - 1)
对于包含额外模块的硬件木马电路，所捕获的电磁发射信号可以建模为
EMtQ) = EM。⑴ + EMp ⑴ + EMn(t) +	(5-2)
其中，EMt⑴为硬件木马模块所引起的电磁发射。
一般情况下，测量噪声EMn(t)是一个随机过程，随时间的变化而不尽相同。 依据大数定律可知，当对捕获的大量电磁发射迹线进行平均操作的时候，标准黄 金电路的测量噪声E%(t)和硬件木马电路的测量噪声EMn(t)近乎相等，加之滤波 去噪的操作，可以将测量噪声的影响控制在极低的水平，因此可以忽略测量噪声 的影响。所以，上述两个模型便简化为
EMg ⑴=EMg (t) + EMp ⑴	(5 - 3)
EMt (t) = EMg ⑴ 4- EMp(t) + EM, (t)	(5 - 4)
由于工艺偏差的影响，在时域上对硬件木马的电磁发射信号进行区分存在一 定的困难，因此需要对所采集到的电磁发射信号进行空间变换，使之转换到另外 一个空间中提取电磁指纹后再将EMg⑴、EMp(t)、EMt⑴区分开。例如，将时域空 间中的电磁发射信号转换到频域空间中，利用频域的信息来对硬件木马进行区分。 其中，工艺偏差一般不会对电磁发射信号的频谱分布产生影响，所以工艺偏差项 的影响可以忽略不计，则式(5-4)在频域中的表达式如式(5-5)所示。
介(3)=%(3)+京 3)	(5-5)
92
从式（5-5）可知，频域中含有硬件木马电路的电磁发射方3）主要包含标准 黄金电路部分的电磁发射为3）和硬件木马电路的电磁发射正3）。一般而言，标 准黄金电路和硬件木马电路所引起的电路差别往往工作在不同的频率，其频谱分 布往往不同，可以用于电磁发射信号的硬件木马检测。
综上所述，针对硬件木马检测单一域空间信息不足的问题，可以通过空间变 换来获取更多的信息，结合多种空间不同的信息来对硬件木马进行检测以提高分 类检测效率。
5.3	基于迁移学习的电磁旁路硬件木马检测框架
5.3.1	迁移学习概述
机器学习是让计算机从数据中归纳出一个通用的模型并用于预测新数据，为 新问题的求解提供新的思路。而迁移学习隶属于机器学习，主要是通过在其他领 域中学习到的知识迁移到新的领域中，以提高解决新问题的能力和速度。迁移学 习的主要思想是利用数据、任务或模型之间的相似性，将在源域学习过的模型和 知识应用于目标域〔2D,其基本模型示意图如图5-5所示。
图5-5迁移学习示意图
迁移学习的定义是利用在源域。s学习的任务或知识我的帮助下改善目标域 力的学习任务或知识方的预测函数的性能方（・）。其中，0s H 2，①。北。除此 之外，在大多数情况下0s的大小要远大于。t。
93
相较于传统机器学习，深度学习对海量训练数据的依赖性特别强，从而能够 发现数据中隐藏的特征。在某些领域训练数据不足是不可避免的问题，而迁移学 习不再要求训练数据和测试数据满足独立同分布的要求，可以在目标域中从源域 训练好的网络模型开始训练，因此可以减少网络在目标域中的训练数据和训练时 间。迁移学习放宽了训练数据与测试数据的限制，同时又能获得比较好的性能, 这促使我们使用迁移学习来解决某些领域中训练数据不足的问题。
5.3.2	基于卷积神经网络的迁移学习
卷积神经网络(Convolutional Neural Networks, CNN)因在网络中使用卷积 运算而得名，已经在图像处理、语音识别、自然语言处理等众多领域中取得了巨 大成功0〕。VGG-16网络是2014年提出的一种深度卷积神经网络模型，并在 ImageNet比赛中取得了 92.7%的top5测试准确率的优异成绩囱。VGG-16网络 的最大特点是结构简单，利用固定大小的卷积尺寸和池化尺寸，通过卷积层和池 化层的堆叠来加深神经网络的结构从而提升性能。
X1OS
E4AUOU
华 s AUOU NSAUO5 工 AuaI
图5-6 VGG-16网络结构
VGG-16网络的基本结构如图5-6所示，主要是由卷积层、池化层、全连接 层和softmax层堆叠而成。其主要特点是小卷积核、多卷积层、小池化核和多通 道数。
(1)卷积层(Convolution, Conv)
卷积操作是卷积神经网络中最为关键的部分，卷积层主要进行的操作是卷积, 卷积核按照固定步长滑动，并将卷积后的值作为样本输出值，其过程如图5-7所 示，对于二维矩阵的输入/和一个二维的卷积核K进行卷积操作得到输出操作矩 阵的数学表达式为
S(iJ) =。*	= 2 W	- m,j - n) (5 - 6)
m n
其中，i, /和m,几分别为相应矩阵的行数和列数。
94
卷积操作体现了稀疏连接和参数共享的特性，每层神经元都共用一个卷积核 参数与部分上层神经元相连接。
VGG-16网络中卷积层的卷积核大小为3x3。
1,	0	0
Qo	互		1	0
0 xO	1,	1	1
0	0	1	1	0
0	1	1	0	0
4	3	4
2	4	3
2	3	4
图5-7卷积操作示意图
(2)池化层(Pooling)
池化层主要是对卷积后的特征再进一步压缩，通过降采样操作在保留主要特 征的同时去除冗余信息从而降低计算量。常用的池化操作主要是最大池化和平均 池化。以最大池化为例，其池化操作如图5-8所示，取按照固定步长滑动的池化 核所在区域内的最大值作为采样后的输出样本值。VGG-16网络中用的是2x2的 最大池化。平均池化主要是将池化核所在区域内的特征值取均值后作为采样后的 输出样本值。
图5-8池化操作示意图
(3)全连接层(Full Connect, FC)
全连接层属于全局操作，对所有的输入特征进行加权组合后输出从而实现对 全局特征的提取。全连接层的每一个神经元都会与上层所有的神经元进行连接, 每个连接都会有一个权值，同层神经元之间没有任何连接。全连接操作的示意图 如图5-9所示。
95
图5-9全连接操作示意图

(4) Softmax 层
VGG-16网络使用的区分器是softmax函数，它将任意真实值转换为样本概 率，这通常对机器学习非常有用。它对"维输入X=［x/,X2,…，对执行以下变换
其中，e为自然常数。
Softmax区分器的输出总是在［0, 1］的范围内并且总和为1。因此，它们形成 了一个样本概率分布。最大样本概率被视为预测输出。Softmax区分器用概率 来回答分类问题，更具有说服力。
VGG-16网络是通过在ImageNet等庞大的数据集上训练模型而获得的，这 些学习到的参数能够为网络提供了出色的特征提取能力，拓展性比较强，迁移到 其他数据上的时候泛化性能比较好，而且结构简单，因此可以用于提高硬件木马 检测时的分类性能，通过对全连接层的修改使之符合硬件木马分类的情况。
VGG-16网络的输入是固定的224 X 224的二维图像，而原始的电磁发射信 号是一维信号，因此我们需要通过变换将其转换成二维图像，并且调整输入图像 的大小，使之满足VGG-16网络的输入。通过522节的理论分析可知通过电磁 发射信号的时域信息和频域信息能够有效的检测出硬件木马的存在，而时频图将 信号的时域信息和频域信息有机的结合在一起，因此考虑将电磁发射信号经过时 频分析之后的时频图作为VGG-16网络的输入。
5.3.3	基于小波变换的时频分析
时频分析是一种处理时变非平稳信号的技术，主要研究的是信号的频谱随时 间变化的关系，提供了时域与频域的联合分布信息［2旬。小波变换是对傅里叶变换
96
的改进发展而来的一种有效的时频分析方式，傅里叶变换在信号处理领域中应用 广泛，但是傅里叶变换损失了时间信息，在时域中没有分辨能力［25-2刀。然而时域 信息在某些问题中依然具有重要的作用，小波变换可以很好地解决信号在时域和 频域的分辨能力问题。小波变换拓展了信号的傅里叶变换，通过小波基函数的变 换来分析信号中所蕴含的局部特征，在二维情况下能够对信号的方向进行选择, 从而获得了广泛的应用。
小波变换是由某一基本小波函数g(t),也称母小波函数，经过平移T后，然后 在不同的尺度S下与待分析的信号,此处为电磁发射信号进行内积操作。
WT?Q, s) =|j EM(t)W	dt	(5 - 8)
其中，T是控制小波位置的时域平移；S是控制小波宽度的尺度参数。
图5-10小波变换时频分辨率示意图
小波变换的一个重要特点就是多分辨率分析［2叫如图5-10所示。小波变换 对时域分辨率和频域分辨率进行了权衡，在不同的频段拥有不同的分辨率；在时 间相关特征感兴趣的尺度上，它在时域中具有高分辨率，而在频率相关特征感兴 趣的尺度上，它在频域中具有高分辨率。因此，通过小波变换能够更好的获取到 信号中所包含的重要信息。
连续小波变换(ContinuousWaveletTransfbnn, CWT)是原始信号与母小波 函数”(t)乘积后积分的过程〔2叫莫尔斯小波可以有效地将所有其他类型的常用分 析小波包含在一个统一的家族中，能够呈现出多种形式即⑶］。因此，使用莫尔斯 小波作为母小波函数比将所有这些其他类型的函数放在一起提供了更大的灵活 性。此外，简单的频域形式意味着可以很容易地推导出关键属性的解析表达式,
97
因此它被用作母小波函数来对采集到的电磁发射信号进行分析。莫尔斯小波的数 学表达式为
M⑴=，	修3y x do） （5 - 9）
J-8
其中，H（3）为赫维赛德阶跃函数，3为角频率，参数£为阶数，控制低频行为, 而参数Y为族，控制高频衰减。
对于硬件木马的电磁发射信号，我们可以通过连续小波变换将时域的电磁发 射信号转换到时频域当中，然后再进行区分。如果硬件木马的电磁发射信号 EMNt）在时频域的表达式为St0,s）,那么通过连续小波变换可以得到
ST（J. S）= Sg（t, s） + SP（T, s） 4- St（t, s）	（5-10）
其中，Sg（T,S）为标准黄金电路部分电磁发射的时频分量，Sp（T,S）为工艺偏差所引 起电磁发射差异的时频分量部分，Sf（T,S）为硬件木马电路部分所引起的电磁发射 时频分量。
依据上式来进行硬件木马电磁发射指纹的构建，根据电磁指纹的差异来进行 硬件木马的检测区分。工艺偏差并不会对电磁旁路信息的频谱成分产生影响，因 而可以忽略其影响。当集成电路中存在硬件木马的时候，硬件木马会引入新的时 频分量Sf（T,S）;如果引入的时频分量和标准黄金电路的时频分量相同，则在时 频图中二者会出现叠加现象；如果引入的时频分量和标准黄金电路的时频分量不 同，则在时频图中会出现新的成分。通过连续小波变换，既能实现对频域信息的 有效利用，同时又没有损失掉时域信息。
图5-11硬件木马电磁发射时频图
98
通过电磁旁路分析实验平台所捕获的硬件木马电磁发射信号的时频图如图 5-11所示。时频图是作为时间和频率的函数绘制的连续小波变换的绝对值。其中， 横轴表示时间，纵轴表示以对数刻度绘制的频率，通过改变颜色或亮度来显示系 数值。电磁指纹在时域和频域的变化能够在同一幅时频图中获得。
除此之外，CWT还可以看成是一个滤波的过程，仅允许原始时域信号中与 尺度变换后的小波中心频率相近的信号成分通过。其主要思想是通过选定一个中 心频率，然后经过尺度变换和时移得到一系列不同中心频率不同区间的母小波函 数，再分别同原始的时域信号相对于母小波函数区间的某一段进行乘积后积分, 在原始时域信号的固有频率上会有极值出现，极值所对应的频率就是时域信号在 该区间上所包含的频率。可以将其理解为原始时域信号通过不同的高通滤波器和 低通滤波器，过滤掉信号中的低频或高频部分。这个过程会重复很多次，每次都 会从信号中去除对应于某些频率的某些信号部分。因此，经过CWT处理后，电 磁信号中的噪声会更少。
5.3.4	支持向■机区分器
图5-12支持向量与间隔
支持向量机的主要思想是找到一个分类超平面最大化的分隔正负样本的边 缘[32,33],如图5-12所示。这个分类超平面可以通过下式(5-11)来表达
wT - x + b = 0	(5 - 11)
其中，W =(W1，W2,…,Wd)是超平面的法向量；X是输入样本；b是位移项。
如果训练样本是线性可分，能够被超平面正确的分隔开，则有
货+廿+1, %=+1
+ b4一1,	% = -1
99
其中，%是输入样本的标签。使上式中等式成立并且距离超平面最近的样本点被
称为支持向量，两个不同类别支持向量间的垂直距离称为间隔，其值为y =言。 llwll
超平面欲要最大化间隔可等效转化为
1
min 21Mli2	6 — IB)
s.t. + Z>) > 1
利用上式所求得的超平面划分最大间隔的数学模型为
f(X)= wT - x + b
(5 - 14)
因为无法保证超平面在样本空间中能将所有不同标签的样本完全划分开，所 以允许支持向量机在某些样本上出现差错。为此，在式(5-13)的基础之上引入 松弛变量£。
min
s.t.
m
|||W|12 + C^£Z i=l + 6) > 1 -£j > 0
(5- 15)
其中，C为惩罚系数。
超平面的寻找可以视为是一个二次规划的问题，但一个更高效的方法是通过 添加拉格朗日乘子心,由得到其对偶问题来进行求解。其拉格朗日函数为
m
m
r , ,	、 II w II2
L(w, b, a, £, 〃)= --- +
M
W(C -%)与 + { ai(
1. — £1 — %(卬,勺 + 6))(5 — 16)
i=l

其中，> 0, Hi > 0 =
在满足KKT的条件下，对L(w,力,的w, b, £求偏导并令其为0可得
rdL(w,b,a,£,fi)
dw
=w- ) a^Xi = 0
m
w = 2 atytXi
dL(w,b,a, £, 〃)

db dL(w,b,a,£,fi)
mwi=lc
= 0 =
二C 一/一出二0
将上式结果代入公式(5-15)可得
100
m 1mm
max 2修一,W 2 %为%才无『勺
i=l	i=i J=1
3	(5-18)
s.t. 2,佐％ = °
04由(C,i = 1,2, ...,m
对于上述过程，需满足KKT (Karush-kuhn-Tucher)条件
q > 0,出 > 0
为”修)-1 +，>0
%(%〃修)-1 + 幻=0	3	)
V£i > 0,出与=0
如果训练样本是非线性的，也许找不到一个超平面能将其正确的分隔开，此 时需要利用核函数进行特征空间的变换，将非线性分类转换成线性分类问题。也 就是假设原空间汇到新空间冗的映射函数为。@)，那么对于任意的M，XjSX存 在核函数K(x”功满足
K(爸,Xj)=43)70(/)	(5 - 20)
常用的核函数主要有以下几种MP】：
(1)线性核函数：
K(Xi, Xj) = x^Xj	(5 — 21)
(2)多项式核函数：
Kg 可)=(&『/. + r)d,A > 0	(5 — 22)
其中，a、r、d均为核函数参数。
(3)高斯核函数：
= exp(一用看一可『),4 > o	(5 — 23)
(4) Sigmoid 核函数：
K(xbXj) = tanh(双/芍• + r)	(5 — 24)
一般情况下，对于硬件木马的检测分类，我们事先无法确定经过哪个核函数 的映射之后会是线性可分，所以需要依据电磁发射指纹的特性选取合适的核函数。 在实际情况中，如果样本的特征维度比较大，则首选考虑使用线性核函数进行映 射。如果线性核函数的效果不理想，则考虑使用高斯核函数进行映射，然后再考 虑使用其余核函数映射；如果样本的特征维度不是很大，一般首先尝试高斯核函
101
数进行映射。除此之外，对于更为复杂度问题，核函数还可以通过以上几种核函 数经过数学运算组合而得到。
支持向量机的决策函数为
m
/(X)= W i=l
aiytKQx, x£) 4- b
(5 - 25)
综上所述，支持向量机采用结构风险最小化的原则，同时兼顾经验风险；而 卷积神经网络采用经验风险最小化原则，因此使用支持向量机作为分类区分器相 对于标准卷积神经网络具有更好的泛化能力。故将VGG-16网络的softmax层替 换为SVM层来进行硬件木马的检测，并将该网络称之为CNN+SVM网络，其网
络结果如图5-13所示。
K
—HP— 憎ld
AISI5
二 Auoul
Irnood 事I>jlgilol 甲 A=laI I4IAU05
MLEiood
E—s £05
AuluI


图5-13 CNN+SVM网络结构
53.5基于迁移学习的电磁旁路硬件木马检测框架
输出
SYM/softmax
木 马 检 测
信号处理
图5-14硬件木马检测框架
102
日常生活中的很多数码设备都是由集成电路组成的，比如手机、电脑、U盘 等。这些设备存在被植入硬件木马的风险，可能会导致信息的泄露或其他难以想 象的后果。因此，我们提出了一个硬件木马检测的框架来规避风险。硬件木马检 测框架如图5-14所示。主要有三个步骤：信号采集、信号处理和木马检测。
(1)信号采集
信号采集阶段所利用的信息为旁路信息，包括时间、功耗、电磁发射和声音 等不同类型，可以通过对旁路信息进行分析以推断设备内部的状态。电磁旁路分 析是一种很有前途的方法，由于其高效、非接触和高精度的优点在实践中得到了 广泛的应用。电磁发射信号的测量可以通过天线或近场电磁探头来获得。
(2)信号处理
信号处理阶段，运用连续小波变换将采集到的一维电磁发射信号转换成二维 时频信号并进行电磁发射指纹的提取，充分利用硬件木马电磁发射指纹的时域和 频域信息来进行检测。除此之外，连续小波变换也可以看作是一个滤波的过程， 执行时间局部化滤波。时域信号通过不同的高通滤波器和低通滤波器后，信号的 部分高频或低频成分会被滤除。这个过程重复多次，每次都从信号中移除某些频 率成分的信号。因此，经过连续小波变换处理后，硬件木马的电磁发射信号中的 噪声会更少。
(3)木马检测
在木马检测阶段，迁移学习被用来进行硬件木马电磁发射指纹的检测，利用 深度学习在海量数据集上所学到的强大的特征提取能力来对硬件木马的物理特 性进行识别并排除冗余信息的干扰。在迁移学习中使用了两种区分器：softmax区 分器和SVM区分器。先冻结VGG-16网络的部分参数，利用VGG-16网络对硬 件木马的电磁发射时频信号进行指纹特征的提取，然后再输送到区分器中进行硬 件木马的检测分类，最后将分类结果输出。
5.4电磁旁路硬件木马检测分析
5.4.1	电磁旁路硬件木马检测预备实验
密码集成电路在执行不同操作时其电路往往是不同的，所利用的逻辑门数量 一般也是不同的，因此所泄漏的电磁发射信号往往也是不同的，这为硬件木马的 分类检测提供了依据。为了验证该依据的准确性，我们在密码集成电路中设计了 四种不同的算术运算，分别为：加法运算、减法运算、乘法运算和除法运算。在 密码集成电路中仅运行上述四种简单的算术运算，没有其他复杂操作的情况下， 采集四种算术运算工作状态时所泄漏的电磁发射信号，并进行简单的信号去噪等
103
预处理来提取其电磁发射指纹，然后利用支持向量机对四种电磁发射指纹来进行 分类检测。将采集到的电磁发射信号随机分成不同的集合，在每个集合上重复相 同的操作，所得实验结果如表5-1所示。
表5-1算术运算不同集合的分类准确率
实验集合	1	2	3	4	5	6
分类准确率	92.3%	90.6%	91.9%	90.6%	90.2%	91.7%
平均准确率	91.2%
通过表5-1可知，四种算术运算的电磁发射指纹分类准确率均在90%以上, 平均准确率为91.2%。说明密码集成电路的不同算术运算可以通过电磁发射指纹 区分开，同时也说明不同操作的电磁发射信号也是不同的，因此，通过电磁发射 指纹可以对硬件木马进行检测和区分。
5.4.2	电磁旁路硬件木马设计与检测
Trust-Hub网站提供了一系列的硬件木马电路基准，旨在提供一个交流的平 台来促进硬件安全可信领域的发展和评估技术，目前已经广泛地被工业界和学术 界的相关研究人员认可和应用的。设计者可以参考该网站所提供的硬件木马基准 电路的实现方式，应用于自己的设备当中来验证硬件木马检测方法的有效性。针 对AES基准电路，该网站提供了 22个基于FPGA实现的硬件木马。这些硬件木 马大致可以划分为两类，其中19个属于敏感信息的泄露，其他3个属于耗尽电 池电量以降低性能。
基于上述两类基本电路，本文利用触发式硬件木马设计了同样的两种不同类 型的硬件木马电路来进行检测。将耗尽电池电量来降低性能的硬件木马称为T1, 将泄露敏感信息的硬件木马称为T2。
根据触发式硬件木马的情况，可以划分为三种状态：
（1）标准黄金电路：密码集成电路中没有硬件木马。
（2）硬件木马未触发：FPGA板包括标准黄金电路和木马电路，但硬件木 马的触发部分并未起作用。
（3）硬件木马激活：FPGA板包括标准黄金电路、木马电路，其中硬件木马 的触发部分激活有效载荷执行恶意功能。
针对硬件木马的不同状态，可以将硬件木马划分为5类：
（1）标准黄金电路状态：标准黄金电路中没有植入硬件木马，所泄漏的电 磁发射信号仅由标准AES加密算法所涉及的逻辑门导致，称此时的状态为T0。
104
(2)降低性能木马的未触发状态：标准黄金电路中植入了降低性能的硬件 木马，但是硬件木马尚未触发，所泄漏的电磁发射信号由标准黄金电路和未触发 部分的硬件木马的逻辑门导致，称此时的状态为T10。
(3)降低性能木马的激活状态：标准黄金电路中植入了降低性能的硬件木 马，并且硬件木马激活，有效载荷部分发挥作用，耗尽电池电量来降低性能，所 泄漏的电磁发射信号由标准黄金电路和已激活部分的硬件木马的逻辑门导致，称 此时的状态为T11。
(4)信息泄露木马的未触发状态：标准黄金电路中植入了敏感信息泄露的 硬件木马，但是硬件木马尚未触发，所泄漏的电磁发射信号由标准黄金电路和未 触发部分的硬件木马的逻辑门导致，称此时的状态为T20。
(5)信息泄露木马的激活状态：标准黄金电路中植入了敏感信息泄露的硬 件木马，并且硬件木马激活，有效载荷部分发挥作用，敏感信息被泄露，所泄漏 的电磁发射信号由标准黄金电路和已激活部分的硬件木马的逻辑门导致，称此时 的状态为T21。
针对上述5种不同情况下的硬件木马电路，将其在密码集成电路电磁旁路分 析实验平台上实现，并对其电磁发射信号样本进行捕获和存储，依据硬件木马检 测框架的流程对所采集到的电磁发射信号进行处理。
5.4.3	电磁旁路硬件木马检测评价标准
目前，对于硬件木马的检测还没有统一有效的评估标准，常用的性能评价标 准有：准确率(Accuracy)、精确率(Precision)、召回率(Recall)等⑼。所涉及 到的指标的具体含义如下：
前提假设：对于所要预测的状态T的硬件木马称之为阳，其他非T状态的 硬件木马称之为阴。
真阳性(TruePositive, TP)：预测为阳，实际也为阳的样本个数。
假阳性(False Positive, FP)：预测为阳，实际为阴的样本个数。
真阴性(TrueNegative, TN)：预测为阴，实际也为阴的样本个数。
假阴性(FalseNegative, FN)：预测为阴，实际为阳的样本个数。
真阳率(True Positive Rate, TPR)：真阳性样本个数与实际阳性总数的比率。 假阳率(False Positive Rate, FPR)：假阳性样本个数与实际阴性总数的比率。 真阴率(TrueNegative Rate, TNR)：真阴性样本数与实际阴性总数的比率。 假阴率(False Negative Rate, FNR)：假阴性样本数与实际阳性总数的比率。 准确率：预测正确的硬件木马样本个数与硬件木马样本总数之比。
105
TP + TN
Accuracy = —————— x 100% 」TP + TN + FP + FN
(5 - 26)
精确率：预测为真阳性的硬件木马样本个数中实际为阳性的硬件木马样本所 占的比例。
TP
Precision = 7「十刖 x 100%	(5 — 27)
召回率：预测为真阳性的硬件木马样本个数与实际为阳性的硬件木马总数之 比。
Recall = —^― X 100%	(5 - 28)
1	r n- r/V
上述各个指标一般可以通过混淆矩阵来同时进行表达，以可视化的形式展现 分类结果的各项指标，不仅简洁高效，而且方便明了。
除此之外，在深度学习的训练过程中，损失函数(Loss fimction,亦简称Loss) 是用来度量模型预测错误程度大小的一个重要指标，刻画的是预测输出与实际输 出之间的距离，是一个非负实值函数。损失函数值越小，说明模型的鲁棒性越好， 预测越精准。
5.4.4电磁旁路硬件木马检测结果
采用预训练的VGG-16网络作为基本模型并重新训练参数进行迁移学习的 检测分类，将VGG-16网络在ImageNet数据集上训练所获得的网络参数迁移到 硬件木马的检测中对硬件木马的特征进行深度提取和分析，实验是在服务器的 MATLAB平台上实现的,配有一块GeForce GTX1080的GPU,运行内存为64GB, 中央处理器为Intel Xeon E5-2620o实验中训练数据是由电磁旁路分析实验平台 获得，5种不同状态的硬件木马分别作为5种类别的标签，针对每一类的硬件木 马分别采集了 10000条电磁发射迹线，然后随机选择80%的电磁发射迹线用于 训练集，15%的电磁发射迹线用于验证集，其余的电磁发射迹线用于测试集。 VGG-16网络的批量大小设置为32,学习设置率为0.00001,最大的epoch设置 为15。为了保持通用性和避免过拟合，数据在每个epoch之后会重新打乱。
迁移学习过程中的训练集分类准确率和验证集分类准确率如图5-15所示。 随着epoch的增多，分类准确率都在逐渐升高。迁移学习可以在几个epoch后以 较高的分类准确率达到稳定的水平，因此，就不会在数据的训练步骤上花费太多 时间。图5-16中还给出了训练集损失和验证集损失。随着epoch的增加，损失值 不断减少。经过几个epoch之后，验证集的损失达到稳定状态。
106
o o
o 9
(％)AJc5un2v
6	8	10	12	14
Epoch
80
2
0.2
图5-15训练集和验证集的分类准确率
0.4
0.1
2	4	6	8	10	12	14
Epoch
—— Training Set
Validation Set
图5-16训练集和验证集损失
迁移学习在测试集上的混淆矩阵也在图5-17中给出。混淆矩阵中的行对应 于预测的输出类，列对应于真实的目标类。对角线单元格表示正确分类的硬件木 马状态，非对角线单元格是错误分类的硬件木马状态。其中，有499条标记为T0 的电磁发射指纹分类正确。这对应于所有2495条电磁发射指纹中的20%。其他 标记为T10、Til、T20、T21的电磁发射指纹分别被正确分类的准确率为20%、 19.9%、16.7%、14.3%。从混淆矩阵中可以看出，有1条标记为T11的、2条标 记为T20的、2条标记为T21的电磁发射指纹被错误地归类为TlOo有81条T20 的电磁发射指纹被错误归类为T21,有140条T21的电磁发射指纹被错误的归类 为 T20。
混淆矩阵的最右边一列显示了预测属于每个类别的所有样本被正确和错误 分类的百分比。它们通常被分别称为精度和错误发现率。在预测为T0的499条
107
电磁发射指纹和预测为T11的496条电磁发射指纹均被正确分类。在预测为T10 的505条电磁发射指纹中，99%是正确的，1%是错误的。在预测为T20的557条 电磁发射指纹中，74.9%是正确的，25.1%是错误的。在预测为T21的438条电 磁发射指纹中，81.5%是正确的，18.5%是错误的。
预测输出
混淆矩阵
T0
T10
T11
T20
T21
499 20.0%	0 0.0%	o 0.0%	0 0.0%	0 0.0%	100% 0.0%
0 0.0%	500 20.0%	1 0.0%	2 0.1%	2 0.1%	1.0%
0 0.0%	0 0.0%	496 19.9%	0 0.0%	o 0.0%	0.0%
0 0.0%	0 0.0%	0 0.0%	417 16.7%	140 5.6%	74 9% 25.1%
0 0.0%	0 0.0%	0 0.0%	81 3.2%	357 14.3%	81.5% 18.5%
100% 0.0%	100% 0.0%	99.8% 0.2%	83.4% 16.6%	71.5% 2S.5%	SO.S% 94%
Q M /
目标类别
图5-17混淆矩阵
混淆矩阵的最底下一行显示了属于每个类别的所有样本被正确和错误分类 的百分比。它们通常分别称为召回率和假阴性率。在T0的499条电磁发射指纹 和T10的500条电磁发射指纹中，它们都被正确分类。在T11的497条电磁发 射指纹中，99.8%被正确预测，0.2%被预测为T10。在T20的500条电磁发射指 纹中，83.4%被正确预测，16.6%被错误预测。在T21的499条电磁发射指纹中， 71.5%被正确预测，28.5%被错误预测。矩阵右下角的单元格是整体的分类准确 率，表明在所采集的5类硬件木马中90.9%的硬件木马被正确预测分类，只有9.1% 被错误分类成其他类别。
混淆矩阵还表明降低性能硬件木马的T10类和T11类能够以较高的分类准 确率检测分开。这意味着，当耗尽电池电量来降低性能的硬件木马被激活时，与 硬件木马尚未触发状态的电磁发射指纹有较多的差异存在。而针对敏感信息泄露 硬件木马的T20类和T21类中有部分被错误分类。这是因为泄露敏感信息的硬 件木马当中，尚未触发状态和激活状态的硬件木马电路之间只有微小的区别。因 此，电磁发射指纹的变化很小，彼此可能会被错误分类。
108
除此之外，如果只考虑是否感染硬件木马，即标准黄金电路TO和硬件木马 感染电路T10、TH. T20、T21两类，所提出的方法可以将其完全区分开。如果 考虑三种不同类型的硬件木马，即标准黄金电路TO、降低性能的T1型硬件木马 电路T10或T11和泄露敏感信息的T2型硬件木马电路T20或T21,所提出方法 依然能够将其正确识别，准确率高达99.8%。
为了比较不同方法的性能，我们使用了支持向量机、卷积神经网络、迁移学 习和CNN+SVM对五种不同状态下的电磁发射指纹进行了分类，实验结果如表 5-2所示。从表中可知，支持向量机的硬件木马检测最高只能获得71%左右的分 类准确率,而且不同核函数的支持向量机分类准确率波动程度比较大。通过CNN 网络在9个epochs之后可以获得90.5%的更高的准确率，迁移学习在6个epochs 之后获得了 90.9%的准确率，用较短的时间获得了同CNN 一样级别的准确率。 经过卷积神经网络提取特征之后再利用不同核函数的支持向量机进行分类，其结 果相较于卷积神经网络和支持向量机均有不同程度的提升，进一步改进了分类结 果，其中Sigmoid核函数的分类准确率最高，在迁移学习的基础上分类准确率又 提升了 3.1%,达到了 94%的分类准确率，而且不同核函数的CNN+SVM的分类 准确率波动程度小，比较稳定。综上可知，卷积神经网络具有较好的特征提取能 力，迁移学习能够较好的平衡训练时间和输出分类准确率之间的关系，用更短的 时间获得更好的分类准确率。
表5-2不同方法的分类准确率
分类方法	准确率（％）
SVM （线性核）	60.5
SVM （多项式核）	66
SVM （高斯核）	62.5
SVM (Sigmoid核)	71
CNN (9 epochs)	90.5
迁移学习（6epochs）（本文）	90.9
CNN+SVM （线性核）（本文）	92
CNN+SVM （多项式核）（本文）	91.4
CNN+SVM （高斯核）（本文）	92.6
CNN+SVM （Sigmoid核）（本文）	94
注：SVM的方法借鉴于文献［2］, CNN的方法借鉴于文献口］。在此基础之上 发展出本文中迁移学习和CNN+SVM的方法应用于硬件木马的检测。
109
5.5本章小结
硬件木马正在逐渐成为密码集成电路一种严重的威胁，为了掌握硬件木马的 特性，本章分析了硬件木马电磁泄漏机理，设计了敏感信息泄露和降低性能两种 硬件木马，并在此基础之上提出一种基于迁移学习的电磁旁路硬件木马检测框架, 将迁移学习引入到密码集成电路的硬件木马检测当中，利用迁移学习从源域学习 到的知识迁移到目标域，在同等准确率下节省训练时间和解决数据不足的问题。 通过连续小波变换对采集到的原始电磁发射信号进行处理，获得其时频信息并对 时频信息提取电磁指纹然后进行检测分类。同时还提出了一种将迁移学习和 SVM相结合的方式来进一步改善检测分类效果，称之为CNN+SVM网络，通过 将迁移学习的卷积神经网络的区分器替换成SVM区分器来进行分类检测，利用 卷积神经网络来提取硬件木马的电磁发射指纹差异，SVM对其进行检测区分， 从而实现了更好的分类效果。
110
本章参考文献
[1]	Sharma R, Rathor V S, Shanna G, et al. A new hardware Trojan detection technique using deep convolutional neural network [J]. Integration, 2021, 79: 111.
[2]苏静.基于分类决策的侧信道硬件木马检测方法研究[D].天津大学,2017.
[3]郭晓轩.电路电磁辐射模型在硬件木马检测中的应用[D].河北工业大学, 2019.
[4]	Zhang J, Yuan F, Wei L, et al. VeriTrust: Verification for hardware trust [J]. IEEE Transactions on Computer-Aided Design of Integrated Circuits and Systems, 2015, 34(7): 1148-1161.
[5]	Guo X, Dutta R G, Mishra P, et al. Scalable SoC trust verification using integrated theorem proving and model checking [A]. //2016 IEEE International Symposium on Hardware Oriented Security and Trust (HOST) [C]: IEEE 2016:124-129.
[6]	Rathmair M, Schupfer F, Krieg C. Applied formal methods for hardware Trojan detection [A]. // 2014 IEEE International Symposium on Circuits and Systems (ISCAS) [C]: IEEE 2014:169-172.
[7]	Hu W, Mao B, Oberg J, et al. Detecting hardware trojans with gate-level information-flow tracking [J]. Computer, 2016,49(8): 44-52.
[8]胡伟，王馨慕.硬件安全威胁与防范[Z].西安；西安电子科技大学出版社. 2019
[9]覃皓.FPGA硬件木马检测的关键技术研究[D].电子科技大学,2019.
[10]	Bao C, Xie Y, Liu Y et al. Reverse engineering-based hardware trojan detection [M]. The Hardware Trojan War. Springer. 2018: 269-288.
[11]	Faezi S, Yasaei R, Barua A, et al. Brain-inspired golden chip free hardware trojan detection [J]. IEEE Transactions on Information Forensics and Security, 2021,16: 2697-2708.
[12]	Tehranipoor M, Sahnani H, Zhang X. Integrated Circuit Authentication [M]. Berlin: Springer 2018.
[13]解啸天.硬件木马设计与特征分析技术研究[D].天津大学,2018.
[14]	Xue M, Gu C5 Liu W, et al. Ten years of hardware Trojans: a survey from the attacker's perspective [J]. let Computers and Digital Techniques, 2020,14(6): 231246.
[15]	Huang Z5 Wang Q, Chen Y, et al. A Survey on Machine Learning Against Hardware in
Trojan Attacks: Recent Advances and Challenges [J]. IEEE Access, 2020, 8(99): 1079640826.
[16]	Liakos K G, Georgakilas G K, Moustakidis S, et al. Conventional and machine learning approaches as countermeasxires against hardware trojan attacks [J]. Microprocessors and Microsystems, 2020, 79.
[17]	Shakya B, He T, Salmani H, et at Benchmarking of hardware trojans and maliciously affected circuits [J]. Journal of Hardware and Systems Security, 2017, 1(1): 85-102.
[18]	Tehranipoor M, Koushanfar F. A Survey of Hardware Trojan Taxonomy and Detection [J]. IEEE Design and Test of Computers, 2010, 27(1): 10-25.
[19]	He J, Zhao Y Guo X, et al. Hardware Trojan Detection Through Chip-Free Electromagnetic Side-Channel Statistical Analysis [J]. IEEE Transactions on Very Large Scale Integration Systems, 2017, PP(10): 1-10.
[20]唐永康，胡星，苏颂，等.用于硬件木马检测的电磁辐射分析方法研究[J]. 网络与信息安全学报,2021, 7(02): 43-56.
[21]杨强，张宇，戴文渊，潘嘉林.迁移学习[M].北京：机械工业出版社，2020.
[22]	Lecun Y Bengio Y Convolutional Networks for Images, Speech, and Time-Series [J]. Handbook of Brain Theory & Neural Networks, 1995: 255-258.
[23]	Simonyan K, Zisserman A. Very deep convolutional networks for large-scale image recognition [J]. arXiv preprint arXiv:14091556,2014.
[24]杨哂哂.时频分析方法的总结与比较[D].华东师范大学,2009.
[25]	Combes J M, Grossmann A, Tchamitchian P. Mvelets: Time-Frequency Methods and Phase Space [J]. The Journal of the Acoustical Society of America, 1989,-1(5): 2477-2478.
[26]	Daubechies I.小波十讲[M].北京：人民邮电出版社，2004.
[2刀 Ceravolo R・ Time-Frequency Analysis [M]. Encyclopedia of Structural Health Monitoring, 2009.
[28]	Wyien R D. The Illustrated Wavelet Transform Handbook [J]. Biomedical Instrumentation & Technology, 2004, 38(4): 298-298.
[29]	Polikar R. The wavelet tutorial [Z]. 1996
[30]	Lilly J M, Olhede S C. Generalized Morse wavelets as a superfamily of analytic wavelets [J]. IEEE Transactions on Signal Processing, 2012, 60(11): 6036-6041.
[31]	Lilly J M. Element analysis: a wavelet-based method for analysing time-localized events in noisy time series [J]. Proceedings of the Royal Society A: Mathematical,
112
Physical and Engineering Sciences, 2017,473(2200): 20160776.
[32]	Cortes C, Wpnik V. Support-Vector Networks [J]. Machine Learning, 1995,20(3): 273-297.
[33]	Hsu C W, Chang C C, Lin C J. A Practical Guide to Support Vector Classication [J]. 2003: 1396-1400.
[34]周志华.机器学习[M].清华：清华大学出版社，2016.
[35]李航.统计学习方法[M],清华：清华大学出版社，2012.
[36]	Trust-Hub [Z]. https :〃www.trust-hub.org/.
[37]黄钊.嵌入式SoC中硬件木马检测与安全设计防御关键技术研究[D].西安 电子科技大学,2020.
113
第六章总结与展望
电磁旁路分析已经逐渐成为密码集成电路物理信息安全的严重威胁之一。密 码集成电路的电磁旁路分析与检测技术研究也逐渐成为国内外的研究热点，展现 出了巨大的学术潜力和应用价值。
6.1	论文工作总结
本文主要围绕密码集成电路电磁旁路分析的密钥恢复与硬件木马的检测技 术分别展开，重点研究了密码集成电路信息泄露的电磁分析建模、密钥多字节电 磁分析以及硬件木马的电磁旁路检测，取得的成果如下：
(1)密码集成电路信息泄露的电磁分析建模
针对密码集成电路的电磁发射泄漏与密码算法之间的关系缺乏一个通用的 模型来解释刻画的问题，深入研究了密码算法在集成电路中的工作机制，探究了 密码算法在运行时有关密钥的电磁发射源机理，根据密钥所在寄存器前后数据变 化引起的电流波动，将其用电偶极子来进行等效刻画，并建立了密码集成电路的 电磁发射模型。与此同时，近场探头用于密码集成电路电磁发射迹线的探测和采 集，通过近场探头的作用将无形的电磁发射转化为电压波形的变化从而便于进行 深层次的研究分析。对用于接收电磁波的近场探头也进行了研究，依据其等效结 构建立起了电磁接收模型。电磁发射模型是前因，电磁接收模型是后果，二者共 同构成了密码集成电路信息泄露的电磁分析模型。最后，构建了基于多元线性回 归的电磁分析模型，通过统计学多元线性回归理论来验证所提出的密码集成电路 信息泄露的电磁分析模型的正确性。
(2)基于智能算法优化的多字节电磁分析
针对传统电磁旁路分析在硬件并行实现时信息利用不足问题，通过对其原理 的探究，提出了一种多字节电磁分析的方法，在理论上为多字节电磁分析提高信 息利用率提供依据。为更好地对多字节电磁分析进行求解，引入粒子群优化算法 和遗传算法将电磁分析的密钥恢复问题转化为密钥寻优的问题，利用智能算法迭 代寻优启发式的特点在密钥搜索空间中高效地寻找出正确密钥。为了获得更快更 好的寻优结果，需要对智能算法进行改进以更适合密码算法的密钥求解。其中， 对粒子群优化算法的速度更新公式增加惯性权重，而位置更新公式则增加突变移 动以更快的搜索到正确结果；对遗传算法增加排序算子和筛选算子，排序算子将 子种群中的个体按适应度降序排列，从而使优秀的个体能够以较大的概率组合在
114
第六章总结与展望
一起生成最优候选密钥；筛选算子则通过对最优候选密钥的筛选从而挑选出正确 结果。经过改进后的智能算法在密钥的寻优上也有了极大的改善。
（3）基于迁移学习的电磁旁路硬件木马检测
针对密码集成电路的硬件木马存在着隐蔽性强，触发概率低而无法获得大量 电磁发射迹线的问题，提出了一种基于迁移学习的硬件木马检测框架，通过信号 采集、信号处理和木马检测三个步骤实现硬件木马的检测。迁移学习在放宽训练 数据限制的同时又能获得比较好的性能，同时又能够节省训练时间，非常适合用 于硬件木马的检测。根据第三章的电磁发射的泄漏基础可知硬件木马电路与标准 黄金电路电磁旁路泄漏的不同，它们之间的差异可以用来检测硬件木马电路的存 在。设计了两种不同类型的硬件木马用以检验所提出的基于迁移学习的硬件木马 检测框架的有效性。硬件木马检测的大致流程是首先采集两种类型的硬件木马在 未触发状态和激活状态四种情况的电磁发射信号，然后通过连续小波变换对采集 到的一维电磁发射信号进行时频信息的提取，并将提取到的时频信息送入到迁移 学习网络中进行检测分类。除此之外，使用支持向量机作为分类区分器替代原来 的分类器，通过迁移学习与支持向量机的结合，进一步提升硬件木马的检测分类 效果。
6.2	未来研究工作展望
虽然本文在密码集成电路电磁旁路分析与检测方面取得了一定的研究成果， 但是还有一些不足之处值得进一步的深入思考。因此，依据当前的研究现状，并 结合本文研究过程中存在的不足，对密码集成电路电磁旁路分析以后的研究可以 在以下几个方向的基础之上继续开展：
（1）目前的电磁旁路分析模型往往是基于各种假设，受限于特定的模型， 研究基于零假设的通用电磁旁路分析模型将是当前甚至未来很哀一段时间电磁 旁路分析理论和方法的主要问题和基本问题。
（2）本文提出了密码集成电路信息泄露的电磁分析模型，搭建起密码算法 中间值与电磁发射泄漏的桥梁。但是由于密码集成电路高度集成的限制，二者之 间的关系还没有精确量化，目前仅给出了二者之间的定性关系。在未来的研究当 中，应该寻求一种估算方法对信息泄露的电磁分析模型的相关参数进行估计抑或 是通过一定的手段对相关参数精确测量从而实现将模型精确量化，定量的给出密 码算法中间值与电磁发射泄漏之间的关系。
（3）本文中基于智能算法的多字节电磁分析所涉及到的AES算法并没有 采用任何的防护措施，而很多密码算法的实现往往都带有一定的防护措施，比如
115
信息隐藏、掩码、隔离等。针对带有防护方案的高阶多字节电磁分析，需要在未 来进行更深入的探究。
(4)深度学习对于特征提取和模型刻画往往具有非常好的效果，能够避免 人为因素的影响，探究深度学习与电磁旁路分析的结合，利用深度学习特征提取 和模型刻画的能力为电磁旁路分析服务将是未来的一个极有研究价值的方向。
(5)硬件木马具有形式多样、隐蔽性强和触发概率低的特点，本文中提出 的基于迁移学习的硬件木马检测方案需要没有硬件木马的标准黄金电路作为参 考，但是在实际情况中，很难获得标准黄金电路，研究无需标准黄金电路作为参 考的硬件木马检测方案在未来是一个值得研究的方向。
116
缩略语
AES	Advanced Encryption Standard	高级加密标准
CEMA	Correlation ElectroMagnetic Analysis	相关电磁分析
CMOS	Complementary-Metal-Oxide-Semiconductor	互补金属-氧化物-半导
体
CNN	Convolutional Neural Network	卷积神经网络
CRT	Cathode Ray Tube	阴极射线管
CWT	Continuous Wavelet Transform	连续小波变换
DEMA	Differential ElectroMagnetic Analysis	差分电磁分析
DES	Data Encryption Standard	数据加密标准
DRP	Dual-Rail Precharge	双轨预充电
ECC	Elliptic Curve Cryptography	椭圆曲线密码
ESS	Explained Sum of Squares	解释平方和
FC	Full Connect	全连接
FN	False Negative	假阴性
FNR	False Negative Rate	假阴率
FP	False Positive	假阳性
FPGA	Field Programmable Gate Array	现场可编程阵列
FPR	False Positive Rate	假阳率
GA	Genetic Algorithm	遗传算法
GPU	Graphics Processing Unit	图形处理单元
IL	Insert Loss	插入损耗
loE	Internet of Everything	万物互联
IP	Intellectual Property	知识产权
KKT	Karush-Kuhn-Tucher	卡罗需-库恩-塔克
LCD	Liquid Crystal Display	液晶显示器
MBEMAGA Multi-Byte	ElectroMagnetic	Analysis 基于遗传算法优化的
based on Genetic Algorithm	多字节电磁分析
MOS	Metal-Oxide-Semiconductor	金属-氧化物-半导体
NIST	National Institute of Standards and Technology	国家技术标准局
PSO	Particle Swarm Optimization	粒子群优化
117
PSO-CEMA PSO-Correlation ElectroMagnetic Analysis
基于粒子群优化算的 相关电磁分析
RSS	Residual Sum of Square	残差平方和
SEMA	Simple ElectroMagnetic Analysis	简单电磁分析
SVM	Support Vector Machine	支持向量机
TEMPEST	Test for ElectroMagnetic Propagation Emission 电磁传播发射与安全
and Secure Transmission	传输测试
TN	True Negative	真阴性
TNR	True Negative Rate	真阴率
TP	True Positive	真阳性
TPR	True Positive Rate	真阳率
TSS	Total Sum of Squares	总离差平方和
ZVM	Zero-Value Model	零值模型
118
